<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Linux Foundation Certified System Administrator (LFCS) Exam Personal Notes </title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Linux Foundation Certified System Administrator (LFCS) Exam Personal Notes </h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/giulianopz/lfcs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>These are my personal notes to prepare for the <a href="https://training.linuxfoundation.org/certification/linux-foundation-certified-sysadmin-lfcs/#exams">LFCS</a> exam.</p>
<p>This book consists of a detailed guide for each topic in the official checklist of domains the candidates are requested to master in order to pass the exam.</p>
<p>These notes has been collected from a wide range of <a href="./references.html">sources</a> available on the web and partially re-elaborated by me, plus some additional topics of interest for a developer/sysadmin (still in progress): even if you are not interested in the certification at all (but curious about <code>*nix</code> systems), you may nevertheless find useful the guides in the first domain (<em>Essential Commands</em>) since they cover the very basic commands to work inside a bash shell.</p>
<p>Please, note that I took into consideration only Ubuntu (18.04/20.04) as exam environment. Things can be different in CentOS.</p>
<p align="center"><img src="https://images.youracclaim.com/images/1e6611ca-8afe-4ecc-ad4d-305fba52ee7e/1_LFCS-600x600.png" width="300" height="300"/></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="1-essential-commands---25"><a class="header" href="#1-essential-commands---25">1. Essential Commands - 25%</a></h1>
<ul>
<li><a href="1-essential-commands/./a.html">Log into local &amp; remote graphical and text mode consoles</a></li>
<li><a href="1-essential-commands/./b.html">Search for files</a></li>
<li><a href="1-essential-commands/./c.html">Evaluate and compare the basic file system features and options</a></li>
<li><a href="1-essential-commands/./d.html">Compare and manipulate file content</a></li>
<li><a href="1-essential-commands/./e.html">Use input-output redirection</a></li>
<li><a href="1-essential-commands/./f.html">Analyze text using basic regular expressions</a></li>
<li><a href="1-essential-commands/./g.html">Archive, backup, compress, unpack, and uncompress files</a></li>
<li><a href="1-essential-commands/./h.html">Create, delete, copy, and move files and directories</a></li>
<li><a href="1-essential-commands/./i.html">Create and manage hard and soft links</a></li>
<li><a href="1-essential-commands/./l.html">List, set, and change standard file permissions</a></li>
<li><a href="1-essential-commands/./m.html">Read, and use system documentation</a></li>
<li><a href="1-essential-commands/./n.html">Manage access to the root account</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h2 id="log-into-local--remote-graphical-and-text-mode-consoles"><a class="header" href="#log-into-local--remote-graphical-and-text-mode-consoles">Log into local &amp; remote graphical and text mode consoles</a></h2>
<p>Console and terminal are closely related. Originally, they meant a piece of equipment through which you could interact with a computer: in the early days of unix, that meant a teleprinter-style device resembling a typewriter, sometimes called a teletypewriter, or <strong>tty</strong> in shorthand. The name <em>terminal</em> came from the electronic point of view, and the name <em>console</em> from the furniture point of view.</p>
<p>For a quick historical overview look <a href="https://www.computernetworkingnotes.com/linux-tutorials/linux-virtual-console-and-terminal-explained.html">here</a> and <a href="https://askubuntu.com/questions/506510/what-is-the-difference-between-terminal-console-shell-and-command-line">here</a>.</p>
<p>Long story short, in modern terminology:</p>
<ul>
<li>a <strong>terminal</strong> is in Unix a textual input/output handling device, but the term is more often used for pseudo-terminals (pts) that allows us to access and use the shell (e.g. terminal emulators Konsole on KDE)</li>
<li>a <strong>console</strong> was originally a physical terminal device connected with Linux system on serial port via serial cable physically, but now by <em>virtual console</em> is meant an app which simulates a physical terminal (on Unix-like systems, such as Linux and FreeBSD, the console appears as several terminals (ttys) accessed via spacial keys combinations)</li>
<li>a <strong>shell</strong> is a command line interpreter (e.g. bash) invoked when a user logs in, whose primary purpose is to start other programs.</li>
</ul>
<hr />
<p>To log into:</p>
<ul>
<li>
<p>a local environment in GUI mode you must provide, when prompted, username and password</p>
</li>
<li>
<p>a local environment in text/console mode (tty), start your computer and immediately after the BIOS/UEFI splash screen, press and hold the <code>Shift</code> (BIOS), or press the <code>Esc</code> (UEFI) key repeatedly, to access the GRUB menu. Once you see the GNU GRUB screen, with the first entry from the menu selected, press the <code>e</code> key. This allows you to edit the kernel parameters before booting. Look for the line that begins with <code>linux</code> (use the Up / Down / Left / Right arrow keys to navigate); <code>vmlinuz</code> should also be on the same line. At the end of this line (you can place the cursor using the arrow keys at the beginning of the line, then press the <code>End</code> key to move the cursor to the end of that line) add a space followed by the number <code>3</code>. Don't change anything else. This <code>3</code> represents the <strong>multi-user.target</strong> systemd target which is mapped to the old, now obsolete runlevel 2, 3 and 4 (used to start and stop groups of services). For example the old runlevel 5 is mapped to the systemd <strong>graphical.target</strong> and using this starts the graphical (GUI) target. After doing this, press <code>Ctrl+x</code> or <code>F10</code> to boot to console (text) mode. To reboot your system while in console mode, use the reboot command (<code>sudo reboot now</code>).</p>
</li>
</ul>
<blockquote>
<p>This is how the line beginning with "linux" looks like for Ubuntu 18.04 LTS:
<code>linux      /boot/vmlinuz-4.18.0-15-generic root=UUID=1438eb20-da3d-4880-bb3a-414e+++0a929 ro quiet splash $vt_handoff 3</code></p>
</blockquote>
<ul>
<li>
<p>a remote text environment as a full login session you can use <strong>ssh</strong>:
<code>ssh -i &lt;*rsa.pub&gt; -p &lt;9199&gt; username@host -t "exec bash"</code></p>
</li>
<li>
<p>a remote environment in GUI mode you can use <code>ssh -X</code> to enable X11 forwarding or a remote desktop client for a full graphical interface (by default, Ubuntu comes with <strong>Remmina</strong> remote desktop client with support for VNC and RDP protocols).</p>
</li>
</ul>
<hr />
<p>Once logged command <code>w</code> can be used to show who is logged and what they are doing:</p>
<pre><code>[root@localhost ~]# w
23:41:16 up 2 min,  2 users,  load average: 0.02, 0.02, 0.01
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
root     tty1                      23:40   60.00s  0.01s  0.01s -bash
root     pts/0    192.168.0.34     23:41    1.00s  0.02s  0.00s w
</code></pre>
<p>The first column shows which user is logged into system and the second one to which terminal.
In the second column:</p>
<ul>
<li>for virtual consoles in terminal is showed <code>tty1</code>, <code>tty2</code> etc.</li>
<li>for ssh remote sessions (pseudo-terminal salve) in terminal is showed <code>pts/0</code>, <code>pts/1</code> etc.</li>
<li><code>:0</code> is for a X11 server namely used for graphical login sessions.</li>
</ul>
<p>The usual method of command-line access in Ubuntu is to start a terminal (with <code>Ctrl+t</code> usually, or <code>F12</code> if you are using a Guake-like drop-down terminal emulator, such as Yakuake on KDE), however sometimes it's useful to switch to the real console:</p>
<ul>
<li>use the <code>Ctrl-Alt-F1</code> shortcut keys to switch to the first console.</li>
<li>to switch back to Desktop mode, use the <code>Ctrl-Alt-F7</code> shortcut keys.</li>
</ul>
<p>There are six consoles available. Each one is accessible with the shortcut keys <code>Ctrl-Alt-F1</code> to <code>Ctrl-Alt-F6</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="search-for-files"><a class="header" href="#search-for-files">Search for files</a></h2>
<p>Find files with depth 3 and size above 2 mb:
<code>find . -maxdepth 3 -type f -size +2M</code></p>
<p>Find files with permission 777 and remove them:
<code>find /home/user -perm 777 -exec rm '{}' +</code></p>
<blockquote>
<p>Using <code>-exec</code> with a semicolon (eg. "find . -exec ls '{}' ;"), will execute the command separately for each argument passed, while using a plus sign instead (e.g "find . -exec ls '{}' +"), as many arguments as possible are passed to a single command: if the number of arguments exceeds the system's maximum command line length, the command will be called multiple times.</p>
</blockquote>
<p>Find files based on how many times they have been accessed (<code>-atime n</code>) or modified (<code>-mtime n</code>) (with <code>n</code> = n*24 hours ago):
<code>find /etc -iname "*.conf" -mtime -180 –print</code></p>
<p>To combine two conditions:
<code>find . \( -name name1 -o -name name2 \)</code></p>
<p>To negate a condition:
<code>find . \! -user owner</code></p>
<p>To search for a filename ignoring the case:
<code>find . -iname name</code></p>
<p>Find all files with at least (<code>-</code> sign before <code>g</code> in this example) permission write for group:
<code>find . -perm -g=w</code></p>
<p>Boolean conditions for searching by permission mode:</p>
<ul>
<li><code>-perm mode</code>: file's permission bits are exactly mode (octal or symbolic)</li>
<li><code>-perm -mode</code>: all of the permission bits mode are set for the file</li>
<li><code>-perm /mode</code>: any of the permission bits mode are set for the file.</li>
</ul>
<p>Audit a system to find files with root SUID/SGID:
<code>sudo find / -user root \( -perm 4000 -o -perm 2000 \) -print</code></p>
<p>Remove a file by inode:
<code>find . -maxdepth 1 -type f -inum 7404301 -delete</code></p>
<p>Combine find and grep:
<code>find . -name "*.md" -exec grep -Hni --color=always inode {} \;</code></p>
<p>Alternatively, you can use the <code>locate</code> command, which searches for a given pattern through a database file that is generated by the <code>updatedb</code> command. The found results are displayed on the screen, one per line.</p>
<p>During the installation of the <code>mlocate</code> package, a cron job is created that runs the updatedb command every 24 hours. This ensures the database is regularly updated. For more information about the cron job check the /etc/cron.daily/mlocate file.</p>
<p>The syntax for the locate command is as follows:
<code>locate [OPTION] PATTERN</code></p>
<p>For example to search for a file named <em>.bashrc</em> you would type:
<code>locate .bashrc</code></p>
<p>Compared to the more powerful find command that searches the file system, locate operates much faster but can search only for entries present in its cache.</p>
<hr />
<h3 id="file-globbing"><a class="header" href="#file-globbing">File Globbing</a></h3>
<p><em>File globbing</em> is a feature provided by the UNIX/Linux shell to represent multiple filenames by using special characters called wildcards with a single file name. Long ago, in UNIX V6, there was a program /etc/glob that would expand wildcard patterns. Soon afterward this became a shell built-in.</p>
<p>A wildcard is essentially a symbol which may be used to substitute for one or more characters. Therefore, we can use wildcards for generating the appropriate combination of file names as per our requirement.</p>
<p>Use <code>*</code> to mean "every character": <code>ls -l a*</code></p>
<p>Use <code>?</code> for a single character: <code>ls -l a?</code></p>
<p>Use square brackets to declare a set of characters: <code>ls -l a[ab]</code></p>
<p>Wildcards can be combined: <code>ls -l a[a-c]*</code></p>
<p>Use curly braces to consider any listed element: <code>mkdir /etc/{public,private,protected}</code></p>
<p><code>!</code> is used to exclude characters from the list that is specified within the square brackets: <code>ls /lib[!x]*</code></p>
<blockquote>
<p>Note: Beware that the syntax for excluding specific characters is slightly different with regex: you have to use the square brackets and the ^ (hat). For example, the pattern <code>[^abc]</code> will match any single character except for the letters <code>a</code>, <code>b</code>, or <code>c</code>.</p>
</blockquote>
<p>Named character classes ([[:named:]]) are used inside brackets to represent an entire class of chars. Their interpretation depends on the LC_CTYPE locale. Some of them are listed below:</p>
<ul>
<li>‘[:alnum:]', prints all those files having alphabets and digits, both lower and uppercases are considered.</li>
<li>‘[:alpha:]', prints all those files having alphabets only, both lower and uppercases are considered.</li>
<li>‘[:digit:]', prints all those files having digits.</li>
<li>‘[:lower:]', prints all those files having lower-case letters.</li>
<li>‘[:punct:]', prints all those files having punctuation characters, will search for ! ” # $ % &amp; ‘ ( ) * + , – . / : ; &lt; = &gt; ? @ [ \ ] ^ _ ` { | } ~.</li>
<li>‘[:space:]', prints all those files having space characters.</li>
<li>‘[:upper:]', prints all those files having lower-case letters.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h2 id="evaluate-and-compare-the-basic-file-system-features-and-options"><a class="header" href="#evaluate-and-compare-the-basic-file-system-features-and-options">Evaluate and compare the basic file system features and options</a></h2>
<p>Print out disk free space in a human readable format:
<code>df -h</code></p>
<p>See which file system type each partition is:
<code>df -T</code></p>
<p>See more details with <code>file</code> command about individual devices:
<code>file -sL /dev/sda1</code></p>
<p>Or: <code>sudo fdisk -l /dev/sda1</code></p>
<p>File system fatures:</p>
<ul>
<li><strong>ext</strong>, "Extended Filesystem", old, deprecated</li>
<li><strong>ext2</strong>, no journaling, max file size 2TB, lower writes to disk = good for USB sticks etc</li>
<li><strong>ext3</strong>, journaling (journal, ordered, writeback), max file size 2TB; journaling, i.e. file changes and metadata are written to a journal before being committed; if a system crashes during an operation, the journal can be used to bring back the system files quicker with lower likeliness of corrupted files</li>
<li><strong>ext4</strong>, from 2008, supports up to 16TB file size, can turn off journaling optionally</li>
<li><strong>fat</strong>, from Microsoft, no journaling, max file size 4 GB</li>
<li><strong>tmpfs</strong>, temporary file system used on many Unix-like filesystems, mounted and structured like a disk-based filesystem, but resides in volatile memory space, similar to a RAM disk</li>
<li><strong>xfs</strong>, excels at parallel I/O, data consistency, and overall filesystem performance, well suited for real-time applications, due to a unique feature which allows it to maintain guaranteed data I/O bandwidth, originally created to support extremely large filesystems with sizes of up to 16 exabytes and file sizes of up to 8 exabytes</li>
<li><strong>btrfs</strong>, a copy-on-write filesystem for Linux aimed at implementing advanced features while focusing on fault tolerance, repair, and easy administration, although it has some features that make it <a href="https://btrfs.wiki.kernel.org/index.php/FAQ#Is_btrfs_stable.3F">unstable</a>.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h2 id="compare-and-manipulate-file-content"><a class="header" href="#compare-and-manipulate-file-content">Compare and manipulate file content</a></h2>
<p>Create a file: <code>touch &lt;filename&gt;</code></p>
<p>Or: <code>echo "you've got to hide your love away" &gt; filename</code></p>
<p>Compare two files: <code>diff &lt;file1&gt; &lt;file2&gt;</code></p>
<p>Compare two dirs: <code>diff -ur &lt;dir1&gt; &lt;dir2&gt;</code></p>
<p>Report or remove repeated lines: <code>uniq &lt;filename&gt;</code></p>
<p>Sort lines by reverse numeric order: <code>ps aux | sort -k2 -r -n</code></p>
<p>Print second and third columns from file using comma as a field separator: <code>cut -d ',' -f 2,3 &lt;file.csv&gt;</code></p>
<p>Replace comma with semicolon as field separator: <code>tr ',' ';' &lt; &lt;file.csv&gt;</code></p>
<p>Replace all consecutive occurrences of space with a single space: <code>cat file | tr -s ' '</code></p>
<p>Print file with line numbers: <code>nl -ba &lt;filename&gt;</code></p>
<p>Count lines in a file: <code>wc -l &lt;filename&gt;</code></p>
<p>Identify the type of a file:</p>
<pre><code>file &lt;file&gt;.csv 
&lt;file&gt;.csv: CSV text
</code></pre>
<p>Display text both in character and octal format: <code>od -bc &lt;filename.txt&gt;</code></p>
<blockquote>
<p>Tip: Useful for debugging texts for unwanted chars or to visualize data encoded in a non-human readable format (e.g. a binary file).</p>
</blockquote>
<p>Change file name (<code>-n</code> for dry-run): <code>rename -n "s/cat/dog/g" cat.txt</code></p>
<p>Apply uniform spacing between words and sentencese: <code>fmt -u &lt;filename&gt;</code></p>
<p>Merge file side by side: <code>paste &lt;file1&gt; &lt;file2&gt;</code></p>
<p>Paginate a file for printing: <code>pr &lt;filename&gt;</code></p>
<p>Join two files which have a common join field:</p>
<pre><code>cat foodtypes.txt
&gt;1 Protein
&gt;2 Carbohydrate
&gt;3 Fat

cat foods.txt
&gt;1 Cheese 
&gt;2 Potato
&gt;3 Butter

join foodtypes.txt foods.txt
&gt;1 Protein Cheese
&gt;2 Carbohydrate Potato
&gt;3 Fat Butter
</code></pre>
<p>To join files using different fields, the <code>-1</code> and <code>-2</code> flags (or <code>-j</code> if it's the same char or position) options can be passed to join:</p>
<pre><code>cat wine.txt
&gt;Red Beaunes France
&gt;White Reisling Germany
&gt;Red Riocha Spain

cat reviews.txt
&gt;Beaunes Great!
&gt;Reisling Terrible!
&gt;Riocha Meh

join -1 2 -2 1 wine.txt reviews.txt
&gt;Beaunes Red France Great!
&gt;Reisling White Germany Terrible!
&gt;Riocha Red Spain Meh
</code></pre>
<p>Join expects that files will be sorted before joining, so you have to sort them if the lines are not in the right order:
<code>join -1 2 -2 1 &lt;(sort -k 2 wine.txt) &lt;(sort reviews.txt)</code></p>
<p>Split a file into N files based on size of input: <code>split -n &lt;x&gt; &lt;filename&gt;</code></p>
<p>Use <code>expand</code> or <code>unexpand</code> to convert from tabs to the (equivalent number of) spaces and viceversa.</p>
<p>To tabs N characters apart, instead of the default of 8: <code>expand --tabs=&lt;n&gt; &lt;filename&gt;</code></p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="use-input-output-redirection"><a class="header" href="#use-input-output-redirection">Use input-output redirection</a></h2>
<p>When bash starts it opens the three standard file descriptors (/dev/fd/*): <strong>stdin</strong> (file descriptor 0), <strong>stdout</strong> (file descriptor 1), and <strong>stderr</strong> (file descriptor 2). A <strong>file descriptor</strong> (fd) is a number which refers to an open file. Each process has its own private set of fds, but fds are inherited by child processes from the parent process.</p>
<p>File descriptors always point to some file (unless they're closed). Usually when bash starts all three file descriptors, stdin, stdout, and stderr, point to your terminal. The input is read from what you type in the terminal and both outputs are sent to the terminal.</p>
<p>In fact, an open terminal in a Unix-based operating system is usually itself a file, commonly stored in /dev/tty0. When a new session is opened in parallel with an existing one, the new terminal will be /dev/tty1 and so on. Therefore, initially the three file descriptor all point to the file representing the terminal in which they are executed.</p>
<hr />
<p>Redirect the standard output of a command to a file: <code>command &gt;file</code></p>
<p>Writing <code>command &gt;file</code> is the same as writing <code>command 1&gt;file</code>. The number 1 stands for stdout, which is the file descriptor number for standard output.</p>
<p>Redirect the standard error of a command to a file: <code>command 2&gt;file</code></p>
<p>Redirect both standard output and standard error to a file: <code>command &amp;&gt;file</code></p>
<p>This is bash's shortcut for quickly redirecting both streams to the same destination. There are several ways to redirect both streams to the same destination. You can redirect each stream one after another: <code>command &gt;file 2&gt;&amp;1</code></p>
<p>This is a much more common way to redirect both streams to a file. First stdout is redirected to file, and then stderr is duplicated to be the same as stdout. So both streams end up pointing to file.</p>
<blockquote>
<p>Warning: This is not the same as writing: <code>command 2&gt;&amp;1 &gt;file</code>. The order of redirects matters in bash! This command redirects only the standard output to the file. The stderr will still be printed to the terminal.</p>
</blockquote>
<p>Discard the standard output of a command: <code>command &gt; /dev/null</code></p>
<p>Similarly, by combining the previous one-liners, we can discard both stdout and stderr by doing: <code>command &gt;/dev/null 2&gt;&amp;1</code></p>
<p>Or just simply: <code>command &amp;&gt;/dev/null</code></p>
<p>Redirect the contents of a file to the stdin of a command: <code>grep [pattern] &lt; [file]</code></p>
<p>Redirect a bunch of text to the stdin of a command with the <strong>here-document</strong> redirection operator <strong>&lt;&lt;EOF</strong> ('EOF' can be any placeholder of your choice):</p>
<pre><code>grep 'ciao' &lt;&lt;EOF  
hello
halo
ciao
EOF
</code></pre>
<p>This operator instructs bash to read the input from stdin until a line containing only 'EOF' is found. At this point bash passes the all the input read so far to the stdin of the command.</p>
<p>Redirect a single line of text to the stdin of a command: <code>grep ciao &lt;&lt;&lt; $'hello\nhalo\nciao'</code></p>
<blockquote>
<p>Note: <code>$'[text]'</code> allows to replace <code>\n</code> with a newline before passing the whole string to the command, <code>$"[text]"</code> won't do it.</p>
</blockquote>
<blockquote>
<p>Note: This is equivalent to pipe the result of a command to the another one: <code>echo "some text here" | grep "a pattern"</code></p>
</blockquote>
<blockquote>
<p>Note: It's also possible to pass text instead of a file by means of 'process substitution': <code>find . | grep -f &lt;(echo "somefile")</code></p>
</blockquote>
<p>Send stdout and stderr of one process to stdin of another process: <code>command1 |&amp; command2</code></p>
<p>This works on bash versions starting 4.0. As the new features of bash 4.0 aren't widely used, the old, and more portable way to do the same is:
<code>command1 2&gt;&amp;1 | command2</code></p>
<p>Use <code>exec</code> to manipulate channels over ranges of commands:</p>
<pre><code>exec &lt; file # STDIN has become file
exec &gt; file # STDOUT has become file
</code></pre>
<p>You may wish to save STDIN and STDOUT to restore them later:</p>
<pre><code>exec 7&lt;&amp;0 # saved STDIN as channel 7
exec 6&gt;&amp;1 # saved STDOUT as channel 6
</code></pre>
<p>If you want to log all output from a segment of a script, you can combine these together:</p>
<pre><code>exec 6&gt;&amp;1       # saved STDOUT as channel 6
exec &gt; LOGFILE  # all further output goes to LOGFILE
# put commands here
exec 1&gt;&amp;6       # restores STDOUT; output to console again
</code></pre>
<p>A more detailed explanation <a href="https://catonmat.net/bash-one-liners-explained-part-three">here</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="analyze-text-using-basic-regular-expressions"><a class="header" href="#analyze-text-using-basic-regular-expressions">Analyze text using basic regular expressions</a></h2>
<p>A regular expression (shortened as <strong>regex</strong>) is a sequence of characters that specifies a search pattern. For an overview on regular expressions, look <a href="https://www.regular-expressions.info/quickstart.html">here</a>. <a href="https://regexone.com/">Here</a> you can find an interactive tutorial to learn the basic of regex syntax.</p>
<p>Common regex characters:</p>
<div class="table-wrapper"><table><thead><tr><th>Symbol</th><th>Function</th></tr></thead><tbody>
<tr><td><code>.</code></td><td>matches any single character (except newlines, normally)</td></tr>
<tr><td><code>\</code></td><td>escape a special character (e.g. <code>\.</code> matches a literal dot)</td></tr>
<tr><td><code>?</code></td><td>the preceding character may or may not be present (e.g. <code>/hell?o/</code> would match <code>hello</code> or <code>helo</code>)</td></tr>
<tr><td><code>*</code></td><td>any number of the preceding character is allowed (e.g. <code>.*</code> will match any single-line string, including an empty string, and gets used a lot)</td></tr>
<tr><td><code>+</code></td><td>one or more of the preceding character (<code>.+</code> is the same as <code>.*</code> except that it won't match an empty string)</td></tr>
<tr><td>`</td><td>`</td></tr>
<tr><td><code>()</code></td><td>group a section together, this can be useful for conditionals (`(a</td></tr>
<tr><td><code>{}</code></td><td>specify how many of the preceding character (e.g. <code>a{12}</code> matches 12 <code>a</code>s in a row)</td></tr>
<tr><td><code>[]</code></td><td>match any character in this set. - defines ranges (e.g. <code>[a-z]</code> is any lowercase letter), <code>^</code> means "not" (e.g. <code>[^,]+</code> match any number of non-commas in a row)</td></tr>
<tr><td><code>^</code></td><td>beginning of line</td></tr>
<tr><td><code>$</code></td><td>end of line</td></tr>
</tbody></table>
</div>
<p>The three major dialects every programmer should know are:</p>
<ul>
<li>basic regular expressions (BRE)</li>
<li>extended regular expressions (ERE)</li>
<li>Perl-compatible regular expressions (PCRE).</li>
</ul>
<p>Essentials text stream processing tools to use in conjunction with regex patterns are:</p>
<ul>
<li><strong>grep</strong>, filters its input against a pattern;</li>
<li><strong>sed</strong>, applies transformation rules to each line; and</li>
<li><strong>awk</strong>, manipulates an ad hoc database stored as text, e.g. CSV files.</li>
</ul>
<h3 id="1-grep"><a class="header" href="#1-grep">1. grep</a></h3>
<p>The <code>grep</code> tool can filter a file, line by line, against a pattern. By default, grep uses basic regular expressions (BRE). BRE differs syntactically in several key ways. Specifically, the operators <code>{}</code>, <code>()</code>, <code>+</code>, <code>|</code> and <code>?</code> must be escaped with <code>\</code>.</p>
<p>Useful grep flags:</p>
<ul>
<li><code>-v</code>, inverts the match</li>
<li><code>--color(==always)</code>, colors the matched text</li>
<li><code>-F</code>, interprets the pattern as a literal string</li>
<li><code>-H</code>, <code>-h</code>, prints (or doesn't print) the matched filename</li>
<li><code>-i</code>, matches case insensitively</li>
<li><code>-l</code>, prints names of files that match instead</li>
<li><code>-n</code>, prints the line number</li>
<li><code>-w</code>, forces the pattern to match an entire word</li>
<li><code>-x</code>, forces patterns to match the whole line.</li>
</ul>
<p>The <code>egrep</code> tool is identical to grep, except that it uses extended regular expressions (actually, equivalent to <code>grep -E</code>). Extended regular expressions are identical to basic regular expressions, but the operators <code>{}</code>, <code>()</code>, <code>+</code>, <code>|</code> and <code>?</code> should not be escaped.</p>
<p>PCREs can be used by means of the <code>-P</code> flag of <code>grep</code>. Perl has a richer and more predictable syntax than even the extended regular expressions syntax.</p>
<blockquote>
<p>Tip: If you have a choice, always use Perl-style regex.</p>
</blockquote>
<p>Examples:</p>
<pre><code># search for a string in one or more files
----------------------------------------
grep 'fred' /etc/passwd                             # search for lines containing 'fred' in /etc/passwd
grep fred /etc/passwd                               # quotes usually not when you don't use regex patterns
grep null *.scala                                   # search multiple files

# case-insensitive
----------------
grep -i joe users.txt                               # find joe, Joe, JOe, JOE, etc.

# regular expressions
-------------------
grep '^fred' /etc/passwd                            # find 'fred', but only at the start of a line
grep '[FG]oo' *                                     # find Foo or Goo in all files in the current dir
grep '[0-9][0-9][0-9]' *                            # find all lines in all files in the current dir with three numbers in a row

# display matching filenames, not lines
-------------------------------------
grep -l StartInterval *.plist                       # show all filenames containing the string 'StartInterval'

# show matching line numbers
--------------------------
grep -n we gettysburg-address.txt                   # show line numbers as well as the matching lines

# lines before and after grep match
---------------------------------
grep -B5 "the living" gettysburg-address.txt        # show all matches, and five lines before each match
grep -A10 "the living" gettysburg-address.txt       # show all matches, and ten lines after each match
grep -B5 -A5 "the living" gettysburg-address.txt    # five lines before and ten lines after

# invert the sense of matching
-------------------
grep -v fred /etc/passwd                            # find any line *not* containing 'fred'
grep -vi fred /etc/passwd                           # same thing, case-insensitive

# grep in a pipeline
------------------
ps aux | grep httpd                                 # all processes containing 'httpd'
ps aux | grep -i java                               # all processes containing 'java', ignoring case
ls -al | grep '^d'                                  # list all dirs in the current dir

# search for multiple patterns
----------------------------
egrep 'apple|banana|orange' *                       # search for multiple patterns, all files in current dir

# grep + find
-----------
find . -type f -exec grep -il 'foo' {} \;           # print all filenames of files under current dir containing 'foo', case-insensitive

# recursive grep search
---------------------
grep -rl 'null' .                                   # similar to the previous find command; does a recursive search
grep -ril 'null' /home/al/sarah /var/www            # search multiple dirs
egrep -ril 'aja|alvin' .                            # multiple patterns, recursive

# grep gzipped files
---------------
zgrep foo myfile.gz                                 # all lines containing the pattern 'foo'
zgrep 'GET /blog' access_log.gz                     # all lines containing 'GET /blog'
zgrep 'GET /blog' access_log.gz | less              # same thing, case-insensitive

# submatch backreferences to print out words that repeat themselves:
---------------
grep '^\(.*\)\1$' /usr/share/dict/words             # prints "beriberi, bonbon, cancan, ..."

# match text after a string, but excluding this string from the captured text (so called, "positive look-behind")
---------------
grep -P '(?&lt;=name=)[ A-Za-z0-9]*' filename
</code></pre>
<p>For grep advanced features, look <a href="https://caspar.bgsu.edu/~courses/Stats/Labs/Handouts/grepadvanced.htm">here</a>.</p>
<h3 id="2-sed"><a class="header" href="#2-sed">2. sed</a></h3>
<p><code>sed</code> is a "stream editor", which reads a file line-by-line, conditionally applying a sequence of operations to each line and (possibly) printing the result.</p>
<p>By default, sed uses basic regular expression syntax. To use the (more comfortable) extended syntax, supply the flag <code>-E</code>.</p>
<p>Most sed programs consist of a single sed command: substitute (<code>s</code>). But a proper sed program is a sequence of sed commands. Most sed commands have one of three forms:</p>
<ul>
<li><em>operation</em>, apply this operation to the current line</li>
<li><em>address operation</em>, apply this operation to the current line if at the specified address</li>
<li><em>address1,address2 operation</em>, apply this operation to the current line if between the specified addresses.</li>
</ul>
<p>Useful operations:</p>
<ul>
<li><code>{ operation1 ; ... ; operationN }</code>, executes all of the specified operations, in order, on the given address</li>
<li><code>s/pattern/replacement/arguments</code>, replaces instances of pattern with replacement according to the arguments in the current line (in the replacement, <code>\n</code> stands for the nth submatch, while <code>&amp;</code> represents the entire match)</li>
<li><code>b</code>, branches to a label, and if none is specified, then sed skips to processing the next line (think of this as a break operation)</li>
<li><code>y/from/to/</code>, transliterates the characters in "from" to their corresponding character in "to"</li>
<li><code>q</code>, quits sed</li>
<li><code>d</code>, deletes the current line</li>
<li><code>w</code>, file writes the current line to the specified file.</li>
</ul>
<p>Common arguments to the substitute operation:</p>
<ul>
<li>the most common argument to the substitute command is <code>g</code>, which means "globally" replace all matches on the current line, instead of just the first</li>
<li><code>n</code>, tells sed to replace the nth match only, instead of the first</li>
<li><code>p</code>, prints out the result if there is a substitution</li>
<li><code>i</code>, ignores case during the match</li>
<li><code>w file</code>, writes the current line to file.</li>
</ul>
<p>Useful flags:</p>
<ul>
<li><code>-n</code> suppresses automatic printing of each result; to print a result, use command <code>p</code>.</li>
<li><code>-f filename</code> uses the given file as the sed program.</li>
</ul>
<p>Examples:</p>
<pre><code>sed -n '1,13p;40p' &lt;file&gt;
sed '12q' &lt;file&gt;
sed -n '1,+4p' &lt;file&gt;
sed -n '1~5p' &lt;file&gt;   # "first~step" pattern matches a line every 5 lines starting from the first line
sed '1,3d' &lt;file&gt;   # deletes the first 3 lines from stdout (to overwrite the source file, use '-i' flag or '-i.bck' to backup the original file)
# do not use '-n' with (d), otherwise the original file wil be overriden with the empty stdout
sed '/pattern/d' &lt;file&gt; # delete all the lines matched by the given pattern
sed 's/up/down/' &lt;file&gt; # substitues the first occurence matched by the pattern on every line
sed 's/up/down/2' &lt;file&gt; # substitues only the second occurence on a line
sed -n 's/up/down/2p' &lt;file&gt;    # to see which lines would be modified
sed 's/^.*at/(&amp;)/' &lt;file&gt;   # wraps the matched text into parentheses
sed -E 's/([A-Z][a-z]*), ([A-Z][a-z]*( [A-Z][a-z]*[.]?)?)/\2 \1/g' &lt;file&gt;  # use '\n' to reference the groups in the regex pattern
&gt;Might, Matthew B.
&gt;Matthew B. Might
</code></pre>
<h3 id="3-awk"><a class="header" href="#3-awk">3. awk</a></h3>
<p>The <code>awk</code> command provides a more traditional programming language for text processing than <code>sed</code>. Those accustomed to seeing only hairy awk one-liners might not even realize that awk is a real programming language.</p>
<p>The major difference in philosophy between awk and sed is that awk is record-oriented rather than line-oriented. Each line of the input to awk is treated like a delimited record. The awk philosophy melds well with the Unix tradition of storing data in ad hoc line-oriented databases, e.g., /etc/passwd. The command line parameter <code>-F regex</code> sets the regular expression <em>regex</em> to be the field delimiter.</p>
<p>An awk program consists of pattern-action pairs: <code>pattern { statements }</code>, followed by an (optional) sequence of function definitions.</p>
<p>In fact, an action is optional, and a pattern by itself is equivalent to: <code>pattern { print }</code>. As each record is read, each pattern is checked in order, and if it matches, then the corresponding action is executed.</p>
<p>The form for function defintion is: <code>function name(arg1,...,argN) { statements }</code></p>
<p>The patterns can have forms such as:</p>
<ul>
<li><code>/regex/</code>, which matches if the regex matches something on the line</li>
<li><code>expression</code>, which matches if expression is non-zero or non-null</li>
<li><code>pattern1, pattern2</code>, a range pattern which matches all records (inclusive) between <em>pattern1</em> and <em>pattern2</em></li>
<li><code>BEGIN</code>, which matches before the first line is read</li>
<li><code>END</code>, which matches after the last line is read.</li>
</ul>
<p>Some implementations of awk, like <code>gawk</code>, provide additional patterns:</p>
<ul>
<li><code>BEGINFILE</code>, which matches before a new file is read</li>
<li><code>ENDFILE</code>, which matches after a file is read.</li>
</ul>
<p>A basic awk expression is either:</p>
<ul>
<li>a special variable (<code>$1</code> or <code>NF</code>)</li>
<li>a regular variable (<code>foo</code>)</li>
<li>a string literal (<code>"foobar"</code>)</li>
<li>a numeric constant (<code>3</code>, <code>3.1</code>)</li>
<li>a regex constant (<code>/foo|bar/</code>).</li>
</ul>
<p>There are several special variables in AWK:</p>
<div class="table-wrapper"><table><thead><tr><th>Variable</th><th>Meaning</th></tr></thead><tbody>
<tr><td>$0</td><td>the entire text of the matched record</td></tr>
<tr><td>$n</td><td>the nth entry in the current record</td></tr>
<tr><td>FILENAME</td><td>name of current file</td></tr>
<tr><td>NR</td><td>number of records seen so far</td></tr>
<tr><td>FNR</td><td>number of records so far in this file</td></tr>
<tr><td>NF</td><td>number of fields in current record</td></tr>
<tr><td>FS</td><td>input field delimiter, defaults to whitespace</td></tr>
<tr><td>RS</td><td>record delimiter, defaults to newline</td></tr>
<tr><td>OFS</td><td>output field delimiter, defaults to space</td></tr>
<tr><td>ORS</td><td>output record delimiter, defaults to newline</td></tr>
</tbody></table>
</div>
<p>awk is a small language, with only a handful of forms for statements.</p>
<p>The man page lists all of them:</p>
<ul>
<li>if (expression) statement [ else statement ]</li>
<li>while (expression) statement</li>
<li>for (expression; expression; expression) statement</li>
<li>for (var in array) statement</li>
<li>do statement while (expression)</li>
<li>break</li>
<li>continue</li>
<li>{ [ statement ... ] }</li>
<li>expression</li>
<li>print [ expression-list ] [ &gt; expression ]</li>
<li>printf format [ , expression-list ] [ &gt; expression ]</li>
<li>return [ expression ]</li>
<li>next</li>
<li>nextfile</li>
<li>delete array[expression]</li>
<li>delete array</li>
<li>exit [ expression ]</li>
</ul>
<p>The most common statement is <code>print</code>, which is equivalent to <code>print $0</code>.</p>
<p>Useful flags:</p>
<ul>
<li><code>-f filename</code>, uses the provided file as the awk program</li>
<li><code>-F regex</code>, sets the input field separator</li>
<li><code>-v var=value</code>, sets a global variable (multiple <code>-v</code> flags are allowed).</li>
</ul>
<p>Examples:</p>
<pre><code>ps aux | awk '{print $1}'   # prints the first column
ps aux | awk '{printf("%-40s %s\n", $2, $11)}' # prints the first column with a 40 chars right-padding
ps aux | awk '/firefox/' # filters records by regex pattern
ps aux | awk '$2==1645'  # filters records by field comparison
ps aux | awk '$2 &gt; 2100'    # filters records by numeric comparison
ps aux | awk '/firefox/ &amp;&amp; $2 &gt; 2100' # combines a regex pattern with a math operator
ps aux | awk 'BEGIN {printf("%-26s %s\n", "Command", "CPU")} $3&gt;10 {print $11, $3}' # adds a header before processing any data
ps aux | awk '{printf("%s %4.0f MB\n", $11, $6/1024)}'  # controls scale and rounds up
ps aux | awk 'BEGIN {sum=0} /firefox/ {sum+=$6} END {printf("Total memory consumed by Firefox: %.0f MB\n", sum/1024)}'  # sums field values in a column
ps aux | awk 'BEGIN {i=1; while (i&lt;6) {print "Square of", i, "is", i*i; ++i}}'  # to use a while loop
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="archive-backup-compress-unpack-and-uncompress-files"><a class="header" href="#archive-backup-compress-unpack-and-uncompress-files">Archive, backup, compress, unpack, and uncompress files</a></h2>
<p>The idea of “archiving” data generally means backing it up and saving it to a secure location, often in a compressed format. An “archive” on a Linux server in general has a slightly different meaning. Usually it refers to a <code>tar</code> file.</p>
<p>Historically, data from servers was often backed up onto tape archives, which are magnetic tape devices that can be used to store sequential data. This is still the preferred backup method for some industries. In order to do this efficiently, the tar program was created so that you can address and manipulate many files in a filesystem, with intact permissions and metadata, as one file. You can then extract a file or the entire filesystem from the archive.</p>
<p>Basically, a tar file (or a <strong>tarball</strong>) is a file format that creates a convenient way to distribute, store, back up, and manipulate groups of related files. Tar is normally used with a compression tool such as <code>gzip</code>, <code>bzip2</code>, or <code>xz</code> to produce a compressed tarball.</p>
<p><strong>gzip</strong> is the oldest compression tool and provides the least compression, while <strong>bzip2</strong> provides improved compression. In addition, <strong>xz</strong> is the newest but (usually) provides the best compression. This advantage comes at a price: the time it takes to complete the operation, and system resources used during the process. Normally, tar files compressed with these utilities have <strong>.gz</strong>, <strong>.bz2</strong>, or <strong>.xz</strong> extensions, respectively.</p>
<div class="table-wrapper"><table><thead><tr><th>Long option</th><th>Abbreviation</th><th>Description</th></tr></thead><tbody>
<tr><td>–create</td><td>c</td><td>Creates a tar archive</td></tr>
<tr><td>–concatenate</td><td>A</td><td>Appends tar files to an archive</td></tr>
<tr><td>–append</td><td>r</td><td>Appends files to the end of an archive</td></tr>
<tr><td>–update</td><td>u</td><td>Appends files newer than copy in archive</td></tr>
<tr><td>–diff or –compare</td><td>d</td><td>Find differences between archive and file system</td></tr>
<tr><td>–file [archive]</td><td>f</td><td>Use archive file or device <em>archive</em></td></tr>
<tr><td>–list</td><td>t</td><td>Lists the contents of a tarball</td></tr>
<tr><td>–extract or –get</td><td>x</td><td>Extracts files from an archive</td></tr>
<tr><td>–directory [dir]</td><td>C</td><td>Changes to directory dir before performing operations</td></tr>
<tr><td>–same-permissions</td><td>p</td><td>Preserves original permissions</td></tr>
<tr><td>–verbose</td><td>v</td><td>Lists all files read or extracted. When this flag is used along with –list, the file sizes, ownership, and time stamps are displayed.</td></tr>
<tr><td>–verify</td><td>W</td><td>Verifies the archive after writing it</td></tr>
<tr><td>–exclude [file]</td><td>—</td><td>Excludes file from the archive</td></tr>
<tr><td>–exclude=pattern</td><td>X</td><td>Exclude files, given as a <em>pattern</em></td></tr>
<tr><td>–gzip or –gunzip</td><td>z</td><td>Processes an archive through gzip</td></tr>
<tr><td>–bzip2</td><td>j</td><td>Processes an archive through bzip2</td></tr>
<tr><td>–xz</td><td>J</td><td>Processes an archive through xz</td></tr>
</tbody></table>
</div>
<p>List the contents of a tarball : <code>tar tvf [tarball]</code></p>
<p>Update or append operations cannot be applied to compressed files directly:</p>
<pre><code>gzip -d &lt;myfiles.tar.gz&gt;
tar --delete --file &lt;myfiles.tar&gt; &lt;file4&gt;       # deletes the file inside the tarball
tar --update --file &lt;myfiles.tar&gt; &lt;file4&gt;       # adds the updated file
gzip myfiles.tar
</code></pre>
<p>Exclude files from backup depending on file type (e.g. mpeg):
<code>tar X &lt;(for i in $DIR/*; do file $i | grep -i mpeg; if [ $? -eq 0 ]; then echo $i; fi; done) -cjf backupfile.tar.bz2 $DIR/*</code></p>
<p>Restore backups preserving permissions: <code>tar xjf backupfile.tar.bz2 --directory user_restore --same-permissions</code></p>
<p>Only store files newer than a given date (i.e. <em>differential backup</em>): <code>tar --create --newer '2011-12-1' -vf backup1.tar /var/tmp</code></p>
<blockquote>
<p>Note: If [date] starts with <code>/</code> or <code>.</code> it is taken to be a filename and the ctime of that file is used as the date.</p>
</blockquote>
<blockquote>
<p>Note: A differential backup backs up only the files that changed since the last full back. Incremental backups also back up only the changed data, but they only back up the data that has changed since the last backup — be it a full or incremental backup.</p>
</blockquote>
<blockquote>
<p>Note: Each instance of <code>--verbose</code> on the command line increases the verbosity level by one, so if you need more details on the output, specify it twice.</p>
</blockquote>
<p>To create incremental backups:</p>
<pre><code>mkdir data
echo "File1 Data" &gt; data/file1
echo "File2 Data" &gt; data/file2
tar --create --listed-incremental=data.snar --verbose --verbose --file=data.tar data
&gt;tar: data: Directory is new
&gt;drwxrwxr-x ubuntu/ubuntu     0 2018-04-03 14:00 data/
&gt;-rw-rw-r-- ubuntu/ubuntu     5 2018-04-03 14:00 data/file1
&gt;-rw-rw-r-- ubuntu/ubuntu     5 2018-04-03 14:00 data/file2

echo "File3 Data" &gt; data/file3
tar --create --listed-incremental=data.snar --verbose --verbose --file=data1.tar data
&gt;drwxrwxr-x ubuntu/ubuntu     0 2018-04-03 14:41 data/
&gt;-rw-rw-r-- ubuntu/ubuntu    11 2018-04-03 14:41 data/file3

echo "more data" &gt;&gt; data/file2
tar --create --listed-incremental=data.snar --verbose --verbose --file=data2.tar data
&gt;drwxrwxr-x ubuntu/ubuntu     0 2018-04-03 14:41 data/
&gt;-rw-rw-r-- ubuntu/ubuntu    15 2018-04-03 14:47 data/file2

rm data/file1
tar --create --listed-incremental=data.snar --verbose --verbose --file=data3.tar data
&gt;drwxrwxr-x ubuntu/ubuntu     0 2018-04-03 14:55 data/

tar --list --verbose --verbose --listed-incremental=data.snar --file=data3.tar
&gt;drwxrwxr-x ubuntu/ubuntu    15 2018-04-03 14:55 data/
&gt;N file2
&gt;N file3

# restore the dir one backup at a time

tar --extract --verbose --verbose --listed-incremental=/dev/null --file=data.tar
&gt;drwxrwxr-x ubuntu/ubuntu    15 2018-04-03 14:00 data/
&gt;-rw-rw-r-- ubuntu/ubuntu     5 2018-04-03 14:00 data/file1
&gt;-rw-rw-r-- ubuntu/ubuntu     5 2018-04-03 14:00 data/file2
cat data/file1 data/file2
&gt;File1 Data
&gt;File2 Data

tar --extract --verbose --verbose --listed-incremental=/dev/null --file=data1.tar
&gt;drwxrwxr-x ubuntu/ubuntu    22 2018-04-03 14:41 data/
&gt;-rw-rw-r-- ubuntu/ubuntu    11 2018-04-03 14:41 data/file3

tar --extract --verbose --verbose --listed-incremental=/dev/null --file=data2.tar
&gt;drwxrwxr-x ubuntu/ubuntu    22 2018-04-03 14:41 data/
&gt;-rw-rw-r-- ubuntu/ubuntu    15 2018-04-03 14:47 data/file2
cat data/file2
&gt;File2 Data
&gt;more data

tar --extract --verbose --verbose --listed-incremental=/dev/null --file=data3.tar
&gt;drwxrwxr-x ubuntu/ubuntu    15 2018-04-03 14:55 data/
&gt;tar: Deleting ‘data/file1'

# the dir is now up-to-date to the last backup
</code></pre>
<blockquote>
<p>Note: Each backup uses the same meta file (.sar) but its own archive.</p>
</blockquote>
<hr />
<p><code>rsync</code> is a fast and versatile command-line utility for synchronizing files and directories between two locations over a remote shell, or from/to a remote rsync daemon. It provides fast incremental file transfer by transferring only the differences between the source and the destination. It finds files that need to be transferred using a "quick check" algorithm (by default) that looks for files that have changed in size or in last-modified time.</p>
<p><code>sync</code> can be used for mirroring data, incremental backups, copying files between systems, and as a replacement for <code>scp</code>, <code>sftp</code>, and <code>cp</code> commands.</p>
<p>rsync provides a number of options that control how the command behaves. The most widely used options are:</p>
<ul>
<li><code>-a</code>, <code>--archive</code>, archive mode, equivalent to <code>-rlptgoD</code>, this option tells rsync to syncs directories recursively, transfer special and block devices, preserve symbolic links, modification times, groups, ownership, and permissions</li>
<li><code>-n</code>, <code>--dry-run</code>, perform a trial run with no changes made</li>
<li><code>-z</code>, <code>--compress</code>, this option forces rsync to compresses the data as it is sent to the destination machine</li>
</ul>
<blockquote>
<p>Tip: Use this option only if the connection to the remote machine is slow.</p>
</blockquote>
<ul>
<li><code>-P</code>, equivalent to <code>--partial --progress</code>, when this option is used, rsync shows a progress bar during the transfer and keeps the partially transferred files.</li>
</ul>
<blockquote>
<p>Tip: Useful when transferring large files over slow or unstable network connections.</p>
</blockquote>
<ul>
<li><code>--delete</code>, when this option is used, rsync deletes extraneous files from the destination location, it is useful for mirroring</li>
<li><code>-q</code>, <code>--quiet</code>, use this option if you want to suppress non-error messages</li>
<li><code>-e</code>, this option allows you to choose a different remote shell, by default, rsync is configured to use ssh.</li>
</ul>
<h3 id="basic-rsync-usage"><a class="header" href="#basic-rsync-usage">Basic Rsync Usage</a></h3>
<p>The most basic use case of rsync is to copy a single file from one to another local location: <code>rsync -a /opt/filename.zip /tmp/</code></p>
<blockquote>
<p>Note: The user running the command must have read permissions on the source location and write permissions on the destination.</p>
</blockquote>
<p>Omitting the filename from the destination location copies the file with the current name. If you want to save the file under a different name, specify the new name on the destination part: <code>rsync -a /opt/filename.zip /tmp/newfilename.zip</code></p>
<p>The real power of rsync comes when synchronizing directories. The example below shows how to create a local backup of website files:
<code>rsync -a /var/www/domain.com/public_html/ /var/www/domain.com/public_html_backup/</code></p>
<blockquote>
<p>Note: If the destination directory doesn't exist, rsync will create it.</p>
</blockquote>
<blockquote>
<p>Note: It is worth mentioning that rsync gives different treatment to the source directories with a trailing slash (<code>/</code>). If the source directory has a trailing slash, the command will copy only the directory contents to the destination directory. When the trailing slash is omitted, rsync copies the source directory inside the destination directory.</p>
</blockquote>
<h3 id="using-rsync-to-sync-data-fromto-a-remote-machine"><a class="header" href="#using-rsync-to-sync-data-fromto-a-remote-machine">Using rsync to sync data from/to a remote machine</a></h3>
<p>When using rsync to transfer data remotely, it must be installed on both the source and the destination machine. The new versions of rsync are configured to use SSH as default remote shell.</p>
<p>In the following example, we are transferring a directory from a local to a remote machine:
<code>rsync -a /opt/media/ remote_user@remote_host_or_ip:/opt/media/</code></p>
<blockquote>
<p>Note: If we run the command again, we will get a shorter output, because no changes have been made. This illustrates rsync's ability to use modification times to determine if changes have been made.</p>
</blockquote>
<p>To transfer data from a remote to a local machine, use the remote location as a source:
<code>rsync -a remote_user@remote_host_or_ip:/opt/media/ /opt/media/</code></p>
<p>If SSH on the remote host is listening on a port other than the default 22, specify the port using the <code>-e</code> option:
<code>rsync -a -e "ssh -p 2322" /opt/media/ remote_user@remote_host_or_ip:/opt/media/</code></p>
<p>When transferring large amounts of data it is recommended to run the rsync command inside a screen session or to use the <code>-P</code> option:
<code>rsync -a -P remote_user@remote_host_or_ip:/opt/media/ /opt/media/</code></p>
<h3 id="exclude-files-and-directories"><a class="header" href="#exclude-files-and-directories">Exclude Files and Directories</a></h3>
<p>There are two options to exclude files and directories. The first option is to use the <code>--exclude</code> argument and specify the files and directories you want to exclude on the command line. When excluding files or directories, you need to use their relative paths to the source location.</p>
<p>In the following example shows how exclude the node_modules and tmp directories:
<code>rsync -a --exclude=node_modules --exclude=tmp /src_directory/ /dst_directory/</code></p>
<p>The second option is to use the <code>--exclude-from</code> option and specify the files and directories you want to exclude in a file:
<code>rsync -a --exclude-from='/exclude-file.txt' /src_directory/ /dst_directory/</code></p>
<p>The content of <code>/exclude-file.txt</code> can be something like:</p>
<pre><code>node_modules
tmp
</code></pre>
<hr />
<p>To make a full raw device backup: <code>sudo dd if=/dev/sda of=/dev/sdb1 bs=64K conv=noerror,sync status=progress</code></p>
<p>To create a compressed image: <code>sudo dd if=/dev/sda conv=sync,noerror bs=64K | gzip -c  &gt; /PATH/TO/DRIVE/backup_image.img.gz</code></p>
<p>To restore it: <code>gunzip -c /PATH/TO/DRIVE/backup_image.img.gz | dd of=/dev/sda</code></p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="create-delete-copy-and-move-files-and-directories"><a class="header" href="#create-delete-copy-and-move-files-and-directories">Create, delete, copy, and move files and directories</a></h2>
<p>Basic commands: <code>mkdir</code>, <code>rm</code>, <code>touch</code>, <code>cp</code> and <code>mv</code>.</p>
<p>Move back to your previous directory (<code>-</code> is converted to <code>$OLDPWD</code>): <code>cd -</code></p>
<p>Create multiple files in a dir at once: <code>touch /path/to/dir/{a,f,g}.md</code></p>
<p>Or, to create them with names in a linear sequence: <code>touch /path/to/dir/{a..g}.md</code></p>
<p>To recursively remove a dir and its content without being prompted: <code>rm -rf /home/user/somedir</code></p>
<p>To list directories themselves, not their contents: <code>ll -d /home/user/somedir</code></p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="create-and-manage-hard-and-soft-links"><a class="header" href="#create-and-manage-hard-and-soft-links">Create and manage hard and soft links</a></h2>
<p>A <strong>file</strong> is a named collection of related data that appears to the user as a single, contiguous block of information and that is retained in storage.</p>
<p>Whereas users identify files by their names, Unix-like operating systems identify them by their <strong>inodes</strong>. An inode is a data structure that stores everything about a file apart from its name and actual content. A <strong>filename</strong> in a Unix-like operating system is just an entry in an inode table. Inode numbers are unique per filesystem, which means that an inode with a same number can exist on another filesystem in the same computer.</p>
<blockquote>
<p>Note: Saying that "on a UNIX system, everything is a file; if something is not a file, it is a process" is just an acceptable generalization.</p>
</blockquote>
<p>There are two types of links in UNIX-like systems:</p>
<ul>
<li><strong>hard</strong> links: you can think a hard link as an additional name for an existing file. Hard links are associating two or more file names with the same inode. You can create one or more hard links for a single file. Hard links cannot be created for directories and files on a different filesystem or partition.</li>
<li><strong>soft</strong> links: a soft link is something like a shortcut in Windows. It is an indirect pointer to a file or directory. Unlike a hard link, a symbolic link can point to a file or a directory on a different filesystem or partition.</li>
</ul>
<p>In case you delete a file, the hard link will survive while the soft link will be broken.</p>
<p>To create a hard link: <code>ln source target</code></p>
<p>To create a soft link: <code>ln -s source target</code></p>
<p>To overwrite the destination path of the symlink, use the <code>-f</code> (<code>--force</code>) option: <code>ln -sf source target</code></p>
<p>To delete/remove symbolic links use either the <code>rm</code> or <code>unlink</code>: <code>unlink symlink_to_remove</code></p>
<p>To find all hardlinks in a folder:</p>
<pre><code>find /some/dir -type f -links +1 -printf '%i %n %p\n'
&gt;129978 2 ./book.pdf
&gt;129978 2 ./hard-linked-book.pdf
</code></pre>
<p>If the other file in the same dir, this will be apparent since they have the same inode. Otherwise, this command will only show all regular files that have more than one link (name) to them, not telling you which names are linked to the same file, for that you could use <code>-samefile</code> or <code>-inum</code>, e.g.: <code>find -samefile "$somefile"</code></p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="list-set-and-change-standard-file-permissions"><a class="header" href="#list-set-and-change-standard-file-permissions">List, set, and change standard file permissions</a></h2>
<p>To see user standard (<strong>UGO</strong>) permissions use <code>ls -l</code>. Permissions are in the 1st column. Each file/directory has an owner and is associated to a group: the former is in the 3rd columns, the latter in the 4th.</p>
<p>The permissions for each file/directory are given for each of this category:</p>
<ul>
<li>owner (u)</li>
<li>group (g)</li>
<li>others (o) (all other users that are not the owner and are not member of group).</li>
</ul>
<p>For each category the following permissions can be set:</p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>String value</th><th>Octal Value</th></tr></thead><tbody>
<tr><td>read</td><td>r</td><td>4</td></tr>
<tr><td>write</td><td>w</td><td>2</td></tr>
<tr><td>exec</td><td>x</td><td>1</td></tr>
</tbody></table>
</div>
<p>The right that each permission provide are different and depends if target is a file or a directory:</p>
<div class="table-wrapper"><table><thead><tr><th>Permission</th><th>File</th><th>Directory</th></tr></thead><tbody>
<tr><td>read</td><td>read</td><td>list</td></tr>
<tr><td>write</td><td>modify</td><td>create/delete</td></tr>
<tr><td>exec</td><td>run</td><td>cd</td></tr>
</tbody></table>
</div>
<blockquote>
<p>Note: When the exec bit is set for other (also said the "world"), the file will be executed with the identity of the user who is executing the command (his user ID and group ID).</p>
</blockquote>
<p>There are two modes for declare permissions using <code>chmod</code> command:</p>
<ul>
<li>absolute mode, uses numbers for each permission, that must be added if more than a permission is set:</li>
</ul>
<pre><code>chmod 760 file
# owner: granted read, write and exec
# group: granted read and write
# other: no permissions set
</code></pre>
<ul>
<li>relative mode:</li>
</ul>
<pre><code>chmod +x file   # adds exec to owner, group and other
chmod g+w file  #adds write to group
chmod o-rw file #remove read and write to others
</code></pre>
<p>There are other special permissions that can be granted to file/directories:</p>
<div class="table-wrapper"><table><thead><tr><th>Permission</th><th>File</th><th>Directory</th></tr></thead><tbody>
<tr><td>suid (4, -s/-S)</td><td>run as user owner</td><td>subfiles inherit user of parent dir, while subdirs inherit suid</td></tr>
<tr><td>sgid (2, -s/-S)</td><td>run as group owner</td><td>subfiles inherit group of parent dir, while subdirs inherit sgid</td></tr>
<tr><td>sticky bit (1, -t/-T)</td><td>N/A</td><td>files inside dir can be deleted only by the owner</td></tr>
</tbody></table>
</div>
<blockquote>
<p>Note: Since the special bits appear in the third position as exec bit, "-uppercase" means only the special bit is active, whereas "-lowercase" means that both special bit and exec bit are set.</p>
</blockquote>
<p>Special bits can be set with:</p>
<ul>
<li>absolute mode:</li>
</ul>
<pre><code>chmod 4760 file 
</code></pre>
<ul>
<li>relative mode:</li>
</ul>
<pre><code>chmod u+s file  # sets suid
chmod g+s file  # sets guid
chmod +t dir    # sets sticky bit
</code></pre>
<blockquote>
<p>Note: When a file with setuid is executed, the resulting process will assume the effective user ID given to the owner: if the owner is root, this could represents a potential security risk (privilege escalation). It is a good practice to monitor a system for any suspicious usages of the setuid bits to gain superuser privileges: <code>find / -user root -perm -4000 -exec ls -ldb {} \;</code></p>
</blockquote>
<blockquote>
<p>Note: Linux ignores the setuid bit on all interpreted executables for security reasons. If we want our shell script to have the setuid permission, we can use the sudo command to gain privileges of the owner of the script file.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h2 id="read-and-use-system-documentation"><a class="header" href="#read-and-use-system-documentation">Read, and use system documentation</a></h2>
<p>To learn more about system utilities, you can use:</p>
<ul>
<li><code>man &lt;command&gt;</code>, to read man pages (UNIX way of distributiing documentation) stored in /usr/share/man and /usr/local/share/man</li>
<li><code>info &lt;command&gt;</code>, similarly (GNU project meant to replace man)</li>
<li><code>help &lt;command&gt;</code>, for shel built-in commands only.</li>
</ul>
<p>You can use the <code>apropos</code> command (for example, with a keyword such as "partition") to find commands related to something:</p>
<pre><code>apropos partition
</code></pre>
<blockquote>
<p>Note: This equivalent to: <code>man -k &lt;keyword&gt;</code></p>
</blockquote>
<blockquote>
<p>Note: Man pages are grouped into sections (<code>man man-pages</code>) and the section number can be passed to man command:</p>
</blockquote>
<pre><code>man 1 passwd    # display passwd command doc 
man 5 passwd    # display passwd file format doc 
</code></pre>
<p>Use this simple script to quickly find what a command argument stands for:</p>
<pre><code>#!/bin/bash
# Usage: mans &lt;command&gt; &lt;arg&gt;
# e.g. mans cp -R

CMD=$1
OP=$2

if [[ -z "$1" || -z "$2" ]]; then
    echo "No arguments supplied: you mast pass an entry in the man and an option"
    exit 1
fi

echo $(man ${CMD} | awk '/^ *-*'${OP}'[ |,]+.*$/,/^$/{print}')
exit 0
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="manage-access-to-the-root-account"><a class="header" href="#manage-access-to-the-root-account">Manage access to the root account</a></h2>
<p>By default Ubuntu does not set up a root password during installation and therefore you don't get the facility to log in as root. However, this does not mean that the root account doesn't exist in Ubuntu or that it can't be completely accessed. Instead you are given the ability to execute tasks with superuser privileges using the <code>sudo</code> command.</p>
<p>To access the root user account run one of the following commands and enter your normal-user password:</p>
<pre><code>sudo -i         # run the shell specified by the target user's password database entry as a login shell
sudo su         # substitute user staying in the previous dir
sudo su -       # land on substituted user's home
sudo su root    # redundant, since root is the default account
</code></pre>
<p>You can change root password as shown below:</p>
<pre><code>sudo passwd root
&gt;Enter new UNIX password:
&gt;Retype new UNIX password:
&gt;passwd: password updated successfully
</code></pre>
<p>If you wish to disable root account login, run the command below to set the password to expire: <code>sudo passwd -l root</code></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="2-operation-of-running-systems---20"><a class="header" href="#2-operation-of-running-systems---20">2. Operation of Running Systems - 20%</a></h1>
<ul>
<li><a href="2-operation-of-running-systems/./a.html">Boot, reboot, and shut down a system safely</a></li>
<li><a href="2-operation-of-running-systems/./b.html">Boot or change system into different operating modes</a></li>
<li><a href="2-operation-of-running-systems/./c.html">Install, configure and troubleshoot bootloaders</a></li>
<li><a href="2-operation-of-running-systems/./d.html">Diagnose and manage processes</a></li>
<li><a href="2-operation-of-running-systems/./e.html">Locate and analyze system log files</a></li>
<li><a href="2-operation-of-running-systems/./f.html">Schedule tasks to run at a set date and time (./cron, anacron, at)</a></li>
<li><a href="2-operation-of-running-systems/./g.html">Verify completion of scheduled jobs</a></li>
<li><a href="2-operation-of-running-systems/./h.html">Update software to provide required functionality and security</a></li>
<li><a href="2-operation-of-running-systems/./i.html">Verify the integrity and availability of resources</a></li>
<li><a href="2-operation-of-running-systems/./l.html">Verify the integrity and availability of key processes</a></li>
<li><a href="2-operation-of-running-systems/./m.html">Change kernel runtime parameters, persistent and non-persistent</a></li>
<li><a href="2-operation-of-running-systems/./n.html">Use scripting to automate system maintenance tasks</a></li>
<li><a href="2-operation-of-running-systems/./o.html">Manage the startup process and services</a></li>
<li><a href="2-operation-of-running-systems/./p.html">List and identify SELinux/AppArmor file and process contexts</a></li>
<li><a href="2-operation-of-running-systems/./q.html">Manage software</a></li>
<li><a href="2-operation-of-running-systems/./r.html">Identify the component of a Linux distribution that a file belongs to</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h2 id="boot-reboot-and-shut-down-a-system-safely"><a class="header" href="#boot-reboot-and-shut-down-a-system-safely">Boot, reboot, and shut down a system safely</a></h2>
<p>The <code>poweroff</code>, <code>shutdown (-h) now</code>, and <code>halt -p</code> commands all do the same thing as halt alone, while additionally sending an ACPI command to signal the power supply unit to disconnect the main power.</p>
<p>Generally, one uses the <code>shutdown command</code> for system administration of multiuser shell servers, becaus it allows to specify a time delay and a warning message before shutdown or reboot happens: <code>sudo shutdown -r +30 "Planned software upgrades"</code></p>
<p>To reboot the system immediately: <code>sudo reboot</code></p>
<blockquote>
<p>Note: The <code>reboot</code> command, on its own, is basically a shortcut to <code>shutdown -r now</code>.</p>
</blockquote>
<p>On most modern Linux distributions, <strong>systemd</strong> is the init system, so both rebooting and powering down can be performed through the systemd user interface, <strong>systemctl</strong>. The systemctl command accepts, among many other options, <strong>halt</strong> (halts disk activity but does not cut power) <strong>reboot</strong> (halts disk activity and sends a reset signal to the motherboard) and <strong>poweroff</strong> (halts disk acitivity, and then cut power). These commands are mostly equivalent to starting the target file of the same name. For instance, to trigger a reboot: <code>sudo systemctl start reboot.target</code>. Or, simply: <code>sudo systemctl reboot</code></p>
<p>The <code>telinit</code> command is the front-end to your init system.</p>
<blockquote>
<p>Note: Since the concept of SysV runlevels is obsolete the runlevel requests will be transparently translated into systemd unit activation requests.</p>
</blockquote>
<p>To power off your computer by sending it into runlevel 0: <code>sudo telinit 0</code></p>
<p>To reboot using the same method: <code>sudo telinit 6</code></p>
<h3 id="apply-brute-force"><a class="header" href="#apply-brute-force">Apply brute force</a></h3>
<p>There's a provision in the Linux kernel for system requests (<strong>Sysrq</strong> on most keyboards). You can communicate directly with this subsystem using key combinations, ideally regardless of what state your computer is in; it gets complex on some keyboards because the <strong>Sysrq</strong> key can be a special function key that requires a different key to access (such as Fn on many laptops).</p>
<p>An option less likely to fail is using echo to insert information into /proc, manually. First, make sure that the Sysrq system is enabled:
<code>sudo echo 1 &gt; /proc/sys/kernel/sysrq</code></p>
<p>To reboot, you can use either <code>Alt+Sysrq+B</code> or type:
<code>sudo echo b &gt; /proc/sysrq-trigger</code></p>
<p>This method is not a graceful way to reboot your machine on a regular basis, but it gets the job done in a pinch.</p>
<p>The magic SysRq key is often used to recover from a frozen state, or to reboot a computer without corrupting the filesystem, especially when switching to a terminal window (Ctrl+Alt+F2) is not possible. In this case, use the following steps to perform a reboot:</p>
<ul>
<li>Press Alt+SysRq+<strong>R</strong> to get the keyboard</li>
<li>If pressing Ctrl+Alt+F2 before failed, try it again now.</li>
<li>Press Alt+SysRq+<strong>E</strong> to term all processes.</li>
<li>Press Alt+SysRq+<strong>I</strong> to kill all processes.</li>
<li>Press Alt+SysRq+<strong>S</strong> to sync your disks.</li>
<li>Wait for OK or Done message. If you don't see a message, look at your HDD light to see if Sync made a difference.</li>
<li>Press Alt+SysRq+<strong>U</strong> to umount all disk drives.</li>
<li>Wait for OK or Done message. If you don't see a message, in 15-30 seconds, assume disks are unmounted (or that an unmount is not posssible) and proceed.</li>
<li>Press Alt+SysRq+<strong>B</strong> to reboot.</li>
</ul>
<p>The Letters used spell <strong>REISUB</strong> - use the mnemonic <em>Reboot Even If System Utterly Broken</em>.</p>
<p>The final option is, of course, the power button on your computer's physical exterior. Modern PCs have ACPI buttons, which just send the shutdown request to the kernel. If the ACPI daemon is listening and correctly configured, it can signal init and perform a clean shutdown.</p>
<p>If ACPI doesn't work, you will need to cut off electrical power. This is done through a <strong>hard switch</strong> (generally labeled <strong>reset</strong>), possibly using the same button as before but holding it pressed for 5 or so seconds. Taking out the battery (on laptops) and physically disconnecting all power cables is, of course, the only method guaranteed to work. (Make sure no other method listed above works. Even as a last resort, unplugging your computer while it is running is still not recommended.)</p>
<p>Resetting without shutting down can cause problems with the file system. To try and fix this problem, fsck will be run when you next boot up, and journaling filesystems will attempt to complete or rollback files which were changing.</p>
<hr />
<p>Keyboard schortcuts may vary depending on the desktop environment.
On KDE, you can use these schortcuts to leave you computer:</p>
<ul>
<li><code>Ctrl+Alt+L</code>, lock screen</li>
<li><code>Ctrl+Alt+Del</code>, leave</li>
<li><code>Ctrl+Alt+Shift+Del</code>, logout without confirmation</li>
<li><code>Ctrl+Alt+Shift+Page Down</code>, shut down without confirmation</li>
<li><code>Ctrl+Alt+Shift+Page Up</code>, reboot without confirmation</li>
</ul>
<p>For other shortcuts available on KDE, look <a href="https://docs.kde.org/trunk5/en/applications/fundamentals/kbd.html">here</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="boot-or-change-system-into-different-operating-modes"><a class="header" href="#boot-or-change-system-into-different-operating-modes">Boot or change system into different operating modes</a></h2>
<p>On modern systemd-based systems, <strong>targets</strong> are special unit files that describe a system state or synchronization point. Like other units, the files that define targets can be identified by their suffix, which in this case is <code>.target</code>. Targets do not do much themselves, but are instead used to group other units together. These can be used in order to bring the system to certain states, much like other init systems use <strong>runlevels</strong>.</p>
<p>To find the default target for your system, type: <code>systemctl get-default</code></p>
<p>If you wish to set a different default target, you can use the set-default: <code>sudo systemctl set-default graphical.target</code></p>
<p>You can get a list of the available targets on your system by typing: <code>systemctl list-unit-files --type=target</code></p>
<p>It is possible to start all of the units associated with a target and stop all units that are not part of the dependency tree. This is similar to changing the runlevel in other init systems: <code>sudo systemctl isolate multi-user.target</code></p>
<p>You may wish to take a look at the dependencies of the target you are isolating before performing this procedure to ensure that you are not stopping vital services: <code>systemctl list-dependencies multi-user.target</code></p>
<p>There are targets defined for important events like powering off or rebooting. However, systemctl also has some shortcuts that add a bit of additional functionality.</p>
<p>For instance, to put the system into <strong>rescue</strong> (i.e. <strong>single-user</strong>) mode, you can just use the rescue command instead of isolate rescue.target: <code>sudo systemctl rescue</code></p>
<p>This will provide the additional functionality of alerting all logged in users about the event.</p>
<p>To change target at boot time:</p>
<ul>
<li>during boot press ESC/F2 right after the BIOS logo disappears</li>
<li>the grub menu prompt will be showed</li>
<li>choose the entry corrisponding to your system</li>
<li>type 'e' to edit the boot loader configuration</li>
<li>navigate to your prefered Linux kernel line and append either <code>rescue</code> or <code>systemd.unit=emergency.target</code></li>
</ul>
<blockquote>
<p>Note: The changes are not persistent.</p>
</blockquote>
<blockquote>
<p>Note: In this modality disk is mounted read only, to remount it read/write, after boot execute: <code>mount -o remount,rw /</code>.</p>
</blockquote>
<ul>
<li>then press either Ctrl-x or F10 to boot with the modified entry and the system will enter the rescue mode.</li>
</ul>
<blockquote>
<p>Note: The <strong>rescue mode</strong> is equivalent to single user mode in Linux distributions that uses SysV as the default service manager. In rescue mode, all local filesystems will be mounted, only some important services will be started. However, no normal services (E.g network services) won't be started. The rescue mode is helpful in situations where the system can't boot normally. Also, we can perform some important rescue operations, such as reset root password, in rescue mode. In contrast to the rescue mode, nothing is started in the <strong>emergency mode</strong>. No services are started, no mount points are mounted, no sockets are established, nothing. All you will have is just a raw shell. Emergency mode is suitable for debugging purposes.</p>
</blockquote>
<p>For a "visual" guidance on the topic, look <a href="https://ostechnix.com/how-to-boot-into-rescue-mode-or-emergency-mode-in-ubuntu-18-04/">here</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="install-configure-and-troubleshoot-bootloaders"><a class="header" href="#install-configure-and-troubleshoot-bootloaders">Install, configure and troubleshoot bootloaders</a></h2>
<p>The Linux boot process from the time you press the power button of your computer until you get a fully-functional system follows this high-level sequence:</p>
<ol>
<li>A process known as <strong>POST</strong> (<em>Power-On Self Test</em>) performs an overall check on the hardware components of your computer</li>
<li>When POST completes, it passes the control over to the <strong>boot loader</strong>, which in turn loads the Linux kernel in memory (along with <strong>initramfs</strong>) and executes it. The most used boot loader in Linux is the <em>GRand Unified Boot loader</em>, or <strong>GRUB</strong> for short</li>
<li>The kernel checks and accesses the hardware, and then runs the initial process (mostly known by its generic name <strong>init</strong>) which in turn completes the system boot by starting services.</li>
</ol>
<p>Two major GRUB versions (<em>v1</em>, sometimes called <em>GRUB Legacy</em>, and <em>v2</em>) can be found in modern systems, although most distributions use v2 by default in their latest versions. Only Red Hat Enterprise Linux 6 and its derivatives still use v1 today.</p>
<p>Regardless of the GRUB version, a boot loader allows the user to:</p>
<ol>
<li>modify the way the system behaves by specifying different kernels to use,</li>
<li>choose between alternate operating systems to boot, and</li>
<li>add or edit configuration stanzas to change boot options, among other things.</li>
</ol>
<p>When the system boots you are presented with the GRUB menu if you repeatedly press ESC. Initially, you are prompted to choose between alternate kernels (by default, the system will boot using the latest kernel) and are allowed to enter a GRUB command line (with <code>c</code>) or edit the boot options (by pressing the <code>e</code> key).</p>
<p>The GRUB v2 configuration is read on boot from <code>/boot/grub/grub.cfg</code> or <code>/boot/grub2/grub.cfg</code>, <code>whereas /boot/grub/grub.conf</code> or <code>/boot/grub/menu.lst</code> are used in v1. These files are NOT to be edited by hand, but are modified based on the contents of <code>/etc/default/grub</code> and the files found inside <code>/etc/grub.d</code>.</p>
<p>If you're interested specifically in the options available for /etc/default/grub, you can invoke the configuration section directly:
<code>info -f grub -n 'Simple configuration'</code></p>
<p>When multiple operating systems or kernels are installed in the same machine, <code>GRUB_DEFAULT</code> requires an integer value that indicates which OS or kernel entry in the GRUB initial screen should be selected to boot by default. The list of entries can be viewed using the following command:
<code>awk -F\' '$1=="menuentry " {print $2}' /boot/grub/grub.cfg</code></p>
<p>One final GRUB configuration variable that is of special interest is <code>GRUB_CMDLINE_LINUX</code>, which is used to pass options to the kernel. The options that can be passed through GRUB to the kernel are well documented in <code>man 7 kernel-command-line</code> and in <code>man 7 bootparam</code>.</p>
<p>To bring the system to single-user mode to perform maintenance tasks, you can append the word <code>single</code> to GRUB_CMDLINE_LINUX and rebooting.
After editing /etc/defalt/grub, you will need to run <code>update-grub</code> (Ubuntu) afterwards, to update <code>grub.cfg</code> (otherwise, changes will be lost upon boot).</p>
<h3 id="fixing-the-grub"><a class="header" href="#fixing-the-grub">Fixing the GRUB</a></h3>
<p>If you install a second operating system or if your GRUB configuration file gets corrupted due to a human error, there are ways you can get your system back on its feet and be able to boot again.</p>
<p>In the initial screen, press <code>c</code> to get a GRUB command line (remember that you can also press <code>e</code> to edit the default boot options), and use <code>help</code> to bring the available commands in the GRUB prompt.</p>
<p>Use <code>ls</code> to list the installed devices and filesystems. Find the drive containg the grub to boot Linux and there use other high level tools to repair the configuration file or reinstall GRUB altogether if it is needed:</p>
<pre><code>ls (hd0,msdos1)/
</code></pre>
<p>Once sure that GRUB resides in a certain partition (e.g. hd0,msdos1), tell GRUB where to find its configuration file and then instruct it to attempt to launch its menu:</p>
<pre><code>set prefix=(hd0,msdos1)/grub2
set root=(hd0,msdos1)
insmod normal
normal
</code></pre>
<p>Then in the GRUB menu, choose an entry and press Enter to boot using it. Once the system has booted you can issue the <code>grub2-install /dev/sdX</code> command (change <code>sdX</code> with the device you want to install GRUB on). This will rewrite the MBR information to point to the current installation and rewrite some GRUB 2 files (which are already working). Since it isn't done during execution of the previous command, running <code>sudo update-grub</code> after the install will ensure GRUB 2's menu is up-to-date.</p>
<p>Other more complex scenarios are documented, along with their suggested fixes, in the <a href="https://help.ubuntu.com/community/Grub2/Troubleshooting">Ubuntu GRUB2 Troubleshooting guide</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="diagnose-and-manage-processes"><a class="header" href="#diagnose-and-manage-processes">Diagnose and manage processes</a></h2>
<h3 id="processes"><a class="header" href="#processes">Processes</a></h3>
<p><code>ps</code>: reports a snapshot of the current processes</p>
<pre><code>ps # processes of which I'm owner

ps aux # all processes
</code></pre>
<p>It will print:</p>
<ul>
<li><code>user</code>, user owning the process</li>
<li><code>pid</code>, process ID of the process (it is set when process start, this means that implicitly provides info on starting order of processes)</li>
<li><code>%cpu</code>, the CPU time used divided by the time the process has been running</li>
<li><code>%mem</code>, ratio of the process's resident set size to the physical memory on the machine</li>
<li><code>VSZ</code> (virtual memory), virtual memory usage of entire process (in KiB)</li>
<li><code>RSS</code> (resident memory), resident set size, the non-swapped physical memory that a task has used (in KiB)</li>
<li><code>tty</code>, terminal the process is running on (<code>?</code> means that isn't attached to a tty)</li>
<li><code>stat</code>, process state</li>
<li><code>start</code>, starting time or date of the process</li>
<li><code>time</code>, cumulative CPU time</li>
<li><code>command</code>, command with all its arguments (those within <code>[ ]</code> are system processes or kernel thread)</li>
</ul>
<p>Examples:</p>
<pre><code>ps -eo pid,ppid,cmd,%cpu,%mem --sort=-%cpu
</code></pre>
<p>where:</p>
<ul>
<li><code>-e</code>, shows same result of <code>-A</code></li>
<li><code>-o</code>, specifies columns to show</li>
<li><code>--sort</code>, sorts by provided parameter</li>
</ul>
<pre><code>ps -e -o pid,args --forest # the last arg shows a graphical view of processes tree
</code></pre>
<p>In /proc/[pid] there is a numerical subdirectory for each running process; the subdirectory is named by the process ID. The subdirectory /proc/[pid]/fd contains one entry for each file which the process has open, named by its file descriptor, and which is a symbolic link to the actual file. Thus, 0 is standard input, 1 standard output, 2 standard error, and so on.</p>
<p>Lists open files associated with process id of pid: <code>lsof -p pid</code></p>
<p>Find a parent PID (PPID) from a child's process ID (PID): <code>pstree -s -p &lt;PID&gt;</code></p>
<h3 id="background-processes"><a class="header" href="#background-processes">Background processes</a></h3>
<p>Suffix command with <code>&amp;</code> executes a process in background:</p>
<pre><code>sleep 600 &amp;
jobs    # lists processes in background
&gt;[1]+  Running                 sleep 600 &amp;
kill %1 # kills by job number
&gt;[1]+  Terminated              sleep 600
</code></pre>
<p>To return a process in foreground: <code>fg &lt;PID&gt;</code></p>
<h3 id="process-priority"><a class="header" href="#process-priority">Process priority</a></h3>
<p>List "nice" value of processes: <code>ps -e -o pid,nice,command</code>
<strong>Niceness</strong> (NI) value is a user-space concept, while <strong>priority</strong> (PR) is the process's actual priority that use by Linux kernel. In a Linux system priorities are 0 to 139 in which 0 to 99 for real time and 100 to 139 for users. Nice value range is -20 to +19 where -20 is highest, 0 default and +19 is lowest. A negative nice value means higher priority, whereas a positive nice value means lower priority.The exact relation between nice value and priority is:</p>
<pre><code>PR = 20 + NI
</code></pre>
<p>so, the value of PR = 20 + (-20 to +19) is 0 to 39 that maps 100 to 139.</p>
<blockquote>
<p>Note: Only root can assign negative values.</p>
</blockquote>
<p>Execute a command in background with a given nice value to be added to the current one: <code>nice -n &lt;value&gt; &lt;command&gt; &amp;</code></p>
<blockquote>
<p>Note: In case you want to associate a negative nice value to the process, then you'll have to use double hyphen:</p>
</blockquote>
<pre><code>nice --10 wall &lt;&lt;end
System reboots in 5 minutes for Ubuntu Linux kernel update! 
Save all your work!!!
-- Sysadmin
end
</code></pre>
<p>Riassign priority to a process: <code>renice -n &lt;value&gt; &lt;pid&gt;</code></p>
<h3 id="signals"><a class="header" href="#signals">Signals</a></h3>
<p>Send a SIGTERM (15) signal to process: <code>kill &lt;pid&gt;</code></p>
<p>Send a SIGKILL signal to process: <code>kill -9 &lt;pid&gt;</code></p>
<p>Send a signal that correspond to number to process: <code>kill -&lt;number&gt; &lt;pid&gt;</code></p>
<p>List all available signal and corresponding number: <code>kill -l</code></p>
<p>Kill all child processes: <code>pkill -P &lt;ppid&gt;</code></p>
<p>Kill all processes whose name matches a regex pattern: <code>pkill -9 &lt;pattern&gt;</code></p>
<p>Kill by exact name (safer than pkill), unless -r is specified: <code>killall &lt;name&gt;</code></p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="locate-and-analyze-system-log-files"><a class="header" href="#locate-and-analyze-system-log-files">Locate and analyze system log files</a></h2>
<p>In Linux, logs come from different sources, mainly:</p>
<ul>
<li>
<p><strong>systemd journal</strong>: most Linux distros have <strong>systemd</strong> to manage services (like SSH above), systemd catches the output of these services (i.e., logs like the one above) and writes them to the <strong>journal</strong>, the journal is written in a binary format, so you'll use <code>journalctl</code> to explore it, like:</p>
<pre><code>journalctl
&gt;-- Logs begin at Tue 2021-01-05 15:47:18 CET, end at Sat 2021-04-03 10:14:41 CEST. --
&gt;Jan 05 15:47:18 user@hostname kernel: microcode: microcode updated early to revision 0xd6, date = 2020-04-27
&gt;Jan 05 15:47:18 user@hostname kernel: Linux version 5.4.0-59-generic (buildd@lcy01-amd64-028) (gcc version 9.3.0 (Ubuntu 9.3.0-17ubuntu1~20.&gt;04)) #65-Ubuntu SMP Thu Dec 10 12&gt;
&gt;Jan 05 15:47:18 user@hostname kernel: Command line: BOOT_IMAGE=/boot/vmlinuz-5.4.0-59-generic root=UUID=1c568adb-6778-42a6-93e0-a3cab4f81e8f ro quiet splash vt.handoff=7
</code></pre>
</li>
<li>
<p><strong>syslog</strong>: when there's no systemd, processes like SSH can write to a UNIX socket (e.g., /dev/log) in the syslog message format. A syslog daemon (e.g., <strong>rsyslog</strong>) then picks the message, parses it and writes it to various destinations. By default, it writes to files in <strong>/var/log</strong></p>
</li>
<li>
<p>the Linux kernel writes its own logs to a <strong>ring buffer</strong>. Systemd or the syslog daemon can read logs from this buffer, then write to the journal or flat files (typically /var/log/kern.log). You can also see kernel logs directly via dmesg:</p>
<pre><code>dmesg -T
&gt;...
&gt;[Tue May 5 08:41:31 2020] EXT4-fs (sda1): mounted filesystem with ordered data mode. Opts: (null)
&gt;...
</code></pre>
</li>
<li>
<p><strong>application logs</strong>: non-system applications tend to write to /var/log as well.</p>
</li>
</ul>
<p>These sources can interact with each other: journald can forward all its messages to syslog. Applications can write to syslog or the journal.</p>
<p>Typically, you'll find Linux server logs in the /var/log directory and sub-directory. This is where syslog daemons are normally configured to write. It's also where most applications (e.g Apache httpd) write by default. For systemd journal, the default location is /var/log/journal, but you can't view the files directly because they're binary.</p>
<p>If your Linux distro uses systemd (and most modern distros do), then all your system logs are in the journal. To inspect the journal for logs related to a given unit, type: <code>journalctl -eu &lt;unit-name&gt;</code></p>
<p>By default, journalctl pages data through less, but if you want to filter through grep you'll need to disable paging: <code>journalctl --no-pager | grep "ufw"</code></p>
<p>If your distribution writes to local files via syslog, you can view them with standard text processing tools: <code>grep "error" /var/log/syslog | tail</code>. /var/log/syslog is the “catch-all” log file of rsyslod and contains much everything /var/log/messages used to contain in previous versions of Ubuntu, as this line from /etc/rsyslog.conf suggests: <code>*.* /var/log/syslog</code>. Each entry in this configuration file consists of two fields, the selector and the action. Each log message is associated with an application subsystem (called “facility” in the documentation) and each message is also associated with a priority level.</p>
<p>Some distributions have both: journald is set up to forward to syslog. This is done by setting <code>ForwardToSyslog=Yes</code> in /etc/systemd/journald.conf.</p>
<p>Kernel logs go by default to /var/log/dmesg and /var/log/kern.log.</p>
<p>To wait for new messages from the kernel ring buffer: <code>dmesg -w</code></p>
<p>A neat utility to place messages into the System Log arbitrarily is the <code>logger</code> tool: <code>logger "Hello World"</code></p>
<p>To send instead messages to the systemd journal: <code>echo 'hello' | systemd-cat [-t &lt;someapp&gt;] [-p &lt;logging-level&gt;]</code></p>
<p>Show only the most recent journal entries, and continuously print new entries as they are appended to the journal: <code>journalctl -f</code></p>
<p>To learn more about journactl options to view and manipulate systemd logs, look <a href="https://www.digitalocean.com/community/tutorials/how-to-use-journalctl-to-view-and-manipulate-systemd-logs">here</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="schedule-tasks-to-run-at-a-set-date-and-time"><a class="header" href="#schedule-tasks-to-run-at-a-set-date-and-time">Schedule tasks to run at a set date and time</a></h2>
<p>To run tasks at a specific time in the future different services are available:</p>
<ul>
<li><code>at</code> specifies a one-time task that runs at a certain time</li>
<li><code>cron</code> can schedule tasks on a repetitive basis, such as daily, weekly, or monthly</li>
<li><code>anacron</code> can  be  used  to  execute  commands periodically, with a frequency specified in days, but unlike cron, it does not assume that the machine is running continuously.</li>
</ul>
<hr />
<h3 id="cron"><a class="header" href="#cron">Cron</a></h3>
<p>The crond daemon is the background service that enables cron functionality.</p>
<p>The cron service checks for files in the <code>/var/spool/cron</code> and <code>/etc/cron.d</code> directories and the <code>/etc/anacrontab</code> file. The contents of these files define cron jobs that are to be run at various intervals. The individual user cron files are located in /var/spool/cron, and system services and applications generally add cron job files in the /etc/cron.d directory.</p>
<p>The cron utility runs based on commands specified in a cron table (crontab). Each user, including root, can have a cron file. These files don't exist by default, but can be created in the /var/spool/cron directory using the <code>crontab -e</code> command that's also used to edit a cron file:</p>
<pre><code>SHELL=/bin/bash
MAILTO=root@example.com
PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin

# For details see man 4 crontabs

# Example of job definition:
# .---------------- minute (0 - 59)
# |  .------------- hour (0 - 23)
# |  |  .---------- day of month (1 - 31)
# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...
# |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat
# |  |  |  |  |
# *  *  *  *  * user-name  command to be executed

# backup using the rsbu program to the internal 4TB HDD and then 4TB external
01 01 * * * /usr/local/bin/rsbu -vbd1 ; /usr/local/bin/rsbu -vbd2

# Set the hardware clock to keep it in sync with the more accurate system clock
03 05 * * * /sbin/hwclock --systohc

# Perform monthly updates on the first of the month
# 25 04 1 * * /usr/bin/dnf -y update
</code></pre>
<p>The first three lines in the code above set up a default environment. The environment must be set to whatever is necessary for a given user because cron does not provide an environment of any kind.</p>
<blockquote>
<p>Warning: If no user is specified, the job is run as the user that owns the crontab file, root in the case of the root crontab.</p>
</blockquote>
<p>To prevent possible misuse, you can control access to the <code>crontab</code> command by using two files in the /etc/cron.d directory: <code>cron.deny</code> and <code>cron.allow</code>. These files permit only specified users to perform crontab command tasks such as creating, editing, displaying, or removing their own crontab files.</p>
<p>The cron.deny and cron.allow files consist of a list of user names, one user name per line.</p>
<p>These access control files work together as follows:</p>
<ul>
<li>if cron.allow exists, only the users who are listed in this file can create, edit, display, or remove crontab files</li>
<li>if cron.allow does not exist, all users can submit crontab files, except for users who are listed in cron.deny</li>
<li>if neither cron.allow nor cron.deny exists, superuser privileges are required to run the crontab command.</li>
</ul>
<h3 id="anacron"><a class="header" href="#anacron">Anacron</a></h3>
<p>The <strong>anacron</strong> program performs the same function as crond, but it adds the ability to run jobs that were skipped, such as if the computer was off or otherwise unable to run the job for one or more cycles. The anacron program provides some easy options for running regularly scheduled tasks. Just install your scripts in the <code>/etc/cron.[hourly|daily|weekly|monthly]</code> directories, depending how frequently they need to be run (but see below tip). Alternatively, specify the job to run in <code>/etc/anacrontab</code> as you would do with the crontab but with anacron-specific syntax (see below).</p>
<p>anacron itself doesn't run as a service/daemon, but as a cron job: /etc/cron.d/anacron. So cron is running and checking if anacron is present for the daily, weekly and monthly tasks (it would be duplication of effort to have both running preriod-fixed tasks), but not for the hourly tasks. cron runs the hourly tasks.</p>
<p>So, actually anacron uses a variety of methods to run:</p>
<ul>
<li>if the system is running systemd, it uses a systemd timer (in the Debian package, you'll see it in /lib/systemd/system/anacron.timer)</li>
<li>if the system isn't running systemd, it uses a system cron job (in /etc/cron.d/anacron)</li>
<li>in all cases it runs daily, weekly and monthly cron jobs (in /etc/cron.{daily,weekly,monthly}/0anacron)</li>
<li>it also runs at boot (from /etc/init.d/anacron or its systemd unit).</li>
</ul>
<p>anacron will check if a job has been executed within the specified period in the period field. If not, it executes the command specified in the command field after waiting the number of minutes specified in the delay field. Once the job has been executed, it records the date in a timestamp file in the /var/spool/anacron directory with the name specified in the job-id field:</p>
<pre><code>cat /var/spool/anacron/bck.weekly
&gt;20210328
</code></pre>
<p>To quickly check if anacron jobs are really executed, you can force immediately their execution: <code>anacron -f -n</code></p>
<blockquote>
<p>Note: The specified delay times in each line help prevent these jobs from overlapping themselves and other cron jobs.</p>
</blockquote>
<blockquote>
<p>Tip: Instead of placing whole bash programs in the cron.X directories, just install them in the <code>/usr/local/bin</code> directory, which will allow you to run them easily from the command line. Then, add a symlink in the appropriate cron directory, such as <code>/etc/cron.daily</code>.</p>
</blockquote>
<h3 id="examples-of-job-definition-syntax"><a class="header" href="#examples-of-job-definition-syntax">Examples of job definition syntax:</a></h3>
<p>Every minute of every day:</p>
<pre><code># m h dom mon dow command
* * * * * /home/user/command.sh
# or
0-59 0-23 0-31 0-12 0-7 /home/user/command.sh
</code></pre>
<p>Every 15 minutes of every day:</p>
<pre><code># m h dom mon dow command
*/15 * * * * /home/user/command.sh
# or
0-59/15 * * * * /home/user/command.sh
# or
0,15,30,45 * * * * /home/user/command.sh
</code></pre>
<blockquote>
<p>Note: The division expressions must result in a remainder of zero for the job to run.</p>
</blockquote>
<p>Every 5 minutes of the 2 am hour starting at 2:03:</p>
<pre><code># m h dom mon dow command
03-59/5 02 * * * /home/user/command.sh
# This runs at 2:03, 2:08, 2:13, 2:18, 2:23, and so on until 2:58
</code></pre>
<p>Every day at midnight:</p>
<pre><code># m h dom mon dow command
0 0 * * * /home/user/command.sh
# or
0 0 * * 0-7 /home/user/command.sh
</code></pre>
<p>Twice a day:</p>
<pre><code># m h dom mon dow command
0 */12 * * * /home/user/command.sh
# or
# m h dom mon dow command
0 0-23/12 * * * /home/user/command.sh
# or
0 0,12 * * * /home/user/command.sh
</code></pre>
<p>Every weekday at 2 am:</p>
<pre><code># m h dom mon dow command
0 02 * * 1-5 /home/user/command.sh
</code></pre>
<p>Weekends at 2 am:</p>
<pre><code># m h dom mon dow command
0 02 * * 6,7 /home/user/command.sh
# or
0 02 * * 6-7 /home/user/command.sh
</code></pre>
<p>Once a month on the 15th at 2 am:</p>
<pre><code># m h dom mon dow command
0 02 15 * * /home/user/command.sh
</code></pre>
<p>Every 2 days at 2 am:</p>
<pre><code># m h dom mon dow command
0 02 */2 * * /home/user/command.sh
</code></pre>
<p>Every 2 months at 2 am on the 1st:</p>
<pre><code># m h dom mon dow command
0 02 1 */2 * /home/user/command.sh
</code></pre>
<h3 id="shortcuts"><a class="header" href="#shortcuts">Shortcuts</a></h3>
<p>The are shortcuts which can be used to replace the five fields usually used to specify times. The <code>@</code> character is used to identify shortcuts to cron. The list below, taken from the crontab(5) man page, shows the shortcuts with their equivalent meanings.</p>
<ul>
<li><code>@reboot</code>: run once after reboot</li>
<li><code>@yearly</code>: run once a year, i.e. <code>0 0 1 1 *</code></li>
<li><code>@annually</code>: run once a year, i.e. <code>0 0 1 1 *</code></li>
<li><code>@monthly</code>: run once a month, i.e. <code>0 0 1 * *</code></li>
<li><code>@weekly</code>: run once a week, i.e. <code>0 0 * * 0</code></li>
<li><code>@daily</code>: run once a day, i.e. <code>0 0 * * *</code></li>
<li><code>@hourly</code>: run once an hour, i.e. <code>0 * * * *</code></li>
</ul>
<p>These shortcuts can be used in any of the crontab files.</p>
<h3 id="at"><a class="header" href="#at">At</a></h3>
<p><code>at</code> is an interactive command-line utility that allows you to schedule commands to be executed at a particular time. Jobs created with at are executed only once.</p>
<p>The at command takes the date and time (runtime) when you want to execute the job as a command-line parameter, and the command to be executed from the standard input.</p>
<p>Let's create a job that will be executed at 9:00 am: <code>at 09:00</code></p>
<p>Once you hit Enter, you'll be presented with the at command prompt that most often starts with <code>at&gt;</code>. You also see a warning that tells you the shell in which the command will run:</p>
<pre><code>warning: commands will be executed using /bin/sh
at&gt;
</code></pre>
<p>Enter one or more command you want to execute: <code>tar -xf /home/linuxize/file.tar.gz</code></p>
<p>When you're done entering the commands, press Ctrl-D to exit the prompt and save the job:</p>
<pre><code>at&gt; &lt;EOT&gt;
job 4 at Tue May  5 09:00:00 2020
</code></pre>
<p>The command will display the job number and the execution time and date.</p>
<p>There are also other ways to pass the command you want to run, besides entering the command in the at prompt. One way is to use echo and pipe the command to at:</p>
<pre><code>echo "command_to_be_run" | at 09:00
</code></pre>
<p>The at utility accepts a wide range of time specifications. You can specify time, date, and increment from the current time:</p>
<ul>
<li>
<p>time: to specify a time, use the <code>HH:MM</code> or <code>HHMM</code> form. To indicate a 12-hour time format, use <code>am</code> or <code>pm</code> after the time (e.g. <code>at 1pm + 2 days</code>). You can also use strings like <code>now</code>, <code>midnight</code>, <code>noon</code>, or <code>teatime</code> (16:00). If the specified time is passed, the job will be executed the next day.</p>
</li>
<li>
<p>date: the command allows you to schedule job execution on a given date. The date can be specified using the month name followed by the day and an optional year. You can use strings, such as <code>today</code>, <code>tomorrow</code>, or weekday. The date can be also indicated using the <code>MMDD[CC]YY</code>, <code>MM/DD/[CC]YY</code>, <code>DD.MM.[CC]YY</code> or <code>[CC]YY-MM-DD</code> formats (e.g. <code>at 12:30 102120</code>).</p>
</li>
<li>
<p>increment: at also accepts increments in the <code>now + count time-unit</code> format, where <code>count</code> is a number and <code>time-unit</code> can be one of the following strings: <code>minutes</code>, <code>hours</code>, <code>days</code>, or <code>weeks</code> (e.g. <code>at sunday +10 minutes</code>).</p>
</li>
</ul>
<p>Time, date and increment can be combined.</p>
<p>Alternatively, use a here document or pass a file with <code>-f</code>.</p>
<p>To list the user's pending jobs run the atq or at -l command: <code>atq</code></p>
<p>To remove a pending job invoke the atrm or at -r command followed by the job number: <code>atrm 9</code></p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="verify-completion-of-scheduled-jobs"><a class="header" href="#verify-completion-of-scheduled-jobs">Verify completion of scheduled jobs</a></h2>
<p>First, check the status of the cron service to ensure it is currently running: <code>sudo systemctl status cron</code></p>
<p>Check if rsyslogd is logging cron jobs execution in its own file:</p>
<pre><code>cat /etc/rsyslog.d/50-default.conf | grep cron
&gt;#cron.*                         /var/log/cron.log
</code></pre>
<p>If this line is commentd as above, the cron logs are on the syslog dump file.</p>
<p><code>crond</code> (unless configured otherwise, as said above) will send a log message to syslog every time it invokes a scheduled job. The simplest way to verify that cron tried to run the job is to simply examine the logs: <code>grep -E "(ana)*cron" /var/log/syslog</code></p>
<blockquote>
<p>Note: If you have a mail transfer agent — such as Sendmail — installed and properly configured on your server, you can send the output of cron tasks to the email address associated with your Linux user profile. You can also manually specify an email address by providing a MAILTO setting at the top of the crontab.</p>
</blockquote>
<p>For <code>anacron</code>, you can force the execution of the scheduled jobs: <code>sudo anacron -f -n</code>, and then examining the logs: <code>tail -f  /var/log/syslog</code>. The timestamp for each job is stored in <code>/var/spool/anacron</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="update-software-to-provide-required-functionality-and-security"><a class="header" href="#update-software-to-provide-required-functionality-and-security">Update software to provide required functionality and security</a></h2>
<p>Update the system in one line: <code>sudo apt update &amp;&amp; sudo apt upgrade -y &amp;&amp; sudo apt autoremove -y</code></p>
<p>The command <code>dist-upgrade</code> does a little trickier work the just <code>upgrade</code>, handling upgrades which may have been held back by the latter. It is usually run before upgrading Ubuntu to a new LTS version by executing <code>sudo do-release-upgrade</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="verify-the-integrity-and-availability-of-resources"><a class="header" href="#verify-the-integrity-and-availability-of-resources">Verify the integrity and availability of resources</a></h2>
<p>Display amount of free and used memory in the system:
<code>free -h</code></p>
<p>Report virtual memory statistics:
<code>vmstat 1 5</code></p>
<p>Report Central Processing Unit (CPU) statistics and input/output statistics for devices and partitions:
<code>iostat 1 2</code></p>
<p>Display a periodically updated table of I/O usage:
<code>sudo iotop</code></p>
<p>Collect, report and save system activity information in a binary file:
<code>sar 2 5 -o report.file</code></p>
<p>Find which process lock a file:</p>
<pre><code>less .vimrc
# put in background (ctrl+Z)
fuser .vimrc
.vimrc:              28135
</code></pre>
<p>or:
<code>lsof | grep .vimrc</code></p>
<p>See currently used swap areas:
<code>cat /proc/swaps</code></p>
<p>Examine filesystem capacity and usage:
<code>df -hT</code></p>
<p>Find what is eating up disk space:
<code>sudo du -x -d1 -h / | sort -h</code></p>
<blockquote>
<p>Note: The flag -h makes <code>sort</code> command to compare numbers in human readable format.</p>
</blockquote>
<p>See if a piece of hardware is detected:
<code>lspci</code></p>
<p>or:
<code>lsusb</code></p>
<p>Find open ports on your machine:
<code>sudo netstat -nlptu</code></p>
<p>Find laptop battery charge state and percentage:
<code>upower -i $(upower -e | grep _BAT) | grep -P "(state|percentage)"</code></p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="verify-the-integrity-and-availability-of-key-processes"><a class="header" href="#verify-the-integrity-and-availability-of-key-processes">Verify the integrity and availability of key processes</a></h2>
<p>Analyze boot time with regard to single processes:
<code>systemd-analyze blame</code></p>
<p>List process sorted per cpu usage in descending order:
<code>ps aux --sort=-pcpu | head</code></p>
<p>List processes in tree format:
<code>ps -e --forest</code></p>
<p>Displays a dynamic real-time view of a running processes and threads:
<code>top</code></p>
<p>List process table sorted by an arbitrary column:
<code>ps aux | sort -n -k 3 | head</code></p>
<p>Get a visual description of process ancestry or multi-threaded applications:
<code>pstree -aAp &lt;pid&gt;</code></p>
<p>Find the process ID of a running process:
<code>pidof &lt;process&gt;</code></p>
<p>Intercept and log the system calls:
<code>strace -Ff -tt &lt;program&gt; &lt;arg&gt; 2&gt;&amp;1 | tee strace-&lt;program&gt;.log</code></p>
<p>Use <code>-p</code> for an already running process.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="change-kernel-runtime-parameters-persistent-and-non-persistent"><a class="header" href="#change-kernel-runtime-parameters-persistent-and-non-persistent">Change kernel runtime parameters, persistent and non-persistent</a></h2>
<p>The latest specification of the Filesystem Hierarchy Standard indicates that /proc represents the default method for handling process and system information as well as other kernel and memory information. Particularly, <code>/proc/sys</code> is where you can find all the information about devices, drivers, and some kernel features.</p>
<p>If you want to view the complete list of Kernel parameters, just type:</p>
<pre><code>sysctl -a 
</code></pre>
<p>It's possible to view the value of a particular Linux kernel parameter using either <code>sysctl</code> followed by the name of the parameter or reading the associated file:</p>
<pre><code>sysctl dev.cdrom.autoclose
cat /proc/sys/dev/cdrom/autoclose
sysctl net.ipv4.ip_forward
cat /proc/sys/net/ipv4/ip_forward
</code></pre>
<p>To set the value for a kernel parameter we can use <code>sysctl</code>, but using the <code>-w</code> option and followed by the parameter's name, the equal sign, and the desired value.</p>
<p>Another method consists of using echo to overwrite the file associated with the parameter. In other words, the following methods are equivalent to disable the packet forwarding functionality in our system (which, by the way, should be the default value when a box is not supposed to pass traffic between networks):</p>
<pre><code>echo 0 &gt; /proc/sys/net/ipv4/ip_forward
sysctl -w net.ipv4.ip_forward=0
</code></pre>
<p>It is important to note that kernel parameters that are set using sysctl will only be enforced during the current session and will disappear when the system is rebooted. To set these values permanently, edit /etc/sysctl.conf with the desired values. For example, to disable packet forwarding in /etc/sysctl.conf make sure this line appears in the file:
<code>net.ipv4.ip_forward=0</code></p>
<p>Then run following command to apply the changes to the running configuration.
<code>sysctl -p</code></p>
<p>Other examples of important kernel runtime parameters are:</p>
<ul>
<li>
<p><code>fs.file-max</code> specifies the maximum number of file handles the kernel can allocate for the system. Depending on the intended use of your system (web / database / file server, to name a few examples), you may want to change this value to meet the system's needs. Otherwise, you will receive a “Too many open files” error message at best, and may prevent the operating system to boot at the worst. If due to an innocent mistake you find yourself in this last situation, boot in single user mode and edit /etc/sysctl.conf as instructed earlier. To set the same restriction on a per-user basis, use <code>ulimit</code>.</p>
</li>
<li>
<p><code>kernel.sysrq</code> is used to enable the SysRq key in your keyboard (also known as the print screen key) so as to allow certain key combinations to invoke emergency actions when the system has become unresponsive. The default value (16) indicates that the system will honor the Alt+SysRq+key combination and perform the actions listed in the sysrq.c documentation found in kernel.org (where key is one letter in the b-z range). For example, Alt+SysRq+b will reboot the system forcefully (use this as a last resort if your server is unresponsive).</p>
</li>
</ul>
<blockquote>
<p>Warning: Do not attempt to press this key combination on a virtual machine because it may force your host system to reboot!</p>
</blockquote>
<ul>
<li>when set to 1, <code>net.ipv4.icmp_echo_ignore_all</code> will ignore ping requests and drop them at the kernel level.</li>
</ul>
<p>A better and easier way to set individual runtime parameters is using .conf files inside /etc/sysctl.d, grouping them by categories.</p>
<p>For example, instead of setting net.ipv4.ip_forward=0 and net.ipv4.icmp_echo_ignore_all=1 in /etc/sysctl.conf, we can create a new file named net.conf inside /etc/sysctl.d:</p>
<pre><code>echo "net.ipv4.ip_forward=0" &gt; /etc/sysctl.d/net.conf
echo "net.ipv4.icmp_echo_ignore_all=1" &gt;&gt; /etc/sysctl.d/net.conf
</code></pre>
<p>Again, type <code>sysctl -p </code> toreload permanent configuration. Alternatively, reboot the system.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="use-scripting-to-automate-system-maintenance-tasks"><a class="header" href="#use-scripting-to-automate-system-maintenance-tasks">Use scripting to automate system maintenance tasks</a></h2>
<p>A bash shell script:</p>
<ul>
<li>begins with a shebang (<code>#!/bin/bash</code>) which tells the operating system which interpreter to use to parse the rest of the file</li>
<li>contains a series of commands or/and typical constructs of imperative programming</li>
<li>is usually associated with the <code>.sh</code> extension</li>
<li>must be executable: <code>chmod +x &lt;file&gt;.sh</code></li>
<li>can be executed by typing: <code>./&lt;file&gt;.sh</code></li>
</ul>
<p>To learn more about bash, have a look at the <a href="2-operation-of-running-systems/../7-bonus-miscellanea/a.html">bash refresher</a> in this repo.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="manage-the-startup-process-and-services"><a class="header" href="#manage-the-startup-process-and-services">Manage the startup process and services</a></h2>
<p>To start a service by typing: <code>sudo systemctl start &lt;unit&gt;.service</code></p>
<p>To stop it: <code>sudo systemctl stop &lt;unit&gt;.service</code></p>
<p>To restart the service, we can type: <code>sudo systemctl restart &lt;unit&gt;.service</code></p>
<p>To attempt to reload the service without interrupting normal functionality, we can type: <code>sudo systemctl reload &lt;unit&gt;.service</code></p>
<blockquote>
<p>Note: "Loading" means parsing the unit's configuration and keeping it in memory.</p>
</blockquote>
<p>To enable a service to start automatically at boot, type: <code>sudo systemctl enable &lt;unit&gt;.service</code></p>
<p>This will create a symbolic link from the system's copy of the service file (usually in /lib/systemd/system or /etc/systemd/system) into the location on disk where systemd looks for autostart files (usually <code>/etc/systemd/system/some_target.target.wants</code>).</p>
<blockquote>
<p>Note: To enable and start a service, use: <code>sudo systemctl enable --now &lt;unit&gt;.service</code></p>
</blockquote>
<p>If you wish to disable the service again, type: <code>sudo systemctl disable &lt;unit&gt;.service</code></p>
<p>To get all of the unit files that systemd has listed as “active”, type: <code>systemctl list-units</code></p>
<blockquote>
<p>Note: You can actually leave off the list-units as this is the default systemctl behavior.</p>
</blockquote>
<p>To list all of the units that systemd has loaded or attempted to load into memory, including those that are not currently active, add the <code>--all</code> switch:
<code>systemctl list-units --all</code></p>
<p>To list all of the units installed on the system, including those that systemd has not tried to load into memory, type: <code>systemctl list-unit-files</code></p>
<p>To see only active service units, we can use: <code>systemctl list-units --type=service</code></p>
<p>To show whether the unit is active, information about the process, and the latest journal entries: <code>systemctl status &lt;unit&gt;.service</code></p>
<p>A unit file contains the parameters that systemd uses to manage and run a unit. To see the full contents of a unit file (and the ovverriding files, if any), type:
<code>systemctl cat &lt;unit&gt;.service</code></p>
<p>To see the dependency tree of a unit (which units systemd will attempt to activate when starting the unit), type:
<code>systemctl list-dependencies &lt;unit&gt;.service</code></p>
<p>This will show the dependent units, with target units recursively expanded. To expand all dependent units recursively, pass the --all flag:
<code>systemctl list-dependencies --all &lt;unit&gt;.service</code></p>
<p>Finally, to see the low-level details of the unit's settings on the system, you can use the show option:
<code>systemctl show &lt;unit&gt;.service</code></p>
<p>To add a unit file snippet, which can be used to append or override settings in the default unit file, simply call the edit option on the unit:
<code>sudo systemctl edit &lt;unit&gt;.service</code></p>
<p>This will be a blank file that can be used to override or add directives to the unit definition. A directory will be created within the <code>/etc/systemd/system</code> directory which contains the name of the unit with <code>.d</code> appended. For instance, for the <code>nginx.service</code>, a directory called <code>nginx.service.d</code> will be created. Within this directory, a snippet will be created called override.conf. When the unit is loaded, systemd will, in memory, merge the override snippet with the full unit file. The snippet's directives will take precedence over those found in the original unit file (usually found somewhere in <code>/lib/systemd/system</code>).</p>
<p>If you prefer to modify the entire content of the unit file instead of creating a snippet, pass the <code>--full</code> flag:
<code>sudo systemctl edit --full &lt;unit&gt;.service</code></p>
<p>After modifying a unit file, you should reload the systemd process itself to pick up your changes:
<code>sudo systemctl daemon-reload</code></p>
<p>systemd also has the ability to mark a unit as completely unstartable, automatically or manually, by linking it to /dev/null. This is called <strong>masking</strong> the unit, and is possible with the mask command: <code>sudo systemctl mask nginx.service</code></p>
<p>Use <code>unmask</code> to undo the masking.</p>
<hr />
<p>The files that define how systemd will handle a unit can be found in many different locations, each of which have different priorities and implications.</p>
<p>The system's copy of unit files are generally kept in the <code>/lib/systemd/system</code> directory. When software installs unit files on the system, this is the location where they are placed by default. You should not edit files in this directory. Instead you should override the file, if necessary, using another unit file location which will supersede the file in this location. The best location to do so is within the <code>/etc/systemd/system</code> directory. Unit files found in this directory location take precedence over any of the other locations on the filesystem. If you need to modify the system's copy of a unit file, putting a replacement in this directory is the safest and most flexible way to do this. If you wish to override only specific directives from the system's unit file, you can actually provide unit file snippets within a subdirectory. These will append or modify the directives of the system's copy, allowing you to specify only the options you want to change. The correct way to do this is to create a directory named after the unit file with <code>.d</code> appended on the end. So for a unit called example.service, a subdirectory called <code>example.service.d</code> could be created. Within this directory a file ending with <code>.conf</code> can be used to override or extend the attributes of the system's unit file. There is also a location for run-time unit definitions at <code>/run/systemd/system</code>. Unit files found in this directory have a priority landing between those in /etc/systemd/system and /lib/systemd/system. The systemd process itself uses this location for dynamically created unit files created at runtime. This directory can be used to change the system's unit behavior for the duration of the session. All changes made in this directory will be lost when the server is rebooted.</p>
<p>To learn more about unit files, look <a href="https://www.digitalocean.com/community/tutorials/understanding-systemd-units-and-unit-files">here</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="list-and-identify-selinuxapparmor-file-and-process-contexts"><a class="header" href="#list-and-identify-selinuxapparmor-file-and-process-contexts">List and identify SELinux/AppArmor file and process contexts</a></h2>
<h3 id="1-selinux"><a class="header" href="#1-selinux">1. SELinux</a></h3>
<p>Security-Enhanced Linux (SELinux) is a Linux kernel security module that provides a mechanism for supporting access control security policies, including mandatory access controls, which restricts ability of processes to access or perform other operations on system objects (files, dirs, network ports, etc). Mostly used in CentOS.</p>
<p>Modes: <strong>enforcing</strong>, <strong>permissive</strong> (i.e. logging mode), <strong>disabled</strong>.</p>
<p>To install it on Ubuntu:</p>
<pre><code>sudo apt install policycoreutils selinux-utils selinux-basics
sudo selinux-activate
sudo selinux-config-enforcing
sudo reboot                       
# The relabelling will be triggered after you reboot your system. When finished the system will reboot one more time automatically
sestatus
</code></pre>
<p>To disable SELinux open up the /etc/selinux/config configuration file and change the following line:</p>
<pre><code>#SELINUX=enforcing
SELINUX=disabled
</code></pre>
<p>Another way of permanently disabling the SELinux is to edit the kernel boot parameters. Edit the grub configuration at boot and add the <code>selinux=0</code> option to the kernel options.</p>
<p>Get current mode: <code>getenforce</code></p>
<p>Set current mode (non-persistent): <code>setenforce [Enforcing|Permissive|1|0]</code></p>
<blockquote>
<p>Note: <code>1</code> is for enforcing, <code>0</code> is for permissive mode.</p>
</blockquote>
<p>To set a mode persistently, manually edit <code>/etc/selinux/config</code> and set the <code>SELINUX</code> variable to either <code>enforcing</code>, <code>permissive</code>, or <code>disabled</code> in order to achieve persistence across reboots.</p>
<p>To get SELinux man pages:</p>
<pre><code>yum install selinux-policy-devel
mandb                                                               # update man pages database
apropos selinux                                                     # see man pages
</code></pre>
<p>See security context for file/dir and processes:</p>
<pre><code>ls -lZ &lt;dir&gt;
&gt; drwxrwxr-x. vagrant vagrant unconfined_u:object_r:user_home_t:s0 cheat
ps auZ
</code></pre>
<p>Check audit logs for SELinux related files:</p>
<pre><code>cat /var/log/audit/audit.log | grep AVC | tail -f
</code></pre>
<blockquote>
<p>Note: SELinux log messages include the word “AVC” so that they might be easily identified from other messages.</p>
</blockquote>
<p>Main commands: <code>semanage</code> and <code>sepolicy</code>.</p>
<p>Get SELinux policy:</p>
<pre><code>sepolicy -a                                                         # see all policies with descriptions
getsebool -a                                                        # see state of all policies
</code></pre>
<p>Change file SELinux security context:</p>
<pre><code>chcon -t etc_t somefile                                             # set type TYPE in the target security context 
chcon --reference RFILE file                                        # use RFILE's security context rather than specifying a CONTEXT value  
</code></pre>
<p>Use <code>getselbool</code> and <code>setselbool</code> to configure SEL policy behaviour at runtime without rewriting the policy itself.</p>
<p>Two classic cases where we will most likely have to deal with SELinux are:</p>
<ul>
<li>changing the default port where a daemon listens on</li>
<li>setting the DocumentRoot directive for a virtual host outside of /var/www/html.</li>
</ul>
<p>If you tried to change the default ssh port to 9999, taking a look at /var/log/audit/audit.log, you would see that sshd can be prevented from starting on port 9999 by SELinux because that is a reserved port for the JBoss Management service.To modify the existing SELinux rule and assign that port to SSH instead:</p>
<pre><code>semanage port -l | grep ssh                                         # find ssh policy
semanage port -m -t ssh_port_t -p tcp 9999                          # -m for modiy, -a for add, -d for delete
</code></pre>
<p>If you need to set up a Apache virtual host using a directory other than /var/www/html as DocumentRoot. Apache will refuse to serve the content because the index.html has been labeled with the <code>default_t</code> SELinux type, which Apache can't access. To add apache read-only access to dir:</p>
<pre><code>semanage fcontext -a -t httpd_sys_content_t "/custom_dir(/.*)?"     #  -a add, -t type
restorecon -R -v /custom_dir                                        # remember to run restorecon after you set the file context
</code></pre>
<h3 id="2-apparmor"><a class="header" href="#2-apparmor">2. AppArmor</a></h3>
<p>AppArmor (AA) is a Linux kernel security module that allows the system administrator to restrict programs' capabilities with per-program profiles. Profiles can allow capabilities like network access, raw socket access, and the permission to read, write, or execute files on matching paths. AppArmor is installed and loaded by default in Ubuntu.</p>
<p>The optional apparmor-utils package contains command line utilities that you can use to change the AppArmor execution mode, find the status of a profile, create new profiles, etc: <code>sudo apt-get install apparmor-utils</code></p>
<p>Programs can run in:</p>
<ul>
<li>encforce mode (default)</li>
<li>complain mode.</li>
</ul>
<p>The /etc/apparmor.d directory is where the AppArmor profiles are located. It can be used to manipulate the mode of all profiles. The files are named after the full path to the executable they profile replacing the “/” with “.”. For example /etc/apparmor.d/bin.ping is the AppArmor profile for the /bin/ping command. There are two main type of rules used in profiles:</p>
<ul>
<li>path entries: detail which files an application can access in the file system</li>
<li>capability entries: determine what privileges a confined process is allowed to use.</li>
</ul>
<p>It comes with a list of utilities whose name always starts with "aa-".</p>
<p>Find out if AppArmor is enabled (returns <code>Y</code> if true):</p>
<pre><code>cat /sys/module/apparmor/parameters/enabled
</code></pre>
<p>To view the current status of AppArmor profiles: <code>sudo apparmor_status</code></p>
<p>Put a profile in complain mode: <code>sudo aa-complain &lt;/path/to/bin&gt;</code></p>
<p>Put a profile in enforce mode: <code>sudo aa-enforce &lt;/path/to/bin&gt;</code></p>
<p>Enter the following to place all profiles into complain mode: <code>sudo aa-complain /etc/apparmor.d/*</code></p>
<p>You can generate a profile for a program while it is running, AA will scan /var/log/syslog for errors:</p>
<pre><code>aa-genprof &lt;executable&gt;
# once done, reload the policies
sudo systemctl reload apparmor
</code></pre>
<p>When the program is misbehaving, audit messages are sent to the log files. The program aa-logprof can be used to scan log files for AppArmor audit messages, review them and update the profiles. From a terminal: <code>sudo aa-logprof</code></p>
<p>List all loaded AppArmor profiles for applications and processes and detail their status (enforced, complain, unconfined):</p>
<pre><code>sudo aa-status
</code></pre>
<p>List running executables which are currently confined by an AppArmor profile:</p>
<pre><code>ps auxZ | grep -v '^unconfined'
</code></pre>
<p>List of processes with tcp or udp ports that do not have AppArmor profiles loaded:</p>
<pre><code>sudo aa-unconfined
</code></pre>
<p>To reload a currently loaded profile after modifying it to have the changes take effect:
<code>sudo apparmor_parser -r /etc/apparmor.d/profile.name</code></p>
<p>To disable one profile:</p>
<pre><code>sudo ln -s /etc/apparmor.d/profile.name /etc/apparmor.d/disable/
sudo apparmor_parser -R /etc/apparmor.d/profile.name
</code></pre>
<p>To re-enable a disabled profile remove the symbolic link to the profile in /etc/apparmor.d/disable/, then load the profile using the <code>-a</code> option:</p>
<pre><code>sudo rm /etc/apparmor.d/disable/profile.name
cat /etc/apparmor.d/profile.name | sudo apparmor_parser -a
</code></pre>
<p>The AppArmor Linux Security Modules (LSM) must be enabled from the linux kernel command line in the bootloader:</p>
<pre><code>sudo mkdir -p /etc/default/grub.d
echo 'GRUB_CMDLINE_LINUX_DEFAULT="$GRUB_CMDLINE_LINUX_DEFAULT apparmor=1 security=apparmor"' | sudo tee /etc/default/grub.d/apparmor.cfg
sudo update-grub
sudo reboot
</code></pre>
<p>If AppArmor must be disabled (e.g. to use SELinux instead), users can:
<code>sudo systemctl disable --now apparmor</code></p>
<p>To disable AppArmor at the kernel level:</p>
<pre><code>sudo mkdir -p /etc/default/grub.d
echo 'GRUB_CMDLINE_LINUX_DEFAULT="$GRUB_CMDLINE_LINUX_DEFAULT apparmor=0"' | sudo tee /etc/default/grub.d/apparmor.cfg
sudo update-grub
sudo reboot
</code></pre>
<p>AppArmor is enabled by default. If you used the above procedures, to disable it, you can re-enable it by:</p>
<ul>
<li>ensuring that AppArmor is not disabled in <em>/etc/default/grub</em> if using Ubuntu kernels, or if using non-Ubuntu kernels, that /etc/default/grub has <em>apparmor=1</em> and <em>security=apparmor</em></li>
<li>ensuring that the <em>apparmor</em> package is installed</li>
<li>enabling the systemd unit: <code>sudo systemctl enable --now apparmor</code></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h2 id="manage-software"><a class="header" href="#manage-software">Manage software</a></h2>
<p><code>apt</code> is a high-level command-line utility for installing, updating, removing, and otherwise managing deb packages on Ubuntu, Debian, and related Linux distributions. It combines the most frequently used commands from the <code>apt-get</code> and apt-cache tools with different default values of some options.</p>
<blockquote>
<p>Note: Prefer using apt-get and apt-cache in your shell scripts as they are backward compatible between the different versions and have more options and features.</p>
</blockquote>
<p>The first command updates the APT package index which is essentially a database of available packages from the repositories defined in the <code>/etc/apt/sources.list</code> file and in the <code>/etc/apt/sources.list.d</code> directory.</p>
<p>In addition to the officially supported package repositories available for Ubuntu, there exist additional community-maintained repositories which add thousands more packages for potential installation. Many other package sources are available, sometimes even offering only one package, as in the case of package sources provided by the developer of a single application.</p>
<blockquote>
<p>Warning: Two of the most popular are the <strong>universe</strong> and <strong>multiverse</strong> repositories. Packages in the multiverse repository often have licensing issues that prevent them from being distributed with a free operating system, and they may be illegal in your locality. Be advised that neither the universe or multiverse repositories contain officially supported packages. In particular, there may not be security updates for these packages. By default, the universe and multiverse repositories are enabled but if you would like to disable them edit /etc/apt/sources.list and comment the lines containing these repositories' names.</p>
</blockquote>
<p>Actions of the apt command, such as installation and removal of packages, are logged in the <code>/var/log/dpkg.log</code> log file.</p>
<hr />
<p>Installing packages is as simple as running the following command: <code>sudo apt install &lt;package&gt;</code></p>
<p>To remove the package including all configuration files: <code>sudo remove --purge install &lt;package&gt;</code></p>
<p>To list all available packages use the following command (optionally, only the installed or upgradable ones): <code>sudo apt list (--installed/--upgradeable)</code></p>
<p>To retrieve information about a given package, use the show command: <code>sudo apt show &lt;package&gt;</code></p>
<p>To prevent updating a specific package: <code>sudo apt-mark hold &lt;package&gt;</code></p>
<p>To remove the hold: <code>sudo apt-mark unhold &lt;package&gt;</code></p>
<p>Show all packages on hold: <code>sudo apt-mark showhold</code></p>
<p>To add an APT repository to either /etc/apt/sources.list or to a separate file in the /etc/apt/sources.list.d directory (e.g. MongoDB):</p>
<pre><code># first import the repository public key
sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 9DA31620334BD75D9DCB49F368818C72E52529D4
# add the MongoDB repository using the command below
sudo add-apt-repository 'deb [arch=amd64] https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.0 multiverse'
# you can now install any of the packages from the newly enabled repository
sudo apt install mongodb-org
</code></pre>
<p>For example, to add the a PPA repo (e.g. Jonathon F's PPA which provides FFmpeg version 4.x) you would run:</p>
<pre><code>sudo add-apt-repository ppa:jonathonf/ffmpeg-4`
# the PPA repository public key will be automatically downloaded and registered
# once the PPA is added to your system you can install the repository packages
sudo apt install ffmpeg
</code></pre>
<p>If for any reasons you want to remove a previously enabled repository, use the --remove option: <code>sudo add-apt-repository --remove 'deb [arch=amd64] https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.0 multiverse'</code></p>
<p>If you want to have more control over how your sources are organized you can manually edit the /etc/apt/sources.list file and add the apt repository line to the file, and then manually import the public repository key to your system with <code>apt-key</code>.</p>
<hr />
<p><code>dpkg</code> is a low-level package manager for Debian-based systems. It can install, remove, and build packages, but unlike other package management systems, it cannot automatically download and install packages or their dependencies. <code>apt</code> and <code>aptitude</code> are newer, and layer additional features on top of dpkg.</p>
<p>To list all packages in the system's package database, including all packages, installed and uninstalled, from a terminal prompt type:
<code>dpkg -l</code></p>
<p>Depending on the number of packages on your system, this can generate a large amount of output. Pipe the output through grep to see if a specific package is installed: <code>dpkg -l | grep &lt;package-name-or-regex&gt;</code></p>
<p>To list the files installed by a package, enter:
<code>dpkg -L &lt;package&gt;</code></p>
<p>If you are not sure which package installed a file, <code>dpkg -S</code> may be able to tell you. For example:</p>
<pre><code>dpkg -S /etc/host.conf 
base-files: /etc/host.conf
</code></pre>
<blockquote>
<p>Note: Many files are automatically generated during the package install process, and even though they are on the filesystem, dpkg -S may not know which package they belong to.</p>
</blockquote>
<p>You can install a local .deb file by entering: <code>sudo dpkg -i &lt;package&gt;_&lt;version&gt;-&lt;revision-num&gt;_&lt;arch&gt;.deb</code></p>
<blockquote>
<p>Note: For historical reasons, the 64-bit x86 architecture is called "amd64", while the 32-bit version is named "i386".</p>
</blockquote>
<p>Uninstalling a package can be accomplished by: <code>sudo dpkg -r &lt;package&gt; # -P instead removes also config files</code></p>
<blockquote>
<p>Warning: Uninstalling packages using dpkg, in most cases, is NOT recommended. It is better to use a package manager that handles dependencies to ensure that the system is in a consistent state. For example, using dpkg -r zip will remove the zip package, but any packages that depend on it will still be installed and may no longer function correctly.</p>
</blockquote>
<hr />
<p>Installing a package from source is the old-school approach of managing software. A source package provide you with all of the necessary files to compile or otherwise, build the desired piece of software. It consists, in its simplest form, of three files:</p>
<ul>
<li>the upstream tarball with <code>.tar.gz</code> ending</li>
<li>a description file with <code>.dsc ending.</code> It contains the name of the package, both, in its filename as well as content</li>
<li>a tarball, with any changes made to upstream source, plus all the files created for the Debian package (ending with <code>.debian.tar.gz</code> or a <code>.diff.gz</code>)</li>
</ul>
<p>To install a debian package from source:</p>
<ol>
<li>download the sources (or download it manually): <code> apt source &lt;package&gt;</code></li>
</ol>
<blockquote>
<p>Note: You need a deb-src entry in your /etc/apt/sources.list file, like: <code>deb-src http://http.us.debian.org/debian unstable main</code></p>
</blockquote>
<ol start="2">
<li>install the dependecies for the package: <code>apt build-dep &lt;package&gt;</code></li>
<li>go into the extracted source directory and then build the package:</li>
</ol>
<pre><code>dpkg-buildpackage -rfakeroot -b -uc -us
# or
debuild -b -uc -us
# or
apt source --compile
</code></pre>
<ol start="4">
<li>install the .deb file: <code>dpkg -i &lt;deb-file&gt;</code></li>
<li>if you see a error message caused by missing deependencies, type: <code>apt install -f</code></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h2 id="identify-the-component-of-a-linux-distribution-that-a-file-belongs-to"><a class="header" href="#identify-the-component-of-a-linux-distribution-that-a-file-belongs-to">Identify the component of a Linux distribution that a file belongs to</a></h2>
<p>In any DEB-based systems, you can find the package that provides a certain file using apt-file tool.
If you just installed apt-file, the system-wide cache might be empty. You need to run 'apt-file update' as root to update the cache. You can also run 'apt-file update' as normal user to use a cache in the user's home directory.</p>
<p>And, then search for the packages that contains a specific file, say alisp.h, with command (for repository packages, either installed or not installed):</p>
<pre><code>apt-file find &lt;alisp.h&gt; # *find* is an alias for *search*
</code></pre>
<p>apt-file may also be used to list all the files included in a package:</p>
<pre><code>apt-file list &lt;packagename&gt;
</code></pre>
<p>If you already have the file, and just wanted to know which package it belongs to, you can use dpkg command as shown below (only for installed DEB packages - from any source):</p>
<pre><code>dpkg -S $(which &lt;alisp.h&gt;)
</code></pre>
<p>If you already know the package name, you can quickly look up the files that are installed by a Debian package:</p>
<pre><code>dpkg -L &lt;packagename&gt;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="3-user-and-group-management---10"><a class="header" href="#3-user-and-group-management---10">3. User and Group Management - 10%</a></h1>
<ul>
<li><a href="3-user-and-group-management/./a.html">Create, delete, and modify local user accounts</a></li>
<li><a href="3-user-and-group-management/./b.html">Create, delete, and modify local groups and group memberships</a></li>
<li><a href="3-user-and-group-management/./c.html">Manage system-wide environment profiles</a></li>
<li><a href="3-user-and-group-management/./d.html">Manage template user environment</a></li>
<li><a href="3-user-and-group-management/./e.html">Configure user resource limits</a></li>
<li><a href="3-user-and-group-management/./f.html">Manage user privileges</a></li>
<li><a href="3-user-and-group-management/./g.html">Configure PAM</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h2 id="create-delete-and-modify-local-user-accounts"><a class="header" href="#create-delete-and-modify-local-user-accounts">Create, delete, and modify local user accounts</a></h2>
<h3 id="add-a-user"><a class="header" href="#add-a-user">Add a User</a></h3>
<p>In Ubuntu, there are two command-line tools that you can use to create a new user account:</p>
<ul>
<li><code>useradd</code>, a low-level utility</li>
<li><code>adduser</code>, a script written in Perl that acts as a friendly interactive frontend for <code>useradd</code>.</li>
</ul>
<p>Adding a new user is quick and easy, simply invoke <code>adduser &lt;username&gt;</code> command followed by the username and aswer all the questions when propted.</p>
<p>When invoked, <code>useradd</code> creates a new user account according to the options specified on the command line and the default values set in the <code>/etc/default/useradd</code> file. <code>useradd</code> also reads the content of the /etc/login.defs file. This file contains configuration for the shadow password suite such as password expiration policy, ranges of user IDs used when creating system and regular users, and more.</p>
<p>To create a user modifying some default values:
<code>sudo useradd -s /usr/bin/zsh -d "/home/students/moose" -m -k /etc/skel -c "Bullwinkle J Moose" bmoose</code></p>
<p>To be able to log in as the newly created user, you need to set the user password. To do that run the passwd command followed by the username:
<code>sudo passwd &lt;username&gt;</code></p>
<p>You to specify a list of supplementary groups which the user will be a member of with the -G (--groups) option:
<code>sudo useradd -g users -G wheel,developers &lt;username&gt;</code></p>
<p>You can check the user groups by typing:</p>
<pre><code>id username
&gt;uid=1002(username) gid=100(users) groups=100(users),10(wheel),993(docker)
</code></pre>
<p>To define a time at which the new user accounts will expire, use the -e (--expiredate) option. This is useful for creating temporary accounts.</p>
<blockquote>
<p>Note: The date must be specified using the YYYY-MM-DD format.</p>
</blockquote>
<p>For example to create a new user account named username with an expiry time set to January 22 2019 you would run:
<code>sudo useradd -e 2019-01-22 &lt;username&gt;</code></p>
<p>Use the chage command to verify the user account expiry date:
<code>sudo chage -l &lt;username&gt;</code></p>
<p>The default useradd options can be viewed and changed using the <code>-D</code>, <code>--defaults</code> option, or by manually editing the values in the /etc/default/useradd file.
To view the current default options type:</p>
<pre><code>useradd -D
&gt;GROUP=100
&gt;HOME=/home
&gt;INACTIVE=-1
&gt;EXPIRE=
&gt;SHELL=/bin/sh
&gt;SKEL=/etc/skel
&gt;CREATE_MAIL_SPOOL=no
</code></pre>
<p>Let's say you want to change the default login shell from /bin/sh to /bin/bash. To do that, specify the new shell as shown below:</p>
<pre><code>sudo useradd -D -s /bin/bash
sudo useradd -D | grep -i shell
&gt;SHELL=/bin/bash
</code></pre>
<h3 id="modify-a-user"><a class="header" href="#modify-a-user">Modify a User</a></h3>
<p>To modify a user, you can use the <code>usermod</code> command which allows you to specify the same set of flags as <code>useradd</code>.</p>
<p>To add a user to a group: <code>sudo usermod -aG dialout &lt;username&gt;</code></p>
<blockquote>
<p>Note: In general (for the GUI, or for already running processes, etc.), the user will need to log out and log back in to see their new group added. For the current shell session, you can use newgrp: <code>newgrp &lt;groupname&gt;</code>. This command adds the group to the current shell session.</p>
</blockquote>
<p>Although not very often, sometimes you may want to change the name of an existing user. The -l option is used to change the username:
<code>sudo usermod -l &lt;new-username&gt; &lt;username&gt;</code></p>
<p>To set the min and max number of days between password changes: <code>sudo chage -m 14 -M 30 &lt;username&gt;</code></p>
<h3 id="block-a-user"><a class="header" href="#block-a-user">Block a user</a></h3>
<p>To force immediate expiration of a user account: <code>sudo chage -d 0 &lt;username&gt;</code></p>
<p>To disable the expiration of an account, set an empty expiry date: <code>sudo usermod -e "" &lt;username&gt;</code></p>
<p>The <code>-L</code> option allows you to lock a user account: <code>sudo usermod -L &lt;username&gt;</code></p>
<p>The commands will insert an exclamation point (!) mark in front of the encrypted password. When the password field in the /etc/shadow file contains an exclamation point, the user will not be able to login to the system using password authentication. Other login methods, like key-based authentication (SSH Login) or switching to the user (su) are still allowed. If you want to lock the account and disable all login methods, you also need to set the expiration date to 1. The following examples shows how to lock a user: <code>sudo usermod -L -e 1 &lt;username&gt;</code></p>
<p>To unlock a user, run usermod with the <code>-U</code> option: <code>usermod -U &lt;username&gt;</code></p>
<p>If your system also encounters some problem(s) and you are forced to put it down to fix the problem(s), create the <code>/etc/nologin</code> file to disallow user logins and notify users: if a user attempts to log in to a system where this file exists, the contents of the nologin file is displayed, and the user login is terminated. Superuser logins are not affected.</p>
<p>To block a specific user from accessing a shell: <code>chsh -s /bin/nologin &lt;username&gt;</code></p>
<blockquote>
<p>Note: A user could still log on to the system via programs such as ftp that do not necessarily require a shell to connect to a system.</p>
</blockquote>
<p>Use a restricted shell to limit what a user can do:</p>
<pre><code># assign to the the user rbash as login shell
sudo useradd &lt;username&gt; -s /bin/rbash
sudo passwd &lt;username&gt;
sudo mkdir -p /home/&lt;username&gt;/bin

# restrict the path to a bin dir in his home
sudo &lt;username&gt; /home/&lt;username&gt;/.bash_profile
echo "PATH=$HOME/bin" &gt; /home/&lt;username&gt;/.bash_profile
sudo chown root:root /home/&lt;username&gt;/.bash_profile
sudo chmod 755 /home/&lt;username&gt;/.bash_profile

# copy into bin the only commands you want the user to access to
sudo ln -s /bin/ls /home/&lt;username&gt;/bin
sudo ln -s /bin/top /home/&lt;username&gt;/bin
sudo ln -s /bin/uptime /home/&lt;username&gt;/bin
sudo ln -s /bin/pinky /home/&lt;username&gt;/bin
</code></pre>
<blockquote>
<p>Note: On some distributions, rbash may not exist, so just create it as a symlink to bash: sudo ln -s /bin/bash /bin/rbash</p>
</blockquote>
<h3 id="remove-a-user"><a class="header" href="#remove-a-user">Remove a User</a></h3>
<p>In Ubuntu, you can use two commands to delete a user account: <code>userdel</code> and its interactive frontend <code>deluser</code>.</p>
<p>To delete the user and its home directory and mail spool: <code>sudo userdel -r &lt;username&gt;</code></p>
<p>If the user you want to remove is still logged in, or if there are running processes that belong to this user, the userdel command does not allow to remove the user.</p>
<p>In this situation, it is recommended to log out the user and kill all user's running processes with the killall command:
<code>sudo killall -u &lt;username&gt;</code></p>
<p>Once done, you can remove the user.</p>
<p>Another option is to use the -f (--force) option that tells userdel to forcefully remove the user account, even if the user is still logged in or if there are running processes that belong to the user: <code>userdel -f &lt;username&gt;</code></p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="create-delete-and-modify-local-groups-and-group-memberships"><a class="header" href="#create-delete-and-modify-local-groups-and-group-memberships">Create, delete, and modify local groups and group memberships</a></h2>
<p>Use the <code>groupadd</code> command to add a new group: <code>groupadd [options] group_name</code></p>
<p>To creaste a system group with the give GID: <code>$ sudo groupadd -r -g 215 staff</code></p>
<blockquote>
<p>Note: By convention, UIDs and GUIDs in the range 0-999 are reserved to system users and groups.</p>
</blockquote>
<blockquote>
<p>Note: On many Linux systems, the USERGROUPS_ENAB variable in /etc/login.defs controls whether commands like useradd or userdel automatically add or delete an associated personal group.</p>
</blockquote>
<p>Use the <code>groupmod</code> command to modify an existing group: <code>groupmod [options] group_name</code></p>
<p>Use <code>groupdel</code> to delete the group. You can remove a group even if there are users in the group: <code>groupdel group_name</code></p>
<blockquote>
<p>Note: You can not remove the primary group of an existing user. You must remove the user before removing the group.</p>
</blockquote>
<p>Use the gpasswd command to administer the groups: <code>gpasswd [options] group_name</code></p>
<p>To add user test in group student: <code>gpasswd -a test student</code></p>
<p>The <code>groups</code> command displays the group the user belongs to:</p>
<pre><code>groups &lt;username&gt;
&gt;&lt;username&gt; : oinstall dba asm asmdba oper
grep &lt;username&gt; /etc/group
&gt;oinstall:x:5004:&lt;username&gt;
&gt;dba:x:5005:&lt;username&gt;
&gt;asm:x:5006:&lt;username&gt;
&gt;asmdba:x:5007:&lt;username&gt;
&gt;oper:x:5008:&lt;username&gt;
</code></pre>
<p>The <code>newgroup</code> command executes a new shell and changes a user's real group information:</p>
<pre><code>id
&gt;uid=5004(&lt;username&gt;) gid=5004(oinstall) groups=5004(oinstall),5005(dba) ...

ps
&gt;   PID TTY          TIME CMD
&gt;106591 pts/0    00:00:00 bash
&gt;106672 pts/0    00:00:00 ps

newgrp dba
# the gis is changed
id
&gt;uid=5004(&lt;username&gt;) gid=5005(dba) groups=5005(dba),5004(oinstall) ...

# also note that a new shell has been executed
ps
&gt;   PID TTY          TIME CMD
&gt;106591 pts/0    00:00:00 bash
&gt;106231 pts/0    00:00:00 bash
&gt;106672 pts/0    00:00:00 ps
</code></pre>
<blockquote>
<p>Note: You can only change your real group name to a group that you are member of.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h2 id="manage-system-wide-environment-profiles"><a class="header" href="#manage-system-wide-environment-profiles">Manage system-wide environment profiles</a></h2>
<p>In order to set a value to an existing <strong>environment variable</strong>, we use an assignment expression. For instance, to set the value of the "LANG" variable to "he_IL.UTF-8", we use the following command: <code>LANG=he_IL.UTF-8</code></p>
<p>If we use an assignment expression for a variable that doesn't exist, the shell will create a <strong>shell variable</strong>, which is similar to an environment variable but does not influence the behaviour of other applications.</p>
<p>A shell variable can be exported to become an environment variable with the export command. To create the "EDITOR" environment variable and assign the value "nano" to it, you can do:</p>
<pre><code>EDITOR=nano
export EDITOR
</code></pre>
<blockquote>
<p>Note: Use 'export -f FUN', to make a function available to all child processes.</p>
</blockquote>
<p>The bash shell provides a shortcut for creating environment variables. The previous example could be performed with the following single command:
<code>export EDITOR=nano</code></p>
<p>The printenv command prints the names and values of all currently defined environment variables: <code>printenv</code></p>
<blockquote>
<p>Note: This command is equivalent to 'export -p' and 'env', while 'set' prints all shell variables and functions.</p>
</blockquote>
<p>To examine the value of a particular variable, we can specify its name to the printenv command: <code>printenv TERM</code></p>
<p>Another way to achieve that is to use the dollar sign ($), as used in the following example: <code>echo $TERM</code></p>
<p>The dollar sign can actually be used to combine the values of environment variables in many shell commands. For example, the following command can be used to list the contents of the "Desktop" directory within the current user's home directory: <code>ls $HOME/Desktop</code></p>
<p>For the sake of completeness: If you want to print the names and values also of the non-exported shell variables, i.e. not only the environment variables, this is one way: <code>( set -o posix ; set ) | less</code></p>
<p>The <code>source</code> command reads and executes commands from the file specified as its argument in the current shell environment. It is useful to load functions, variables, and configuration files into shell scripts.</p>
<h3 id="session-wide-environment-variables"><a class="header" href="#session-wide-environment-variables">Session-wide environment variables</a></h3>
<p>A suitable file for environment variable settings that should affect just a particular user (rather than the system as a whole) is ~/.profile.</p>
<p>Shell config files such as <code>~/.bashrc</code>, <code>~/.bash_profile</code>, and <code>~/.bash_login</code> are often suggested for setting environment variables.</p>
<blockquote>
<p>Warning: While this may work on Bash shells for programs started from the shell, variables set in those files are not available by default to programs started from the graphical environment in a desktop session.</p>
</blockquote>
<h3 id="system-wide-environment-variables"><a class="header" href="#system-wide-environment-variables">System-wide environment variables</a></h3>
<p>A suitable file for environment variable settings that affect the system as a whole (rather than just a particular user) is <code>/etc/environment</code>. An alternative is to create a file for the purpose in the <code>/etc/profile.d</code> directory.</p>
<p>The <code>/etc/environment</code> file is specifically meant for system-wide environment variable settings. It is not a script file, but rather consists of assignment expressions, one per line: <code>FOO=bar</code></p>
<blockquote>
<p>Warning: Variable expansion does not work in /etc/environment.</p>
</blockquote>
<p>iles with the .sh extension in the <code>/etc/profile.d</code> directory get executed whenever a bash login shell is entered (e.g. when logging in from the console or over ssh), as well as by the DisplayManager when the desktop session loads.</p>
<p>You can for instance create the file /etc/profile.d/myenvvars.sh and set variables like this:</p>
<pre><code>export JAVA_HOME=/usr/lib/jvm/jdk1.7.0
export PATH=$PATH:$JAVA_HOME/bin
</code></pre>
<p>While <code>/etc/profile</code> is often suggested for setting environment variables system-wide, it is a configuration file of the base-files package, so it's not appropriate to edit that file directly. Use a file in /etc/profile.d instead.</p>
<p><code>/etc/default/locale</code> is specifically meant for system-wide locale environment variable settings. It's written to by the installer and when you use Language Support to set the language or regional formats system-wide. On a desktop system there is normally no reason to edit this file manually.</p>
<p>The <code>/etc/security/pam_env.conf</code> file specifies the environment variables to be set, unset or modified by pam_env(8). When someone logs in, this file is read and the environment variables are set according.</p>
<blockquote>
<p>Note: Any variables added to these locations will not be reflected when invoking them with a sudo command, as sudo has a default policy of resetting the Environment and setting a secure path (this behavior is defined in /etc/sudoers). As a workaround, you can use "sudo su" that will provide a shell with root privileges but retaining any modified PATH variables. Alternatively you can setup sudo not to reset certain environment variables by adding some explicit environment settings to keep in /etc/sudoers: Defaults env_keep += "http_proxy SOMEOTHERVARIABLES ANOTHERVARIABLE ETC"</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h2 id="manage-template-user-environment"><a class="header" href="#manage-template-user-environment">Manage template user environment</a></h2>
<p>The <code>/etc/skel</code> directory contains files and directories that are automatically copied over to a new user's when it is created from <code>useradd</code> command:</p>
<pre><code>ll /etc/skel/
&gt;total 48K
&gt;drwxr-xr-x   3 root root 4.0K Jul 31  2020 ./
&gt;drwxr-xr-x 156 root root  12K Mar 26 21:44 ../
&gt;-rw-r--r--   1 root root  220 Feb 25  2020 .bash_logout
&gt;-rw-r--r--   1 root root 3.7K Feb 25  2020 .bashrc
&gt;drwxr-xr-x   2 root root 4.0K Jul 31  2020 .config/
&gt;-rw-r--r--   1 root root  15K Apr 13  2020 .face
&gt;lrwxrwxrwx   1 root root    5 Jan  5 15:33 .face.icon -&gt; .face
&gt;-rw-r--r--   1 root root  807 Feb 25  2020 .profile
</code></pre>
<blockquote>
<p>Note: The location of /etc/skel can be changed by editing the line that begins with SKEL= in the configuration file /etc/default/useradd.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h2 id="configure-user-resource-limits"><a class="header" href="#configure-user-resource-limits">Configure user resource limits</a></h2>
<p>Any user can change it's own soft limits, between "zero", and the hard limit (typically enforced by pam_limit).</p>
<p>To print all the resource limits for the current user:
<code>ulimit -a</code></p>
<p>Show the current Soft limit for "memlock":</p>
<pre><code>ulimit -S -l
&gt; 64
</code></pre>
<p>Set the current Soft "memlock" limit to 48KiB:</p>
<pre><code>ulimit -S -l 48
</code></pre>
<p>The system resources are defined in a configuration file located at <em>/etc/security/limits.conf</em>. <em>ulimit</em>, when called, will report these values.</p>
<p>To manually set resource limits for users or groups:
<code>sudo vim /etc/security/limits.conf</code></p>
<p>Each entry has to follow the following structure: [domain] [type] [item] [value].</p>
<p>These are some example lines which might be specified in <em>/etc/security/limits.conf</em>:</p>
<pre><code>*               soft    core            0
root            hard    core            100000
*               hard    rss             10000
@student        hard    nproc           20
@faculty        soft    nproc           20
@faculty        hard    nproc           50
ftp             hard    nproc           0
@student        -       maxlogins       4
</code></pre>
<p>To find limits for a process:</p>
<pre><code>cat /proc/&lt;PID&gt;/limits
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="manage-user-privileges"><a class="header" href="#manage-user-privileges">Manage user privileges</a></h2>
<p>A user with administrative privileges is sometimes called a <code>super user</code>. This is simply because that user has more privileges than normal users. Commands like <code>su</code> and <code>sudo</code> are programs for temporarily giving you “super user” (administrative) privileges.</p>
<p><code>Administrative privileges</code> are associated with your user account. Administrator users are allowed to have these privileges while Standard users are not. Without administrative privileges you will not be able to install software. Some user accounts (e.g <code>root</code>) have permanent administrative privileges. You should not use administrative privileges all of the time, because you might accidentally change something you did not intend to (like delete a needed system file, for example).</p>
<p>These privileges are gained by adding the user to the <code>sudo</code> group. Users in the "sudo" group can use sudo to gain administrative privileges after supplying their password.</p>
<blockquote>
<p>Note: Up until Ubuntu 11.10, administrator access using the sudo tool was granted via the "admin" Unix group. Starting with Ubuntu 12.04, administrator access are granted via the "sudo"group. This makes Ubuntu more consistent with the upstream implementation and Debian. For compatibility purposes, the admin group is still available to provide sudo/administrator access.</p>
</blockquote>
<p>If you want a new user to be able to perform administrative tasks, you need to add the user to the <code>sudo</code> group:
<code>sudo usermod -aG sudo &lt;username&gt;</code></p>
<p>As an alternative to putting your user in the sudo group, you can use the <code>visudo</code> command, which opens a configuration file called <code>/etc/sudoers</code> in the system's default editor, and explicitly specify privileges on a per-user basis: <code>sudo visudo</code></p>
<blockquote>
<p>Note: Typically, visudo uses vim to open the /etc/sudoers. If you don't have experience with vim and you want to edit the file with nano , change the default editor by running: sudo EDITOR=nano visudo</p>
</blockquote>
<p>Use the arrow keys to move the cursor, search for the line that defines root previleges and use the same syntax for this user:</p>
<pre><code>#       HOSTS=(USERS:GROUPS) COMMANDS
root    ALL=(ALL:ALL) ALL
newuser ALL=(ALL:ALL) ALL
</code></pre>
<p>Another typical example is to allow the user to run only specific commands via sudo (and without password). For example, to allow only the <code>mkdir</code> and <code>rmdir</code> commands, you would use:
<code>username ALL=(ALL) NOPASSWD:/bin/mkdir,/bin/rmdir</code></p>
<p>To remove the sudo privileges from a specific user: <code>sudo deluser &lt;username&gt; sudo</code></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="configure-pam"><a class="header" href="#configure-pam">Configure PAM</a></h1>
<p>PAM is a powerful suite of shared libraries used to dynamically authenticate a user to applications (or services) in a Linux system. It integrates multiple low-level authentication modules into a high-level API that provides dynamic authentication support for applications.</p>
<p>To employ PAM, an application/program needs to be “PAM-aware“; it needs to have been written and compiled specifically to use PAM. To find out if a program is “PAM-aware” or not, check if it has been compiled with the PAM library using the <em>ldd</em> command:</p>
<pre><code>sudo ldd /usr/sbin/sshd | grep libpam.so
&gt; libpam.so.0 =&gt; /lib/x86_64-linux-gnu/libpam.so.0 (0x00007effddbe2000)
</code></pre>
<p>The main configuration file for PAM is <em>/etc/pam.conf</em> and the <em>/etc/pam.d/</em> directory contains the PAM configuration files for each PAM-aware application/services.</p>
<p>The syntax for the main configuration file is as follows: the file is made up of a list of rules written on a single line (you can extend rules using the “\” escape character) and comments are preceded with “#” marks and extend to the next end of line.</p>
<p>The format of each rule is a space separated collection of tokens (the first three are case-insensitive):
<code>service type control-flag module module-arguments</code>; where:</p>
<ul>
<li>service: actual application name</li>
<li>type: module type/context/interface</li>
<li>control-flag: indicates the behavior of the PAM-API should the module fail to succeed in its authentication task</li>
<li>module: the absolute filename or relative pathname of the PAM</li>
<li>module-arguments: space separated list of tokens for controlling module behavior.</li>
</ul>
<p>The syntax of each file in /etc/pam.d/ is similar to that of the main file and is made up of lines of the following form:
<code>type control-flag module module-arguments</code></p>
<p>A module is associated to one these management group types:</p>
<ul>
<li>account: provide services for account verification</li>
<li>authentication: authenticate a user and set up user credentials</li>
<li>password: are responsible for updating user passwords and work together with authentication modules</li>
<li>session: manage actions performed at the beginning of a session and end of a session.</li>
</ul>
<p>PAM loadable object files (i.e. the modules) are to be located in the following directory: /lib/security/ or /lib64/security depending on the architecture.</p>
<p>The supported control-flags are:</p>
<ul>
<li>requisite: failure instantly returns control to the application indicating the nature of the first module failure</li>
<li>required: all these modules are required to succeed for libpam to return success to the application</li>
<li>sufficient: given that all preceding modules have succeeded, the success of this module leads to an immediate and successful return to the application (failure of this module is ignored)</li>
<li>optional: the success or failure of this module is generally not recorded.</li>
</ul>
<p>In addition to the above keywords, there are two other valid control flags:</p>
<ul>
<li>include: include all lines of given type from the configuration file specified as an argument to this control</li>
<li>substack: this differs from the previous one in that evaluation of the done and die actions in a substack does not cause skipping the rest of the complete module stack, but only of the substack..</li>
</ul>
<p>Example: how to use PAM to disable root user access to a system via SSH and login.</p>
<p>We can use the <em>/lib/security/pam_listfile.so</em> module which offers great flexibility in limiting the privileges of specific accounts. Open and edit the file for the target service in the <em>/etc/pam.d/</em> directory as shown.</p>
<pre><code>sudo vim /etc/pam.d/sshd
sudo vim /etc/pam.d/login
</code></pre>
<p>Add this rule in both files:</p>
<pre><code>auth    required       pam_listfile.so \
    onerr=succeed  item=user  sense=deny  file=/etc/ssh/deniedusers
</code></pre>
<p>Explaining the tokens in the above rule:</p>
<ul>
<li>auth: is the module type (or context)</li>
<li>required: is a control-flag that means if the module is used, it must pass or the overall result will be fail, regardless of the status of other modules</li>
<li>pam_listfile.so: is a module which provides a way to deny or allow services based on an arbitrary file</li>
<li>onerr=succeed: module argument</li>
<li>item=user: module argument which specifies what is listed in the file and should be checked for</li>
<li>sense=deny: module argument which specifies action to take if found in file, if the item is NOT found in the file, then the opposite action is requested</li>
<li>file=/etc/ssh/deniedusers: module argument which specifies file containing one item per line.</li>
</ul>
<p>Next, we need to create the file /etc/ssh/deniedusers and add the name root in it:
<code>sudo vim /etc/ssh/deniedusers</code></p>
<p>Save the changes and close the file, then set the required permissions on it:
<code>sudo chmod 600 /etc/ssh/deniedusers</code></p>
<p>From now on, the above rule will tell PAM to consult the /etc/ssh/deniedusers file and deny access to the SSH and login services for any listed user.</p>
<p>Another good example of PAM configuration is showed in <strong>pam_tally2</strong> module man page: it explains how to configure login to lock the account after 4 failed logins.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="4-networking---12"><a class="header" href="#4-networking---12">4. Networking - 12%</a></h1>
<ul>
<li><a href="4-networking/./a.html">Configure networking and hostname resolution statically or dynamically</a></li>
<li><a href="4-networking/./b.html">Configure network services to start automatically at boot</a></li>
<li><a href="4-networking/./c.html">Implement packet filtering (./iptables, firewalld or ufw)</a></li>
<li><a href="4-networking/./d.html">Start, stop, and check the status of network services</a></li>
<li><a href="4-networking/./e.html">Statically route IP traffic</a></li>
<li><a href="4-networking/./f.html">Synchronize time using other network peers</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h2 id="configure-networking-and-hostname-resolution-statically-or-dynamically"><a class="header" href="#configure-networking-and-hostname-resolution-statically-or-dynamically">Configure networking and hostname resolution statically or dynamically</a></h2>
<h3 id="networking"><a class="header" href="#networking">Networking</a></h3>
<p>Networks consist of two or more devices, such as computer systems, printers, and related equipment which are connected by either physical cabling or wireless links for the purpose of sharing and distributing information among the connected devices.</p>
<p>The two protocol components of TCP/IP deal with different aspects of computer networking. Internet Protocol, the “IP” of TCP/IP is a connectionless protocol which deals only with network packet routing using the IP Datagram as the basic unit of networking information. The IP Datagram consists of a header followed by a message. The Transmission Control Protocol is the “TCP” of TCP/IP and enables network hosts to establish connections which may be used to exchange data streams. TCP also guarantees that the data between connections is delivered and that it arrives at one network host in the same order as sent from another network host.</p>
<p>The TCP/IP protocol configuration consists of several elements which must be set by editing the appropriate configuration files, or deploying solutions such as the Dynamic Host Configuration Protocol (DHCP) server which in turn, can be configured to provide the proper TCP/IP configuration settings to network clients automatically. These configuration values must be set correctly in order to facilitate the proper network operation of your Ubuntu system.</p>
<p>The common configuration elements of TCP/IP and their purposes are as follows:</p>
<ul>
<li>
<p><strong>IP address</strong>: The IP address is a unique identifying string expressed as four decimal numbers ranging from zero (0) to two-hundred and fifty-five (255), separated by periods, with each of the four numbers representing eight (8) bits of the address for a total length of thirty-two (32) bits for the whole address. This format is called <em>dotted quad notation</em>.</p>
</li>
<li>
<p><strong>Netmask</strong>: The Subnet Mask (or simply, netmask) is a local bit mask, or set of flags which separate the portions of an IP address significant to the network from the bits significant to the subnetwork. For example, in a Class C network, the standard netmask is 255.255.255.0 which masks the first three bytes of the IPaddress and allows the last byte of the IP address to remain available for specifying hosts on the subnetwork.</p>
</li>
<li>
<p><strong>Network Address</strong>: The Network Address represents the bytes comprising the network portion of an IP address. For example, the host 12.128.1.2 in a Class A network would use 12.0.0.0 as the network address, where twelve (12) represents the first byte of the IP address, (the network part) and zeroes (0) in all of the remaining three bytes to represent the potential host values. A network host using the private IP address 192.168.1.100 would in turn use a Network Address of 192.168.1.0, which specifies the first three bytes of the Class C 192.168.1 network and a zero (0) for all the possible hosts on the network.</p>
</li>
<li>
<p><strong>Broadcast Address</strong>: The Broadcast Address is an IP address which allows network data to be sent simultaneously to all hosts on a given subnetwork rather than specifying a particular host. The standard general broadcast address for IP networks is 255.255.255.255, but this broadcast address cannot be used to send a broadcast message to every host on the Internet because routers block it. A more appropriate broadcast address is set to match a specific subnetwork. Forexample, on the private Class C IP network, 192.168.1.0, the broadcast address is 192.168.1.255. Broadcast messages are typically produced by network protocols such as the Address Resolution Protocol (ARP) and the Routing Information Protocol (RIP).</p>
</li>
<li>
<p><strong>Gateway Address</strong>: A Gateway Address is the IP address through which a particular network, or host on a network, may be reached. If one network host wishes to communicate with another network host, and that host is not located on the same network, then a gateway must be used. In many cases, the Gateway Address will be that of a router on the same network, which will in turn pass traffic on to other networks or hosts, such as Internet hosts. The value of the Gateway Address setting must be correct, or your system will not be able to reach any hosts beyond those on the same network.</p>
</li>
<li>
<p><strong>Nameserver Address</strong>: Nameserver Addresses represent the IP addresses of Domain Name Service (DNS) systems, which resolve network hostnames into IP addresses. There are three levels of Nameserver Addresses, which may be specified in order of precedence: The Primary Nameserver, the Secondary Nameserver, and the Tertiary Nameserver. In order for your system to be able to resolve network hostnames into their corresponding IP addresses, you must specify valid Nameserver Addresses which you are authorized to use in your system's TCP/IP configuration. In many cases these addresses can and will be provided by your network service provider,but many free and publicly accessible nameservers are available for use, such as the Level3 (Verizon) servers with IP addresses from 4.2.2.1 to 4.2.2.6.</p>
</li>
</ul>
<blockquote>
<p>Tip: The IP address, Netmask, Network Address, Broadcast Address, Gateway Address, and Nameserver Addresses are typically specified via the appropriate directives in the file /etc/network/interfaces (before Ubuntu 18.04, see below). For more information, view the system manual page for interfaces: <code>man interfaces</code></p>
</blockquote>
<h3 id="netplan"><a class="header" href="#netplan">Netplan</a></h3>
<p>Ubuntu 18.04 (LTS) has switched from <strong>ifupdown</strong> to <strong>Netplan</strong> for configuring network interfaces. Netplan is based on YAML config files that makes configuration process very simple. Netplan has replaced the old configuration file<code> /etc/network/interface</code>s that was previously used for configuring network interfaces in Ubuntu.</p>
<p>During early boot, the Netplan <em>networkd renderer</em> runs, reads /{lib,etc,run}/netplan/*.yaml and writes configuration to /run to hand off control of devices to the specified networking daemon:</p>
<ul>
<li>configured devices get handled by<code> systemd-network</code>d by default, unless explicitly marked as managed by a specific renderer (<strong>NetworkManager</strong>)</li>
<li>devices not covered by the network config do not get touched at all.</li>
</ul>
<p>If you are not on an Ubuntu Server, but on Desktop, chances are that the network is driven by the NetworkManager.</p>
<p>Netplan supports both networkd and NetworkManager as backends. You can specify which network backend should be used to configure particular devices by using the renderer key. You can also delegate all configuration of the network to NetworkManager itself by specifying only the renderer key:</p>
<pre><code>network:
    version: 2
    renderer: NetworkManager
</code></pre>
<hr />
<h3 id="ethernet-interfaces"><a class="header" href="#ethernet-interfaces">Ethernet Interfaces</a></h3>
<p>Ethernet interfaces are identified by the system using predictable network interface names. These names can appear as <em>eno1</em> or <em>enp0s25</em>. However, in some cases an interface may still use the kernel <em>eth#</em> style of naming.</p>
<p>To quickly identify all available Ethernet interfaces, you can use the <code>ip</code> command as shown below:</p>
<pre><code>ip a
&gt;1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
&gt;    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
&gt;    inet 127.0.0.1/8 scope host lo
&gt;       valid_lft forever preferred_lft forever
&gt;    inet6 ::1/128 scope host
&gt;       valid_lft forever preferred_lft forever
&gt;2: enp0s25: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000
&gt;    link/ether 00:16:3e:e2:52:42 brd ff:ff:ff:ff:ff:ff link-netnsid 0
&gt;    inet 10.102.66.200/24 brd 10.102.66.255 scope global dynamic eth0
&gt;       valid_lft 3257sec preferred_lft 3257sec
&gt;    inet6 fe80::216:3eff:fee2:5242/64 scope link
&gt;       valid_lft forever preferred_lft forever
</code></pre>
<p>Another application that can help identify all network interfaces available to your system is the <code>lshw</code> command. This command provides greater details around the hardware capabilities of specific adapters. In the example below, <code>lshw</code> shows a single Ethernet interface with the logical name of <code>eth4</code> along with bus information, driver details and all supported capabilities:</p>
<pre><code>sudo lshw -class network
  *-network
       description: Ethernet interface
       product: MT26448 [ConnectX EN 10GigE, PCIe 2.0 5GT/s]
       vendor: Mellanox Technologies
       physical id: 0
       bus info: pci@0004:01:00.0
       logical name: eth4
       version: b0
       serial: e4:1d:2d:67:83:56
       slot: U78CB.001.WZS09KB-P1-C6-T1
       size: 10Gbit/s
       capacity: 10Gbit/s
       width: 64 bits
       clock: 33MHz
       capabilities: pm vpd msix pciexpress bus_master cap_list ethernet physical fibre 10000bt-fd
       configuration: autonegotiation=off broadcast=yes driver=mlx4_en driverversion=4.0-0 duplex=full firmware=2.9.1326 ip=192.168.1.1 latency=0 link=yes multicast=yes port=fibre speed=10Gbit/s
       resources: iomemory:24000-23fff irq:481 memory:3fe200000000-3fe2000fffff memory:240000000000-240007ffffff
</code></pre>
<h3 id="ethernet-interface-logical-names"><a class="header" href="#ethernet-interface-logical-names">Ethernet Interface Logical Names</a></h3>
<p>Interface logical names can also be configured via a netplan configuration. If you would like control which interface receives a particular logical name use the <code>match</code> and <code>set-name</code> keys. The <code>match</code> key is used to find an adapter based on some criteria like MAC address, driver, etc. Then the <code>set-name</code> key can be used to change the device to the desired logial name:</p>
<pre><code>network:
  version: 2
  renderer: networkd
  ethernets:
    eth_lan0:
      dhcp4: true
      match:
        macaddress: 00:11:22:33:44:55
      set-name: eth_lan0
</code></pre>
<h3 id="ethernet-interface-settings"><a class="header" href="#ethernet-interface-settings">Ethernet Interface Settings</a></h3>
<p><code>ethtool</code> is a program that displays and changes ethernet card settings such as auto-negotiation, port speed, duplex mode, and Wake-on-LAN. The following is an example of how to view supported features and configured settings of an ethernet interface.</p>
<pre><code>sudo ethtool eth4
&gt;Settings for eth4:
&gt;    Supported ports: [ FIBRE ]
&gt;    Supported link modes:   10000baseT/Full
&gt;    Supported pause frame use: No
&gt;    Supports auto-negotiation: No
&gt;    Supported FEC modes: Not reported
&gt;    Advertised link modes:  10000baseT/Full
&gt;    Advertised pause frame use: No
&gt;    Advertised auto-negotiation: No
&gt;    Advertised FEC modes: Not reported
&gt;    Speed: 10000Mb/s
&gt;    Duplex: Full
&gt;    Port: FIBRE
&gt;    PHYAD: 0
&gt;    Transceiver: internal
&gt;    Auto-negotiation: off
&gt;    Supports Wake-on: d
&gt;    Wake-on: d
&gt;    Current message level: 0x00000014 (20)
&gt;                   link ifdown
&gt;    Link detected: yes
</code></pre>
<h3 id="temporary-ip-address-assignment"><a class="header" href="#temporary-ip-address-assignment">Temporary IP Address Assignment</a></h3>
<p>For temporary network configurations, you can use the ip command which is also found on most other GNU/Linux operating systems. The ip command allows you to configure settings which take effect immediately, however they are not persistent and will be lost after a reboot.</p>
<p>To temporarily configure an IP address, you can use the ip command in the following manner. Modify the IP address and subnet mask to match your network requirements:
<code>sudo ip addr add 10.102.66.200/24 dev enp0s25</code></p>
<p>The ip can then be used to set the <strong>link</strong> (i.e. network device) up or down:</p>
<pre><code>ip link set dev enp0s25 up
ip link set dev enp0s25 down
</code></pre>
<p>To verify the IP address configuration of enp0s25, you can use the ip command in the following manner:</p>
<pre><code>ip address show dev enp0s25
&gt;10: enp0s25: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000
&gt;    link/ether 00:16:3e:e2:52:42 brd ff:ff:ff:ff:ff:ff link-netnsid 0
&gt;    inet 10.102.66.200/24 brd 10.102.66.255 scope global dynamic eth0
&gt;       valid_lft 2857sec preferred_lft 2857sec
&gt;    inet6 fe80::216:3eff:fee2:5242/64 scope link
&gt;       valid_lft forever preferred_lft forever6
</code></pre>
<p>To configure a default gateway, you can use the ip command in the following manner. Modify the default gateway address to match your network requirements:
<code>sudo ip route add default via 10.102.66.1</code></p>
<p>To verify your default gateway configuration, you can use the ip command in the following manner:</p>
<pre><code>ip route show
&gt;default via 10.102.66.1 dev eth0 proto dhcp src 10.102.66.200 metric 100
&gt;10.102.66.0/24 dev eth0 proto kernel scope link src 10.102.66.200
&gt;10.102.66.1 dev eth0 proto dhcp scope link src 10.102.66.200 metric 100
</code></pre>
<p>If you require DNS for your temporary network configuration, you can add DNS server IP addresses in the file /etc/resolv.conf. In general, editing <code>/etc/resolv.conf</code> directly is not recommanded, but this is a temporary and non-persistent configuration. The example below shows how to enter two DNS servers to <code>/etc/resolv.conf</code>, which should be changed to servers appropriate for your network:</p>
<pre><code>nameserver 8.8.8.8
nameserver 8.8.4.4
</code></pre>
<p>If you no longer need this configuration and wish to purge all IP configuration from an interface, you can use the ip command with the flush option as shown below.
<code>ip addr flush eth0</code></p>
<blockquote>
<p>Note: Flushing the IP configuration using the ip command does not clear the contents of /etc/resolv.conf. You must remove or modify those entries manually, or reboot which should also cause /etc/resolv.conf, which is a symlink to /run/systemd/resolve/stub-resolv.conf, to be re-written.</p>
</blockquote>
<h3 id="dynamic-ip-address-assignment-dhcp-client"><a class="header" href="#dynamic-ip-address-assignment-dhcp-client">Dynamic IP Address Assignment (DHCP Client)</a></h3>
<p>To configure your server to use DHCP for dynamic address assignment, create a netplan configuration in the file <code>/etc/netplan/99_config.yaml</code>. The example below assumes you are configuring your first ethernet interface identified as <code>enp3s0</code>:</p>
<pre><code>network:
  version: 2
  renderer: networkd
  ethernets:
    enp3s0:
      dhcp4: true
</code></pre>
<p>The configuration can then be applied using the netplan command: <code>sudo netplan apply</code></p>
<p>In case you see any error, try debugging to investigate the problem. To run debug, use the following command as sudo: <code>sudo netplan –d apply</code></p>
<p>To ensure that whether our machine is managed by “systemd-networkd”, all you have to do is using this command:</p>
<pre><code>networkctl
#in case of success, you should see a something like this:
IDX LINK    TYPE  OPERATIONAL   SETUP
_______________________________________
1 enp3s0   ether  routable  configured
2 wlp2s0b1 wlan   routable  configured
</code></pre>
<p>Once all the configurations are successfully applied, restart the Network-Manager service by running the following command: <code>sudo systemctl restart network-manager</code></p>
<p>If you are using a Ubuntu Server, use the following command instead: <code>sudo systemctl restart system-networkd</code></p>
<h3 id="static-ip-address-assignment"><a class="header" href="#static-ip-address-assignment">Static IP Address Assignment</a></h3>
<p>To configure your system to use static address assignment, create a netplan configuration in the file <code>/etc/netplan/99_config.yaml</code>. The example below assumes you are configuring your first ethernet interface identified as <code>eth0</code>. Change the addresses, gateway4, and nameservers values to meet the requirements of your network:</p>
<pre><code>network:
  version: 2
  renderer: networkd
  ethernets:
    eth0:
      addresses:
        - 10.10.10.2/24
      gateway4: 10.10.10.1
      nameservers:
          search: [mydomain, otherdomain]
          addresses: [10.10.10.1, 1.1.1.1]
</code></pre>
<p>The configuration can then be applied using the netplan command: <code>sudo netplan apply</code></p>
<p><a href="https://netplan.io/examples/">Here</a> is a a collection of example netplan configurations for common scenarios.</p>
<hr />
<h3 id="name-resolution"><a class="header" href="#name-resolution">Name Resolution</a></h3>
<p>Name resolution as it relates to IP networking is the process of mapping IP addresses to hostnames, making it easier to identify resources on a network. The following section will explain how to properly configure your system for name resolution using DNS and static hostname records.</p>
<h3 id="dns-client-configuration"><a class="header" href="#dns-client-configuration">DNS Client Configuration</a></h3>
<p>Traditionally, the file /etc/resolv.conf was a static configuration file that rarely needed to be changed or automatically changed via DCHP client hooks. systemd-resolved handles name server configuration, and it should be interacted with through the <code>systemd-resolve</code> command. Netplan configures systemd-resolved to generate a list of nameservers and domains to put in /etc/resolv.conf, which is a symlink:
<code>/etc/resolv.conf -&gt; ../run/systemd/resolve/stub-resolv.conf</code></p>
<p>To configure the resolver, add the IP addresses of the nameservers that are appropriate for your network to the netplan configuration file. You can also add a list of search domains (DNS suffixes), which are used when a non-fully qualified hostname is given. The resulting file might look like the following:</p>
<pre><code>network:
  version: 2
  renderer: networkd
  ethernets:
    enp0s25:
      addresses:
        - 192.168.0.100/24
      gateway4: 192.168.0.1
      nameservers:
          search: [mydomain, otherdomain]
          addresses: [1.1.1.1, 8.8.8.8, 4.4.4.4]
</code></pre>
<p>The <code>search</code> option can also be used with multiple domain names so that DNS queries will be appended in the order in which they are entered. For example, your network may have multiple sub-domains to search; a parent domain of example.com, and two sub-domains, sales.example.com and dev.example.com.</p>
<p>If you have multiple domains you wish to search, your configuration might look like the following:</p>
<pre><code>network:
  version: 2
  renderer: networkd
  ethernets:
    enp0s25:
      addresses:
        - 192.168.0.100/24
      gateway4: 192.168.0.1
      nameservers:
          search: [example.com, sales.example.com, dev.example.com]
          addresses: [1.1.1.1, 8.8.8.8, 4.4.4.4]
</code></pre>
<p>If you try to ping a host with the name of server1, your system will automatically query DNS for its Fully Qualified Domain Name (FQDN) in the following order:</p>
<pre><code>server1.example.com
server1.sales.example.com
server1.dev.example.com
</code></pre>
<p>If no matches are found, the DNS server will provide a result of notfound and the DNS query will fail.</p>
<hr />
<p>If you are using NetworkManager in a desktop version of Ubuntu, editing /etc/netplan/*.yaml could not be enough.</p>
<p>If your current DNS server still points to your router (i.e. 192.168.1.1), there are at least two ways to solve this problem:</p>
<ol>
<li>You may configure these settings using the already mentioned GUI:</li>
</ol>
<p>a. Choose a connection (from the <em>Wired</em> or <em>Wireless</em> tab) and click <em>Edit</em>
b. Click on the IPv4 Settings tab
c. Choose <strong>Automatic (DHCP) addresses only</strong> instead of just <em>Automatic (DHCP)</em>
d. Enter the DNS servers in the <em>DNS servers</em> field, separated by spaces (e.g. 208.67.222.222 for OpenDNS)
e. Click on <em>Apply</em>.</p>
<blockquote>
<p>Note: 'Automatic (DHCP) addresses only' means that the network you are connecting to uses a DHCP server to assign IP addresses but you want to assign DNS servers manually.</p>
</blockquote>
<blockquote>
<p>Note: NetworkManager saves these settings in /etc/NetworkManager/system-connections/[name-of-your-connection].</p>
</blockquote>
<ol start="2">
<li>or, if your DNS settigs are messed up by multiple programs trying to update it, you can use <code>resolvconf</code>:</li>
</ol>
<pre><code>sudo apt install resolvconf
sudo systemctl enable --now resolvconf.service
</code></pre>
<p>Then, edit /etc/resolvconf/resolv.conf.d/head and insert the nameservers youu want as:</p>
<pre><code>nameserver 8.8.8.8
nameserver 8.8.4.4
</code></pre>
<p>Finally, to update /etc/resolv.conf by typing: <code>sudo resolvconf -u</code></p>
<p>The /etc/resolv.conf file will be replaced by a symbolic link to /etc/resolvconf/run/resolv.conf, so that the system resolver will use this file instead of the previously symlinked /run/systemd/resolve/stub-resolv.conf.</p>
<h3 id="static-hostnames"><a class="header" href="#static-hostnames">Static Hostnames</a></h3>
<p>Static hostnames are locally defined hostname-to-IP mappings located in the file <code>/etc/hosts</code>. Entries in the hosts file will have precedence over DNS by default. This means that if your system tries to resolve a hostname and it matches an entry in /etc/hosts, it will not attempt to look up the record in DNS. In some configurations, especially when Internet access is not required, servers that communicate with a limited number of resources can be conveniently set to use static hostnames instead of DNS.</p>
<p>The following is an example of a hosts file where a number of local servers have been identified by simple hostnames, aliases and their equivalent Fully Qualified Domain Names (FQDNs):</p>
<pre><code>127.0.0.1   localhost
127.0.1.1   ubuntu-server
10.0.0.11   server1 server1.example.com vpn
10.0.0.12   server2 server2.example.com mail
10.0.0.13   server3 server3.example.com www
10.0.0.14   server4 server4.example.com file
</code></pre>
<blockquote>
<p>Note: In the above example, notice that each of the servers have been given aliases in addition to their proper names and FQDN's. Server1 has been mapped to the name vpn, server2 is referred to as mail, server3 as www, and server4 as file.</p>
</blockquote>
<p>To block ads and tracking sites, append to /etc/hosts the MVPS HOSTS <a href="https://winhelp2002.mvps.org/hosts.txt">file</a>.</p>
<h3 id="name-service-switch-configuration"><a class="header" href="#name-service-switch-configuration">Name Service Switch Configuration</a></h3>
<p>The order in which your system selects a method of resolving hostnames to IP addresses is controlled by the <em>Name Service Switch</em> (<strong>NSS</strong>) configuration file <code>/etc/nsswitch.conf</code>. As mentioned in the previous section, typically static hostnames defined in the systems /etc/hosts file have precedence over names resolved from DNS. The following is an example of the line responsible for this order of hostname lookups in the file /etc/nsswitch.conf:
<code>hosts:          files mdns4_minimal [NOTFOUND=return] dns mdns4</code></p>
<p>The entries listed are:</p>
<ul>
<li>
<p><code>files</code> first tries to resolve static hostnames located in /etc/hosts</p>
</li>
<li>
<p><code>mdns4_minimal</code> attempts to resolve the name using Multicast DNS</p>
</li>
<li>
<p><code>[NOTFOUND=return]</code> means that any response of notfound by the preceding mdns4_minimal process should be treated as authoritative and that the system should not try to continue hunting for an answer</p>
</li>
<li>
<p><code>dns</code> represents a legacy unicast DNS query</p>
</li>
<li>
<p><code>mdns4</code> represents a Multicast DNS query.</p>
</li>
</ul>
<p>To modify the order of the above mentioned name resolution methods, you can simply change the <code>hosts:</code> string to the value of your choosing. For example, if you prefer to use legacy Unicast DNS versus Multicast DNS, you can change the string in /etc/nsswitch.conf as shown below:
<code>hosts:          files dns [NOTFOUND=return] mdns4_minimal mdns4</code></p>
<h3 id="bridging"><a class="header" href="#bridging">Bridging</a></h3>
<p>Bridging multiple interfaces is a more advanced configuration, but is very useful in multiple scenarios. One scenario is setting up a bridge with multiple network interfaces, then using a firewall to filter traffic between two network segments. Another scenario is using bridge on a system with one interface to allow virtual machines direct access to the outside network. The following example covers the latter scenario.</p>
<p>Configure the bridge by editing your netplan configuration found in /etc/netplan/:</p>
<pre><code>network:
  version: 2
  renderer: networkd
  ethernets:
    enp3s0:
      dhcp4: no
  bridges:
    br0:
      dhcp4: yes
      interfaces:
        - enp3s0
</code></pre>
<blockquote>
<p>Note: Enter the appropriate values for your physical interface and network.</p>
</blockquote>
<p>Now apply the configuration to enable the bridge: <code>sudo netplan apply</code></p>
<p>The new bridge interface should now be up and running. The <code>brctl</code> command can provide useful information about the state of the bridge: <code>sudo brctl show</code></p>
<hr />
<p>Resolve a hostname to an ip address: <code>dig +short google.com</code></p>
<p>Resolve a hostname with another DNS server:</p>
<pre><code>nslookup
&gt; server 8.8.8.8
&gt; some.hostname.com
# or
dig some.hostname.com @8.8.8.8
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="configure-network-services-to-start-automatically-at-boot"><a class="header" href="#configure-network-services-to-start-automatically-at-boot">Configure network services to start automatically at boot</a></h2>
<p>It's usually a good idea to configure essential network services to automatically start on boot. This saves you the hassle of starting them manually upon a reboot and also, the resulting havoc caused in case you forget to do so. Some of the crucial network services include <code>SSH</code>, <code>NTP</code>, and <code>httpd</code>.</p>
<p>You can confirm what is your system service manager by running the following command:</p>
<pre><code>ps --pid 1
&gt;    PID TTY          TIME CMD
&gt;      1 ?        00:00:04 systemd
</code></pre>
<p>To enable a service to start on boot, use the syntax: <code>sudo systemctl enable &lt;service-name&gt;</code></p>
<blockquote>
<p>Note: On SysV-based systems use <code>chkconfig</code> in place of <code>systemctl</code>.</p>
</blockquote>
<p>To confirm that the desired service has been enabled, list all the enabled services by executing the command:
<code>sudo systemctl list-unit-files --state=enabled</code></p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="implement-packet-filtering"><a class="header" href="#implement-packet-filtering">Implement packet filtering</a></h2>
<p>The Linux kernel includes the <em>Netfilter</em> subsystem, which is used to manipulate or decide the fate of network traffic headed into or through your server. All modern Linux firewall solutions use this system for packet filtering.</p>
<p>The kernel's packet filtering system would be of little use to administrators without a userspace interface to manage it. This is the purpose of <em>iptables</em>: when a packet reaches your server, it will be handed off to the Netfilter subsystem for acceptance, manipulation, or rejection based on the rules supplied to it from userspace via iptables. Thus, iptables is all you need to manage your firewall, if you're familiar with it, but many frontends are available to simplify the task.</p>
<p>Starting with CentOS 7, <em>firewall-d</em> replaced iptables as the default firewall management tool. The default firewall configuration tool for Ubuntu is <em>ufw</em>. By default, ufw is set to deny all incoming connections and allow all outgoing connections. This means anyone trying to reach your server would not be able to connect, while any application within the server would be able to reach the outside world.</p>
<p>Basic ufw management: <code>sudo ufw [enable|disable|reset|status]</code></p>
<p>To open a port (SSH in this example): <code>sudo ufw allow 22</code></p>
<blockquote>
<p>Note: If the port you want to open or close is defined in <code>/etc/services</code>, you can use the port name instead of the number. In the above examples, replace <code>22</code> with <code>ssh</code>.</p>
</blockquote>
<p>Rules can also be added using a numbered format: <code>sudo ufw insert 1 allow 80</code></p>
<p>Similarly, to close an opened port: <code>sudo ufw deny 22</code></p>
<p>To remove a rule, use delete followed by the rule: <code>sudo ufw delete deny 22</code></p>
<p>It is also possible to allow access from specific hosts or networks to a port. The following example allows SSH access from host 192.168.0.2 to any IP address on this host: <code>sudo ufw allow proto tcp from 192.168.0.2 to any port 22</code></p>
<p>Replace <code>192.168.0.2</code> with <code>192.168.0.0/24</code> to allow SSH access from the entire subnet.</p>
<p>Adding the <code>–dry-run</code> option to a ufw command will output the resulting rules, but not apply them. For example, the following is what would be applied if opening the HTTP port: <code>sudo ufw --dry-run allow http</code></p>
<p>For more verbose status information use: <code>sudo ufw status verbose</code></p>
<p>To view the numbered format: <code>sudo ufw status numbered</code></p>
<p>Applications that open ports can include an ufw profile, which details the ports needed for the application to function properly. The profiles are kept in <code>/etc/ufw/applications.d</code>, and can be edited if the default ports have been changed.</p>
<p>To view which applications have installed a profile, enter the following in a terminal: <code>sudo ufw app list</code></p>
<p>Similar to allowing traffic to a port, using an application profile is accomplished by entering: <code>sudo ufw allow Samba</code></p>
<p>An extended syntax is available as well: <code>ufw allow from 192.168.0.0/24 to any app Samba</code></p>
<p>Replace <code>Samba</code> and <code>192.168.0.0/24</code> with the application profile you are using and the IP range for your network. There is no need to specify the protocol for the application, because that information is detailed in the profile. Also, note that the app name replaces the port number.</p>
<p>To view details about which ports, protocols, etc., are defined for an application, enter: <code>sudo ufw app info Samba</code></p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="start-stop-and-check-the-status-of-network-services"><a class="header" href="#start-stop-and-check-the-status-of-network-services">Start, stop, and check the status of network services</a></h2>
<p>On systemd-based systems, use:
<code>sudo systemctl [is-active|is-enabled-start|restart|reload|status|stop|try-restart] &lt;name.service&gt;</code></p>
<blockquote>
<p>Note: On SysV-based systems use the <code>service</code> command instead.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h2 id="statically-route-ip-traffic"><a class="header" href="#statically-route-ip-traffic">Statically route IP traffic</a></h2>
<h3 id="ip-routing"><a class="header" href="#ip-routing">IP Routing</a></h3>
<p>IP routing is a means of specifying and discovering paths in a TCP/IP network along which network data may be sent. Routing uses a set of routing tables to direct the forwarding of network data packets from their source to the destination, often via many intermediary network nodes known as routers. There are two primary forms of IP routing: Static Routing and Dynamic Routing.</p>
<p><strong>Static routing</strong> involves manually adding IP routes to the system's routing table, and this is usually done by manipulating the routing table with the route command. Static routing enjoys many advantages over dynamic routing, such as simplicity of implementation on smaller networks, predictability (the routing table is always computed in advance, and thus the route is precisely the same each time it is used), and low overhead on other routers and network links due to the lack of a dynamic routing protocol. However, static routing does present some disadvantages as well. For example, static routing is limited to small networks and does not scale well. Static routing also fails completely to adapt to network outages and failures along the route due to the fixed nature of the route.</p>
<p><strong>Dynamic routing</strong> depends on large networks with multiple possible IP routes from a source to a destination and makes use of special routing protocols, such as the <em>Router Information Protocol</em> (<strong>RIP</strong>), which handle the automatic adjustments in routing tables that make dynamic routing possible. Dynamic routing has several advantages over static routing, such as superior scalability and the ability to adapt to failures and outages along network routes. Additionally, there is less manual configuration of the routing tables, since routers learn from one another about their existence and available routes. This trait also eliminates the possibility of introducing mistakes in the routing tables via human error. Dynamic routing is not perfect, however, and presents disadvantages such as heightened complexity and additional network overhead from router communications, which does not immediately benefit the end users, but still consumes network bandwidth.</p>
<hr />
<p>When you need to access network devices located on a different network segment than the one you are on, you need to have a route set up so the networking stack knows how to get to the other network segment. This generally just points to your main gateway, but you may want to set up additional static routes, where you don't want the traffic going through your main default gateway.</p>
<p>For Ubuntu versions prior to 18.04, you had to manually edit the <em>/etc/network/interfaces</em> file to set up persistent static routes. With the introduction of Ubuntu 18.04, along came the netplan YAML based network configuration tool.</p>
<p>The netplan configuration files are located in the <em>/etc/netplan</em> folder (for more info about technical specification, have a look at the <a href="https://netplan.io/reference/">reference</a>).</p>
<p>First step is to open the main netplan configuration file using administrative privileges: <code>sudo vi /etc/netplan/01-network-manager-all.yaml</code></p>
<p>Find the configuration stanza related to the network interface which you wish to add the static route to. In this example we will add the the static route to the destination network subnet <code>172.16.0.0/24</code> via the network gateway <code>192.168.1.100</code> on the interface <code>enp0s3</code>:</p>
<pre><code># This file is generated from information provided by
# the datasource.  Changes to it will not persist across an instance.
# To disable cloud-init's network configuration capabilities, write a file
# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:
# network: {config: disabled}
network:
    ethernets:
        enp0s3:
            dhcp4: false
            addresses: [192.168.1.202/24]
            gateway4: 192.168.1.1
            nameservers:
              addresses: [8.8.8.8,8.8.4.4,192.168.1.1]
            routes:
            - to: 172.16.0.0/24
              via: 192.168.1.100
    version: 2
</code></pre>
<p>Once you made all required changes to add the static route all the new netplan configuration using the below command: <code>sudo netplan apply</code></p>
<p>Or, if you want to test it first, and potentially roll back any changes, you can use the following command: <code>sudo netplan try [config-file]</code></p>
<p>This option apply the changes, and provide a 120 timeout where by if you don't accept the changes, they will revert back. This is useful to prevent you from locking yourself out of the system, if the network change didn't work the way you were intending.</p>
<p>Check all static routes available on your Ubuntu system:</p>
<pre><code>ip route s
&gt; default via 192.168.1.1 dev enp0s3 proto static
&gt; 172.16.0.0/24 via 192.168.1.100 dev enp0s3 proto static
&gt; 192.168.1.0/24 dev enp0s3 proto kernel scope link src 192.168.1.202
</code></pre>
<p>To add non-persistent routes:</p>
<pre><code>sudo ip route add 10.10.10.0/24 via 192.168.1.254           # specific route
sudo ip route add default via 192.168.1.254                 # default route (gw)
</code></pre>
<p>Example: adding a static route to a different subnet that cannot be accessed through your default gateway</p>
<p>If your computer is on a network and is not directly connected to the internet, it will be configured with what is called a default gateway, which is usually a router. If the computer cannot find the specific IP address on its local network (aka broadcast domain), as defined by its subnet, it will forward any packets headed to that IP address to the default gateway. The gateway will then attempt to forward packets elsewhere, such as the internet, or another broadcast domain.</p>
<p>But what if you have a separate network (i.e. another office department) that is NOT accessible via the default gateway?</p>
<p>For example, your internet router may be located at <code>10.0.0.1</code> and it is serving your local network, <code>10.0.0.0/8</code>. However, you have a <code>172.16.5.0/24</code> network that is accessible only through a secondary router, which has the IP address <code>10.0.0.101</code> on the main network. Therefore, you need to point your OS to the secondary router for any IP addresses located in the <code>172.16.5.0-255</code> address space. To do this, you need to add a static route.</p>
<p>If you wish to add one temporarily, simply run the <code>ip route add</code> command with the right network information:
<code>ip route add 172.16.5.0/24 via 10.0.0.101 dev eth0</code></p>
<p><strong>172.16.5.0</strong> is the network you wish to access.
<strong>/24</strong> is the subnet mask
<strong>10.0.0.101</strong> is the secondary router to which you are adding a default route
<strong>eth0</strong> is the network interface assigned to your main network (in this case, 10.0.0.0/8)</p>
<blockquote>
<p>Note: <em>ip route add</em> command will only persist until the next reboot or interface/network settings restart.</p>
</blockquote>
<hr />
<p>Further reading:</p>
<ul>
<li><a href="https://ro-che.info/articles/2021-02-27-linux-routing">Understanding modern Linux routing (and wg-quick)</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h2 id="synchronize-time-using-other-network-peers"><a class="header" href="#synchronize-time-using-other-network-peers">Synchronize time using other network peers</a></h2>
<p>Ubuntu by default uses <strong>timedatectl</strong> (front-end utility)/<strong>timesyncd</strong> (daemon) to synchronize time and users can optionally use <strong>chrony</strong> to serve the <em>Network Time Protocol</em>.</p>
<p>Until recently, most network time synchronization was handled by the Network Time Protocol daemon or <strong>ntpd</strong>. This service connects to a pool of other NTP servers that provide it with constant and accurate time updates.</p>
<p>Ubuntu's default install now uses <strong>timesyncd</strong> instead of ntpd. timesyncd connects to the same time servers and works in roughly the same way, but is more lightweight and more integrated with systemd and the low level workings of Ubuntu.</p>
<p><code>ntpdate</code> is considered deprecated in favor of <code>timedatectl</code> (or <code>chrony</code>) and thereby no more installed by default. timesyncd will generally do the right thing keeping your time in sync, and chrony will help with more complex cases: <code>systemd-timesyncd</code> implements SNTP, not NTP, hence multi-server support is out of focus; if you want a full NTP implementation, please use <code>ntpd</code> (&lt;18.04) or <code>chrony</code> (&gt;18.04).</p>
<p>We can query the status of timesyncd by running timedatectl with no arguments. You don't need to use sudo in this case: <code>timedatectl</code></p>
<p><em>system clock synchronized: yes</em> indicates that the time has been successfully synced, and <em>systemd-timesyncd.service active: yes</em> means that timesyncd is enabled and running.</p>
<p>If you're not sure about your time zone, you can list the available time zones with the following command: <code>timedatectl list-timezones</code></p>
<p>Next, you can set the time zone using the timedatectl set-timezone command: <code>timedatectl set-timezone America/Antigua</code></p>
<h3 id="hardware-vs-system-clock"><a class="header" href="#hardware-vs-system-clock">Hardware vs System Clock</a></h3>
<p>A Linux system will generally have two clocks, a hardware clock/real time clock (<strong>RTC</strong>) and a system clock.</p>
<p>The hardware clock is physically present and continues to run from battery power even if the system is not plugged into a power source, this is how the time stays in place when there is no power available. As the Linux system boots up it will read time from the hardware clock, this initial time is then passed to the system clock.</p>
<p>The system clock runs in the kernel and after getting its initial time from the hardware clock it will then synchronize with an NTP server to become up to date.</p>
<p>We can manually synchronize the hardware clock to the system clock if required, this would generally only be required if there was no NTP server available: <code>hwclock --hctosys</code></p>
<p>We can also reverse the process and synchronize the system clock to the hardware clock. <code>hwclock --systohc</code></p>
<p>The <code>hwclock</code> command can also be used to display the current time of the hardware clock as shown below:</p>
<pre><code>sudo hwclock
&gt; Tue 15 Sep 2015 22:24:32 AEST  -0.352785 seconds
</code></pre>
<h3 id="understanding-stratum"><a class="header" href="#understanding-stratum">Understanding Stratum</a></h3>
<p>NTP servers work based on a layered hierarchy referred to as <em>stratum</em>, starting at stratum 0. Stratum 0 are the highly exact time sources such as atomic clocks or GPS clocks, these are our reference time devices. Stratum 1 are the computers that synchronize with the stratum 0 sources, these are highly accurate NTP servers. Stratum 2 servers then get their time from the stratum 1 servers, while stratum 3 servers synchronize with stratum 2 sources.</p>
<p>Essentially stratum n+1 will synchronize against stratum n, the highest limit is 15, while 16 refers to a device that is not synchronized. There are <a href="https://www.pool.ntp.org">plenty of public stratum-1 servers available</a> on the Internet for use. It is generally recommended that you synchronize with a time source higher in the hierarchy, for instance synchronizing time against a stratum 1 server will be considered more reliable than using a stratum 4 server.</p>
<h3 id="firewall-rules"><a class="header" href="#firewall-rules">Firewall Rules</a></h3>
<p>By default NTP uses UDP port <strong>123</strong>, so if you are connecting over the Internet to an external NTP server ensure that outbound UDP 123 traffic is allowed out to the NTP server specified in your configuration. Normally by default all outbound traffic is allowed so this should not be a problem. Public NTP servers on the Internet should already be configured to accept inbound NTP traffic.</p>
<h2 id="how-to-synchronize-the-system-clock-with-a-remote-server-enable-ntp-using-timedatectl"><a class="header" href="#how-to-synchronize-the-system-clock-with-a-remote-server-enable-ntp-using-timedatectl">How to synchronize the system clock with a remote server (enable NTP) using timedatectl</a></h2>
<p>Enable the NTP service on your Linux system with the command, if it's inactive:
<code>sudo timedatectl set-ntp on</code></p>
<p>It's worth noting that this command fails if a NTP service is not installed, e.g. timesyncd, ntpd, Chrony or others. timesyncd should be installed by default in many cases though (for example it's installed by default with Ubuntu 16.04 and newer).</p>
<p>If using a service like chrony or ntpd to make changes, these are not shown by timedatectl until systemd-timedated is restarted:
<code>sudo systemctl restart systemd-timedated</code></p>
<p>On an Ubuntu 18.04 server I also had to restart systemd-timesyncd (but this was no needed on my Ubuntu 19.04 or Solus OS systems for example), or else the system time would not get synchronized. In case you're also using timesyncd, and timedatectl shows <code>System clock synchronized: no</code>, even though it shows <code>NTP service active</code>, restart systemd-timesyncd: <code>sudo systemctl restart systemd-timesyncd</code></p>
<p>When using the default systemd-timesyncd service, you can see some more information than that provided by timedatectl, like the NTP time server used, and a log showing the last time the synchronization was performed, with: <code>sudo systemctl status systemd-timesyncd</code></p>
<p>On systemd 239 and newer (e.g. this won't work on Ubuntu 18.04, because it uses systemd 237) you may show the systemd-timesyncd status using: <code>timedatectl show-timesync</code></p>
<p>And the properties systemd-timesyncd using: <code>timedatectl timesync-status</code></p>
<p>You can change the settings shown here by editing the <code>/etc/systemd/timesyncd.conf</code> configuration file. E.g. to change the NTP servers (you could use the servers provided by the <a href="https://www.ntppool.org/en/use.html">NTP Pool Project</a>), uncomment the NTP line, and add the servers you want to use separated by a space. After changing the configuration file, restart systemd-timesyncd:</p>
<pre><code>[Time]
NTP=0.it.pool.ntp.org 1.it.pool.ntp.org 2.it.pool.ntp.org 3.it.pool.ntp.org
FallbackNTP=ntp.ubuntu.com
RootDistanceMaxSec=5
PollIntervalMinSec=32
PollIntervalMaxSec=2048
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="5-service-configuration---20"><a class="header" href="#5-service-configuration---20">5. Service Configuration - 20%</a></h1>
<ul>
<li><a href="5-service-configuration/./a.html">Configure a caching DNS server</a></li>
<li><a href="5-service-configuration/./b.html">Maintain a DNS zone</a></li>
<li><a href="5-service-configuration/./c.html">Configure email aliases</a></li>
<li><a href="5-service-configuration/./d.html">Configure SSH servers and clients</a></li>
<li><a href="5-service-configuration/./e.html">Restrict access to the HTTP proxy server</a></li>
<li><a href="5-service-configuration/./f.html">Configure an IMAP and IMAPS service</a></li>
<li><a href="5-service-configuration/./g.html">Query and modify the behavior of system services at various operating modes</a></li>
<li><a href="5-service-configuration/./h.html">Configure an HTTP server</a></li>
<li><a href="5-service-configuration/./i.html">Configure HTTP server log files</a></li>
<li><a href="5-service-configuration/./l.html">Configure a database server</a></li>
<li><a href="5-service-configuration/./m.html">Restrict access to a web page</a></li>
<li><a href="5-service-configuration/./n.html">Manage and configure containers</a></li>
<li><a href="5-service-configuration/./o.html">Manage and configure Virtual Machines</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h2 id="configure-a-caching-dns-server"><a class="header" href="#configure-a-caching-dns-server">Configure a caching DNS server</a></h2>
<p>Domain Name Service (DNS) is an Internet service that maps IP addresses and fully qualified domain names (FQDN) to one another. In this way, DNS alleviates the need to remember IP addresses. Computers that run DNS are called <strong>name servers</strong>. Ubuntu ships with <strong>BIND</strong> (Berkley Internet Naming Daemon), the most common program used for maintaining a name server on Linux.</p>
<p>The following is meant to show you how to set up a local DNS resolver on Ubuntu (20.04), with the widely-used BIND9 DNS software. A DNS resolver is known by many names, some of which are listed below. They all refer to the same thing:</p>
<ul>
<li>full resolver (in contrast to stub resolver)</li>
<li>DNS recursor</li>
<li>recursive DNS server</li>
<li>recursive resolver</li>
</ul>
<p>Also, be aware that a DNS server can also be called a name server, as said before. Examples of DNS resolver are <code>8.8.8.8</code> (Google public DNS server) and <code>1.1.1.1</code> (Cloudflare public DNS server). The OS on your computer also has a resolver, although it's called <em>stub resolver</em> due to its limited capability. A stub resolver is a small DNS client on the end user's computer that receives DNS requests from applications such as Firefox and forward requests to a recursive resolver. Almost every resolver can cache DNS response to improve performance, so they are also called caching DNS server.</p>
<p>There are many ways to configure BIND9. Some of the most common configurations are a caching nameserver, primary server, and secondary server:</p>
<ul>
<li>when configured as a <strong>caching nameserver</strong> BIND9 will find the answer to name queries and remember the answer when the domain is queried again</li>
<li>as a <strong>primary server</strong>, BIND9 reads the data for a zone from a file on its host and is authoritative for that zone</li>
<li>as a <strong>secondary server</strong>, BIND9 gets the zone data from another nameserver that is authoritative for the zone.</li>
</ul>
<p>Run the following command to install BIND 9 on Ubuntu (20.04), from the default repository (BIND 9 is the current version and BIND 10 is a dead project):</p>
<pre><code>sudo apt update
sudo apt install bind9 bind9utils bind9-doc bind9-host
</code></pre>
<p>The BIND server will run as the <strong>bind</strong> user, which is created during installation, and listens on TCP and UDP port 53. The BIND daemon is called <strong>named</strong>. The <strong>rndc</strong> binary is used to reload/stop and control other aspects of the BIND daemon. Communication is done over TCP port 953.</p>
<p>The DNS configuration files are stored in the /etc/bind directory. The primary configuration file is /etc/bind/named.conf, which in the layout provided by the package just includes these files:</p>
<ul>
<li>/etc/bind/named.conf.options: global DNS options</li>
<li>/etc/bind/named.conf.local: for your zones</li>
<li>/etc/bind/named.conf.default-zones: default zones such as localhost, its reverse, and the root hints.</li>
</ul>
<p>The root nameservers used to be described in the file /etc/bind/db.root. This is now provided instead by the /usr/share/dns/root.hints file shipped with the dns-root-data package, and is referenced in the named.conf.default-zones configuration file above.</p>
<p>It is possible to configure the same server to be a caching name server, primary, and secondary: it all depends on the zones it is serving. A server can be the Start of Authority (SOA) for one zone, while providing secondary service for another zone. All the while providing caching services for hosts on the local LAN.</p>
<h2 id="caching-nameserver"><a class="header" href="#caching-nameserver">Caching Nameserver</a></h2>
<p>The default configuration acts as a caching server. Simply uncomment and edit /etc/bind/named.conf.options to set the IP addresses of your ISP's DNS servers:</p>
<pre><code>forwarders {
    1.2.3.4;
    5.6.7.8;
};
</code></pre>
<p>Replace <em>1.2.3.4</em> and <em>5.6.7.8</em> with the IP Addresses of actual nameservers (e.g 8.8.8.8, 8.8.4.4).</p>
<p>Save and close the file. Then test the config file syntax: <code>sudo named-checkconf</code></p>
<p>If the test is successful (indicated by a silent output), then restart BIND9: <code>sudo systemctl restart named</code></p>
<p>If you have UFW firewall running on the BIND server, then you need to open port 53 to allow LAN clients to send DNS queries: <code>sudo ufw allow domain</code></p>
<p>To turn query logging on, run: <code>sudo rndc querylog on</code></p>
<p>This will open TCP and UDP port 53 to the private network 192.168.0.0/24. Then from another computer in the same LAN, we can run the following command to query the A record of <code>google.com</code>. Replace 192.168.0.102 with the IP address of your BIND resolver: <code>dig A google.com @192.168.0.102</code></p>
<p>Now on the BIND resolver, check the query log with the following command: <code>sudo journalctl -eu named</code></p>
<p>This will show the latest log message of the bind9 service unit. You should fine something like the following line in the log, which indicates that a DNS query for google.com's A record has been received from port 57806 of 192.168.0.103:</p>
<pre><code>named[1162]: client @0x7f4d2406f0f0 192.168.0.103#57806 (google.com): query: google.com IN A +E(0)K (192.168.0.102)
</code></pre>
<p>Another way of testing your configuration is to use dig against the loopback interface to make sure it is listening on port 53. From a terminal prompt:
<code>dig -x 127.0.0.1</code></p>
<p>You should see lines similar to the following in the command output:</p>
<pre><code>;; Query time: 1 msec
;; SERVER: 192.168.1.10#53(192.168.1.10)
</code></pre>
<p>If you have configured BIND9 as a Caching nameserver “dig” an outside domain to check the query time: <code>dig ubuntu.com</code></p>
<p>Note the query time towards the end of the command output: <code>;; Query time: 49 msec</code></p>
<p>After a second dig there should be improvement: <code>;; Query time: 1 msec</code></p>
<hr />
<h2 id="setting-the-default-dns-resolver-on-ubuntu-2004-server"><a class="header" href="#setting-the-default-dns-resolver-on-ubuntu-2004-server">Setting the Default DNS Resolver on Ubuntu 20.04 Server</a></h2>
<p><strong>systemd-resolved</strong> provides the stub resolver on Ubuntu 20.04. As mentioned in the beginning of this article, a stub resolver is a small DNS client on the end-user's computer that receives DNS requests from applications such as Firefox and forward requests to a recursive resolver.</p>
<p>The default recursive resolver can be seen with this command: <code>systemd-resolve --status</code></p>
<p>If you don'find <code>127.0.0.1</code> as your current DNS Server, BIND isn't the default. If your are testing it on your laptop, chances are that your current DNS server is your home router.</p>
<p>If you run the following command on the BIND server, the related DNS query won't be found in BIND log: <code>dig A facebook.com</code></p>
<p>Instead, you need to explicitly tell dig to use BIND: <code>dig A facebook.com @127.0.0.1</code></p>
<p>To set BIND as the default resolver, open the systemd-resolved configuration file: <code>sudo vi /etc/systemd/resolved.conf</code></p>
<p>In the <code>[Resolve]</code> section, add the following line. This will set a global DNS server for your server: <code>DNS=127.0.0.1</code></p>
<p>Save and close the file. Then restart systemd-resolved service: <code>sudo systemctl restart systemd-resolved</code></p>
<p>Now run the following command to check the default DNS resolver: <code>systemd-resolve --status</code></p>
<p>Now perform a DNS query without specifying 127.0.0.1: <code>dig A facebook.com</code></p>
<p>You will see the DNS query in BIND log, which means BIND is now the default recursive resolver. If you don't see any queries in the BIND log, you might need to configure per-link DNS server.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="maintain-a-dns-zone"><a class="header" href="#maintain-a-dns-zone">Maintain a DNS zone</a></h2>
<p>A <strong>DNS zone</strong> is a distinct part of the domain namespace which is delegated to a legal entity — a person, organization or company, who is responsible for maintaining the DNS zone. A DNS zone is also an administrative function, allowing for granular control of DNS components, such as authoritative name servers.</p>
<p>When a web browser or other network device needs to find the IP address for a hostname such as “example.com”, it performs a <strong>DNS lookup</strong> - essentially a DNS zone check - and is taken to the DNS server that manages the DNS zone for that hostname. This server is called the <strong>authoritative name server</strong> for the domain. The authoritative name server then resolves the DNS lookup by providing the IP address, or other data, for the requested hostname.</p>
<p>The Domain Name System (DNS) defines a domain namespace, which specifies <strong>Top Level Domains</strong> (such as “.com”), second-level domains, (such as “acme.com”) and lower-level domains, also called subdomains (such as “support.acme.com”). Each of these levels can be a DNS zone.</p>
<p>For example, the root domain “acme.com” may be delegated to a Acme Corporation. Acme assumes responsibility for setting up an authoritative DNS server that holds the correct DNS records for the domain.</p>
<p>At each hierarchical level of the DNS system, there is a Name Server containing a <strong>zone file</strong>, which holds the trusted, correct DNS records for that zone.</p>
<p>The <strong>root</strong> of the DNS system, represented by a dot at the end of the domain name — for example, "www.example.com." — is the primary DNS zone. Since 2016, the root zone is overseen by the Internet Corporation for Assigned Names and Numbers (ICANN), which delegates management to a subsidiary acting as the Internet Assigned Numbers Authority (IANA).</p>
<p>The DNS root zone is operated by 13 logical servers, run by organizations like Verisign, the U.S. Army Research Labs and NASA. Any recursive DNS query (more about DNS query types <a href="5-service-configuration/../7-bonus-miscellanea/p.html">here</a>) starts by contacting one of these root servers, and requesting details for the next level down the tree — the Top Level Domain (TLD) server.</p>
<p>There is a DNS zone for each Top Level Domain, such as “.com”, “.org” or country codes like “.co.uk”. There are currently over 1500 top level domains. Most top level domains are managed by ICANN/IANA.</p>
<p><strong>Second-level domains</strong> like the domain “ns1.com”, are defined as separate DNS zones, operated by individuals or organizations. Organizations can run their own DNS name servers, or delegate management to an external provider.</p>
<p>If a domain has subdomains, they can be part of the same zone. Alternatively, if a subdomain is an independent website, and requires separate DNS management, it can be defined as its own DNS zone.</p>
<p>DNS servers can be deployed in a <strong>primary/secondary</strong> topology, where a secondary DNS server holds a read-only copy of the primary DNS server's DNS records. The primary server holds the primary zone file, and the secondary server constitutes an identical secondary zone; DNS requests are distributed between primary and secondary servers. A <strong>DNS zone transfer</strong> occurs when the primary server zone file is copied, in whole or in part, to the secondary DNS server.</p>
<p>DNS <strong>zone files</strong> are defined in RFC 1035 and RFC 1034. A zone file contains mappings between domain names, IP addresses and other resources, organized in the form of <strong>resource records</strong> (RR).</p>
<p>There are two types of zone files:</p>
<ul>
<li>a DNS Primary File which authoritatively describes a zone</li>
<li>a DNS Cache File which lists the contents of a DNS cache — this is only a copy of the authoritative DNS zone.</li>
</ul>
<p>In a zone file, each line represents a DNS resource record (RR). A record is made up of the following fields:</p>
<ul>
<li><strong>Name</strong> is an alphanumeric identifier of the DNS record. It can be left blank, and inherits its value from the previous record.</li>
<li><strong>TTL</strong> (time to live) specifies how long the record should be kept in the local cache of a DNS client. If not specified, the global TTL value at the top of the zone file is used.</li>
<li><strong>Record class</strong> indicates the namespace — typically <strong>IN</strong>, which is the Internet namespace.</li>
<li><strong>Record type</strong> is the DNS record type — for example an <strong>A</strong> record maps a hostname to an IPv4 address, and a <strong>CNAME</strong> is an alias which points a hostname to another hostname.</li>
<li><strong>Record</strong> data has one or more information elements, depending on the record type, separated by a white space. For example an MX record has two elements — a priority and a domain name for an email server.</li>
</ul>
<p>DNS Zone files start with two mandatory records:</p>
<ul>
<li><strong>Global Time to Live</strong> (TTL), which specifies how long records should be kept in local DNS cache.</li>
<li><strong>Start of Authority</strong> (SOA) record—specifies the primary authoritative name server for the DNS Zone.</li>
</ul>
<p>After these two records, the zone file can contain any number of resource records, which can include:</p>
<ul>
<li><strong>Name Server records</strong> (NS) — specifies that a specific DNS Zone, such as “example.com” is delegated to a specific authoritative name server</li>
<li><strong>IPv4 Address Mapping records</strong> (A) — a hostname and its IPv4 address.</li>
<li><strong>IPv6 Address records</strong> (AAAA) — a hostname and its IPv6 address.</li>
<li><strong>Canonical Name records</strong> (CNAME) — points a hostname to an alias. This is another hostname, which the DNS client is redirected to</li>
<li><strong>Mail exchanger record</strong> (MX) — specifies an SMTP email server for the domain.</li>
</ul>
<p>Zone File Tips:</p>
<ul>
<li>when adding a record for a hostname, the hostname must end with a period (.)</li>
<li>hostnames which do not end with a period are considered relative to the main domain name — for example, when specifying a "www" or “ftp” record, there is no need for a period</li>
<li>you can add comments in a zone file by adding a semicolon (<code>;</code>) after a resource record</li>
<li>many admins like to use the last date edited as the serial of a zone, such as 2020012100 which is yyyymmddss (where <code>ss</code> is the Serial Number)</li>
</ul>
<hr />
<h2 id="primary-server-maintaining-a-forward-zone"><a class="header" href="#primary-server-maintaining-a-forward-zone">Primary Server maintaining a Forward Zone</a></h2>
<p>To add a DNS zone to BIND9, turning BIND9 into a Primary server, first edit <code>/etc/bind/named.conf.local</code>:</p>
<pre><code>zone "example.com" {
    type master;
    file "/etc/bind/db.example.com";
};
</code></pre>
<p>Now use an existing zone file as a template to create the <strong>/etc/bind/db.example.com</strong> file: <code>sudo cp /etc/bind/db.local /etc/bind/db.example.com</code></p>
<p>Edit the new zone file <code>/etc/bind/db.example.com</code> and change <code>localhost.</code> to the FQDN of your server, leaving the additional <code>.</code> at the end. Change <code>127.0.0.1</code> to the nameserver's IP Address and <code>root.localhost</code> to a valid email address, but with a <code>.</code> instead of the usual <code>@</code> symbol, again leaving the <code>.</code> at the end. Change the comment to indicate the domain this file is for.</p>
<p>Create an A record for the base domain, <strong>example.com</strong>. Also, create an A record for <strong>ns.example.com</strong>, the name server in this example:</p>
<pre><code>;
; BIND data file for example.com
;
$TTL    604800
@       IN      SOA     example.com. root.example.com. (
                              2         ; Serial
                         604800         ; Refresh
                          86400         ; Retry
                        2419200         ; Expire
                         604800 )       ; Negative Cache TTL

@       IN      NS      ns.example.com.
@       IN      A       192.168.1.10
@       IN      AAAA    ::1
ns      IN      A       192.168.1.10
</code></pre>
<p>You must increment the Serial Number every time you make changes to the zone file. If you make multiple changes before restarting BIND9, simply increment the Serial once.</p>
<p>Once you have made changes to the zone file BIND9 needs to be restarted for the changes to take effect: <code>sudo systemctl restart bind9.service</code></p>
<h2 id="reverse-zone"><a class="header" href="#reverse-zone">Reverse Zone</a></h2>
<p>Now that the zone is setup and resolving names to IP addresses, a reverse zone needs to be added to allows DNS to resolve an address to a name.</p>
<p>Edit <strong>/etc/bind/named.conf.local</strong> and add the following:</p>
<pre><code>zone "1.168.192.in-addr.arpa" {
    type master;
    file "/etc/bind/db.192";
};
</code></pre>
<blockquote>
<p>Note: Replace 1.168.192 with the first three octets of whatever network you are using. Also, name the zone file /etc/bind/db.192 appropriately. It should match the first octet of your network. Reverse DNS lookups for IPv4 addresses use the special domain <code>in-addr.arpa</code>. In this domain, an IPv4 address is represented as a concatenated sequence of four decimal numbers, separated by dots, to which is appended the second level domain suffix <code>.in-addr.arpa</code>. The four decimal numbers are obtained by splitting the 32-bit IPv4 address into four octets and converting each octet into a decimal number. These decimal numbers are then concatenated in the order: least significant octet first (leftmost), to most significant octet last (rightmost). It is important to note that this is the reverse order to the usual dotted-decimal convention for writing IPv4 addresses in textual form. For example, to do a reverse lookup of the IP address <code>8.8.4.4</code> the PTR record for the domain name <code>4.4.8.8.in-addr.arpa</code> would be looked up, and found to point to <code>google-public-dns-b.google.com</code>.</p>
</blockquote>
<p>Now create the <strong>/etc/bind/db.192</strong> file from template: <code>sudo cp /etc/bind/db.127 /etc/bind/db.192</code></p>
<p>Next edit /etc/bind/db.192 changing the same options as <strong>/etc/bind/db.example.com</strong>:</p>
<pre><code>;
; BIND reverse data file for local 192.168.1.XXX net
;
$TTL    604800
@       IN      SOA     ns.example.com. root.example.com. (
                              2         ; Serial
                         604800         ; Refresh
                          86400         ; Retry
                        2419200         ; Expire
                         604800 )       ; Negative Cache TTL
;
@       IN      NS      ns.
10      IN      PTR     ns.example.com.
</code></pre>
<p>The Serial Number in the Reverse zone needs to be incremented on each change as well. For each A record you configure in /etc/bind/db.example.com, that is for a different address, you need to create a PTR record in /etc/bind/db.192.</p>
<p>After creating the reverse zone file restart BIND9: <code>sudo systemctl restart bind9.service</code></p>
<h2 id="secondary-server"><a class="header" href="#secondary-server">Secondary Server</a></h2>
<p>Once a Primary Server has been configured a secondary server is highly recommended in order to maintain the availability of the domain should the Primary become unavailable.</p>
<p>First, on the primary server, the zone transfer needs to be allowed. Add the <code>allow-transfer</code> option to the example forward and reverse zone definitions in /etc/bind/named.conf.local:</p>
<pre><code>zone "example.com" {
    type master;
    file "/etc/bind/db.example.com";
    allow-transfer { 192.168.1.11; };
};
    
zone "1.168.192.in-addr.arpa" {
    type master;
    file "/etc/bind/db.192";
    allow-transfer { 192.168.1.11; };
};
</code></pre>
<blockquote>
<p>Note: Replace 192.168.1.11 with the IP address of your secondary nameserver.</p>
</blockquote>
<p>Restart BIND9 on the Primary server: <code>sudo systemctl restart bind9.service</code></p>
<p>Next, on the scondary server, install the bind9 package the same way as on the primary. Then edit the /etc/bind/named.conf.local and add the following declarations for the forward and reverse zones:</p>
<pre><code>zone "example.com" {
    type slave;
    file "db.example.com";
    masters { 192.168.1.10; };
};        
          
zone "1.168.192.in-addr.arpa" {
    type slave;
    file "db.192";
    masters { 192.168.1.10; };
};
</code></pre>
<blockquote>
<p>Note: Replace 192.168.1.10 with the IP address of your primary nameserver.</p>
</blockquote>
<p>Restart BIND9 on the secondary server: <code>sudo systemctl restart bind9.service</code></p>
<p>In /var/log/syslog you should see something similar to the following (some lines have been split to fit the format of this document):</p>
<pre><code>client 192.168.1.10#39448: received notify for zone '1.168.192.in-addr.arpa'
zone 1.168.192.in-addr.arpa/IN: Transfer started.
transfer of '100.18.172.in-addr.arpa/IN' from 192.168.1.10#53:
 connected using 192.168.1.11#37531
zone 1.168.192.in-addr.arpa/IN: transferred serial 5
transfer of '100.18.172.in-addr.arpa/IN' from 192.168.1.10#53:
 Transfer completed: 1 messages, 
6 records, 212 bytes, 0.002 secs (106000 bytes/sec)
zone 1.168.192.in-addr.arpa/IN: sending notifies (serial 5)

client 192.168.1.10#20329: received notify for zone 'example.com'
zone example.com/IN: Transfer started.
transfer of 'example.com/IN' from 192.168.1.10#53: connected using 192.168.1.11#38577
zone example.com/IN: transferred serial 5
transfer of 'example.com/IN' from 192.168.1.10#53: Transfer completed: 1 messages, 
8 records, 225 bytes, 0.002 secs (112500 bytes/sec)
</code></pre>
<blockquote>
<p>Note: A zone is only transferred if the Serial Number on the primary is larger than the one on the secondary. If you want to have your primary DNS notifying other secondary DNS servers of zone changes, you can add <code>also-notify { ipaddress; };</code> to /etc/bind/named.conf.local as shown in the example below:</p>
</blockquote>
<pre><code>zone "example.com" {
    type master;
    file "/etc/bind/db.example.com";
    allow-transfer { 192.168.1.11; };
    also-notify { 192.168.1.11; }; 
};

zone "1.168.192.in-addr.arpa" {
    type master;
    file "/etc/bind/db.192";
    allow-transfer { 192.168.1.11; };
    also-notify { 192.168.1.11; }; 
};
</code></pre>
<blockquote>
<p>Note: The default directory for non-authoritative zone files is /var/cache/bind/. This directory is also configured in AppArmor to allow the named daemon to write to it.</p>
</blockquote>
<h2 id="testing"><a class="header" href="#testing">Testing</a></h2>
<p>A good way to test your zone files is by using the <strong>named-checkzone</strong> utility installed with the bind9 package. This utility allows you to make sure the configuration is correct before restarting BIND9 and making the changes live.</p>
<p>To test our example forward zone file enter the following from a command prompt: <code>named-checkzone example.com /etc/bind/db.example.com</code></p>
<p>If everything is configured correctly you should see output similar to:</p>
<pre><code>zone example.com/IN: loaded serial 6
OK
</code></pre>
<p>Similarly, to test the reverse zone file enter the following: <code>named-checkzone 1.168.192.in-addr.arpa /etc/bind/db.192</code></p>
<p>The output should be similar to:</p>
<pre><code>zone 1.168.192.in-addr.arpa/IN: loaded serial 3
OK
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="configure-email-aliases"><a class="header" href="#configure-email-aliases">Configure email aliases</a></h2>
<p>The process of getting an email from one person to another over a network or the Internet involves many systems working together. Each of these systems must be correctly configured for the process to work. The sender uses a <strong>Mail User Agent</strong> (MUA), or email client, to send the message through one or more <strong>Mail Transfer Agents</strong> (MTA), the last of which will hand it off to a <strong>Mail Delivery Agent</strong> (MDA) for delivery to the recipient's mailbox, from which it will be retrieved by the recipient's email client, usually via a POP3 or IMAP server.</p>
<p>The <strong>sendmail</strong> smtp mail server is able to set up mailbox aliases which can be used to forward mail to specific users, or even other aliases. This can be done by simply editing a configuration file called ‘aliases' that is generally located in <strong>/etc/mail/aliases</strong> (symlinked to <strong>/etc/aliases</strong>).</p>
<p>The following are some example aliases from an aliases file:</p>
<pre><code># Unix Workstation Support Group
ajc: ajc@indiana.edu
brier: brier@indiana.edu
leighg: leighg@indiana.edu
rtompkin: rtompkin@indiana.edu
uthuppur: uthuppur@indiana.edu

group: ajc,brier,leighg,rtompkin,uthuppur
</code></pre>
<p>The first line is a comment, ignored by sendmail, as is the blank line before the group alias. The rest of the lines are aliases, which explain a lot about how aliasing works.</p>
<p>The first five aliases (ajc, brier, leighg, rtompkin, and uthuppur) are for those users, and they simply redirect each user's mail to user@indiana.edu. So, instead of being delivered locally, mail to each of those users will go to them @indiana.edu (which, incidentally, is another alias on IU's post office machines, which redirects mail to the user's preferred email address here at IU).</p>
<p>The last alias, group, is a bit more interesting in terms of demonstrating how aliasing works. The group alias does not correspond to an actual user of the system. Instead, it is an alias pointing to a group of users (in this case, the members of the UWSG). So, an alias can direct mail to more than one address, as long as addresses are separated by commas.</p>
<p>Edit the file in your favorite text editor to suit your needs:
<code>sudo vi /etc/mail/aliases</code></p>
<p>Once you have the aliases configuration file set up the way you want, you need to use that plain text file to update the random access database aliases.db file using the <strong>newaliases</strong> command as follows:
<code>sudo newaliases</code></p>
<h2 id="how-to-install-and-configure-sendmail-on-ubuntu"><a class="header" href="#how-to-install-and-configure-sendmail-on-ubuntu">How To Install And Configure Sendmail On Ubuntu</a></h2>
<ol>
<li>
<p>Install Sendmail:
<code>sudo apt-get install sendmail</code></p>
</li>
<li>
<p>Configure /etc/hosts file.</p>
</li>
</ol>
<p>Find your hostname by typing:
<code>hostname</code></p>
<p>Then:
<code>sudo vi /etc/hosts</code></p>
<p>On the line starting with 127.0.0.1, add the hostname to the end so it looks the same as:
<code>127.0.0.1 localhost &lt;hostname&gt;</code></p>
<p>(You willl notice that your hostname can also be identified on the line that starts with 127.0.1.1 where it appears twice)</p>
<ol start="3">
<li>
<p>Run Sendmail's config and answer ‘Y' to everything:
<code>sudo sendmailconfig</code></p>
</li>
<li>
<p>Restart Apache
<code>sudo service apache2 restart</code></p>
</li>
<li>
<p>Using sendmail.</p>
</li>
</ol>
<p>To quickly send an email:
<code>sendmail -v someone@email.com</code></p>
<p>After hitting the enter key, on the line directly below, enter a From address (each line after you hit enter will be blank):
<code>From: you@yourdomain.com</code></p>
<p>Hit enter again and type a subject:
<code>Subject: This is the subject field of the email</code></p>
<p>Hit enter again and type the message:
<code>This is the message to be sent.</code></p>
<p>Hit enter again. To send the email, type a ‘.‘ (period/dot) on the empty line and press enter:
<code>.</code></p>
<p>Wait a few seconds and you will see the output of the email being sent.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="configure-ssh-servers-and-clients"><a class="header" href="#configure-ssh-servers-and-clients">Configure SSH servers and clients</a></h2>
<ol>
<li>Installation</li>
</ol>
<p>Installation of the OpenSSH client and server applications is simple. To install the OpenSSH client applications on your Ubuntu system, use this command at a terminal prompt:
<code>sudo apt install openssh-client</code></p>
<p>To install the OpenSSH server application, and related support files, use this command at a terminal prompt:
<code>sudo apt install openssh-server</code></p>
<ol start="2">
<li>Configuration</li>
</ol>
<p>You may configure the default behavior of the OpenSSH server application, sshd, by editing the file <strong>/etc/ssh/sshd_config</strong>. For information about the configuration directives used in this file, you may view the appropriate manual page with the following command, issued at a terminal prompt:
<code>man sshd_config</code></p>
<p>There are many directives in the sshd configuration file controlling such things as communication settings, and authentication modes. The following are examples of configuration directives that can be changed by editing the /etc/ssh/sshd_config file.</p>
<blockquote>
<p>Tip: Prior to editing the configuration file, you should make a copy of the original file and protect it from writing so you will have the original settings as a reference and to reuse as necessary. Copy the /etc/ssh/sshd_config file and protect it from writing with the following commands, issued at a terminal prompt:</p>
</blockquote>
<pre><code>sudo cp /etc/ssh/sshd_config /etc/ssh/sshd_config.original
sudo chmod a-w /etc/ssh/sshd_config.original
</code></pre>
<p>Furthermore since losing an ssh server might mean losing your way to reach a server, check the configuration after changing it and before restarting the server:
<code>sudo sshd -t -f /etc/ssh/sshd_config</code></p>
<p>The following are examples of configuration directives you may change.</p>
<p>To set your OpenSSH to listen on TCP port 2222 instead of the default TCP port 22, change the Port directive as such:
<code>Port 2222</code></p>
<p>To make your OpenSSH server display the contents of the /etc/issue.net file as a pre-login banner, simply add or modify this line in the /etc/ssh/sshd_config file:
<code>Banner /etc/issue.net</code></p>
<p>After making changes to the /etc/ssh/sshd_config file, save the file, and restart the sshd server application to effect the changes using the following command at a terminal prompt:
<code>sudo systemctl restart sshd.service</code></p>
<blockquote>
<p>Warning: Many other configuration directives for sshd are available to change the server application's behavior to fit your needs. Be advised, however, if your only method of access to a server is ssh, and you make a mistake in configuring sshd via the /etc/ssh/sshd_config file, you may find you are locked out of the server upon restarting it. Additionally, if an incorrect configuration directive is supplied, the sshd server may refuse to start, so be extra careful when editing this file on a remote server.</p>
</blockquote>
<ol start="3">
<li>SSH Keys</li>
</ol>
<p>SSH allow authentication between two hosts without the need of a password. SSH key authentication uses a private key and a public key.</p>
<p>To generate the keys, from a terminal prompt enter:
<code>ssh-keygen -t rsa</code></p>
<p>This will generate the keys using the RSA Algorithm. At the time of this writing, the generated keys will have 3072 bits. You can modify the number of bits by using the -b option. For example, to generate keys with 4096 bits, you can do:
<code>ssh-keygen -t rsa -b 4096</code></p>
<p>During the process you will be prompted for a password. Simply hit Enter when prompted to create the key.</p>
<p>By default the public key is saved in the file ~/.ssh/id_rsa.pub, while ~/.ssh/id_rsa is the private key. Now copy the id_rsa.pub file to the remote host and append it to ~/.ssh/authorized_keys by entering:
<code>ssh-copy-id &lt;username&gt;@&lt;remotehost&gt;</code></p>
<p>Please, note that this requires that password authentication is enabled on the remote ssh server.</p>
<p>Finally, double check the permissions on the authorized_keys file, only the authenticated user should have read and write permissions. If the permissions are not correct change them by:
<code>chmod 600 .ssh/authorized_keys</code></p>
<p>You should now be able to SSH to the host without being prompted for a password, but you will be asked to provide the passphrase of the private key.</p>
<p>To avoid it, you can use <code>ssh-agent</code> to handle passwords for SSH private keys. Use <code>ssh-add</code> to add the keys to the list maintained by ssh-agent. After you add a private key password to ssh-agent, you do not need to enter it each time you connect to a remote host with your public key until you restart your host or you log out from it:</p>
<pre><code>ssh-agent $SHELL
ssh-add
ssh-add -l
ssh &lt;username&gt;@&lt;remotehost&gt;
</code></pre>
<p>To completely automate ssh-login without neither entering the passphrase, you can use <code>gpg</code> and <code>sshpass</code>:</p>
<pre><code>sudo apt install sshpass
echo 'YOUR_PWD' &gt; .sshpasswd
gpg -c .sshpasswd
rm .sshpasswd
gpg -d -q .sshpasswd.gpg | sshpass -Ppassphrase ssh -o StrictHostKeyChecking=no -tt &lt;username&gt;@&lt;remotehost&gt;
</code></pre>
<ol>
<li>Import keys from public keyservers</li>
</ol>
<p>These days many users have already ssh keys registered with services like launchpad or github. Those can be easily imported with:
<code>ssh-import-id &lt;username-on-remote-service&gt;</code></p>
<p>The prefix <code>lp:</code> is implied and means fetching from launchpad, the alternative <code>gh:</code> will make the tool fetch from github instead.</p>
<ol start="5">
<li>Two factor authentication with U2F/FIDO</li>
</ol>
<p>OpenSSH 8.2 added support for U2F/FIDO hardware authentication devices. These devices are used to provide an extra layer of security on top of the existing key-based authentication, as the hardware token needs to be present to finish the authentication.</p>
<p>It's very simple to use and setup. The only extra step is generate a new keypair that can be used with the hardware device. For that, there are two key types that can be used: ecdsa-sk and ed25519-sk. The former has broader hardware support, while the latter might need a more recent device.</p>
<p>Once the keypair is generated, it can be used as you would normally use any other type of key in openssh. The only requirement is that in order to use the private key, the U2F device has to be present on the host.</p>
<p>For example, plug the U2F device in and generate a keypair to use with it:</p>
<pre><code>$ ssh-keygen -t ecdsa-sk
Generating public/private ecdsa-sk key pair.
You may need to touch your authenticator to authorize key generation. &lt;-- touch device
Enter file in which to save the key (/home/ubuntu/.ssh/id_ecdsa_sk):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /home/ubuntu/.ssh/id_ecdsa_sk
Your public key has been saved in /home/ubuntu/.ssh/id_ecdsa_sk.pub
The key fingerprint is:
SHA256:V9PQ1MqaU8FODXdHqDiH9Mxb8XK3o5aVYDQLVl9IFRo ubuntu@focal
</code></pre>
<p>Now just transfer the public part to the server to ~/.ssh/authorized_keys and you are ready to go:</p>
<pre><code>$ ssh -i .ssh/id_ecdsa_sk ubuntu@focal.server
Confirm user presence for key ECDSA-SK SHA256:V9PQ1MqaU8FODXdHqDiH9Mxb8XK3o5aVYDQLVl9IFRo &lt;-- touch device
Welcome to Ubuntu Focal Fossa (GNU/Linux 5.4.0-21-generic x86_64)
(...)
ubuntu@focal.server:~$
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="restrict-access-to-the-http-proxy-server"><a class="header" href="#restrict-access-to-the-http-proxy-server">Restrict access to the HTTP proxy server</a></h2>
<p><strong>Squid</strong> is a full-featured caching proxy supporting popular network protocols like HTTP, HTTPS, FTP, and more. It can be used to improve the web server's performance by caching repeated requests, filter web traffic, and access geo-restricted content.</p>
<h3 id="installing-squid-on-ubuntu"><a class="header" href="#installing-squid-on-ubuntu">Installing Squid on Ubuntu</a></h3>
<p>The squid package is included in the standard Ubuntu 20.04 repositories. To install it, run the following commands as sudo user:</p>
<pre><code>sudo apt update
sudo apt install squid
</code></pre>
<p>Once the installation is completed, the Squid service will start automatically. To verify it, check the service status:
<code>sudo systemctl status squid</code></p>
<h3 id="configuring-squid"><a class="header" href="#configuring-squid">Configuring Squid</a></h3>
<p>The squid service can be configured by editing the <strong>/etc/squid/squid.conf</strong> file. The configuration file contains comments that describe what each configuration option does. You can also put your configuration settings in separate files, which can be included in the main configuration file using the “include” directive.</p>
<p>Before making any changes, it is recommended to back up the original configuration file:
<code>sudo cp /etc/squid/squid.conf{,.orginal}</code></p>
<p>To start configuring your squid instance, open the file in your text editor:
<code>sudo vi /etc/squid/squid.conf</code></p>
<p>By default, squid is set to listen on port 3128 on all network interfaces on the server.</p>
<p>If you want to change the port and set a listening interface, locate the line starting with <strong>http_port</strong> and specify the interface IP address and the new port. If no interface is specified Squid will listen on all interfaces.</p>
<p>Running Squid on all interfaces and on the default port should be fine for most users.</p>
<p>Squid allows you to control how the clients can access the web resources using Access Control Lists (ACLs). By default, access is permitted only from the localhost.</p>
<p>If all clients who use the proxy have a static IP address, the simplest option to restrict access to the proxy server is to create an ACL that will include the allowed IPs. Otherwise, you can set squid to use authentication.</p>
<p>Instead of adding the IP addresses in the main configuration file, create a new dedicated file that will hold the allowed IPs:</p>
<pre><code>#/etc/squid/allowed_ips
192.168.33.1
# All other allowed IPs
</code></pre>
<p>Once done, open the main configuration file and create a new ACL named allowed_ips and allow access to that ACL using the http_access directive:</p>
<pre><code>#/etc/squid/squid.conf
# ...
acl allowed_ips src "/etc/squid/allowed_ips.txt"
# ...
http_access allow localhost
http_access allow allowed_ips
# And finally deny all other access to this proxy
http_access deny all
</code></pre>
<p>The order of the http_access rules is important. Make sure you add the line before http_access deny all.</p>
<p>The http_access directive works in a similar way as the firewall rules. Squid reads the rules from top to bottom, and when a rule matches, the rules below are not processed.</p>
<p>Whenever you make changes to the configuration file, you need to restart the Squid service for the changes to take effect:
<code>sudo systemctl restart squid</code></p>
<h3 id="squid-authentication"><a class="header" href="#squid-authentication">Squid Authentication</a></h3>
<p>If restricting access based on IP doesn't work for your use case, you can configure squid to use a back-end to authenticate users. Squid supports Samba, LDAP, and HTTP basic auth.</p>
<p>In this guide, we'll use basic auth. It is a simple authentication method built into the HTTP protocol.</p>
<p>To generate a crypted password, use the openssl tool. The following command appends the USERNAME:PASSWORD pair to the /etc/squid/htpasswd file:
<code>printf "USERNAME:$(openssl passwd -crypt PASSWORD)\n" | sudo tee -a /etc/squid/htpasswd</code></p>
<p>For example, to create a user “josh” with password “P@ssvv0rT”, you would run:</p>
<pre><code>printf "josh:$(openssl passwd -crypt 'P@ssvv0rd')\n" | sudo tee -a /etc/squid/htpasswd
&gt;josh:QMxVjdyPchJl6
</code></pre>
<p>The next step is to enable the HTTP basic authentication and include the file containing the user credentials to the squid configuration file.</p>
<p>Open the main configuration and add the following:</p>
<pre><code>#/etc/squid/squid.conf
# ...
auth_param basic program /usr/lib/squid3/basic_ncsa_auth /etc/squid/htpasswd
auth_param basic realm proxy
acl authenticated proxy_auth REQUIRED
# ...
#http_access allow localnet
http_access allow localhost
http_access allow authenticated
# And finally deny all other access to this proxy
http_access deny all
</code></pre>
<p>The first three lines are creating a new ACL named authenticated, and the last "http_access allow" line is allowing access to authenticated users.</p>
<p>Restart the Squid service:
<code>sudo systemctl restart squid</code></p>
<h3 id="configuring-firewall"><a class="header" href="#configuring-firewall">Configuring firewall</a></h3>
<p>To open the Squid ports, enable the UFW ‘Squid' profile:
<code>sudo ufw allow 'Squid'</code></p>
<h2 id="configuring-firefox-to-use-proxy"><a class="header" href="#configuring-firefox-to-use-proxy">Configuring Firefox to Use Proxy</a></h2>
<p>In the upper right-hand corner, click on the hamburger icon ☰ to open Firefox's menu: click on the ⚙ Preferences link.</p>
<p>Scroll down to the Network Settings section and click on the Settings... button.</p>
<p>A new window will open.</p>
<p>Select the Manual proxy configuration radio button.</p>
<p>Enter your Squid server IP address in the HTTP Host field and 3128 in the Port field.</p>
<p>Select the Use this proxy server for all protocols checkbox.</p>
<p>Click on the OK button to save the settings.</p>
<p>At this point, your Firefox is configured, and you can browse the Internet through the Squid proxy. To verify it, open google.com, type “what is my ip” and you should see your Squid server IP address.</p>
<p>To revert back to the default settings, go to Network Settings, select the Use system proxy settings radio button and save the settings.</p>
<p>There are several plugins that can also help you to configure Firefox's proxy settings, such as FoxyProxy.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="configure-an-imap-and-imaps-service"><a class="header" href="#configure-an-imap-and-imaps-service">Configure an IMAP and IMAPS service</a></h2>
<p><strong>Dovecot</strong> is a Mail Delivery Agent, written with security primarily in mind. It supports the major mailbox formats: <strong>mbox</strong> or <strong>Maildir</strong>. This section explains how to set it up as an IMAP or POP3 server.</p>
<h3 id="installation"><a class="header" href="#installation">Installation</a></h3>
<p>To install a basic Dovecot server with common POP3 and IMAP functions, run the following command:
<code>sudo apt install dovecot-imapd dovecot-pop3d</code></p>
<p>There are various other Dovecot modules including dovecot-sieve (mail filtering), dovecot-solr (full text search), dovecot-antispam (spam filter training), dovecot-ldap (user directory).</p>
<h3 id="configuration"><a class="header" href="#configuration">Configuration</a></h3>
<p>To configure Dovecot, edit the file /etc/dovecot/dovecot.conf and its included config files in /etc/dovecot/conf.d/. By default all installed protocols will be enabled via an include directive in /etc/dovecot/dovecot.conf:
<code>!include_try /usr/share/dovecot/protocols.d/*.protocol</code></p>
<p>IMAPS and POP3S are more secure because they use SSL encryption to connect. A basic self-signed ssl certificate is automatically set up by package ssl-cert and used by Dovecot in /etc/dovecot/conf.d/10-ssl.conf.</p>
<p>By default mbox format is configured, if required you can also use Maildir. More about that can be found in the comments in /etc/dovecot/conf.d//10-mail.conf. Also see the Dovecot web site to learn about further benefits and details.</p>
<p>Make sure to also configure your Mail Transport Agent (MTA) to transfer the incoming mail to the selected type of mailbox.</p>
<p>Once you have configured Dovecot, restart its daemon in order to test your setup:
<code>sudo service dovecot restart</code></p>
<p>Try to log in with the commands telnet localhost pop3 (for POP3) or telnet localhost imap2 (for IMAP). You should see something like the following:</p>
<pre><code>telnet localhost pop3
&gt; Trying 127.0.0.1...
&gt; Connected to localhost.localdomain.
&gt; Escape character is '^]'.
&gt; +OK Dovecot ready.
</code></pre>
<h3 id="dovecot-ssl-configuration"><a class="header" href="#dovecot-ssl-configuration">Dovecot SSL Configuration</a></h3>
<p>Dovecot is configured to use SSL automatically by default, using the package ssl-cert which provides a self signed certificate.</p>
<p>You can instead generate your own custom certificate for Dovecot using openssh, for example:</p>
<pre><code>sudo openssl req -new -x509 -days 1000 -nodes -out "/etc/dovecot/dovecot.pem" \
    -keyout "/etc/dovecot/private/dovecot.pem"
</code></pre>
<p>See certificates-and-security for more details on creating custom certificates.</p>
<p>Then edit /etc/dovecot/conf.d/10-ssl.conf and amend following lines to specify Dovecat use these custom certificates :</p>
<pre><code>ssl_cert = &lt;/etc/dovecot/private/dovecot.pem
ssl_key = &lt;/etc/dovecot/private/dovecot.key
</code></pre>
<p>You can get the SSL certificate from a Certificate Issuing Authority or you can create self-signed one (see certificates-and-security for details). Once you create the certificate, you will have a key file and a certificate file that you want to make known in the config shown above.</p>
<h3 id="firewall-configuration-for-an-email-server"><a class="header" href="#firewall-configuration-for-an-email-server">Firewall Configuration for an Email Server</a></h3>
<p>To access your mail server from another computer, you must configure your firewall to allow connections to the server on the necessary ports:</p>
<ul>
<li>IMAP - 143</li>
<li>IMAPS - 993</li>
<li>POP3 - 110</li>
<li>POP3S - 995</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h2 id="query-and-modify-the-behavior-of-system-services-at-various-operating-modes"><a class="header" href="#query-and-modify-the-behavior-of-system-services-at-various-operating-modes">Query and modify the behavior of system services at various operating modes</a></h2>
<p>The basic object that systemd manages and acts upon is a <strong>unit</strong>. Units can be of many types, but the most common type is a <strong>service</strong> (indicated by a unit file ending in .service). To manage services on a systemd enabled server, our main tool is the systemctl command.</p>
<h3 id="basic-unit-management"><a class="header" href="#basic-unit-management">Basic Unit Management</a></h3>
<p>All of the normal init system commands have equivalent actions with the systemctl command. We will use the nginx.service unit to demonstrate (you'll have to install Nginx with your package manager to get this service file).</p>
<p>For instance, we can start the service by typing:
<code>sudo systemctl start nginx.service</code></p>
<p>We can stop it again by typing:
<code>sudo systemctl stop nginx.service</code></p>
<p>To restart the service, we can type:
<code>sudo systemctl restart nginx.service</code></p>
<p>To attempt to reload the service without interrupting normal functionality, we can type:
<code>sudo systemctl reload nginx.service</code></p>
<h3 id="enabling-or-disabling-units"><a class="header" href="#enabling-or-disabling-units">Enabling or Disabling Units</a></h3>
<p>By default, most systemd unit files are not started automatically at boot. To configure this functionality, you need to <strong>enable</strong> to unit. This hooks it up to a certain boot <strong>target</strong>, causing it to be triggered when that target is started.</p>
<p>To enable a service to start automatically at boot, type:
<code>sudo systemctl enable nginx.service</code></p>
<p>If you wish to disable the service again, type:
<code>sudo systemctl disable nginx.service</code></p>
<h3 id="getting-an-overview-of-the-system-state"><a class="header" href="#getting-an-overview-of-the-system-state">Getting an Overview of the System State</a></h3>
<p>There is a great deal of information that we can pull from a systemd server to get an overview of the system state.</p>
<p>For instance, to get all of the unit files that systemd has listed as <strong>active</strong>, type (you can actually leave off the list-units as this is the default systemctl behavior):
<code>systemctl list-units</code></p>
<p>To list all of the units that systemd has loaded or attempted to load into memory, including those that are not currently active, add the --all switch:
<code> systemctl list-units --all</code></p>
<p>To list all of the units installed on the system, including those that systemd has not tried to load into memory, type:
<code>systemctl list-unit-files</code></p>
<h3 id="viewing-basic-log-information"><a class="header" href="#viewing-basic-log-information">Viewing Basic Log Information</a></h3>
<p>A systemd component called <strong>journald</strong> collects and manages journal entries from all parts of the system. This is basically log information from applications and the kernel.</p>
<p>To see all log entries, starting at the oldest entry, type:
<code>journalctl</code></p>
<p>By default, this will show you entries from the current and previous boots if journald is configured to save previous boot records. Some distributions enable this by default, while others do not (to enable this, either edit the /etc/systemd/journald.conf file and set the Storage= option to “persistent”, or create the persistent directory by typing sudo mkdir -p /var/log/journal).</p>
<p>If you only wish to see the journal entries from the current boot, add the -b flag:
<code>journalctl -b</code></p>
<p>To see only kernel messages, such as those that are typically represented by dmesg, you can use the -k flag:
<code>journalctl -k</code></p>
<p>Again, you can limit this only to the current boot by appending the -b flag:
<code>journalctl -k -b</code></p>
<h3 id="querying-unit-states-and-logs"><a class="header" href="#querying-unit-states-and-logs">Querying Unit States and Logs</a></h3>
<p>While the above commands gave you access to the general system state, you can also get information about the state of individual units.</p>
<p>To see an overview of the current state of a unit, you can use the status option with the systemctl command. This will show you whether the unit is active, information about the process, and the latest journal entries:
<code>systemctl status nginx.service</code></p>
<p>To see all of the journal entries for the unit in question, give the -u option with the unit name to the journalctl command (-e to jump to the end):
<code>journalctl -e -u nginx.service</code></p>
<p>As always, you can limit the entries to the current boot by adding the -b flag:
<code>journalctl -b -u nginx.service</code></p>
<h3 id="inspecting-units-and-unit-files"><a class="header" href="#inspecting-units-and-unit-files">Inspecting Units and Unit Files</a></h3>
<p>By now, you know how to modify a unit's state by starting or stopping it, and you know how to view state and journal information to get an idea of what is happening with the process. However, we haven't seen yet how to inspect other aspects of units and unit files.</p>
<p>A unit file contains the parameters that systemd uses to manage and run a unit. To see the full contents of a unit file, type:
<code>systemctl cat nginx.service</code></p>
<p>To see the dependency tree of a unit (which units systemd will attempt to activate when starting the unit), type:
<code>systemctl list-dependencies nginx.service</code></p>
<p>This will show the dependent units, with target units recursively expanded. To expand all dependent units recursively, pass the --all flag:
<code>systemctl list-dependencies --all nginx.service</code></p>
<p>Finally, to see the low-level details of the unit's settings on the system, you can use the show option:
<code>systemctl show nginx.service</code></p>
<p>This will give you the value of each parameter being managed by systemd.</p>
<h3 id="modifying-unit-files"><a class="header" href="#modifying-unit-files">Modifying Unit Files</a></h3>
<p>If you need to make a modification to a unit file, systemd allows you to make changes from the systemctl command itself so that you don't have to go to the actual disk location.</p>
<p>To add a unit file snippet, which can be used to append or override settings in the default unit file, simply call the edit option on the unit:
<code>sudo systemctl edit nginx.service</code></p>
<p>If you prefer to modify the entire content of the unit file instead of creating a snippet, pass the --full flag:
<code>sudo systemctl edit --full nginx.service</code></p>
<p>After modifying a unit file, you should reload the systemd process itself to pick up your changes:
<code>sudo systemctl daemon-reload</code></p>
<h3 id="manually-editing-unit-files"><a class="header" href="#manually-editing-unit-files">Manually Editing Unit Files</a></h3>
<p>The files that define how systemd will handle a unit can be found in many different locations, each of which have different priorities and implications.</p>
<p>The system's copy of unit files are generally kept in the <strong>/lib/systemd/system directory</strong>. When software installs unit files on the system, this is the location where they are placed by default.</p>
<p>Unit files stored here are able to be started and stopped on-demand during a session. This will be the generic, vanilla unit file, often written by the upstream project's maintainers that should work on any system that deploys systemd in its standard implementation. You should not edit files in this directory. Instead you should override the file, if necessary, using another unit file location which will supersede the file in this location.</p>
<p>If you wish to modify the way that a unit functions, the best location to do so is within the <strong>/etc/systemd/system directory</strong>. Unit files found in this directory location take precedence over any of the other locations on the filesystem. If you need to modify the system's copy of a unit file, putting a replacement in this directory is the safest and most flexible way to do this.</p>
<p>If you wish to override only specific directives from the system's unit file, you can actually provide unit file snippets within a subdirectory. These will append or modify the directives of the system's copy, allowing you to specify only the options you want to change.</p>
<p>The correct way to do this is to create a directory named after the unit file with .d appended on the end. So for a unit called example.service, a subdirectory called <em>example.service.d</em> could be created. Within this directory a file ending with .conf can be used to override or extend the attributes of the system's unit file.</p>
<p>There is also a location for run-time unit definitions at /run/systemd/system. Unit files found in this directory have a priority landing between those in /etc/systemd/system and /lib/systemd/system. Files in this location are given less weight than the former location, but more weight than the latter.</p>
<p>The systemd process itself uses this location for dynamically created unit files created at runtime. This directory can be used to change the system's unit behavior for the duration of the session. All changes made in this directory will be lost when the server is rebooted.</p>
<h3 id="using-targets-runlevels"><a class="header" href="#using-targets-runlevels">Using Targets (Runlevels)</a></h3>
<p>Another function of an init system is to transition the server itself between different states. Traditional init systems typically refer to these as “runlevels”, allowing the system to only be in one runlevel at any one time.</p>
<p>In systemd, <strong>targets</strong> are used instead. Targets are basically synchronization points that the server can used to bring the server into a specific state. Service and other unit files can be tied to a target and multiple targets can be active at the same time.</p>
<p>To see all of the targets available on your system, type:
<code>systemctl list-unit-files --type=target</code></p>
<p>To view the default target that systemd tries to reach at boot (which in turn starts all of the unit files that make up the dependency tree of that target), type:
<code>systemctl get-default</code></p>
<p>You can change the default target that will be used at boot by using the set-default option:
<code>sudo systemctl set-default multi-user.target</code></p>
<p>To see what units are tied to a target, you can type:
<code>systemctl list-dependencies multi-user.target</code></p>
<p>You can modify the system state to transition between targets with the isolate option. This will stop any units that are not tied to the specified target. Be sure that the target you are isolating does not stop any essential services:
<code>sudo systemctl isolate multi-user.target</code></p>
<h3 id="stopping-or-rebooting-the-server"><a class="header" href="#stopping-or-rebooting-the-server">Stopping or Rebooting the Server</a></h3>
<p>For some of the major states that a system can transition to, shortcuts are available. For instance, to power off your server, you can type:
<code>sudo systemctl poweroff</code></p>
<p>If you wish to reboot the system instead, that can be accomplished by typing:
<code>sudo systemctl reboot</code></p>
<p>You can boot into rescue mode by typing:
<code>sudo systemctl rescue</code></p>
<p>Note that most operating systems include traditional aliases to these operations so that you can simply type <code>sudo poweroff</code> or 'sudo reboot` without the systemctl. However, this is not guaranteed to be set up on all systems.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="configure-an-http-server"><a class="header" href="#configure-an-http-server">Configure an HTTP server</a></h2>
<p>The primary function of a web server is to store, process and deliver Web pages to clients. The clients communicate with the server sending HTTP requests. Clients, mostly via Web Browsers, request for a specific resources and the server responds with the content of that resource or an error message. The response is usually a Web page such as HTML documents which may include images, style sheets, scripts, and the content in form of text.</p>
<p>When accessing a Web Server, every HTTP request that is received is responded to with a content and a HTTP status code. HTTP status codes are three-digit codes, and are grouped into five different classes. The class of a status code can be quickly identified by its first digit:</p>
<ul>
<li>1xx : Informational - Request received, continuing process</li>
<li>2xx : Success - The action was successfully received, understood, and accepted</li>
<li>3xx : Redirection - Further action must be taken in order to complete the request</li>
<li>4xx : Client Error - The request contains bad syntax or cannot be fulfilled</li>
<li>5xx : Server Error - The server failed to fulfill an apparently valid request</li>
</ul>
<p>More information about status code check the RFC 2616.
Implementation</p>
<p>Web Servers are heavily used in the deployment of Web sites and in this scenario we can use two different implementations:</p>
<ul>
<li>Static Web Server: The content of the server's response will be the hosted files “as-is”.</li>
<li>Dynamic Web Server: Consist in a Web Server plus an extra software, usually an application server and a database. For example, to produce the Web pages you see in the Web browser, the- application server might fill an HTML template with contents from a database. Due to that we say that the content of the server's response is generated dynamically.</li>
</ul>
<h3 id="installation-1"><a class="header" href="#installation-1">Installation</a></h3>
<p>At a terminal prompt enter the following command:
<code>sudo apt install apache2</code></p>
<h3 id="configuration-1"><a class="header" href="#configuration-1">Configuration</a></h3>
<p>Apache2 is configured by placing directives in plain text configuration files. These directives are separated between the following files and directories:</p>
<ul>
<li>apache2.conf: the main Apache2 configuration file. Contains settings that are global to Apache2.</li>
<li>httpd.conf: historically the main Apache2 configuration file, named after the httpd daemon. In other distributions (or older versions of Ubuntu), the file might be present. In Ubuntu,all configuration options have been moved to apache2.conf and the below referenced directories, and this file no longer exists.</li>
<li>conf-available: this directory contains available configuration files. All files that were previously in /etc/apache2/conf.d should be moved to /etc/apache2/conf-available.</li>
<li>conf-enabled: holds symlinks to the files in /etc/apache2/conf-available. When a configuration file is symlinked, it will be enabled the next time apache2 is restarted.</li>
<li>envvars: file where Apache2 environment variables are set.</li>
<li>mods-available: this directory contains configuration files to both load modules and configure them. Not all modules will have specific configuration files, however.</li>
<li>mods-enabled: holds symlinks to the files in /etc/apache2/mods-available. When a module configuration file is symlinked it will be enabled the next time apache2 is restarted.</li>
<li>ports.conf: houses the directives that determine which TCP ports Apache2 is listening on.</li>
<li>sites-available: this directory has configuration files for Apache2 Virtual Hosts. Virtual Hosts allow Apache2 to be configured for multiple sites that have separate configurations.</li>
<li>sites-enabled: like mods-enabled, sites-enabled contains symlinks to the /etc/apache2/sites-available directory. Similarly when a configuration file in sites-available is symlinked,the - site configured by it will be active once Apache2 is restarted.</li>
<li>magic: instructions for determining MIME type based on the first few bytes of a file.</li>
</ul>
<p>In addition, other configuration files may be added using the Include directive, and wildcards can be used to include many configuration files. Any directive may be placed in any of these configuration files. Changes to the main configuration files are only recognized by Apache2 when it is started or restarted.</p>
<p>The server also reads a file containing mime document types; the filename is set by the TypesConfig directive, typically via /etc/apache2/mods-available/mime.conf, which might also include additions and overrides, and is /etc/mime.types by default.</p>
<h3 id="basic-settings"><a class="header" href="#basic-settings">Basic Settings</a></h3>
<p>Apache2 ships with a virtual-host-friendly default configuration. That is, it is configured with a single default virtual host (using the <strong>VirtualHost</strong> directive) which can be modified or used as-is if you have a single site, or used as a template for additional virtual hosts if you have multiple sites. If left alone, the default virtual host will serve as yourdefault site, or the site users will see if the URL they enter does not match the ServerName directive of any of your custom sites. To modify the default virtual host, edit the file etc/apache2/sites-available/000-default.conf.</p>
<p>Note</p>
<blockquote>
<p>The term <strong>Virtual Host</strong> refers to the practice of running more than one web site (such as company1.example.com and company2.example.com) on a single machine. Virtual hosts can be "IP-based", meaning that you have a different IP address for every web site, or "name-based", meaning that you have multiple names running on each IP address. The fact that they are running on the same physical server is not apparent to the end user.</p>
</blockquote>
<p>Note</p>
<blockquote>
<p>The directives set for a virtual host only apply to that particular virtual host. If a directive is set server-wide and not defined within the virtual host settings, the default setting is used. For example, you can define a Webmaster email address and not define individual email addresses for each virtual host.</p>
</blockquote>
<p>If you wish to configure a new virtual host or site, copy that file into the same directory with a name you choose. For example:
<code>sudo cp /etc/apache2/sites-available/000-default.conf /etc/apache2/sites-available/mynewsite.conf</code></p>
<p>Edit the new file to configure the new site using some of the directives described below.</p>
<p>The <strong>ServerAdmin</strong> directive specifies the email address to be advertised for the server's administrator. The default value is webmaster@localhost. This should be changed to an emailaddress that is delivered to you (if you are the server's administrator). If your website has a problem, Apache2 will display an error message containing this email address to reportthe problem to. Find this directive in your site's configuration file in /etc/apache2/sites-available.</p>
<p>The <strong>Listen</strong> directive specifies the port, and optionally the IP address, Apache2 should listen on. If the IP address is not specified, Apache2 will listen on all IP addresses assignedto the machine it runs on. The default value for the Listen directive is 80. Change this to 127.0.0.1:80 to cause Apache2 to listen only on your loopback interface so that it will notbe available to the Internet, to (for example) 81 to change the port that it listens on, or leave it as is for normal operation. This directive can be found and changed in its ownfile, /etc/apache2/ports.conf</p>
<p>The <strong>ServerName</strong> directive is optional and specifies what FQDN your site should answer to. The default virtual host has no ServerName directive specified, so it will respond to allrequests that do not match a ServerName directive in another virtual host. If you have just acquired the domain name mynewsite.com and wish to host it on your Ubuntu server, the valueof the ServerName directive in your virtual host configuration file should be mynewsite.com. Add this directive to the new virtual host file you created earlier (/etc/apache2sites-available/mynewsite.conf).</p>
<p>You may also want your site to respond to www.mynewsite.com, since many users will assume the www prefix is appropriate. Use the ServerAlias directive for this. You may also usewildcards in the <strong>ServerAlias</strong> directive.
For example, the following configuration will cause your site to respond to any domain request ending in .mynewsite.com.
<code>ServerAlias *.mynewsite.com</code></p>
<p>The <strong>DocumentRoot</strong> directive specifies where Apache2 should look for the files that make up the site. The default value is /var/www/html, as specified in /etc/apache2/sites-available000-default.conf. If desired, change this value in your site's virtual host file, and remember to create that directory if necessary!</p>
<h2 id="enable-the-new-virtualhost-using-the-a2ensite-utility-and-restart-apache2"><a class="header" href="#enable-the-new-virtualhost-using-the-a2ensite-utility-and-restart-apache2">Enable the new VirtualHost using the a2ensite utility and restart Apache2:</a></h2>
<pre><code>sudo a2ensite mynewsite.conf
sudo systemctl restart apache2.service
</code></pre>
<p>Note</p>
<blockquote>
<p>Be sure to replace mynewsite with a more descriptive name for the VirtualHost. One method is to name the file after the ServerName directive of the VirtualHost.</p>
</blockquote>
<p>Note</p>
<blockquote>
<p>If you haven't been using actual domain names that you own to test this procedure and have been using some example domains instead, you can at least test the functionality of this process by temporarily modifying the /etc/hosts file on your local computer:</p>
</blockquote>
<pre><code>&lt;your_server_IP&gt; example.com
</code></pre>
<p>Similarly, use the a2dissite utility to disable sites. This is can be useful when troubleshooting configuration problems with multiple VirtualHosts:</p>
<pre><code>sudo a2dissite mynewsite
sudo systemctl restart apache2.service
</code></pre>
<h3 id="default-settings"><a class="header" href="#default-settings">Default Settings</a></h3>
<p>This section explains configuration of the Apache2 server default settings. For example, if you add a virtual host, the settings you configure for the virtual host take precedence for that virtual host. For a directive not defined within the virtual host settings, the default value is used.</p>
<p>The <strong>DirectoryIndex</strong> is the default page served by the server when a user requests an index of a directory by specifying a forward slash (/) at the end of the directory name.</p>
<p>For example, when a user requests the page http://www.example.com/this_directory/, he or she will get either the DirectoryIndex page if it exists, a server-generated directory list if it does not and the Indexes option is specified, or a Permission Denied page if neither is true. The server will try to find one of the files listed in the DirectoryIndex directive and will return the first one it finds. If it does not find any of these files and if Options Indexes is set for that directory, the server will generate and return a list, in HTML format, of the subdirectories and files in the directory. The default value, found in /etc/apache2/mods-available/dir.conf is “index.html index.cgi index.pl index.php index.xhtml index.htm”. Thus, if Apache2 finds a file in a requested directory matching any of these names, the first will be displayed.</p>
<p>The <strong>ErrorDocument</strong> directive allows you to specify a file for Apache2 to use for specific error events. For example, if a user requests a resource that does not exist, a 404 error will occur. By default, Apache2 will simply return a HTTP 404 Return code. Read /etc/apache2/conf-available/localized-error-pages.conf for detailed instructions for using ErrorDocument, including locations of example files.</p>
<p>By default, the server writes the transfer log to the file /var/log/apache2/access.log. You can change this on a per-site basis in your virtual host configuration files with the CustomLog directive, or omit it to accept the default, specified in /etc/apache2/conf-available/other-vhosts-access-log.conf. You may also specify the file to which errors are logged, via the ErrorLog directive, whose default is /var/log/apache2/error.log. These are kept separate from the transfer logs to aid in troubleshooting problems with your Apache2 server. You may also specify the LogLevel (the default value is “warn”) and the LogFormat (see /etc/apache2/apache2.conf for the default value).</p>
<p>Some options are specified on a per-directory basis rather than per-server. Options is one of these directives. A Directory stanza is enclosed in XML-like tags, like so:</p>
<pre><code>&lt;Directory /var/www/html/mynewsite&gt;
...
&lt;/Directory&gt;
</code></pre>
<h3 id="https-configuration"><a class="header" href="#https-configuration">HTTPS Configuration</a></h3>
<p>The <strong>mod_ssl</strong> module adds an important feature to the Apache2 server - the ability to encrypt communications. Thus, when your browser is communicating using SSL, the https:// prefix is used at the beginning of the Uniform Resource Locator (URL) in the browser navigation bar.</p>
<p>The mod_ssl module is available in apache2-common package. Execute the following command at a terminal prompt to enable the mod_ssl module:
<code>sudo a2enmod ssl</code></p>
<p>There is a default HTTPS configuration file in /etc/apache2/sites-available/default-ssl.conf. In order for Apache2 to provide HTTPS, a certificate and key file are also needed. The default HTTPS configuration will use a certificate and key generated by the ssl-cert package. They are good for testing, but the auto-generated certificate and key should be replaced by a certificate specific to the site or server. For information on generating a key and obtaining a certificate see Certificates.</p>
<p>To configure Apache2 default configuration for HTTPS, enter the following:
<code>sudo a2ensite default-ssl</code></p>
<blockquote>
<p>Note: The directories /etc/ssl/certs and /etc/ssl/private are the default locations. If you install the certificate and key in another directory make sure to change SSLCertificateFile and SSLCertificateKeyFile appropriately.</p>
</blockquote>
<p>To generate a self-signed certificate:
<code>openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/ssl/private/&lt;apache-self-signed&gt;.key -out /etc/ssl/private/&lt;apache-self-signed&gt;.crt</code></p>
<p>Edit /etc/apache2/sites-available/mynewsite.conf as follows:</p>
<pre><code>&lt;VirtualHost *:443&gt;
    ServerName mynewsite.com
    DocumentRoot /var/www/mynewsite

    SSLEngine on
    SSLCertificateFile /etc/ssl/private/&lt;apache-self-signed&gt;.crt
    SSLCertificateKeyFile /etc/ssl/private/&lt;apache-self-signed&gt;.key
&lt;/VirtualHost&gt;
</code></pre>
<p>Enable your configuration:
<code>sudo a2ensite mynewsite.conf</code></p>
<p>Test it:
<code>sudo apache2ctl configtest</code></p>
<p>With Apache2 now configured for HTTPS, restart the service to enable the new settings:
<code>sudo systemctl restart apache2.service</code></p>
<blockquote>
<p>Note: Depending on how you obtained your certificate you may need to enter a passphrase when Apache2 starts.</p>
</blockquote>
<p>You can access the secure server pages by typing https://mynewsite.com in your browser address bar.</p>
<blockquote>
<p>Note: You should receive a warning, since the certificate is not signed by any certificate authorities known by the browser</p>
</blockquote>
<p>To redirect http to https, add to /etc/apache2/sites-available/mynewsite.conf:</p>
<pre><code>&lt;VirtualHost *:80&gt;
    ServerName mynewsite.com
    Redirect / https://mynewsite.com/
&lt;/VirtualHost&gt;
</code></pre>
<p>Teste again the configuration and reload the apache2 service.</p>
<h3 id="sharing-write-permission"><a class="header" href="#sharing-write-permission">Sharing Write Permission</a></h3>
<p>For more than one user to be able to write to the same directory it will be necessary to grant write permission to a group they share in common. The following example grants shared write permission to /var/www/html to the group “webmasters”.</p>
<pre><code>sudo chgrp -R webmasters /var/www/html
sudo chmod -R g=rwX /var/www/html/
</code></pre>
<p>These commands recursively set the group permission on all files and directories in /var/www/html to allow reading, writing and searching of directories. Many admins find this useful for allowing multiple users to edit files in a directory tree.</p>
<blockquote>
<p>Warning: The apache2 daemon will run as the www-data user, which has a corresponding www-data group. These should not be granted write access to the document root, as this would mean that vulnerabilities in Apache or the applications it is serving would allow attackers to overwrite the served content.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h2 id="configure-http-server-log-files"><a class="header" href="#configure-http-server-log-files">Configure HTTP server log files</a></h2>
<p>By default on Debian-based distributions such as Ubuntu , access and error logs are located in the /var/log/apache2 directory. On CentOS the log files are placed in /var/log/httpd directory.</p>
<h2 id="reading-and-understanding-the-apache-log-files"><a class="header" href="#reading-and-understanding-the-apache-log-files">Reading and Understanding the Apache Log Files</a></h2>
<p>The log files can be opened and parsed using standard commands like cat , less , grep , cut , awk , and so on.</p>
<p>Here is an example record from the access log file that uses the Debian' combine log format:</p>
<pre><code>192.168.33.1 - - [08/Jan/2020:21:39:03 +0000] "GET / HTTP/1.1" 200 6169 "-" "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.88 Safari/537.36"
</code></pre>
<p>Let's break down what each field of the record means:</p>
<ul>
<li><code>%h</code> (192.168.33.1) - The Hostname or the IP address of the client making the request.</li>
<li><code>%l</code> (-) - Remote logname. When the user name is not set, this field shows -.</li>
<li><code>%u</code> (-) - If the request is authenticated, the remote user name is shown.</li>
<li><code>%t</code> ([08/Jan/2020:21:39:03 +0000]) - Local server time.</li>
<li><code>\"%r\"</code> ("GET / HTTP/1.1") - First line of request. The request type, path, and protocol.</li>
<li><code>%&gt;s</code> (200) - The final server response code. If the &gt; symbol is not used and the request has been internally redirected, it will show the status of the original request.</li>
<li><code>%O</code> (396) - The size of server response in bytes.</li>
<li><code>\"%{Referer}i\"</code> ("-") - The URL of the referral.</li>
<li><code>\"%{User-Agent}i\"</code> (Mozilla/5.0 ...) - The user agent of the client (web browser).</li>
</ul>
<h2 id="virtual-hosts-and-global-logging"><a class="header" href="#virtual-hosts-and-global-logging">Virtual Hosts and Global Logging</a></h2>
<p>The logging behavior and the location of the files can be set either globally or per virtual host basis.</p>
<p>Then the CustomLog or ErrorLog directives are set in the main server context, the server writes all log messages to the same access and error log files. Otherwise, if the directives are placed inside a <VirtualHost> block, only the log messages for that virtual host are written to the specified file.</p>
<p>The log directive set in the <VirtualHost> block overrides the one set in the server context.</p>
<p>Virtual hosts without CustomLog or ErrorLog directives will have their log messages written to the global server logs.</p>
<p>The CustomLog directive defines the location of the log file and the format of the logged messages.</p>
<p>The most basic syntax of the <strong>CustomLog</strong> directive is as follows:
<code>CustomLog log_file format [condition];</code></p>
<p>The second argument, format specifies the format of the log messages. It can be either an explicit format definition or a nickname defined by the LogFormat directive.</p>
<pre><code>LogFormat "%h %l %u %t \"%r\" %&gt;s %O \"%{Referer}i\" \"%{User-Agent}i\"" combined
CustomLog logs/access.log combined
</code></pre>
<p>The third argument <code>[condition]</code> is optional and allows you to write log messages only when a specific condition is met.</p>
<p>The <strong>ErrorLog</strong> directive defines the name location of the error log. It takes the following form:
<code>ErrorLog log_file</code></p>
<p>For better readability, it is recommended to set separate access and error log files for each virtual host. Here is an example:</p>
<pre><code>&lt;VirtualHost *:80&gt;
     ServerName example.com
     ServerAlias www.example.com
     ServerAdmin webmaster@example.com
     DocumentRoot /var/www/example.com/public
     LogLevel warn
     ErrorLog /var/www/example.com/logs/error.log
     CustomLog /var/www/example.com/logs/access.log combined
&lt;/VirtualHost&gt;
</code></pre>
<p>If your server is low on resources and you have a busy website, you might want to disable the access log. To do that, simply comment out or remove the CustomLog directive from the main server configuration and virtual server sections.</p>
<p>If you want to turn off the access log only for one virtual host, set the first argument of the CustomLog directive to /dev/null:
<code>CustomLog /dev/null combined</code></p>
<p>Restart the Apache service for the changes to take effect.</p>
<h3 id="configure-logging-level"><a class="header" href="#configure-logging-level">Configure logging level</a></h3>
<p>The <strong>LogLevel</strong> parameter sets the level of logging. Below are levels listed by their severity (from low to high):</p>
<ul>
<li>trace1 - trace8 - Trace messages.</li>
<li>debug - Debugging messages.</li>
<li>info - Informational messages.</li>
<li>notice - Notices.</li>
<li>warn - Warnings.</li>
<li>error - Errors while processing a request.</li>
<li>crit - Critical issues. Requires a prompt action.</li>
<li>alert - Alerts. Action must be taken immediately.</li>
<li>emerg - Emergency situation. The system is in an unusable state.</li>
</ul>
<p>Each log level includes the higher levels. For example, if you set the log level to warn, Apache also writes the error, crit, alert, and emerg messages.</p>
<p>When the LogLevel parameter is not specified, it defaults to warn. It is recommended to set the level to at least crit.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="configure-a-database-server"><a class="header" href="#configure-a-database-server">Configure a database server</a></h2>
<p>Ubuntu provides two popular database servers:</p>
<ul>
<li><a href="https://ubuntu.com/server/docs/databases-mysql">MySQL</a></li>
<li><a href="https://ubuntu.com/server/docs/databases-postgresql">PostgreSQL</a></li>
</ul>
<p>Both are popular choices among developers, with similar feature sets and performance capabilities. Historically, Postgres tended to be a preferred choice for its attention to standards conformance, features, and extensibility, whereas Mysql may be more preferred for higher performance requirements, however over time each has made good strides catching up with the other. Specialized needs may make one a better option for a certain application, but in general both are good, strong options.</p>
<p>They are available in the main repository and equally supported by Ubuntu.</p>
<h2 id="mysql"><a class="header" href="#mysql">MySQL</a></h2>
<p>MySQL is a fast, multi-threaded, multi-user, and robust SQL database server. It is intended for mission-critical, heavy-load production systems and mass-deployed software. To install MySQL, run the following command from a terminal prompt: <code>sudo apt install mysql-server</code></p>
<p>Once the installation is complete, the MySQL server should be started automatically: <code>sudo systemctl status mysql</code></p>
<p>ou can edit the files in <code>/etc/mysql/</code> to configure the basic settings – log file, port number, etc. For example, to configure MySQL to listen for connections from network hosts, in the file <code>/etc/mysql/mysql.conf.d/mysqld.cnf</code>, change the bind-address directive to the server's IP address:</p>
<pre><code>bind-address            = 192.168.0.5
</code></pre>
<blockquote>
<p>Note: Replace <code>192.168.0.5</code> with the appropriate address, which can be determined via <code>ip address show</code>.</p>
</blockquote>
<p>After making a configuration change, the MySQL daemon will need to be restarted: <code>sudo systemctl restart mysql</code></p>
<p>Whilst the default configuration of MySQL provided by the Ubuntu packages is perfectly functional and performs well there are things you may wish to consider before you proceed.</p>
<p>MySQL is designed to allow data to be stored in different ways. These methods are referred to as either <strong>database or storage engines</strong>. There are two main engines that you'll be interested in: <strong>InnoDB</strong> (locking can occur on a row level basis within a table --&gt; multiple updates can occur on a single table simultaneously) and <strong>MyISAM</strong> (only capable of locking an entire table for writing --&gt; only one process can update a table at a time). Storage engines are transparent to the end user. MySQL will handle things differently under the surface, but regardless of which storage engine is in use, you will interact with the database in the same way.</p>
<p>For fresh installations of MySQL, you'll want to run the DBMS's included security script. This script changes some of the less secure default options for things like remote root logins and sample users.</p>
<p>Run the security script with sudo: <code>sudo mysql_secure_installation</code></p>
<p>This will take you through a series of prompts where you can make some changes to your MySQL installation's security options. The first prompt will ask whether you'd like to set up the <strong>Validate Password Plugin</strong>, which can be used to test the password strength of new MySQL users before deeming them valid.</p>
<p>If you elect to set up the Validate Password Plugin, any MySQL user you create that authenticates with a password will be required to have a password that satisfies the policy you select. The strongest policy level — which you can select by entering <code>2</code> — will require passwords to be at least eight characters long and include a mix of uppercase, lowercase, numeric, and special characters:</p>
<p>Regardless of whether you choose to set up the Validate Password Plugin, the next prompt will be to set a password for the MySQL root user.</p>
<blockquote>
<p>Note: Even though you've set a password for the root MySQL user, this user is not currently configured to authenticate with a password when connecting to the MySQL shell.</p>
</blockquote>
<p>If you used the Validate Password Plugin, you'll receive feedback on the strength of your new password. Then the script will ask if you want to continue with the password you just entered or if you want to enter a new one. Assuming you're satisfied with the strength of the password you just entered, enter <code>Y</code> to continue the script.</p>
<p>From there, you can press <code>Y</code> and then <code>ENTER</code> to accept the defaults for all the subsequent questions. This will remove some anonymous users and the test database, disable remote root logins, and load these new rules so that MySQL immediately respects the changes you have made.</p>
<p>Once the script completes, your MySQL installation will be secured. You can now move on to creating a dedicated database user with the MySQL client.</p>
<p>Upon installation, MySQL creates a root user account which you can use to manage your database. This user has full privileges over the MySQL server, meaning it has complete control over every database, table, user, and so on. Because of this, it's best to avoid using this account outside of administrative functions. This step outlines how to use the root MySQL user to create a new user account and grant it privileges.</p>
<p>In Ubuntu systems running MySQL 5.7 (and later versions), the root MySQL user is set to authenticate using the <strong>auth_socket</strong> plugin by default rather than with a password. This plugin requires that the name of the operating system user that invokes the MySQL client matches the name of the MySQL user specified in the command, so you must invoke mysql with sudo privileges to gain access to the root MySQL user: <code>sudo mysql</code></p>
<blockquote>
<p>Note: If you installed MySQL with another tutorial and enabled password authentication for root, you will need to use a different command to access the MySQL shell. The following will run your MySQL client with regular user privileges, and you will only gain administrator privileges within the database by authenticating: <code>mysql -u root -p</code></p>
</blockquote>
<p>Once you have access to the MySQL prompt, you can create a new user with a CREATE USER statement. These follow this general syntax:</p>
<pre><code>CREATE USER 'username'@'host' IDENTIFIED WITH authentication_plugin BY 'password';
</code></pre>
<p>After <code>CREATE USER</code>, you specify a username. This is immediately followed by an <code>@</code> sign and then the hostname from which this user will connect. If you only plan to access this user locally from your Ubuntu server, you can specify <code>localhost</code>. Wrapping both the username and host in single quotes isn't always necessary, but doing so can help to prevent errors.</p>
<p>You have several options when it comes to choosing your user's authentication plugin. The auth_socket plugin mentioned previously can be convenient, as it provides strong security without requiring valid users to enter a password to access the database. But it also prevents remote connections, which can complicate things when external programs need to interact with MySQL.</p>
<p>As an alternative, you can leave out the <code>WITH authentication plugin</code> portion of the syntax entirely to have the user authenticate with MySQL's default plugin, <strong>caching_sha2_password</strong>. The MySQL documentation recommends this plugin for users who want to log in with a password due to its strong security features.</p>
<p>Run the following command to create a user that authenticates with caching_sha2_password. Be sure to change sammy to your preferred username and password to a strong password of your choosing: <code>CREATE USER 'sammy'@'localhost' IDENTIFIED BY 'password';</code></p>
<blockquote>
<p>Note: There is a known issue with some versions of PHP that causes problems with caching_sha2_password. If you plan to use this database with a PHP application — phpMyAdmin, for example — you may want to create a user that will authenticate with the older, though still secure, mysql_native_password plugin instead:
<code>CREATE USER 'sammy'@'localhost' IDENTIFIED WITH mysql_native_password BY 'password';</code></p>
</blockquote>
<p>If you aren't sure, you can always create a user that authenticates with caching_sha2_plugin and then ALTER it later on with this command:
<code>ALTER USER 'sammy'@'localhost' IDENTIFIED WITH mysql_native_password BY 'password';</code></p>
<p>After creating your new user, you can grant them the appropriate privileges. The general syntax for granting user privileges is as follows:
<code>GRANT PRIVILEGE ON database.table TO 'username'@'host';</code></p>
<p>The PRIVILEGE value in this example syntax defines what actions the user is allowed to perform on the specified database and table. You can grant multiple privileges to the same user in one command by separating each with a comma. You can also grant a user privileges globally by entering asterisks (<code>*</code>) in place of the database and table names. In SQL, asterisks are special characters used to represent “all” databases or tables.</p>
<p>To illustrate, the following command grants a user global privileges to CREATE, ALTER, and DROP databases, tables, and users, as well as the power to <code>INSERT</code>, <code>UPDATE</code>, and <code>DELETE</code> data from any table on the server. It also grants the user the ability to query data with <code>SELECT</code>, create foreign keys with the <code>REFERENCES</code> keyword, and perform <code>FLUSH</code> operations with the <code>RELOAD</code> privilege. However, you should only grant users the permissions they need, so feel free to adjust your own user's privileges as necessary.</p>
<p>You can find the full list of available privileges in the official MySQL documentation.</p>
<p>Run this GRANT statement, replacing sammy with your own MySQL user's name, to grant these privileges to your user:
<code>GRANT CREATE, ALTER, DROP, INSERT, UPDATE, DELETE, SELECT, REFERENCES, RELOAD on *.* TO 'sammy'@'localhost' WITH GRANT OPTION;</code></p>
<blockquote>
<p>Note: This statement also includes <code>WITH GRANT OPTION</code>. This will allow your MySQL user to grant any that it has to other users on the system.</p>
</blockquote>
<blockquote>
<p>Warning: Some users may want to grant their MySQL user the ALL PRIVILEGES privilege, which will provide them with broad superuser privileges akin to the root user's privileges, like so: <code>GRANT ALL PRIVILEGES ON *.* TO 'sammy'@'localhost' WITH GRANT OPTION;</code></p>
</blockquote>
<p>Such broad privileges should not be granted lightly, as anyone with access to this MySQL user will have complete control over every database on the server.</p>
<p>Following this, it's good practice to run the <code>FLUSH PRIVILEGES</code> command. This will free up any memory that the server cached as a result of the preceding CREATE USER and GRANT statements: <code>ì</code>FLUSH PRIVILEGES;`</p>
<p>Then you can exit the MySQL client: <code>exit</code></p>
<p>In the future, to log in as your new MySQL user, you'd use a command like the following: <code>mysql -u sammy -p</code></p>
<p>The <code>-p</code> flag will cause the MySQL client to prompt you for your MySQL user's password in order to authenticate.</p>
<p>Finally, let's test the MySQL installation. Regardless of how you installed it, MySQL should have started running automatically. To test this, check its status:
<code>sudo systemctl status mysql.service</code></p>
<p>You'll see output similar to the following:</p>
<p>If MySQL isn't running, you can start it with <code>sudo systemctl start mysql</code>.</p>
<p>For an additional check, you can try connecting to the database using the <code>mysqladmin</code> tool, which is a client that lets you run administrative commands. For example, this command says to connect as a MySQL user named <em>sammy</em> (<code>-u sammy</code>), prompt for a password (<code>-p</code>), and return the version. Be sure to change sammy to the name of your dedicated MySQL user, and enter that user's password when prompted: <code>sudo mysqladmin -p -u sammy version</code></p>
<p>You should see output similar to this:</p>
<pre><code>Output
mysqladmin  Ver 8.0.19-0ubuntu5 for Linux on x86_64 ((Ubuntu))
Copyright (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Server version      8.0.19-0ubuntu5
Protocol version    10
Connection      Localhost via UNIX socket
UNIX socket     /var/run/mysqld/mysqld.sock
Uptime:         10 min 44 sec

Threads: 2  Questions: 25  Slow queries: 0  Opens: 149  Flush tables: 3  Open tables: 69  Queries per second avg: 0.038
</code></pre>
<p>This means MySQL is up and running.</p>
<p>To learn more about the basic syntax of SQL queries as well as some of the more commonly-employed functions and operators, look <a href="https://www.digitalocean.com/community/tutorials/introduction-to-queries-mysql">here</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="restrict-access-to-a-web-page"><a class="header" href="#restrict-access-to-a-web-page">Restrict access to a web page</a></h2>
<p>In Apache 2.4 the authorization configuration setup has changed from previous versions. <code>Satisfy, Order, Deny and Allow</code> have all been deprecated and replaced with new <code>Require</code> directives.</p>
<p>If you wish to restrict access to portions of your site based on the host address of your visitors, this is most easily done using mod_authz_host.</p>
<p>The Require provides a variety of different ways to allow or deny access to resources. In conjunction with the RequireAll, RequireAny, and RequireNone directives, these requirements may be combined in arbitrarily complex ways, to enforce whatever your access policy happens to be.</p>
<p>The Allow, Deny, and Order directives, provided by mod_access_compat, are deprecated and will go away in a future version. You should avoid using them, and avoid outdated tutorials recommending their use.</p>
<p>The usage of these directives is:</p>
<pre><code>Require host address
Require ip ip.address
</code></pre>
<p>In the first form, address is a fully qualified domain name (or a partial domain name); you may provide multiple addresses or domain names, if desired.</p>
<p>In the second form, ip.address is an IP address, a partial IP address, a network/netmask pair, or a network/nnn CIDR specification. Either IPv4 or IPv6 addresses may be used.</p>
<p>You can insert not to negate a particular requirement. Note, that since a not is a negation of a value, it cannot be used by itself to allow or deny a request, as not true does not constitute false. Thus, to deny a visit using a negation, the block must have one element that evaluates as true or false. For example, if you have someone spamming your message board, and you want to keep them out, you could do the following in the virtual host block:</p>
<pre><code>&lt;Directory /var/www/html&gt;
    &lt;RequireAll&gt;
        Require all granted
        Require not ip 10.252.46.165
    &lt;/RequireAll&gt;
&lt;/Directory&gt;
</code></pre>
<p>Visitors coming from that address (10.252.46.165) will not be able to see the content covered by this directive. If, instead, you have a machine name, rather than an IP address, you can use that:
<code>Require not host host.example.com</code></p>
<p>And, if you'd like to block access from an entire domain, you can specify just part of an address or domain name:</p>
<pre><code>Require not ip 192.168.205
Require not host phishers.example.com moreidiots.example
Require not host gov
</code></pre>
<p>Use of the RequireAll, RequireAny, and RequireNone directives may be used to enforce more complex sets of requirements.</p>
<p>To enforce basic authentication, have a look at the <a href="https://httpd.apache.org/docs/2.4/howto/auth.html">documentaion</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="manage-and-configure-containers"><a class="header" href="#manage-and-configure-containers">Manage and configure containers</a></h2>
<p>While virtualization is in many ways similar to containers, these are different and implemented via other solutions like <strong>LXD</strong>, <strong>systemd-nspawn</strong>, <strong>containerd</strong> and others.</p>
<p>LXD (pronounced lex-dee) is the lightervisor, or lightweight container hypervisor. LXC (lex-see) is a program which creates and administers “containers” on a local system. It also provides an API to allow higher level managers, such as LXD, to administer containers. In a sense, one could compare LXC to QEMU, while comparing LXD to libvirt.</p>
<h3 id="docker"><a class="header" href="#docker">Docker</a></h3>
<p>Prerequisites:</p>
<ul>
<li>Docker <strong>Community Edition</strong> (CE) is installed as described in the offical <a href="https://docs.docker.com/engine/install/ubuntu/">doc</a></li>
<li>a personal account on <strong>Docker Hub</strong></li>
</ul>
<p>Docker containers are built from Docker images. By default, Docker pulls these images from Docker Hub, a Docker registry managed by Docker, the company behind the Docker project. Anyone can host their Docker images on Docker Hub, so most applications and Linux distributions you'll need will have images hosted there.</p>
<p>If you want to avoid typing sudo whenever you run the docker command, add your username to the docker group: <code>sudo usermod -aG docker ${USER}</code></p>
<p>To apply the new group membership, log out of the server and back in, or type the following: <code>newgrp docker</code></p>
<p>To view all available subcommands, just type: <code>docker</code></p>
<p>To view the options available to a specific command, type: <code>docker [docker-subcommand] --help</code></p>
<p>To view system-wide information about Docker, use: <code>docker info</code></p>
<p>To check whether you can access and download images from Docker Hub, type: <code>docker run hello-world</code></p>
<p>You can search for images available on Docker Hub by using: <code>docker search ubuntu</code></p>
<p>Once you've identified the image that you would like to use, you can download it to your computer using: <code>docker pull ubuntu</code></p>
<p>After an image has been downloaded, you can then run a container using the downloaded image with the <code>run</code> subcommand. As you saw with the hello-world example, if an image has not been downloaded when docker is executed with the <code>run</code> subcommand, the Docker client will first download the image, then run a container using it.</p>
<p>To see the images that have been downloaded to your computer, type: <code>docker images</code></p>
<p>After using Docker for a while, you'll have many active (running) and inactive containers on your computer. To view the active ones, use: <code>docker ps</code></p>
<p>To view all containers — active and inactive: <code>docker ps -a</code></p>
<p>To view the latest container you created: <code>docker ps -l</code></p>
<p>To start a stopped container, use docker start, followed by the container ID or the container's name: <code>docker start d9b100f2f636</code></p>
<p>To stop a running container, use docker stop, followed by the container ID or name: <code>docker stop [sharp_volhard]</code></p>
<p>Once you've decided you no longer need a container anymore, remove it: <code>docker rm [festive_williams]</code></p>
<p>Containers can be turned into images which you can use to build new containers.</p>
<p>When you start up a Docker image, you can create, modify, and delete files just like you can with a virtual machine. The changes that you make will only apply to that container. You can start and stop it, but once you destroy it with the docker rm command, the changes will be lost for good.</p>
<p>To this purpose, save the state of a container as a new Docker image committing the changes to a new Docker image instance using:
<code>docker commit -m "What you did to the image" -a "Author Name" [container_id] [repository/new_image_name]</code></p>
<p>When you commit an image, the new image is saved locally on your computer.</p>
<blockquote>
<p>Note: Listing the Docker images again will show the new image, as well as the old one that it was derived from.</p>
</blockquote>
<blockquote>
<p>Note: You can also build Images from a <code>Dockerfile</code>, which lets you automate the installation of software in a new image.</p>
</blockquote>
<p>The next logical step after creating a new image from an existing image is to share it by pushing the image to Docker Hub (or any other Docker registry).</p>
<p>To push your image, first log into Docker Hub: <code>docker login -u docker-registry-username</code></p>
<blockquote>
<p>Note: If your Docker registry username is different from the local username you used to create the image, you will have to tag your image with your registry username, e.g. : <code>docker tag [sammy/ubuntu-nodejs] [docker-registry-username/ubuntu-nodejs]</code></p>
</blockquote>
<p>Then you may push your own image using: <code>docker push [docker-registry-username/docker-image-name]</code></p>
<p>You can now use <code>docker pull [docker-registry-username/docker-image-name]</code> to pull the image to a new machine and use it to run a new container.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="manage-and-configure-virtual-machines"><a class="header" href="#manage-and-configure-virtual-machines">Manage and configure Virtual Machines</a></h2>
<p>The default virtualization technology supported in Ubuntu is <strong>KVM</strong>, which add hypervisor capabilities to the kernel. For Intel and AMD hardware KVM requires virtualization extensions. But KVM is also available for IBM Z and LinuxONE, IBM POWER as well as for ARM64. <strong>Qemu</strong> is part of the KVM experience being the userspace backend for it, but it also can be used for hardware without virtualization extensions by using its TCG mode.</p>
<p>Qemu is a machine emulator that can run operating systems and programs for one machine on a different machine. Mostly it is not used as emulator but as virtualizer in collaboration with KVM kernel components. In that case it utilizes the virtualization technology of the hardware to virtualize guests.</p>
<p><strong>libvirt</strong> is a toolkit to interact with virtualization technologies which abstracts away from specific versions and hypervisors.</p>
<p>Managing KVM can be done from both command line tools (<code>virt-*</code> and <code>qemu-*</code>) and graphical interfaces (<code>virt-manager</code>).</p>
<p>Before getting started with libvirt it is best to make sure your hardware supports the necessary virtualization extensions for KVM. Enter the following from a terminal prompt:</p>
<pre><code>kvm-ok
# or alternatively, it should be enough to ensure this regex patter matches some lines in /proc/cpuinfo
egrep "vmx|svm" /proc/cpuinfo 
</code></pre>
<blockquote>
<p>Note: On many computers with processors supporting hardware assisted virtualization, it is necessary to activate an option in the BIOS to enable it.</p>
</blockquote>
<h3 id="installation-2"><a class="header" href="#installation-2">Installation</a></h3>
<p>To install the necessary packages, from a terminal prompt enter:</p>
<pre><code>sudo apt update
sudo apt install qemu-kvm libvirt-daemon-system
</code></pre>
<p>After installing libvirt-daemon-system, the user used to manage virtual machines will need to be added to the libvirt group. This is done automatically for members of the sudo group, but needs to be done in additon for anyone else that should access system wide libvirt resources. Doing so will grant the user access to the advanced networking options.</p>
<p>In a terminal enter: <code>sudo adduser $USER libvirt</code></p>
<p>You are now ready to install a Guest operating system. Installing a virtual machine follows the same process as installing the operating system directly on the hardware.</p>
<p>You either need:</p>
<ul>
<li>a way to automate the installation</li>
<li>a keyboard and monitor will need to be attached to the physical machine.</li>
<li>use cloud images which are meant to self-initialize (<strong>Multipass</strong> and <strong>UVTool</strong>)</li>
</ul>
<p>In the case of virtual machines a Graphical User Interface (GUI) is analogous to using a physical keyboard and mouse on a real computer. Instead of installing a GUI, the <strong>virt-viewer</strong> or <strong>virt-manager</strong> application can be used to connect to a virtual machine's console using <strong>VNC</strong>.</p>
<h3 id="virsh"><a class="header" href="#virsh">virsh</a></h3>
<p>There are several utilities available to manage virtual machines and libvirt. The <code>virsh</code> utility can be used from the command line.</p>
<p>To list running virtual machines: <code>virsh list</code></p>
<p>To start a virtual machine: <code>virsh start &lt;guestname&gt;</code></p>
<p>Similarly, to start a virtual machine at boot: <code>virsh autostart &lt;guestname&gt;</code></p>
<p>Reboot a virtual machine with: <code>virsh reboot &lt;guestname&gt;</code></p>
<p>The state of virtual machines can be saved to a file in order to be restored later. The following will save the virtual machine state into a file named according to the date: <code>virsh save &lt;guestname&gt; save-my.state</code></p>
<p>Once saved the virtual machine will no longer be running. A saved virtual machine can be restored using: <code>virsh restore save-my.state</code></p>
<p>To shutdown a virtual machine do: <code>virsh shutdown &lt;guestname&gt;</code></p>
<p>A CDROM device can be mounted in a virtual machine by entering: <code>virsh attach-disk &lt;guestname&gt; /dev/cdrom /media/cdrom</code></p>
<p>To change the definition of a guest virsh exposes the domain via <code>virsh edit &lt;guestname&gt;</code></p>
<p>That will allow one to edit the XML representation that defines the guest and when saving it will apply format and integrity checks on these definitions.</p>
<p>Editing the XML directly certainly is the most powerful way, but also the most complex one. Tools like <a href="https://ubuntu.com/server/docs/virtualization-virt-tools"><strong>Virtual Machine Manager / Viewer</strong></a> can help unexperienced users to do most of the common tasks.</p>
<blockquote>
<p>Note: If <code>virsh</code> (or other <code>vir*-tools</code>) shall connect to something else than the default qemu-kvm/system hypervisor one can find alternatives for the connect option in man virsh or libvirt doc.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="6-storage-management---13"><a class="header" href="#6-storage-management---13">6. Storage Management - 13%</a></h1>
<ul>
<li><a href="6-storage-management/./a.html">List, create, delete, and modify physical storage partitions (./fdisk, gdisk)</a></li>
<li><a href="6-storage-management/./b.html">Manage and configure LVM storage</a></li>
<li><a href="6-storage-management/./c.html">Create and configure encrypted storage</a></li>
<li><a href="6-storage-management/./d.html">Configure systems to mount file systems at or during boot</a></li>
<li><a href="6-storage-management/./e.html">Configure and manage swap space</a></li>
<li><a href="6-storage-management/./f.html">Create and manage RAID devices</a></li>
<li><a href="6-storage-management/./g.html">Configure systems to mount file systems on demand</a></li>
<li><a href="6-storage-management/./h.html">Create, manage and diagnose advanced file system permissions</a></li>
<li><a href="6-storage-management/./i.html">Setup user and group disk quotas for filesystems</a></li>
<li><a href="6-storage-management/./l.html">Create and configure file systems</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h2 id="list-create-delete-and-modify-physical-storage-partitions"><a class="header" href="#list-create-delete-and-modify-physical-storage-partitions">List, create, delete, and modify physical storage partitions</a></h2>
<p>Lists information about all available or the specified block devices (including partitions and mount points): <code>lsblk</code></p>
<p>Lists the partition tables for the specified devices (If no devices are given, those mentioned in /proc/partitions): <code>sudo fdisk -l</code></p>
<p>Lists partitions the OS i uurently aware of: <code>cat /proc/partitions</code></p>
<p>Reports on block devices attributes: <code>blkid</code></p>
<p>Manipulate interactively a partition table according to its format with:</p>
<ul>
<li><code>fdisk</code> for MBR</li>
<li><code>gdisk</code> for GPT</li>
</ul>
<blockquote>
<p>Note: gdisk, cgdisk and sgdisk all have the same functionality but provide different user interfaces. gdisk is text-mode interactive, sgdisk is command-line, and cgdisk has a curses-based interface.</p>
</blockquote>
<p>To create a new partition on the empty disk, provide it as argument to fdisk:</p>
<pre><code>fdisk /dev/sdb

&gt;Welcome to fdisk (util-linux 2.32.1).
&gt;Changes will remain in memory only, until you decide to write them.
&gt;Be careful before using the write command.
</code></pre>
<p>The fdisk utility awaits our commands. Ccreate a new partition, by typing "n".</p>
<pre><code>&gt;Command (m for help): n
</code></pre>
<p>you are to create a primary partition, so the answer to the next question is "p".</p>
<pre><code>&gt;Partition type
&gt;   p   primary (0 primary, 0 extended, 4 free)
&gt;   e   extended (container for logical partitions)
&gt;Select (default p): p
</code></pre>
<p>The next questions are about partition number, first and last sector, which will determine the actual size of the partition. To create a single partition that will cover the disk, accept the defaults values for partition number, first available sector to start with, and last sector to end with:</p>
<pre><code>&gt;Partition number (1-4, default 1): 
&gt;First sector (2048-4194303, default 2048): 
&gt;Last sector, +sectors or +size{K,M,G,T,P} (2048-4194303, default 4194303): 
&gt;
&gt;Created a new partition 1 of type 'Linux' and of size 2 GiB.
</code></pre>
<p>You are not limited to count in sectors when you define the end of the partition. As the utility hints, you can specify an exact size. For example, if you would like a partition of 1 GB in size, at the last sector you could provide:</p>
<pre><code>&gt;Last sector, +sectors or +size{K,M,G,T,P} (34-4194270, default 4194270): +1G
</code></pre>
<p>The partition is now complete, but as the utility points out on start, the changes are in-memory only until you write them out to the disk. This is on purpose and the warning is in place for a good reason: by writing out the changes to the disk, you destroy anything that resided on the sector range you cover with our new partition. If you are sure there will be no data loss, write the changes to disk:</p>
<pre><code>&gt;Command (m for help): w
&gt;The partition table has been altered.
&gt;Calling ioctl() to re-read partition table.
&gt;Syncing disks.
</code></pre>
<p>Once done, inform the OS of partition table changes: <code>partprobe</code></p>
<p>you can use the fdisk -l feature to be more specific by adding the device name you are interested in.</p>
<pre><code>fdisk -l /dev/sdb

&gt;Disk /dev/sdb: 2 GiB, 2147483648 bytes, 4194304 sectors
&gt;Units: sectors of 1 * 512 = 512 bytes
&gt;Sector size (logical/physical): 512 bytes / 512 bytes
&gt;I/O size (minimum/optimal): 512 bytes / 512 bytes
&gt;Disklabel type: dos
&gt;Disk identifier: 0x29ccc11b
&gt;
&gt;Device     Boot Start     End Sectors Size Id Type
&gt;/dev/sdb1        2048 4194303 4192256   2G 83 Linux
</code></pre>
<p>And in the output you can see that our disk now contains a new /dev/sdb1 partition that is ready to be used.</p>
<hr />
<p>Deleting partition is basically the same process backwards. The utility is built in a logical way: you specify the device you would like to work on, and when you select partition deletion with the "d" command, it will delete our sole partition without any question, because there is only one on the disk:</p>
<pre><code>fdisk /dev/sdb

&gt;Welcome to fdisk (util-linux 2.32.1).
&gt;Changes will remain in memory only, until you decide to write them.
&gt;Be careful before using the write command.
&gt;
&gt;
&gt;Command (m for help): d
&gt;Selected partition 1
&gt;Partition 1 has been deleted.
</code></pre>
<p>While this is quite convenient, note that this tooling makes it really easy to wipe data from disk with a single keypress. This is why all the warnings are in place, you have to know what you are doing. Safeguards are still in place, nothing changes on disk until you write it out:</p>
<pre><code>&gt;Command (m for help): w
&gt;The partition table has been altered.
&gt;Calling ioctl() to re-read partition table.
&gt;Syncing disks.

partprobe 

fdisk -l /dev/sdb
&gt;Disk /dev/sdb: 2 GiB, 2147483648 bytes, 4194304 sectors
&gt;Units: sectors of 1 * 512 = 512 bytes
&gt;Sector size (logical/physical): 512 bytes / 512 bytes
&gt;I/O size (minimum/optimal): 512 bytes / 512 bytes
&gt;Disklabel type: dos
&gt;Disk identifier: 0x29ccc11b
</code></pre>
<hr />
<p>To create a GPT based partition layout, you'll use the gdisk (GPT fdisk) utility:</p>
<pre><code>gdisk /dev/sdb   

&gt;GPT fdisk (gdisk) version 1.0.3
&gt;
&gt;Partition table scan:
&gt;  MBR: MBR only
&gt;  BSD: not present
&gt;  APM: not present
&gt;  GPT: not present
&gt;
&gt;
&gt;***************************************************************
&gt;Found invalid GPT and valid MBR; converting MBR to GPT format
&gt;in memory. THIS OPERATION IS POTENTIALLY DESTRUCTIVE! Exit by
&gt;typing 'q' if you don't want to convert your MBR partitions
&gt;to GPT format!
&gt;***************************************************************
&gt;
&gt;
&gt;Command (? for help): n
&gt;Partition number (1-128, default 1): 
&gt;First sector (34-4194270, default = 2048) or {+-}size{KMGTP}: 
&gt;Last sector (2048-4194270, default = 4194270) or {+-}size{KMGTP}: 
&gt;Current type is 'Linux filesystem'
&gt;Hex code or GUID (L to show codes, Enter = 8300): 
&gt;Changed type of partition to 'Linux filesystem'
&gt;
&gt;Command (? for help): w
&gt;
&gt;Final checks complete. About to write GPT data. THIS WILL OVERWRITE EXISTING
&gt;PARTITIONS!!
&gt;
&gt;Do you want to proceed? (Y/N): Y
&gt;OK; writing new GUID partition table (GPT) to /dev/sdb.
&gt;The operation has completed successfully.
</code></pre>
<p>From the point of commands you did the same, initiated creating a new partition with "n", accepted the defaults that cover the whole disk with the new partition, then written the changes to disk. Two new warnings appear, the first is there only because you partitioned the same disk with fdisk earlier, which was detected by gdisk. The last one is an additional "are you sure?" type of question, before you are allowed to finally overwrite that poor disk.</p>
<blockquote>
<p>Note: Listing GPT partitions requires the same switch to gdisk: gdisk -l &lt;/dev/sdb&gt;</p>
</blockquote>
<p>Deleting the GPT partition you created is done similar as in the MBR case, with the additional sanity check added:</p>
<pre><code>gdisk /dev/sdb

&gt;GPT fdisk (gdisk) version 1.0.3
&gt;
&gt;Partition table scan:
&gt;  MBR: protective
&gt;  BSD: not present
&gt;  APM: not present
&gt;  GPT: present
&gt;
&gt;Found valid GPT with protective MBR; using GPT.
&gt;
&gt;Command (? for help): d
&gt;Using 1
&gt;
&gt;Command (? for help): w
&gt;
&gt;Final checks complete. About to write GPT data. THIS WILL OVERWRITE EXISTING
&gt;PARTITIONS!!
&gt;
&gt;Do you want to proceed? (Y/N): Y
&gt;OK; writing new GUID partition table (GPT) to /dev/sdb.
&gt;The operation has completed successfully.
</code></pre>
<p>Listing the disk now shows that we indeed deleted the GPT partition from the disk:</p>
<pre><code>gdisk -l /dev/sdb

&gt;GPT fdisk (gdisk) version 1.0.3
&gt;
&gt;Partition table scan:
&gt;  MBR: protective
&gt;  BSD: not present
&gt;  APM: not present
&gt;  GPT: present
&gt;
&gt;Found valid GPT with protective MBR; using GPT.
&gt;Disk /dev/sdb: 4194304 sectors, 2.0 GiB
&gt;Sector size (logical/physical): 512/512 bytes
&gt;Disk identifier (GUID): 3AA3331F-8056-4C3E-82F3-A67254343A05
&gt;Partition table holds up to 128 entries
&gt;Main partition table begins at sector 2 and ends at sector 33
&gt;First usable sector is 34, last usable sector is 4194270
&gt;Partitions will be aligned on 2048-sector boundaries
&gt;Total free space is 4194237 sectors (2.0 GiB)
&gt;
&gt;Number  Start (sector)    End (sector)  Size       Code  Name
</code></pre>
<hr />
<p>Common partition type codes for Linux (specified as MBR/GPT):</p>
<ul>
<li>82/8200: Linux swap</li>
<li>83/8300: Linux native partition</li>
<li>ef/ef00: EFI System partition</li>
<li>8e/8e00: Linux Logical Volume Manager (LVM) partition</li>
<li>fd/fd00: Linux raid partition with autodetect using persistent superblock</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h2 id="manage-and-configure-lvm-storage"><a class="header" href="#manage-and-configure-lvm-storage">Manage and configure LVM storage</a></h2>
<p><em>Logical Volumes Management</em> (also known as <strong>LVM</strong>), which have become a default for the installation of most (if not all) Linux distributions, have numerous advantages over traditional partitioning management. Perhaps the most distinguishing feature of LVM is that it allows logical divisions to be resized (reduced or increased) at will without much hassle.</p>
<p>The structure of the LVM consists of:</p>
<ul>
<li>one or more entire hard disks or partitions which are configured as physical volumes (<strong>PVs</strong>)</li>
<li>a volume group (<strong>VG</strong>) is created using one or more physical volumes</li>
<li>multiple logical volumes (<strong>LVs</strong>) which can then be created from a volume group.</li>
</ul>
<p>Each logical volume is somewhat equivalent to a traditional partition – with the advantage that it can be resized at will as said earlier.</p>
<blockquote>
<p>Note: When combined with RAID, you can enjoy not only scalability (provided by LVM) but also redundancy (offered by RAID). In this type of setup, you will typically find LVM on top of RAID, that is, configure RAID first and then configure LVM on top of it.</p>
</blockquote>
<hr />
<h3 id="creating-physical-volumes-volume-groups-and-logical-volumes"><a class="header" href="#creating-physical-volumes-volume-groups-and-logical-volumes">Creating Physical Volumes, Volume Groups, and Logical Volumes</a></h3>
<p>To create physical volumes on top of devices or single partitions: <code>sudo pvcreate /dev/sdb /dev/sdc /dev/sdd</code></p>
<p>List the newly created PVs with: <code>sudo pvs</code></p>
<p>Get detailed information about each PV with: <code>sudo pvdisplay /dev/sd[x]</code></p>
<p>If you omit <code>/dev/sd[x]</code> as arg, you will get information about all the PVs.</p>
<p>To create a volume group named "vg00" using /dev/sdb and /dev/sdc (we will save /dev/sdd for later to illustrate the possibility of adding other devices to expand storage capacity when needed): <code>sudo vgcreate vg00 /dev/sdb /dev/sdc</code></p>
<p>As it was the case with physical volumes, you can also view information about this volume group by issuing: <code>sudo vgdisplay vg00</code></p>
<p>It is considered good practice to name each logical volume according to its intended use. For example, let's create two LVs named "vol_projects" (10 GB) and "vol_backups" (remaining space), which we can use later to store project documentation and system backups, respectively.</p>
<p>The <code>-n</code> option is used to indicate a name for the LV, whereas <code>-L</code> sets a fixed size and <code>-l</code> (lowercase L) is used to indicate a percentage of the remaining space in the container VG:</p>
<pre><code>sudo lvcreate -n vol_projects -L 10G vg00
sudo lvcreate -n vol_backups -l 100%FREE vg00
</code></pre>
<blockquote>
<p>Warning: If you see a message like "ext4 signature detected on at offset 1080. wipe it ?" when manipulating partitions, the mentioned signature is basically a sign that there's something there, and it is not empty, so it means: "There is already data here!...are you sure you want to go ahead?".</p>
</blockquote>
<blockquote>
<p>Note: LVs will be symlinked in /dev/mapper and /dev/[VG-name].</p>
</blockquote>
<p>As before, you can view the list of LVs and basic information with: <code>sudo lvs</code></p>
<p>And detailed information with: <code>sudo lvdisplay</code></p>
<p>To view information about a single LV, use lvdisplay with the VG and LV as parameters, as follows: <code>sudo lvdisplay vg00/vol_projects</code></p>
<p>Before each logical volume can be used, we need to create a filesystem on top of it.</p>
<p>We'll use ext4 as an example here since it allows us both to increase and reduce the size of each LV (as opposed to xfs that only allows to increase the size):</p>
<pre><code>sudo mkfs.ext4 /dev/vg00/vol_projects
sudo mkfs.ext4 /dev/vg00/vol_backups
</code></pre>
<h3 id="resizing-logical-volumes-and-extending-volume-groups"><a class="header" href="#resizing-logical-volumes-and-extending-volume-groups">Resizing Logical Volumes and Extending Volume Groups</a></h3>
<p>Due to the nature of LVM, it's very easy to reduce the size of the two LVs and allocate it for the other, while resizing (<code>-r</code>) each filesystem at the same time:</p>
<pre><code>sudo lvreduce -L -2.5G -r /dev/vg00/vol_projects
sudo lvextend -l +100%FREE -r /dev/vg00/vol_backups
</code></pre>
<blockquote>
<p>Note: If you don't use the (-r) switch, the filesytem must be resized apart, e.g for ext4 filesystems: <code>sudo resize2fs &lt;/dev/mapper/myvg-mylv&gt;</code></p>
</blockquote>
<p>It is important to include the minus (<code>-</code>) or plus (<code>+</code>) signs while resizing a logical volume. Otherwise, you're setting a fixed size for the LV instead of resizing it.</p>
<p>It can happen that you arrive at a point when resizing logical volumes cannot solve your storage needs anymore and you need to buy an extra storage device. Keeping it simple, you will need another disk. We are going to simulate this situation by adding the remaining PV from our initial setup (/dev/sdd).</p>
<p>To add /dev/sdd to vg00: <code>sudo vgextend vg00 /dev/sdd</code></p>
<p>If you run <code>vgdisplay vg00</code> before and after the previous command, you will see the increase in the size of the VG.</p>
<h3 id="mounting-logical-volumes-on-boot-and-on-demand"><a class="header" href="#mounting-logical-volumes-on-boot-and-on-demand">Mounting Logical Volumes on Boot and on Demand</a></h3>
<p>Of course there would be no point in creating logical volumes if we are not going to actually use them! To better identify a logical volume we will need to find out what its UUID:</p>
<pre><code>blkid /dev/vg00/vol_projects
blkid /dev/vg00/vol_backups
</code></pre>
<p>Create mount points for each LV:</p>
<pre><code>sudo mkdir /home/projects
sudo mkdir /home/backups
</code></pre>
<p>Insert the corresponding entries in /etc/fstab:</p>
<pre><code>UUID=b85df913-580f-461c-844f-546d8cde4646 /home/projects	ext4 defaults 0 0
UUID=e1929239-5087-44b1-9396-53e09db6eb9e /home/backups ext4	defaults 0 0
</code></pre>
<p>Then save the changes and mount the LVs:</p>
<pre><code>sudo mount -a
mount | grep home
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="create-and-configure-encrypted-storage"><a class="header" href="#create-and-configure-encrypted-storage">Create and configure encrypted storage</a></h2>
<p>The following illustrates how to encrypt a secondary disk (<a href="https://dev-notes.eu/2020/12/LUKS-Encrypt-Hard-Drive-with-Cryptsetup-on-Ubuntu-20.04/">source</a>). For full-disk encryption, look <a href="https://help.ubuntu.com/community/Full_Disk_Encryption_Howto_2019">here</a>.</p>
<p><strong>cryptsetup</strong> is a utility used to conveniently set up disk encryption based on the DMCrypt kernel module. These include plain dm-crypt volumes, LUKS volumes, loop-AES, TrueCrypt (including VeraCrypt extension) and BitLocker formats.</p>
<p><strong>LUKS</strong> (Linux Unified Key Setup) is a standard for hard disk encryption. It standardizes a partition header, as well as the format of the bulk data. LUKS can manage multiple passwords, that can be revoked effectively and that are protected against dictionary attacks with PBKDF2.</p>
<hr />
<p>Once you have physically connected the disk, find the unmounted disk in the system using <code>lsblk</code> (you can spot it by the size which should match the expexted one).</p>
<blockquote>
<p>Note: Once created, the LUKS partition will have the FSTYPE set as "crypto_LUKS".</p>
</blockquote>
<p>Double check disk info: <code>sudo hdparm -i /dev/sdd</code></p>
<p>If this checks out, you have the device reference. Alternatively, list all drives in short format: <code>sudo lshw -short -C disk</code></p>
<p>If the disk does not have an existing partition, create one: <code>sudo fdisk /dev/sdd</code></p>
<p>Follow the instructions, hit all defaults to create one large partition: it will be something like "/dev/sdd1".</p>
<blockquote>
<p>Note: If the disk is already partitioned, you can use an existing partition, but all data will be over-written.</p>
</blockquote>
<p>Next step is to LUKS encrypt the target partition - in this case, /dev/sdd1: <code>cryptsetup -y -v luksFormat /dev/sdd1</code></p>
<blockquote>
<p>Note: <code>-y</code> forces double entry from the user when interactively setting the passphrase - ask for it twice and complain if both inputs do not match.</p>
</blockquote>
<blockquote>
<p>Warning: Your kernel may not support the default encryption method used by cryptsetup. In that case, you can examine /proc/crypto to see the methods your system supports, and then you can supply a method, as in: <code>sudo cryptsetup luksFormat --cipher aes /dev/sdd1</code></p>
</blockquote>
<p>The encrypted partition is accessed by means of a mapping. To create a mapping for the current session:</p>
<pre><code># open the LUKS partition and create a mapping called "backupSSD"
sudo cryptsetup luksOpen /dev/sdd1 backupSSD
# checks for its presence
ls -l /dev/mapper/backupSSD
lrwxrwxrwx 1 root root 7 Dec 17 15:48 /dev/mapper/backupSSD -&gt; ../dm-6
</code></pre>
<p>Check mapping status:</p>
<pre><code>sudo cryptsetup -v status backupSSD
&gt;[sudo] password for &lt;user&gt;:
&gt;/dev/mapper/backupSSD is active and is in use.
&gt;  type:    LUKS1
&gt;  cipher:  aes-xts-plain64
&gt;  keysize: 256 bits
&gt;  device:  /dev/sdd1
&gt;  offset:  4096 sectors
&gt;  size:    1953519024 sectors
&gt;  mode:    read/write
&gt;Command successful.
</code></pre>
<p>This mapping is not persistent. If you want to open the disk/partition automatically on boot, you will need to amend /etc/crypttab to set up a mapped device name (see below).</p>
<p>Do not omit this step - or the partition won't mount (<code>-L</code> denotes the partition label): <code>sudo mkfs.ext4 /dev/mapper/backupSSD -L "Extra SSD 1TB"</code></p>
<p>Create a mount point and give the mount point appropriate ownership:</p>
<pre><code>sudo mkdir /media/secure-ssd
sudo chown $USER:$USER /media/secure-ssd
</code></pre>
<p>To mount, you need to reference the mapper, not the partition:
<code>sudo mount /dev/mapper/backupSSD /media/secure-ssd</code></p>
<p>To automount at boot:</p>
<ol>
<li>Edit /etc/fstab to reference the mapper to the decrypted volume:</li>
</ol>
<pre><code>/dev/mapper/backupSSD /media/secure-ssd ext4 defaults 0 2
</code></pre>
<ol start="2">
<li>Declare a keyfile to decrypt the disk without typing the passphrase.</li>
</ol>
<p>When you first run luksFormat, the initial password you supply is hashed and stored in key-slot 0 of the LUKS header. You can easily add an additional passphrase, and this can take the form of a keyfile. This means that the volume can be decrypted either with the initial passphrase or the keyfile.</p>
<blockquote>
<p>Warning: To add a password to a LUKS partition, you need an unencrypted copy of the master key - so if the partition is not initialized, you will be prompted for the original passphrase. Because more than one password is possible under LUKS setups, the wording of the password prompt may seem confusing - it says: “Enter any passphrase”. This means enter any valid existing password for the partition.</p>
</blockquote>
<blockquote>
<p>Note: If you want multiple encrypted disks, you can use a passphrase only for the first one while decrypting the others with their keyfiles.</p>
</blockquote>
<p>Create a keyfile:</p>
<pre><code># make an appropriate directory
sudo mkdir /root/.keyfiles
# make a keyfile of randomly sourced bytes
sudo dd if=/dev/urandom of=/root/.keyfiles/hdd-1.key bs=1024 count=4
# make this read-only by owner (in this case, root):
sudo chmod 0400 /root/.keyfiles/hdd-1.key
</code></pre>
<p>Set up a keyfile for the LUKS partition:
<code>sudo cryptsetup luksAddKey /dev/sdd1 /root/.keyfiles/hdd-1.key</code></p>
<p>To automatically mount at boot, the mapping in /etc/crypttab should reference the keyfile:</p>
<pre><code>backupSSD UUID=4f942e15-ff00-4213-aab1-089448b17850 /root/.keyfiles/hdd-1.key luks,discard
</code></pre>
<hr />
<p>To unmount the LUKS partition:</p>
<pre><code>umount /dev/mapper/backupSSD
cryptsetup luksClose backupSSD
</code></pre>
<p>To decrypt and remount:</p>
<pre><code>cryptsetup luksOpen /dev/sdd1 backupSSD
mount /dev/mapper/backupSSD /media/secure-ssd
</code></pre>
<hr />
<p>To check the passphrase:</p>
<pre><code>sudo cryptsetup luksOpen --test-passphrase /dev/sdX &amp;&amp; echo correct
# Prompts for password, echoes "correct" if successful
# Alternatively, specify the intended slot
cryptsetup luksOpen --test-passphrase --key-slot 0 /dev/sdX &amp;&amp; echo correct
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="configure-systems-to-mount-file-systems-at-or-during-boot"><a class="header" href="#configure-systems-to-mount-file-systems-at-or-during-boot">Configure systems to mount file systems at or during boot</a></h2>
<p>There are broadly two aproaches:</p>
<ul>
<li>per-user mounting (usually under /media)</li>
<li>systemwide mounting (anywhere, often under /mnt)</li>
</ul>
<h3 id="1-per-user-mounting"><a class="header" href="#1-per-user-mounting">1. Per-user mounting</a></h3>
<p>Per-user mounting does not require root access, it's just automating the desktop interface. Systemwide mounts (/etc/fstab) can allow access from before login, and are therefore much more suitable for access through a network, or by system services.</p>
<p>When you mount a disc normally with the file browser (e.g. Nautilus) it mounts disks by interacting with <strong>udisks</strong> behind the scenes. You can do the same thing on the command line with the udisks tool.</p>
<h3 id="2-systemwide-mounting"><a class="header" href="#2-systemwide-mounting">2. Systemwide mounting</a></h3>
<p>Unlike DOS or Windows (where this is done by assigning a drive letter to each partition), Linux uses a unified directory tree where each partition is mounted at a mount point in that tree.</p>
<p>A <strong>mount point</strong> is a directory that is used as a way to access the filesystem on the partition, and mounting the filesystem is the process of associating a certain filesystem with a specific directory in the directory tree.</p>
<p>When providing just one parameter (either mout point or device) to the <strong>mount</strong> command, it will read the content of the /etc/fstab configuration file to check whether the specified file system is listed or not.</p>
<p>Usually when mounting a device with a common file system such as ext4 or xfs the mount command will auto-detect the file system type. However, some file systems are not recognized and need to be explicitly specified.</p>
<p>Use the -t option to specify the file system type: <code>mount -t &lt;fs-type&gt; &lt;device&gt; &lt;mount-point&gt;</code></p>
<p>To specify additional mount options , use the -o option: <code>mount -o &lt;options&gt; &lt;device&gt; &lt;mount-point&gt;</code></p>
<p>Multiple options can be provided as a comma-separated list.</p>
<p>The /etc/fstab file contains lines of the form <code>&lt;device&gt; &lt;location&gt; &lt;Linux type&gt; &lt;options&gt; &lt;dump&gt; &lt;pass&gt;</code>. Every element in this line is separated by whitespace (spaces and tabs):</p>
<pre><code># /etc/fstab: static file system information.
#
# Use 'blkid' to print the universally unique identifier for a
# device; this may be used with UUID= as a more robust way to name devices
# that works even if disks are added and removed. See fstab(5).
#
# &lt;file system&gt; &lt;mount point&gt;   &lt;type&gt;  &lt;options&gt;       &lt;dump&gt;  &lt;pass&gt;
# / was on /dev/sda2 during installation
UUID=a2db89ed-d599-4138-8838-0b950b6c3fbb /               ext4    errors=remount-ro 0       1
# /boot/efi was on /dev/sda1 during installation
UUID=AEF0-9F26  /boot/efi       vfat    defaults        0       1
# swap was on /dev/sda3 during installation
UUID=df17fdb9-57a4-4302-856e-3cd656848355 none            swap    sw              0       0
</code></pre>
<p>The first three fields are quite self-explanatory, while the others deserve a lenghtier explanation:</p>
<ul>
<li>
<p><strong>options</strong>: the fourth field, (fs_mntops), describes the mount options associated with the filesystem.</p>
<p>It is formatted as a comma separated list of options. It contains at least the type of mount plus any additional options appropriate to the filesystem type. For documentation on the available options for non-nfs file systems, see mount(8). For documention on all nfs-specific options have a look at nfs(5). Common for all types of file system are the options <code>noauto</code> (do not mount when <code>mount -a</code> is given, e.g., at boot time), <code>user</code> (allow a user to mount), and <code>owner</code> (allow device owner to mount), and <code>comment</code> (e.g., for use by fstab-maintaining programs). The <code>owner</code> and <code>comment</code> options are Linux-specific. For more details, see mount(8).</p>
<p>Most frequently used mount options include:</p>
<ul>
<li><code>async</code>: allows asynchronous I/O operations on the file system being mounted</li>
<li><code>auto</code>: marks the file system as enabled to be mounted automatically using <code>mount -a</code>. It is the opposite of noauto</li>
<li><code>defaults</code>: this option is an alias for <code>async,auto,dev,exec,nouser,rw,suid</code></li>
</ul>
<blockquote>
<p>Note: Multiple options must be separated by a comma without any spaces. If by accident you type a space between options, mount will interpret the subsequent text string as another argument</p>
</blockquote>
<ul>
<li><code>loop</code>: mounts an image (an .iso file, for example) as a loop device</li>
</ul>
<blockquote>
<p>Tip: This option can be used to simulate the presence of the disk's contents in an optical media reader</p>
</blockquote>
<ul>
<li><code>noexec</code>: prevents the execution of executable files on the particular filesystem (the opposite of <code>exec</code>)</li>
<li><code>nouser</code>: prevents any users (other than root) to mount and unmount the filesystem (the opposite of <code>user</code>)</li>
<li><code>remount</code>: mounts the filesystem again in case it is already mounted</li>
<li><code>ro</code>: mounts the filesystem as read only</li>
<li><code>rw</code>: mounts the file system with read and write capabilities</li>
<li><code>relatime</code>: makes access time to files be updated only if atime is earlier than mtime</li>
<li><code>user_xattr</code>: allow users to set and remote extended filesystem attributes</li>
</ul>
</li>
<li>
<p><strong>dump</strong>: the fifth field, (fs_freq), is used for these filesystems by the dump(8) command to determine which filesystems need to be dumped. If the fifth field is not present, a value of zero is returned and dump will assume that the filesystem does not need to be dumped.</p>
</li>
<li>
<p><strong>pass</strong>: the sixth field, (fs_passno), is used by the fsck(8) program to determine the order in which filesystem checks are done at reboot time. The root filesystem should be specified with a fs_passno of 1, and other filesystems should have a fs_passno of 2. Filesystems within a drive will be checked sequentially, but filesystems on different drives will be checked at the same time to utilize parallelism available in the hardware. If the sixth field is not present or zero, a value of zero is returned and fsck will assume that the filesystem does not need to be checked.</p>
</li>
</ul>
<p>So, to mount a filesystem/partition at boot, a common configuration is:
<code>UUID=&lt;uuid&gt; &lt;mount-point&gt; &lt;fs-type&gt; defaults 0 0</code></p>
<p>Before you reboot the machine, you need to test your new fstab entry. Issue the following command to mount all filesystems mentioned in fstab:
<code>sudo mount -a</code></p>
<p>Check if your filesystem was properly mounted:
<code>mount | grep &lt;mount-point&gt;</code></p>
<p>If you see no errors, the fstab entry is correct and you're safe to reboot.</p>
<hr />
<h3 id="mounting-iso-files"><a class="header" href="#mounting-iso-files">Mounting ISO Files</a></h3>
<p>You can mount an ISO file using the loop device which is a special pseudo-device that makes a file accessible as a block device.</p>
<p>Start by creating the mount point, it can be any location you want: <code>sudo mkdir /media/iso</code></p>
<p>Mount the ISO file to the mount point by typing the following command:
<code>sudo mount /path/to/image.iso /media/iso -o loop</code></p>
<p>A common use case is when you want to use a loopback file in place of a fresh new partition for testing purposes:</p>
<pre><code>sudo dd if=/dev/zero of=/imagefile bs=1M count=250
sudo mkfs -t ext4 -b 4096 -v /imagefile
sudo mkdir /mnt/tempdir
sudo mount -o loop /imagefile /mnt/tempdir 
mount | grep tempdir
&gt;/dev/loopX on /mnt/tempdir type ext4 (rw,relatime,seclabel,data=ordered)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="configure-and-manage-swap-space"><a class="header" href="#configure-and-manage-swap-space">Configure and manage swap space</a></h2>
<p>One of the easiest way of guarding against out-of-memory errors in applications is to add some swap space to your server.</p>
<blockquote>
<p>Warning: Although swap is generally recommended for systems utilizing traditional spinning hard drives, using swap with SSDs can cause issues with hardware degradation over time.</p>
</blockquote>
<p>The information written to disk will be significantly slower than information kept in RAM, but the operating system will prefer to keep running application data in memory and use swap for the older data. Overall, having swap space as a fallback for when your system's RAM is depleted can be a good safety net against out-of-memory exceptions on systems with non-SSD storage available.</p>
<h3 id="1-checking-the-system-for-swap-information"><a class="header" href="#1-checking-the-system-for-swap-information">1. Checking the System for Swap Information</a></h3>
<p>Before we begin, we can check if the system already has some swap space available. It is possible to have multiple swap files or swap partitions, but generally one should be enough.</p>
<p>We can see if the system has any configured swap by typing: <code>sudo swapon --show</code></p>
<p>If you don't get back any output, this means your system does not have swap space available currently.</p>
<p>You can verify that there is no active swap using the free utility:</p>
<pre><code>free -h
&gt;Output
&gt;              total        used        free      shared  buff/cache   available
&gt;Mem:           985M         84M        222M        680K        678M        721M
&gt;Swap:            0B          0B          0B
</code></pre>
<p>As you can see in the Swap row of the output, no swap is active on the system.</p>
<h2 id="2-checking-available-space-on-the-hard-drive-partition"><a class="header" href="#2-checking-available-space-on-the-hard-drive-partition">2. Checking Available Space on the Hard Drive Partition</a></h2>
<p>Before we create our swap file, we'll check our current disk usage to make sure we have enough space:</p>
<pre><code>df -h
&gt;Output
&gt;Filesystem      Size  Used Avail Use% Mounted on
&gt;udev            481M     0  481M   0% /dev
&gt;tmpfs            99M  656K   98M   1% /run
&gt;/dev/vda1        25G  1.4G   23G   6% /
&gt;tmpfs           493M     0  493M   0% /dev/shm
&gt;tmpfs           5.0M     0  5.0M   0% /run/lock
&gt;tmpfs           493M     0  493M   0% /sys/fs/cgroup
&gt;/dev/vda15      105M  3.4M  102M   4% /boot/efi
&gt;tmpfs            99M     0   99M   0% /run/user/1000
</code></pre>
<p>The device with <code>/</code> in the <code>Mounted on</code> column is our disk in this case. We have plenty of space available in this example (only 1.4G used). Your usage will probably be different.</p>
<blockquote>
<p>Note: Modern machines probably does not need swap space at all (see <a href="https://opensource.com/article/19/2/swap-space-poll">here</a>).</p>
</blockquote>
<h3 id="3-creating-a-swap-file"><a class="header" href="#3-creating-a-swap-file">3. Creating a Swap File</a></h3>
<p>Now that we know our available hard drive space, we can create a swap file on our filesystem. We will allocate a file of the swap size that we want called <code>swapfile</code> in our root (/) directory.</p>
<p>The best way of creating a swap file is with the <code>fallocate</code> program. This command instantly creates a file of the specified size:
<code>sudo fallocate -l 1G /swapfile</code></p>
<h3 id="4-enabling-the-swap-file"><a class="header" href="#4-enabling-the-swap-file">4. Enabling the Swap File</a></h3>
<p>First, we need to lock down the permissions of the file so that only the users with root privileges can read the contents. This prevents normal users from being able to access the file, which would have significant security implications.</p>
<p>Make the file only accessible to root by typing: <code>sudo chmod 600 /swapfile</code></p>
<p>We can now mark the file as swap space by typing:</p>
<pre><code>sudo mkswap /swapfile
&gt;Output
&gt;Setting up swapspace version 1, size = 1024 MiB (1073737728 bytes)
&gt;no label, UUID=6e965805-2ab9-450f-aed6-577e74089dbf
</code></pre>
<p>After marking the file, we can enable the swap file, allowing our system to start utilizing it: <code>sudo swapon /swapfile</code></p>
<p>Verify that the swap is available by typing:</p>
<pre><code>sudo swapon --show
&gt;Output
&gt;NAME      TYPE  SIZE USED PRIO
&gt;/swapfile file 1024M   0B   -2
</code></pre>
<p>We can check the output of the free utility again to corroborate our findings:</p>
<pre><code>free -h
&gt;Output
&gt;              total        used        free      shared  buff/cache   available
&gt;Mem:           985M         84M        220M        680K        680M        722M
&gt;Swap:          1.0G          0B        1.0G
</code></pre>
<h3 id="5-making-the-swap-file-permanent"><a class="header" href="#5-making-the-swap-file-permanent">5. Making the Swap File Permanent</a></h3>
<p>Our recent changes have enabled the swap file for the current session. However, if we reboot, the server will not retain the swap settings automatically. We can change this by adding the swap file to our /etc/fstab file.</p>
<p>Add the swap file information to the end of your /etc/fstab file by typing:
<code>echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab</code></p>
<hr />
<h3 id="tuning-your-swap-settings"><a class="header" href="#tuning-your-swap-settings">Tuning your Swap Settings</a></h3>
<p>There are a few options that you can configure that will have an impact on your system's performance when dealing with swap:</p>
<ul>
<li>
<p><code>swappiness</code>, a parameter which configures how often your system swaps data out of RAM to the swap space, expressed as a percentage.</p>
<p>We can see the current swappiness value by typing: <code>cat /proc/sys/vm/swappiness</code></p>
<blockquote>
<p>Tip: For a Desktop, a swappiness setting of 60 is not a bad value. For a server, you might want to move it closer to 0.</p>
</blockquote>
<p>We can set the swappiness to a different value by using the sysctl command.</p>
<p>For instance, to set the swappiness to 10, we could type: <code>sudo sysctl vm.swappiness=10</code></p>
<p>This setting will persist until the next reboot. We can set this value automatically at restart by adding the line to our /etc/sysctl.conf file: <code>vm.swappiness=10</code></p>
</li>
<li>
<p><code>vfs_cache_pressure</code>, a parameter which configures how much the system will choose to cache inode and dentry information over other data.</p>
<p>Basically, this is access data about the filesystem. This is generally very costly to look up and very frequently requested, so it's an excellent thing for your system to cache. You can see the current value by querying the proc filesystem again: <code>cat /proc/sys/vm/vfs_cache_pressure</code></p>
<p>As it is currently configured, our system removes inode information from the cache too quickly. We can set this to a more conservative setting like 50 by typing: <code>sudo sysctl vm.vfs_cache_pressure=50</code></p>
<p>Again, this is only valid for our current session. We can change that by adding it to our configuration file like we did with our swappiness setting: <code>vm.vfs_cache_pressure=50</code></p>
</li>
</ul>
<hr />
<h3 id="removing-a-swap-file"><a class="header" href="#removing-a-swap-file">Removing a Swap File</a></h3>
<p>To deactivate and remove the swap file, start by deactivating the swap space by typing: <code>sudo swapoff -v /swapfile</code></p>
<p>Next, remove the swap file entry <code>/swapfile</code> the <code>/etc/fstab</code> file.</p>
<p>Finally, remove the actual swapfile file: <code>sudo rm /swapfile</code></p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="create-and-manage-raid-devices"><a class="header" href="#create-and-manage-raid-devices">Create and manage RAID devices</a></h2>
<p>The technology known as <em>Redundant Array of Independent Disks</em> (<strong>RAID</strong>) is a storage solution that combines multiple hard disks into a single logical unit to provide redundancy of data and/or improve performance in read/write operations to disk.</p>
<p>Essential features of RAID are:</p>
<ul>
<li>mirroring, write the same data to more than one disk</li>
<li>striping, splitting of data to more than one disk</li>
<li>parity, extra data is stored to allow fault-tolerance, error detection and repair.</li>
</ul>
<p>However, the actual fault-tolerance and disk I/O performance lean on how the hard disks are set up to form the disk array. Depending on the available devices and the faulttolerance/performance needs, different RAID levels are defined.</p>
<h3 id="raid-levels"><a class="header" href="#raid-levels">RAID LEVELS</a></h3>
<ul>
<li>RAID 0: uses only striping, it does not allow fault tolerance but it has good performance</li>
</ul>
<blockquote>
<p>The total array size is n times the size of the smallest partition, where n is the number of independent disks in the array (you will need at least two drives). Run the following command to assemble a RAID 0 array using partitions /dev/sdb1 and /dev/sdc1:</p>
</blockquote>
<pre><code>mdadm --create --verbose /dev/md0 --level=stripe --raid-devices=2 /dev/sdb1 /dev/sdc1
</code></pre>
<blockquote>
<p>Common uses: supporting real-time applications where performance is more important than fault-tolerance.</p>
</blockquote>
<ul>
<li>RAID 1: uses only mirroring, good for recovery, at least 2 disks are required</li>
</ul>
<blockquote>
<p>The total array size equals the size of the smallest partition (you will need at least two drives). Run the following command to assemble a RAID 1 array using partitions /dev/sdb1 and /dev/sdc1:</p>
</blockquote>
<pre><code>mdadm --create --verbose /dev/md0 --level=1 --raid-devices=2 /dev/sdb1 /dev/sdc1
</code></pre>
<blockquote>
<p>Common uses: Installation of the operating system or important subdirectories, such as /home.</p>
</blockquote>
<ul>
<li>RAID 5: uses a rotating parity stripe, thus allowing fault tolerance and reliability, at least 3 disks are required</li>
</ul>
<blockquote>
<p>The total array size will be (n – 1) times the size of the smallest partition. The “lost” space in (n-1) is used for parity (redundancy) calculation (you will need at least three drives). Note that you can specify a spare device (/dev/sde1 in this case) to replace a faulty part when an issue occurs. Run the following command to assemble a RAID 5 array using partitions /dev/sdb1, /dev/sdc1, /dev/sdd1, and /dev/sde1 as spare:</p>
</blockquote>
<pre><code>mdadm --create --verbose /dev/md0 --level=5 --raid-devices=3 /dev/sdb1 /dev/sdc1 /dev/sdd1 --spare-devices=1 /dev/sde1
</code></pre>
<blockquote>
<p>Common uses: Web and file servers.</p>
</blockquote>
<ul>
<li>RAID 6: uses striped disks with dual parity, it is an evolution of RAID 5, allowing fault tolerance and performance, at least 4 disks are required</li>
</ul>
<blockquote>
<p>The total array size will be (n<em>s)-2</em>s, where n is the number of independent disks in the array and s is the size of the smallest disk. Note that you can specify a spare device (/dev/sdf1 in this case) to replace a faulty part when an issue occurs. Run the following command to assemble a RAID 6 array using partitions /dev/sdb1, /dev/sdc1, /dev/sdd1, /dev/sde1, and /dev/sdf1 as spare:</p>
</blockquote>
<pre><code>mdadm --create --verbose /dev/md0 --level=6 --raid-devices=4 /dev/sdb1 /dev/sdc1 /dev/sdd1 /dev/sde --spare-devices=1 /dev/sdf1
</code></pre>
<blockquote>
<p>Common uses: File and backup servers with large capacity and high availability requirements.</p>
</blockquote>
<ul>
<li>RAID 10: uses mirroring and striping, thus allowing redundancy and performance, at least 4 disk are required</li>
</ul>
<blockquote>
<p>The total array size is computed based on the formulas for RAID 0 and RAID 1, since RAID 1+0 is a combination of both. First, calculate the size of each mirror and then the size of the stripe. Note that you can specify a spare device (/dev/sdf1 in this case) to replace a faulty part when an issue occurs. Run the following command to assemble a RAID 1+0 array using partitions /dev/sdb1, /dev/sdc1, /dev/sdd1, /dev/sde1, and /dev/sdf1 as spare:</p>
</blockquote>
<pre><code>mdadm --create --verbose /dev/md0 --level=10 --raid-devices=4 /dev/sd[b-e]1 --spare-devices=1 /dev/sdf1
</code></pre>
<blockquote>
<p>Common uses: Database and application servers that require fast I/O operations.</p>
</blockquote>
<h3 id="assembling-partitions-as-raid-devices"><a class="header" href="#assembling-partitions-as-raid-devices">Assembling Partitions as RAID Devices</a></h3>
<ol>
<li>Create the array using mdadm</li>
</ol>
<p>RAID disks require <em>RAID autodetect partitions</em>. These can be made with fdisk:</p>
<pre><code>sudo fdisk /dev/sdb
&gt;d      # until all deleted
&gt;n      # use defaults
&gt;t      # change partition type
&gt;fd     # Linux RAID autodetect type
</code></pre>
<p>If one of the partitions has been formatted previously, or has been a part of another RAID array previously, you will be prompted to confirm the creation of the new array. Assuming you have taken the necessary precautions to avoid losing important data that may have resided in them, you can safely type <code>y</code> and press <code>Enter</code>: <code>mdadm --create --verbose /dev/md0 --level=stripe --raid-devices=2 /dev/sdb1 /dev/sdc1</code></p>
<ol start="2">
<li>Check the array creation status</li>
</ol>
<p>In order to check the array creation status, use the following commands – regardless of the RAID type:</p>
<pre><code>cat /proc/mdstat
&gt;Personalities : [linear] [multipath] [raid0] [raid1] [raid6] [raid5] [raid4] [raid10] 
&gt;md0 : active raid0 sdb[1] sda[0]
&gt;      209584128 blocks super 1.2 512k chunks
&gt;
&gt;            unused devices: &lt;none&gt;
# or
mdadm --detail /dev/md0   # more detailed summary
</code></pre>
<ol start="3">
<li>Format the RAID Device</li>
</ol>
<p>Format the device with a filesystem as per your needs/requirement:</p>
<pre><code>sudo mkfs.ext4 /dev/md0
sudo mkdir -p /mnt/myraid
sudo mount /dev/md0 /myraid
</code></pre>
<p>Check whether the new space is available by typing:</p>
<pre><code>df -h -x devtmpfs -x tmpfs
&gt;Output
&gt;Filesystem      Size  Used Avail Use% Mounted on
&gt;/dev/vda1        25G  1.4G   23G   6% /
&gt;/dev/vda15      105M  3.4M  102M   4% /boot/efi
&gt;/dev/md0        196G   61M  186G   1% /mnt/md0
</code></pre>
<ol start="4">
<li>Save and Monitor the RAID Array</li>
</ol>
<p>To make sure that the array is reassembled automatically at boot: <code>sudo mdadm --detail --scan | sudo tee -a /etc/mdadm/mdadm.conf</code></p>
<p>Afterwards, you can update the initramfs, or initial RAM file system, so that the array will be available during the early boot process: <code>sudo update-initramfs -u</code></p>
<p>Once the configuration file has been updated the array can be assembled: <code>mdadm --assemble --scan</code></p>
<blockquote>
<p>Note: This will assemble and start all arrays listed in the standard config file. This command will typically go in a system startup file.</p>
</blockquote>
<p><code>mdadm</code> provides the systemd service <code>mdmonitor.service</code> which can be useful for monitoring the health of your raid arrays and notifying you via email if anything goes wrong.</p>
<p>This service is special in that it cannot be manually activated like a regular service; mdadm will take care of activating it via udev upon assembling your arrays on system startup, but it will only do so if an email address has been configured for its notifications:
<code>echo "MAILADDR user@domain" | sudo tee -a /etc/mdadm/mdadm.conf</code></p>
<blockquote>
<p>Warning: Failure to configure an email address will result in the monitoring service silently failing to start.</p>
</blockquote>
<blockquote>
<p>Note: In order to send emails, a properly configured mail transfer agent is required.</p>
</blockquote>
<p>Then, to verify that everything is working as it should, run the following command: <code>mdadm --monitor --scan --oneshot --test</code></p>
<p>If the test is successful and the email is delivered, then you are done; the next time your arrays are reassembled, mdmonitor.service will begin monitoring them for errors.</p>
<p>Finally, add the new filesystem mount options to the /etc/fstab file for automatic mounting at boot:
<code>echo '/dev/md0 /mnt/myraid ext4 defaults,nofail,discard 0 0' | sudo tee -a /etc/fstab</code></p>
<h3 id="recover-from-raid-disk-failure"><a class="header" href="#recover-from-raid-disk-failure">Recover from RAID Disk Failure</a></h3>
<p>In RAID levels that support redundancy, replace failed drives when needed. When a device in the disk array becomes faulty, a rebuild automatically starts only if there was a spare device added when we first created the array.</p>
<p>Otherwise, we need to manually attach an extra physical drive to our system and run:  <code>mdadm /dev/md0 --add /dev/sdX1</code></p>
<blockquote>
<p>Note: <code>&lt;/dev/md0&gt;</code> is the array that experienced the issue and <code>&lt;/dev/sdX1&gt;</code> is the new device.</p>
</blockquote>
<p>Depending on the type of RAID (for example, with RAID1), mdadm may add the device as a spare without syncing data to it. You can increase the number of disks the RAID uses by using <code>--grow</code> with the <code>--raid-devices</code> option. For example, to increase an array to four disks: <code>mdadm --grow /dev/md0 --raid-devices=4</code></p>
<p>You can check the progress with: <code>cat /proc/mdstat</code></p>
<p>Check that the device has been added with the command: <code>mdadm --misc --detail /dev/md0</code></p>
<blockquote>
<p>Note: For RAID0 arrays you may get the following error message: "mdadm: add new device failed for /dev/sdc1 as 2: Invalid argument". This is because the above commands will add the new disk as a "spare" but RAID0 does not have spares. If you want to add a device to a RAID0 array, you need to "grow" and "add" in the same command, as demonstrated here: <code>mdadm --grow /dev/md0 --raid-devices=3 --add /dev/sdX1</code></p>
</blockquote>
<hr />
<p>One can remove a device from the array after marking it as faulty:
<code>mdadm --fail /dev/md0 /dev/sdX0</code></p>
<p>Now remove it from the array:
<code>mdadm --remove /dev/md0 /dev/sdX0</code></p>
<p>To remove device permanently (for example, to use it individually from now on), see next session.</p>
<h3 id="disassemble-a-working-array"><a class="header" href="#disassemble-a-working-array">Disassemble a working array</a></h3>
<p>You may have to do this if you need to create a new array using the devices.</p>
<p>Find the active arrays in the /proc/mdstat file by typing:</p>
<pre><code>cat /proc/mdstat
&gt;Output
&gt;Personalities : [raid0] [linear] [multipath] [raid1] [raid6] [raid5] [raid4] [raid10] 
&gt;md0 : active raid0 sdc[1] sdd[0]
&gt;      209584128 blocks super 1.2 512k chunks
&gt;
&gt;            unused devices: &lt;none&gt;
</code></pre>
<p>Unmount the array from the filesystem: <code>sudo umount /dev/md0</code></p>
<p>Then, stop and remove the array by typing: <code>sudo mdadm --stop /dev/md0</code></p>
<p>Find the devices that were used to build the array with the following command:</p>
<blockquote>
<p>Warning: Keep in mind that the /dev/sd* names can change any time you reboot! Check them every time to make sure you are operating on the correct devices.</p>
</blockquote>
<pre><code>lsblk -o NAME,SIZE,FSTYPE,TYPE,MOUNTPOINT
&gt;Output
&gt;NAME     SIZE FSTYPE            TYPE MOUNTPOINT
&gt;sda      100G                   disk 
&gt;sdb      100G                   disk 
&gt;sdc      100G linux_raid_member disk   # here it is
&gt;sdd      100G linux_raid_member disk   # and this is the second one
&gt;vda       25G                   disk 
&gt;├─vda1  24.9G ext4              part /
&gt;├─vda14    4M                   part 
&gt;└─vda15  106M vfat              part /boot/efi
</code></pre>
<p>After discovering the devices used to create an array, zero their superblock to remove the RAID metadata and reset them to normal:</p>
<pre><code>sudo mdadm --zero-superblock /dev/sdc
sudo mdadm --zero-superblock /dev/sdd
</code></pre>
<blockquote>
<p>Warning: Do not issue this command on linear or RAID0 arrays or data loss will occur!</p>
</blockquote>
<blockquote>
<p>Warning: For the other RAID levels, reusing the removed disk without zeroing the superblock will cause loss of all data on the next boot. (After mdadm will try to use it as the part of the raid array).</p>
</blockquote>
<p>You should remove any of the persistent references to the array. Edit the /etc/fstab file and comment out or remove the reference to your array:
<code>sudo sed -i '/\/dev\/md0/d' /etc/fstab</code></p>
<p>Also, comment out or remove from the /etc/mdadm/mdadm.conf file the array definition:</p>
<pre><code>ARRAY /dev/md0 metadata=1.2 name=mdadmwrite:0 UUID=7261fb9c:976d0d97:30bc63ce:85e76e91
</code></pre>
<p>Finally, update the initramfs again so that the early boot process does not try to bring an unavailable array online:</p>
<pre><code>sudo update-initramfs -u
</code></pre>
<p>At this point, you should be ready to reuse the storage devices individually, or as components of a different array.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="configure-systems-to-mount-file-systems-on-demand"><a class="header" href="#configure-systems-to-mount-file-systems-on-demand">Configure systems to mount file systems on demand</a></h2>
<p>One drawback of using /etc/fstab is that, regardless of how infrequently a user accesses the NFS mounted file system, the system must dedicate resources to keep the mounted file system in place. This is not a problem with one or two mounts, but when the system is maintaining mounts to many systems at one time, overall system performance can be affected. An alternative to /etc/fstab is to use the kernel-based <strong>automount</strong> utility. An automounter consists of two components:</p>
<ul>
<li>a kernel module that implements a file system, and</li>
<li>a user-space daemon that performs all of the other functions.</li>
</ul>
<p>The automount utility can mount and unmount NFS file systems automatically (on-demand mounting), therefore saving system resources. It can be used to mount other file systems including AFS, SMBFS, CIFS, and local file systems.</p>
<p>hese automatic mount points are mounted only when they are accessed, and unmounted after a certain period of inactivity. This on-demand behavior saves bandwidth and results in better performance than static mounts managed by /etc/fstab. While <code>autofs</code> is a control script, <code>automount</code> is the command (daemon) that does the actual auto-mounting.</p>
<hr />
<h3 id="1-installation"><a class="header" href="#1-installation">1. Installation</a></h3>
<p>Install the autofs package either by clicking here or entering the following in a terminal window: <code>sudo apt install autofs</code></p>
<h3 id="2-configuration"><a class="header" href="#2-configuration">2. Configuration</a></h3>
<p>autofs can be configured by editing configuration files. There are other ways to configure autofs on a network (see <a href="https://help.ubuntu.com/community/AutofsLDAP">AutofsLDAP</a>), but config files provide the simplest setup.</p>
<p>The master configuration file for autofs is <code>/etc/auto.master</code> by default. Unless you have a good reason for changing this, leave it as the default.</p>
<p>Here is the sample file provided by Ubuntu:</p>
<pre><code>#
# $Id: auto.master,v 1.4 2005/01/04 14:36:54 raven Exp $
#
# Sample auto.master file
# This is an automounter map and it has the following format
# key [ -mount-options-separated-by-comma ] location
# For details of the format look at autofs(5).
#/misc   /etc/auto.misc --timeout=60
#/smb   /etc/auto.smb
#/misc  /etc/auto.misc
#/net    /etc/auto.net
</code></pre>
<p>Each of the lines in auto.master describes a mount and the location of its <strong>map</strong>. These lines have the following format:
<code>mount-point [map-type[,format]:] map [options]</code></p>
<p>The map files are usually named using the convention <code>auto.&lt;X&gt;</code>, where <code>&lt;X&gt;</code> can be anything as long as it matches an entry in <code>auto.master</code> and is valid for a file-name.</p>
<h3 id="3-example-auto-mounting-an-nfs-share"><a class="header" href="#3-example-auto-mounting-an-nfs-share">3. EXAMPLE: Auto-mounting an NFS share</a></h3>
<p>In this howto, we will configure autofs to auto-mount an NFS share, using a set of configuration files. This howto assumes that you are already familiar with NFS exports, and that you already have a properly-functioning NFS share on your network. Go to the <a href="https://help.ubuntu.com/community/SettingUpNFSHowTo">NFS Setup Page</a> to learn how to set up such a server.</p>
<p>3.11. Edit /etc/auto.master</p>
<p>The following step creates a mount point at <code>/nfs</code> and configures it according to the settings specified in <code>/etc/auto.nfs</code> (which we will create in the next step).</p>
<p>Type the following into a terminal: <code>sudo vi /etc/auto.master</code></p>
<p>Add the following line at the end of /etc/auto.master: <code>/nfs   /etc/auto.nfs</code></p>
<p>3.2. Create /etc/auto.nfs</p>
<p>Now we will create the file which contains our automounter map: <code>sudo vi /etc/auto.nfs</code></p>
<p>This file should contain a separate line for each NFS share. The format for a line is <code>{mount point} [{mount options}] {location}</code>. If you have previously configured static mounts in /etc/fstab, it may be helpful to refer to those. Remember, the mount points specified here will be relative to the mount point given in /etc/auto.master.</p>
<p>The following line is for shares using older versions of NFS (prior to version 4): <code>server   server:/</code></p>
<p>This creates a new mount point at <code>/nfs/server/</code> and mounts the NFS root directory exported by the machine whose host-name is <code>server</code>.</p>
<p>3.2.1. NFSv4</p>
<p>If your NFS shares use NFSv4, you need to tell autofs about that. In such a case, the above line would appear as follows: <code>server   -fstype=nfs4   server:/</code></p>
<p>The client needs the same changes to <code>/etc/default/nfs-common</code> to connect to an NFSv4 server. In /etc/default/nfs-common we set:</p>
<pre><code>NEED_IDMAPD=yes
NEED_GSSD=no # no is default
</code></pre>
<p>3.3. Unmount static mounts and edit /etc/fstab</p>
<p>If you have previously configured the NFS shares as static mounts, now is the time to unmount them: <code>sudo umount /server</code></p>
<p>Next, remove (or comment out) their respective entries in /etc/fstab: <code>#server:/ /server/ nfs defaults 0 0</code></p>
<p>3.4. Reload /etc/init.d/autofs</p>
<p>After entering your changes, run the following command to reload autofs: <code>sudo systemctl restart autofs</code></p>
<p>3.5. Make sure it works</p>
<p>In order to access the share and verify that it is working properly, enter the following into a shell: <code>ls /nfs/server</code></p>
<p>If you see your NFS share listed, congratulations! You have a functioning NFS mount via autofs! If you want to learn some more advanced information, keep reading <a href="https://help.ubuntu.com/community/Autofs">here</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="create-manage-and-diagnose-advanced-file-system-permissions"><a class="header" href="#create-manage-and-diagnose-advanced-file-system-permissions">Create, manage and diagnose advanced file system permissions</a></h2>
<p>POSIX <strong>Access Control Lists</strong> (ACLs) are more fine-grained access rights for files and directories. An ACL consists of entries specifying access permissions on an associated object. ACLs can be configured per user, per group or via the effective rights mask.</p>
<p>These permissions apply to an individual user or a group, and use the same as <strong>rwx</strong> found in regular permissions.</p>
<p>Before beginning to work with ACLs the file system must be mounted with ACLs turned on. This can be done in /etc/fstab for the changes to be permanent.</p>
<ol start="0">
<li>
<p>It may be necessary to install acl utilities from the repositories. In the Server Edition, this must be done, but in the desktop editions acl is installed by default: <code>sudo apt-get install acl</code></p>
</li>
<li>
<p>Add the option acl to the partition(s) on which you want to enable ACL in /etc/fstab:</p>
<pre><code>UUID=07aebd28-24e3-cf19-e37d-1af9a23a45d4    /home    ext4   defaults,acl   0   2
</code></pre>
<p>There is a possibility that the acl option is already active as default mount option on the filesystem. Btrfs does and Ext2/3/4 filesystems do too. Use the following command to check ext* formatted partitions for the option:</p>
<pre><code>tune2fs -l /dev/sda1 | grep "Default mount options:"
&gt;Default mount options:    user_xattr acl
</code></pre>
<p>You can set the default mount options of a filesystem using the tune2fs -o option partition command, for example:
<code>tune2fs -o acl /dev/sda1</code></p>
<p>Using the default mount options instead of an entry in /etc/fstab is very useful for external drives, such partition will be mounted with acl option also on other Linux machines. There is no need to edit /etc/fstab on every machine.</p>
<blockquote>
<p>Note: "acl" is specified as default mount option when creating an ext2/3/4 filesystem. This is configured in /etc/mke2fs.conf.</p>
</blockquote>
</li>
<li>
<p>If necessary, remount partition(s) on which ACLs were enabled for them to take effect: <code>sudo mount -o remount /</code></p>
</li>
<li>
<p>Verify that ACLs are enabled on the partition(s): <code>mount | grep acl</code></p>
</li>
</ol>
<hr />
<p>ACL entries consist of a user (u), group (g), other (o) and an effective rights mask (m). An effective rights mask defines the most restrictive level of permissions. <code>setfacl</code> sets the permissions for a given file or directory. <code>getfacl</code> shows the permissions for a given file or directory.</p>
<p>Defaults for a given object can be defined.</p>
<p>ACLs can be applied to users or groups but it is easier to manage groups. Groups scale better than continuously adding or subtracting users.</p>
<p>You will notice that there is an ACL for a given file because it will exhibit a + (plus sign) after its Unix permissions in the output of <code>ls -l</code>:</p>
<pre><code>ls -l /dev/audio
&gt;crw-rw----+ 1 root audio 14, 4 nov.   9 12:49 /dev/audio
</code></pre>
<p>To list the ACLs for a given file or directory: <code>getfacl &lt;file-or-dir&gt;</code></p>
<p>To set permissions for a user (user is either the user name or ID): <code>setfacl -m "u:user:permissions" &lt;file/dir&gt;</code></p>
<p>To set permissions for a group (group is either the group name or ID): <code>setfacl -m "g:group:permissions" &lt;file/dir&gt;</code></p>
<p>To set permissions for others: <code>setfacl -m "other:permissions" &lt;file/dir&gt;</code></p>
<p>Removing a Group from an ACL: <code>setfacl -x g:green /var/www</code></p>
<p>Transfer ACL attributes from a specification file:</p>
<pre><code>echo "g:green:rwx" &gt; acl 
setfacl -M acl /path/to/dir
</code></pre>
<p>Output from getfacl is accepted as input for setfacl with <code>-M</code> (<code>-b</code> clear ACLs, <code>-n</code> do not recalculate effective rights mask, <code>-</code> read from stdin): <code>getfacl dir1 | setfacl -b -n -M - dir2</code></p>
<p>To copy the ACL of a file to another: <code>getfacl file1 | setfacl --set-file=- file2</code></p>
<p>Copying the access ACL into the Default ACL of the sam dir: <code>getfacl --access dir | setfacl -d -M- dir</code></p>
<p>To allow all newly created files or directories to inherit entries from the parent directory (this will not affect files which were already present in the directory, use <code>-R</code> to modify also these files): <code>setfacl -d -m "entry" &lt;dir&gt;</code></p>
<p>Set ACL permissions recursively: <code>setfacl -Rm u:foo:r-x dir</code></p>
<p>To remove a specific entry: <code>setfacl -x "entry" &lt;file/dir&gt;</code></p>
<p>To remove the default entries: <code>setfacl -k &lt;file/dir&gt;</code></p>
<p>To remove all entries (entries of the owner, group and others are retained): <code>setfacl -b &lt;file/dir&gt;</code></p>
<hr />
<h3 id="file-attributes"><a class="header" href="#file-attributes">File Attributes</a></h3>
<p>In Linux, file attributes are meta-data properties that describe the file's behavior. For example, an attribute can indicate whether a file is compressed or specify if the file can be deleted.</p>
<p>Some attributes like immutability can be set or cleared, while others like encryption are read-only and can only be viewed. The support for certain attributes depends on the filesystem being used.</p>
<p>The chattr command takes the following general form:
<code>chattr &lt;options&gt; &lt;operator&gt; &lt;attributes&gt; file</code></p>
<p>The value of the <code>&lt;operator&gt;</code> part can be one of the following symbols:</p>
<ul>
<li><code>+</code>, to add the specified attributes to the existing ones</li>
<li><code>-</code>, to remove the specified attributes from the existing ones</li>
<li><code>=</code>, to set the specified attributes as the only attributes.</li>
</ul>
<p>The operator is followed by one or more <code>&lt;attributes&gt;</code> flags that you want to add or remove from the file attributes:</p>
<ul>
<li><code>a</code>, append only</li>
<li><code>c</code>, compressed</li>
<li><code>d</code>, no dump</li>
<li><code>e</code>, extent format</li>
<li><code>i</code>, immutable</li>
<li><code>j</code>, data journalling</li>
<li><code>s</code>, secure deletion</li>
<li><code>t</code>, no tail-merging</li>
<li><code>u</code>, undeletable</li>
<li><code>A</code>, no atime updates</li>
<li><code>C</code>, no copy on write</li>
<li><code>D</code>, synchronous directory updates</li>
<li><code>S</code>, synchronous updates</li>
<li><code>T</code>, top of directory hierarchy.</li>
</ul>
<blockquote>
<p>Note: By default, file attributes are not preserved when copying a file with commands like cp or rsync.</p>
</blockquote>
<p>For example, if you want to set the immutable bit on some file, use the following command:
<code>chattr +i /path/to/file</code></p>
<p>You can view the file attributes with the lsattr command:</p>
<pre><code>lsattr /path/to/file
&gt;--------------e----- file
</code></pre>
<p>As the ls -l command, the -d option with lsattr will list the attributes of the directory itself instead of the files in that directory:</p>
<pre><code>lsattr -d script-test/
&gt;-------------e-- script-test/
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="setup-user-and-group-disk-quotas-for-filesystems"><a class="header" href="#setup-user-and-group-disk-quotas-for-filesystems">Setup user and group disk quotas for filesystems</a></h2>
<p>Storage space is a resource that must be carefully used and monitored. To do that, <strong>quotas</strong> can be set on a file system basis, either for individual users or for groups.</p>
<p>Thus, a limit is placed on the disk usage allowed for a given user or a specific group, and you can rest assured that your disks will not be filled to capacity by a careless (or malicious) user.</p>
<h3 id="1-installing-the-quota-tools"><a class="header" href="#1-installing-the-quota-tools">1. Installing the Quota Tools</a></h3>
<p>To set and check quotas, we first need to install the quota command line tools using apt. Let's update our package list, then install the package:</p>
<pre><code>sudo apt update
sudo apt install quota
</code></pre>
<h3 id="2-installing-the-quota-kernel-module"><a class="header" href="#2-installing-the-quota-kernel-module">2. Installing the Quota Kernel Module</a></h3>
<p>You can verify that the tools are installed by running the quota command and asking for its version information: <code>quota --version</code></p>
<p>If you are on a cloud-based virtual server, your default Ubuntu Linux installation may not have the kernel modules needed to support quota management. To check, we will use find to search for the quota_v1 and quota_v2 modules in the /lib/modules/... directory:
<code>find /lib/modules/</code>uname -r<code> -type f -name '*quota_v*.ko*'</code></p>
<p>If you get no output from the above command, install the linux-image-extra-virtual package: <code>sudo apt install linux-image-extra-virtual</code></p>
<h3 id="3-updating-filesystem-mount-options"><a class="header" href="#3-updating-filesystem-mount-options">3. Updating Filesystem Mount Options</a></h3>
<p>To activate quotas on a particular filesystem, we need to mount it with a few quota-related options specified. We do this by updating the filesystem's entry in the /etc/fstab configuration file. Open that file in your favorite text editor now: <code>sudo vi /etc/fstab</code></p>
<p>This file's contents will be similar to the following:</p>
<pre><code>LABEL=cloudimg-rootfs   /        ext4   defaults        0 0
LABEL=UEFI      /boot/efi       vfat    defaults        0 0
</code></pre>
<p>Update the line pointing to the root filesystem by replacing the defaults option with the following options:</p>
<pre><code>LABEL=cloudimg-rootfs   /        ext4   usrquota,grpquota        0 0
</code></pre>
<p>This change will allow us to enable both user- (<strong>usrquota</strong>) and group-based (<strong>grpquota</strong>) quotas on the filesystem. If you only need one or the other, you may leave out the unused option. If your fstab line already had some options listed instead of <strong>defaults</strong>, you should add the new options to the end of whatever is already there, being sure to separate all options with a comma and no spaces.</p>
<p>Remount the filesystem to make the new options take effect:
<code>sudo mount -o remount /</code></p>
<p>We can verify that the new options were used to mount the filesystem by looking at the /proc/mounts file. Here, we use grep to show only the root filesystem entry in that file:</p>
<pre><code>cat /proc/mounts | grep ' / '
&gt;/dev/vda1 / ext4 rw,relatime,quota,usrquota,grpquota,data=ordered 0 0
</code></pre>
<p>Note the two options that we specified. Now that we've installed our tools and updated our filesystem options, we can turn on the quota system.</p>
<h3 id="4-enabling-quotas"><a class="header" href="#4-enabling-quotas">4. Enabling Quotas</a></h3>
<p>Before finally turning on the quota system, we need to manually run the quotacheck command once: <code>sudo quotacheck -ugm /</code></p>
<p>This command creates the files <code>/aquota.user</code> and <code>/aquota.group</code>. These files contain information about the limits and usage of the filesystem, and they need to exist before we turn on quota monitoring. The quotacheck parameters we've used are:</p>
<ul>
<li><code>(-u)</code>, specifies that a user-based quota file should be created</li>
<li><code>(-g)</code>, indicates that a group-based quota file should be created</li>
<li><code>(-m)</code>, disables remounting the filesystem as read-only while performing the initial tallying of quotas. Remounting the filesystem as read-only will give more accurate results in case a user is actively saving files during the process, but is not necessary during this initial setup.</li>
</ul>
<p>We can verify that the appropriate files were created by listing the root directory: <code>ls /aquota*</code></p>
<p>Now we're ready to turn on the quota system: <code>sudo quotaon -v /</code></p>
<p>Our server is now monitoring and enforcing quotas, but we've not set any yet!</p>
<h3 id="5-configuring-quotas-for-a-user"><a class="header" href="#5-configuring-quotas-for-a-user">5. Configuring Quotas for a User</a></h3>
<p>There are a few ways we can set quotas for users or groups. Here, we'll go over how to set quotas with both the <code>edquota</code> and <code>setquota</code> commands.</p>
<h4 id="51-using-edquota-to-set-a-user-quota"><a class="header" href="#51-using-edquota-to-set-a-user-quota">5.1 Using edquota to Set a User Quota</a></h4>
<p>We use the <code>edquota</code> command to edit quotas. Let's edit our example <strong>sammy</strong> user's quota: <code>sudo edquota -u sammy</code></p>
<p>The <code>-u</code> option specifies that this is a user quota we'll be editing. If you'd like to edit a group's quota instead, use the <code>-g</code> option in its place.</p>
<p>This will open up a file in your default text editor:</p>
<pre><code>Disk quotas for user sammy (uid 1000):
  Filesystem                   blocks       soft       hard     inodes     soft     hard
  /dev/vda1                        40          0          0         13        0        0
</code></pre>
<p>This lists the username and uid, the filesystems that have quotas enabled on them, and the block- and inode-based usage and limits. Setting an <strong>inode-based</strong> quota would limit how many files and directories a user can create, regardless of the amount of disk space they use. Most people will want <strong>block-based</strong> quotas, which specifically limit disk space usage. This is what we will configure.</p>
<blockquote>
<p>Note: The concept of a block is poorly specified and can change depending on many factors, including which command line tool is reporting them. In the context of setting quotas on Ubuntu, it's fairly safe to assume that 1 block equals 1 kilobyte of disk space.</p>
</blockquote>
<p>In the above listing, our user sammy is using 40 blocks, or 40KB of space on the /dev/vda1 drive. The soft and hard limits are both disabled with a 0 value.</p>
<p>Each type of quota allows you to set both a soft limit and a hard limit. When a user exceeds the soft limit, they are over quota, but they are not immediately prevented from consuming more space or inodes. Instead, some leeway is given: the user has – by default – seven days to get their disk use back under the soft limit. At the end of the seven day <strong>grace period</strong>, if the user is still over the soft limit it will be treated as a hard limit. A hard limit is less forgiving: all creation of new blocks or inodes is immediately halted when you hit the specified hard limit. This behaves as if the disk is completely out of space: writes will fail, temporary files will fail to be created, and the user will start to see warnings and errors while performing common tasks.</p>
<p>Let's update our sammy user to have a block quota with a 100MB soft limit, and a 110MB hard limit:</p>
<pre><code>Disk quotas for user sammy (uid 1000):
  Filesystem                   blocks       soft       hard     inodes     soft     hard
  /dev/vda1                        40       100M       110M         13        0        0
</code></pre>
<p>Save and close the file. To check the new quota we can use the quota command:</p>
<pre><code>sudo quota -vs sammy
&gt;Disk quotas for user sammy (uid 1000):
&gt;     Filesystem   space   quota   limit   grace   files   quota   limit   grace
&gt;      /dev/vda1     40K    100M    110M              13       0       0
</code></pre>
<p>The command outputs our current quota status, and shows that our quota is 100M while our limit is 110M. This corresponds to the soft and hard limits respectively.</p>
<blockquote>
<p>Note: If you want your users to be able to check their own quotas without having sudo access, you'll need to give them permission to read the quota files we created in Step 4. One way to do this would be to make a users group, make those files readable by the users group, and then make sure all your users are also placed in the group.</p>
</blockquote>
<h4 id="52-using-setquota-to-set-a-user-quota"><a class="header" href="#52-using-setquota-to-set-a-user-quota">5.2 Using setquota to Set a User Quota</a></h4>
<p>Unlike <code>edquota</code>, setquota will update our user's quota information in a single command, without an interactive editing step. We will specify the username and the soft and hard limits for both block- and inode-based quotas, and finally the filesystem to apply the quota to:
<code>sudo setquota -u sammy 200M 220M 0 0 /</code></p>
<p>The above command will double sammy's block-based quota limits to 200 megabytes and 220 megabytes. The <code>0 0</code> for inode-based soft and hard limits indicates that they remain unset. This is required even if we're not setting any inode-based quotas.</p>
<p>Once again, use the quota command to check our work:</p>
<pre><code>sudo quota -vs sammy
&gt;Disk quotas for user sammy (uid 1000): 
&gt;     Filesystem   space   quota   limit   grace   files   quota   limit   grace
&gt;      /dev/vda1     40K    200M    220M              13       0       0
</code></pre>
<h3 id="6-generating-quota-reports"><a class="header" href="#6-generating-quota-reports">6. Generating Quota Reports</a></h3>
<p>To generate a report on current quota usage for all users on a particular filesystem, use the repquota command:</p>
<pre><code>&gt;sudo repquota -s /
&gt;Output
&gt;*** Report for user quotas on device /dev/vda1
&gt;Block grace time: 7days; Inode grace time: 7days
&gt;                        Space limits                File limits
&gt;User            used    soft    hard  grace    used  soft  hard  grace
&gt;----------------------------------------------------------------------
&gt;root      --   1696M      0K      0K          75018     0     0
&gt;daemon    --     64K      0K      0K              4     0     0
&gt;man       --   1048K      0K      0K             81     0     0
&gt;nobody    --   7664K      0K      0K              3     0     0
&gt;syslog    --   2376K      0K      0K             12     0     0
&gt;sammy     --     40K    100M    110M             13     0     0
</code></pre>
<p>In this instance we're generating a report for the / root filesystem. The <code>-s</code> command tells repquota to use human-readable numbers when possible. There are a few system users listed, which probably have no quotas set by default. Our user sammy is listed at the bottom, with the amounts used and soft and hard limits.</p>
<p>Also note the <code>Block grace time: 7days</code> callout, and the <code>grace</code> column. If our user was over the soft limit, the grace column would show how much time they had left to get back under the limit.</p>
<h3 id="7-configuring-a-grace-period-for-overages"><a class="header" href="#7-configuring-a-grace-period-for-overages">7. Configuring a Grace Period for Overages</a></h3>
<p>We can configure the period of time where a user is allowed to float above the soft limit. We use the setquota command to do so:
<code>sudo setquota -t 864000 864000 /</code></p>
<p>The above command sets both the block and inode grace times to 864000 seconds, or 10 days. This setting applies to all users, and both values must be provided even if you don't use both types of quota (block vs. inode).</p>
<blockquote>
<p>Note: The values must be specified in seconds.</p>
</blockquote>
<p>Run repquota again to check that the changes took effect:
<code>sudo repquota -s /</code></p>
<p>The changes should be reflected immediately in the repquota output.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="create-and-configure-file-systems"><a class="header" href="#create-and-configure-file-systems">Create and configure file systems</a></h2>
<h3 id="1-create-a-partition"><a class="header" href="#1-create-a-partition">1. Create a Partition</a></h3>
<p>Before creating a file system, make sure you have enough unallocated disk space (or free cylinders).</p>
<p>Check disk space: <code>sudo fdisk -l</code></p>
<p>Create a partition on the hard drive which has enough free space:</p>
<pre><code>sudo fdisk /dev/sda
&gt;Press n
&gt;Press p
&gt;Press “Enter” for default starting cylinder”
&gt;Enter 100MB+
&gt;Now Change the partition type to 83 and finally reboot the system.
</code></pre>
<h3 id="2-set-disk-label-on-the-partition"><a class="header" href="#2-set-disk-label-on-the-partition">2. Set Disk Label on the partition</a></h3>
<p>Set a disk label named <strong>datafiles</strong> for the disk partition:</p>
<pre><code>sudo e2label /dev/sda3 datafiles
# or, equally
tune2fs -L datafiles /dev/sda3
</code></pre>
<h3 id="3-create-a-filesystem"><a class="header" href="#3-create-a-filesystem">3. Create a filesystem</a></h3>
<p>In Linux, you can create filesystem using <code>mkfs</code>, <code>mkfs.ext2</code>, <code>mkfs.ext3</code>, <code>mkfs.ext4</code>, <code>mke4fs</code> or <code>mkfs.xfs</code> commands.</p>
<p>Create an ext4 filesystem on the '/dev/sda3' disk partition: <code>sudo mkfs.ext4 /dev/sda3</code></p>
<h3 id="4-mounting-a-filesystem"><a class="header" href="#4-mounting-a-filesystem">4. Mounting a Filesystem</a></h3>
<p>The most commonly used method for mounting the filesystem is either manually using <code>mount</code> command or by adding entries in <code>/etc/fstab</code> file, so that filesystem gets mounted during boot time: <code>sudo mount /dev/sda3 /data</code></p>
<p>You can verify by executing the following command:</p>
<pre><code>sudo mount | grep -i sda3
&gt;/dev/sda3 on /data type ext4 (rw)
</code></pre>
<p>You can run <code>df -h</code> or <code>lsblk</code> command to get mounted device information such as mount point, filesystem size, etc.</p>
<h3 id="5-configure-a-filesystem"><a class="header" href="#5-configure-a-filesystem">5. Configure a filesystem</a></h3>
<blockquote>
<p>Note: It is not recommend to run tune2fs on a mounted file system.</p>
</blockquote>
<p>To convert an ext2 file system to ext3, enter: <code>tune2fs -j &lt;block_device&gt;</code></p>
<p>The most commonly used options to tune2fs are:</p>
<ul>
<li><code>-c</code> (max-mount-counts), to adjust the maximum mount count between two file system checks</li>
<li><code>-C</code> (mount-count), to set the number of times the file system has been mounted</li>
<li><code>-i n[d|m|w]</code> (interval-between-checks), to adjust the maximum time between two file system checks</li>
<li><code>-m</code> (reserved-blocks-percentage), to set the percentage of reserved file system blocks</li>
<li><code>-r</code> (reserved-blocks-count) to set the number of reserved file system blocks</li>
<li><code>-L</code> (volume-label), to set the volume label of the filesystem.</li>
</ul>
<p>Use the tune2fs command to adjust various tunable file system parameters on ext2, ext3, and ext4 file systems. Current values are displayed by using the -l option: <code>tune2fs –l /dev/xvda1</code></p>
<p>Alternatively, use the dumpe2fs command to display file system parameters: <code>dumpe2fs /dev/xvda1</code></p>
<blockquote>
<p>Note: The xfs_admin command is the rough equivalent of tune2fs for XFS file systems.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="7-bonusmiscellanea---0"><a class="header" href="#7-bonusmiscellanea---0">7. Bonus/Miscellanea - 0%</a></h1>
<ul>
<li><a href="7-bonus-miscellanea/./bash.html">bash</a></li>
<li><a href="7-bonus-miscellanea/./git.html">git</a></li>
<li><a href="7-bonus-miscellanea/">vi(m)</a> (WIP)</li>
<li><a href="7-bonus-miscellanea/">tmux</a> (WIP)</li>
<li><a href="7-bonus-miscellanea/./grub.html">Repair the GRUB from live CD or USB stick</a></li>
<li><a href="7-bonus-miscellanea/./ca-certs.html">Install a CA certificate</a></li>
<li><a href="7-bonus-miscellanea/./self-signed-ssl-cert.html">Create a self-signed SSL certificate for Apache web server</a></li>
<li><a href="7-bonus-miscellanea/./tls-issues.html">Debugging TLS handshake issues</a></li>
<li><a href="7-bonus-miscellanea/./dns.html">DNS essentials</a></li>
<li><a href="7-bonus-miscellanea/./net-manager.html">Network-Manager</a></li>
<li><a href="7-bonus-miscellanea/./ssh-tunneling.html">SSH-tunneling</a></li>
<li><a href="7-bonus-miscellanea/./corrupted-chars.html">Debugging corrupted character encoding issues</a></li>
<li><a href="7-bonus-miscellanea/./mic.html">How to test a microphone</a></li>
<li><a href="7-bonus-miscellanea/./ssh-login.html">Automate login via SSH</a></li>
<li><a href="7-bonus-miscellanea/./edid.html">How to fix low screen resolution</a></li>
<li><a href="7-bonus-miscellanea/">Chroot jails</a> (WIP)</li>
<li><a href="7-bonus-miscellanea/">How to use Linux's built-in USB attack protection</a> (WIP)</li>
<li><a href="7-bonus-miscellanea/">Repair a usb drive</a> (WIP)</li>
<li><a href="7-bonus-miscellanea/">Disable ssh-login as root via PAM</a> (WIP)</li>
<li><a href="7-bonus-miscellanea/">Makefile &amp; GNU Autotools</a> (WIP)</li>
<li><a href="7-bonus-miscellanea/">Manage your dotfiles with GNU stow</a> (WIP)</li>
<li><a href="7-bonus-miscellanea/">Alpine e-mail setup</a> (WIP)</li>
<li><a href="7-bonus-miscellanea/">GPG &amp; SSH keys</a> (WIP)</li>
<li><a href="7-bonus-miscellanea/">Troubleshooting networks</a> (WIP)</li>
<li><a href="7-bonus-miscellanea/">How to handle dynamic and static libraries in Linux</a> (WIP)</li>
<li><a href="7-bonus-miscellanea/./debian.html">Non-Free Firmware for Debian</a></li>
<li><a href="7-bonus-miscellanea/./nvidia.html">How to fix Nvidia graphics card problems</a></li>
<li><a href="7-bonus-miscellanea/">Making a Linux home server sleep on idle and wake on demand</a> (WIP)</li>
</ul>
<!-- https://dgross.ca/blog/linux-home-server-auto-sleep/ --> 
<ul>
<li><a href="7-bonus-miscellanea/">Quick and easy way to recover BIOS passwords on laptops</a> (WIP)</li>
</ul>
<!-- https://bios-pw.org/# -->
<ul>
<li><a href="7-bonus-miscellanea/./optimize-linux.html">Optimize Linux</a> (WIP)</li>
<li><a href="7-bonus-miscellanea/./hostportmapping.html">Mapping Hosts and Ports Locally</a></li>
<li><a href="7-bonus-miscellanea/./tips-tricks.html">Tips &amp; tricks</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h2 id="bash"><a class="header" href="#bash">bash</a></h2>
<p>Variables have a dual nature since eache variable is also an array.</p>
<p>To define a variable, simply: <code>foo=42</code></p>
<p>To reference the value of a variable: <code>echo $foo</code></p>
<p>To remove a variable= <code>unset foo</code></p>
<p>To assign a value which contains spaces, quote it: <code>foo="x j z"</code></p>
<p>Since every variable is an array, the variable itself is an implicit reference to the first index (0), so:</p>
<pre><code>echo $foo
# equals to
echo ${foo[0]}
</code></pre>
<blockquote>
<p>Note: Wrap the variable into curly braces for variable/array manipulation.</p>
</blockquote>
<p>You can declare an array with explicitly or with parenthes:</p>
<pre><code>declare -a array_name
array_name[index_1]=value_1
array_name[index_2]=value_2
array_name[index_n]=value_n
# or
array_name=(value_1, value_2, value_n)
</code></pre>
<p>To access all elements in an array:</p>
<pre><code>echo ${array[@]}
# or
echo ${array[*]}
</code></pre>
<p>To copy an array: <code>copy=("${array[@]}")</code></p>
<blockquote>
<p>Note: double quotes are needed for values conaining white spaces.</p>
</blockquote>
<p>Special variables for grabbing arguments in functions and scripts:</p>
<pre><code>$0          # script or shell name
$[1-9]      # print the nth arg (1 &lt;= n &lt;= 9)
$#          # the number of args
$@          # all args passed
$*          # same, but with a subtle difference, see below
$?          # exit status of the previously run command (if !=0, it's an error)
$$          # PID of the current shell
$!          # PID of the most recently backgrounded process
</code></pre>
<blockquote>
<p>Note: To know if you are in a subshell: <code>echo $SHLVL</code></p>
</blockquote>
<p>bash can operate on the value of a variable while deferencing that same variable:</p>
<pre><code>foo="I'm a cat"
echo ${foo/cat/dog}
</code></pre>
<p>To replace all instances of a string: <code>echo ${foo//cat/dog}</code></p>
<blockquote>
<p>Note: a replacement operation does not modify the value of the variable.</p>
</blockquote>
<p>To delete a substring: <code>echo ${foo/cat}</code></p>
<p><code>#</code> and <code>##</code> remove the shortest and longest prefix of a variable matching a certain pattern:</p>
<pre><code>path="/usr/bin:/bin:/sbin"
echo ${path#/usr}           # prints out "/bin:/bin:/sbin"
echo ${path#*/bin}          # prints out ":/bin:/sbin"
echo ${path##*/bin}         # prints out ":/sbin"

</code></pre>
<p>Similarly, <code>%</code> is used for suffuxes.</p>
<p>bash operators operate on both strings and array, so avoid common mistakes such as:</p>
<pre><code>echo ${#array}          # wrong: prints out the length of the first element of the array (chars in a string)
echo ${#array[@]}       # right: prints out the size of the array
</code></pre>
<p>To slice strings and arrays:</p>
<pre><code>echo ${string:6:3}          # the first num is the start index, the second one is the size of slice
echo ${array[@]:3:2}
</code></pre>
<p>Existence testing operators:</p>
<pre><code>echo ${username-defualt}        # prints "default" if username var in unset
echo ${username:-defualt}       # checks both for existence and emptiness
echo ${unsetvar:=resetvar}      # like "-", but sets the var if it doesn't have a value
echo ${foo+42}                  # prints "42" if foo is set
echo ${foo?failure: no args}    # crashes the program with the given message, if the var is unset
</code></pre>
<p><code>!</code> operator is used for <strong>indirect lookup</strong> or (indirect reference):</p>
<pre><code>foo=bar
bar=42
echo ${!foo}        # print $bar, that is "42"
</code></pre>
<p>similarly, with arrays:</p>
<pre><code>letters=(a b c d e)
char=letters[1]
echo ${!char}       # prints "b"
</code></pre>
<p>As to string declaration, you can use:</p>
<ul>
<li>single quotes (<code>'</code>) for literal strings</li>
<li>double quotes (<code>"</code>) for interpolated strings</li>
</ul>
<p>Mathematical expressions can be declared as follows:</p>
<pre><code>echo $((3 + 3))
# or
((x = 3 + 3)); echo $x
</code></pre>
<p>To explicitly declare an integer variable:</p>
<pre><code>declare -i number
number=2+4*10
</code></pre>
<p>To dump textual content directly into stdin:</p>
<pre><code># a file
grep [pattern] &lt; myfile.txt
# a string
grep [pattern] &lt;&lt;&lt; "this is a string"
# a here-document
grep [pattern] &lt;&lt;EOF
first line
second line
etc
EOF
</code></pre>
<p>The notation <code>M&gt;&amp;N</code> redirects the output of channel M to channel N, e.g. to redirect stderr to stdout: <code>2&gt;&amp;1</code></p>
<blockquote>
<p>Note: in bash, <code>&amp;&gt;</code> equals to <code>2&gt;&amp;1</code>.</p>
</blockquote>
<blockquote>
<p>Note: <code>&gt;</code> is the same as <code>1&gt;</code>.</p>
</blockquote>
<p>To learn more about redirections, look <a href="7-bonus-miscellanea/../1-essential-commands/e.html">here</a>.</p>
<p>Capturing stdout can be accomplished as:</p>
<pre><code>echo `date`
# or
echo $(date)
</code></pre>
<p><strong>Process substitution</strong> involves expanding output of a command into a temporary file which can be read from a command which expects a file to be passed:</p>
<pre><code>cat &lt;(uptime)
# which works as
uptime | cat
</code></pre>
<p><code>wait</code> command waits for a PID's associated process to terminate, but without a PID it waits for all child processes to finish (e.g, it can be used after multiple processes are launched in a for loop):</p>
<pre><code>time-consuming-command &amp;
pid=$!
wait $pid
echo Process $pid finished!

for f in *.jpg
do
  convert $f ${f%.jpg}.png &amp;
done
wait
echo All images have been converted!
</code></pre>
<p><strong>Glob patterns</strong> are automatically expanded to an array of matching strings:</p>
<ul>
<li><code>*</code>, any string</li>
<li><code>?</code>, a single char</li>
<li><code>[aGfz]</code>, any char between square brackets</li>
<li><code>[a-d]</code>, any char between <code>a</code> and <code>d</code></li>
</ul>
<p><strong>Brace expansion</strong> is used to expand elements inside curly braces into a set or sequence:</p>
<pre><code>mkdir /opt/{zotero, skype, office}
# or
echo {0..10}
</code></pre>
<h3 id="control-structures"><a class="header" href="#control-structures">Control Structures</a></h3>
<p>Conditions are expressed as a command (such as <code>test</code>) whose exit status is mapped to true/false (0/non-zero):</p>
<pre><code>if http -k start
then
  echo OK
else
  echo KO
fi
# or

if [ "$1" = "-v" ]
then
  echo "switching to verbose output"
fi
</code></pre>
<blockquote>
<p>Note: An alternative syntax for <code>test [args]</code> is <code>[args]</code>.</p>
</blockquote>
<blockquote>
<p>Tip: Double brackets are safer than single brackets:</p>
</blockquote>
<pre><code>[ $a = $b ]         # will fail if one of the two variables is empty or contains a whitespace
[ "$a" = "$b" ]     # you have to double-quote them to avoid this problem
[[ $a = $b ]]       # this instead won't fail
</code></pre>
<blockquote>
<p>Tip: Additionally, double brackets support:</p>
</blockquote>
<pre><code>[[ $a = ?at ]]      # glob patterns
[[ $a &lt; $b ]]       # lexicographical comparison
[[ $a =~ ^.at ]]    # regex patterns with the operator "=~"
</code></pre>
<p>To learn more, look <a href="https://scriptingosx.com/2018/02/single-brackets-vs-double-brackets/">here</a>.</p>
<p>Iterations are declared as follows.</p>
<pre><code>while [command]; do [command]; done
# or
for [var] in [array]; do [command]; done
</code></pre>
<p>Subroutine (functions) act almost like a separate script. They can see and modify variable defined in the outer scope:</p>
<pre><code>funcion &lt;name&gt; {
  # commands
}

# or

&lt;name&gt; () {
  # commands
}
</code></pre>
<h3 id="array-syntax"><a class="header" href="#array-syntax">Array syntax</a></h3>
<pre><code>arr=()                  # creates an empty array
arr=(1 2 3)             # creates and initializes an array
${arr[2]}               # retrieves the 3rd element
${arr[@]}               # retrieves all element
${!arr[@]}              # retrieves array indices
${#arr[@]}              # get array size
arr[0]=3                # overwrites first element
arr+=(4)                # appends a value
arr=($(ls))             # saves ls output as an array of filenames
${arr[@]:s:n}           # retieves [n] elements starting at index [s]
</code></pre>
<blockquote>
<p>Note: Beware of array quirks  when using <code>@</code> vs. <code>*</code>:</p>
</blockquote>
<ul>
<li><code>*</code> combines all args into a single string, while <code>@</code> requotes the individual args</li>
<li>if the var IFS (internal field separator) is set, then elements in <code>$*</code> are separated by this deimiter value.</li>
</ul>
<h3 id="test-flag-operators"><a class="header" href="#test-flag-operators">Test flag operators</a></h3>
<pre><code># boolean conditions
-a      # &amp;&amp;
-o      # ||

# integer comparison
-eq     # "equals to"
-ne     # "not equal"
-gt     # &gt;
-ge     # &gt;=
-lt     # &lt;
-le     # &lt;=

# string comparison
=
==      # the pattern is literal if within double brackets and variables/string are within double quotes
!=
&lt;       # alphabetical order
&gt;       # must be escaped if within single brackets, e.g. "\&gt;"
-z      # string is null
-n      # string is not null

# file test

-e      # file exists
-f      # file is a regular file
-d      # is a directory
-h/-L   # is a symlink
-s      # is not zero-size
-r      # has read permissions
-w      # has write permissions
-x      # has execute permissions
-u      # SUDI bit is active
-g      # SGID bit is active
-k      # sticky bit is active
-nt/ot  # is newer/older than
</code></pre>
<p>To create a simple <a href="https://www.linux.com/training-tutorials/writing-simple-bash-script/">script</a>:</p>
<ol>
<li>put a <a href="https://en.wikipedia.org/wiki/Shebang_(Unix)">shebang</a> at the very first line: <code>#!/bin/bash</code></li>
<li>write your stuff afterwards</li>
<li>execute the script from its path (i.e <code>./script.sh</code>) or sourcing it (i.e. <code>source script.sh</code>)</li>
</ol>
<blockquote>
<p>Note: When you execute the script you are opening a new shell, type the commands in the new shell, copy the output back to your current shell, then close the new shell. Any changes to environment will take effect only in the new shell and will be lost once the new shell is closed. When you <code>source</code> the script you are typing the commands in your current shell. Any changes to the environment will take effect and stay in your current shell.</p>
</blockquote>
<blockquote>
<p>Note: source is a synonym for dot operator (i.e. '.') in bash, but not in POSIX sh, so for maximum compatibility use the period: so, <code>source filename [arguments]</code> is just like <code>. filename [arguments] </code></p>
</blockquote>
<hr />
<p>References and further reading:</p>
<ul>
<li>This refresher is mostly based on a nice <a href="http://matt.might.net/articles/bash-by-example/">guide</a> written by Matt Might.</li>
<li>You can find <a href="https://github.com/dylanaraps/pure-bash-bible">here</a> a huge collection of bash gems.</li>
<li>For the source vs dot operator, see <a href="https://ss64.com/bash/source.html">here</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h2 id="git"><a class="header" href="#git">git</a></h2>
<h2 id="general"><a class="header" href="#general">General</a></h2>
<p>Initialize a directory as a git repository hosted on GitHub:</p>
<pre><code>touch README.md
git init
git add README.md
git commit -m "first commit"
git remote add origin https://github.com/{user-name}/{repository-name}.git
git push -u origin main
</code></pre>
<p>Create a minimal configuration for git in your <code>~/.gitconfig</code>:</p>
<pre><code>[user]
    name = [username]
    email = [email-address]

# choose a difftool
[diff]
    guitool = meld

[difftool "meld"]
    cmd = meld \"$REMOTE\" \"$LOCAL\" --label \"DIFF (ORIGINAL MY)\"

# choose a mergetool
[merge]
    tool = meld

[mergetool "meld"]
    cmd = meld \"$LOCAL\" \"$MERGED\" \"$REMOTE\" --output \"$MERGED\"

# store your credentials in a plain-text file
[credential]
        helper = store --file ~/.gitcredentials

# choose a default editor
[core]
        editor = vi
</code></pre>
<p>Show all configuration settings and their location: <code>git config --show-origin --list</code></p>
<h2 id="undo"><a class="header" href="#undo">Undo</a></h2>
<p>Undo an already pushed commit recording a new commit: <code>git revert [&lt;commit&gt;]</code></p>
<p>Note that it only reverts that specific commit and not commits after that. If you want to revert a range of commits, you can do it like this:
<code>git revert [&lt;oldest_commit_hash&gt;]^..[&lt;latest_commit_hash&gt;]</code></p>
<blockquote>
<p>Note: The <code>^</code> in the previous command is required as the first end of the interval is not inclusive.</p>
</blockquote>
<p>To undo a pushed merge: <code>git revert -m 1 [&lt;merge-commit-hash&gt;]</code></p>
<p>The <code>-m 1</code> option tells Git that we want to keep the left side of the merge (which is the branch we had merged into). When you view a merge commit in the output of git log, you will see its parents listed on the line that begins with Merge:</p>
<pre><code>commit 8f937c683929b08379097828c8a04350b9b8e183
Merge: 8989ee0 7c6b236
Author: Ben James &lt;ben@example.com&gt;
Date:   Wed Aug 17 22:49:41 2011 +0100

Merge branch 'gh-pages'
</code></pre>
<p>In this situation, <code>git revert 8f937c6 -m 1</code> will get you the tree as it was in <code>8989ee0</code>, and <code>git revert -m 2</code> will reinstate the tree as it was in <code>7c6b236</code>.</p>
<p>Reverting a revert commit may seem unlikely, but it's actually common when you need for example to create a PR of a feature branch which was merged but then reverted:</p>
<pre><code># fix your code in the feature branch
$ git commit -m "fixed issues in feature-branch'

# create a new branch tracking the target branch of the PR (e.g. develop)
$ git checkout -b revert-the-revert-branch -t develop

# revert the reversion commit by its hash
# you can find find it by inspecting the changelog
# e.g.: 'git log | grep -C5 revert | head'
$ git revert &lt;revert-commit-hash&gt;

# checkout the original feature branch
$ git checkout feature-branch

# merge the revert branch into it
$ git merge revert-the-revert-branch

# resolve the eventual conflicts, commit and recreate the PR
</code></pre>
<p>To throw away not yet pushed changes in your working directory, use instead:
<code>git reset [--soft | --mixed | --hard ] [&lt;commit&gt;]</code></p>
<p><img src="https://i.stack.imgur.com/qRAte.jpg" alt="reset-ops-visually-exaplained" /></p>
<p>Typically, to discard all recent changes resetting the HEAD to the previous commit: <code>git reset --hard HEAD^</code></p>
<p>Alternatively, to reset the current local branch to a particular point in time:
<code>git reset --hard master@{"10 minutes ago"}</code></p>
<p>Remove a file from the staging area: <code>git restore --staged [&lt;filepath&gt;]</code></p>
<p>Undo modifications on the working tree (restore files from latest commited version): <code>git checkout -- index.html</code></p>
<p>Restore file from a custom commit (in current branch): <code>git checkout 6eb715d -- index.html</code></p>
<p>Remove files from the working tree and the index: <code>git rm index.html</code></p>
<p>Remove file only from the index: <code>git rm --cached index.html</code></p>
<p>If you have inadvertently pushed sensitive data or something else that you regret, you can clean up those files with <a href="https://rtyley.github.io/bfg-repo-cleaner/">BFG</a>, a faster alternative to <code>git-filter-branch</code>.</p>
<h2 id="branch"><a class="header" href="#branch">Branch</a></h2>
<p>Show all branches (including the remote ones): <code>git branch -l -a</code></p>
<p>Create and switch to a new branch:<code>git checkout -b [branchname]</code></p>
<p>Move to branch: <code>git checkout [branchname]</code></p>
<p>Checkout to new branch tracking a remote one: <code>git checkout --track origin/[branchname]</code></p>
<p>Rename branch: <code>git branch -m [branchname] [new-branchname]</code></p>
<p>Delete merged branch (only possible if not HEAD): <code>git branch -d [branch-to-delete]</code></p>
<p>Delete not merged branch: <code>git branch -D [branch-to-delete]</code></p>
<p>Delete remote branch: <code>git push origin --delete [branch-to-delete]</code></p>
<p>List branches merged into the HEAD (i.e. tip of current branch): <code>git branch --merged [branchname]</code></p>
<p>List branches that have not been merged:<code>git branch --no-merged [branchname]</code></p>
<blockquote>
<p>Note: By default this applies to only the local branches. The <code>-a</code> flag will show both local and remote branches, and the <code>-r</code> flag shows only the remote branches.</p>
</blockquote>
<p>Return to the previous branch (just as <code>cd -</code>): <code>git checkout -</code></p>
<h2 id="merge"><a class="header" href="#merge">Merge</a></h2>
<p>Merge <code>branchname</code> into the cuurent branch: <code>git merge [branchname]</code></p>
<p>Stop merge (in case of conflicts): <code>git merge --abort</code></p>
<p>Merge only one specific commit: <code>git cherry-pick [073791e7]</code></p>
<p>Review the recent history interactively choosing if deleting some of the latest commits: <code>git rebase -i HEAD~[N]</code></p>
<h2 id="stash"><a class="header" href="#stash">Stash</a></h2>
<p>Show stash history: <code>git stash list</code></p>
<p>Put a specific file into the stash: <code>git stash push -m ["welcome_cart"] [app/views/cart/welcome.html]</code></p>
<p>View the content of the most recent stash commit: <code>git stash show -p</code></p>
<p>View the content of an arbitrary stash: <code>git stash show -p stash@{1}</code></p>
<p>Extract a single file from a stash commit:</p>
<pre><code>git show stash@{0}:[full filename]  &gt;  [newfile]
git show stash@{0}:[./relative filename] &gt; [newfile]
</code></pre>
<p>Apply this stash commit on top of the working tree and remove it from the stash: <code>git stash pop stash@{0}</code></p>
<p>Apply this stash commit on top of the working tree but do not remove it: <code>git stash apply stash@{0}</code></p>
<p>Delete custom stash item: <code>git stash drop stash@{0}</code></p>
<p>Delete complete stash: <code>git stash clear</code></p>
<h2 id="log"><a class="header" href="#log">Log</a></h2>
<p>Show commit logs: <code>git log</code></p>
<blockquote>
<p>Note: git log shows the current <code>HEAD</code> and its ancestry. That is, it prints the commit <code>HEAD</code> points to, then its parent, its parent, and so on. It traverses back through the repo's ancestry, by recursively looking up each commit's parent. <code>git reflog </code>doesn't traverse <code>HEAD</code>'s ancestry at all. The <code>reflog</code> is an ordered list of the commits that <code>HEAD</code> has pointed to: it's undo history for your repo. The reflog isn't part of the repo itself (it's stored separately to the commits themselves) and isn't included in pushes, fetches or clones: it's purely local. Aside: understanding <code>reflog</code> means you can't really lose data from your repo once it's been committed. If you accidentally reset to an older commit, or rebase wrongly, or any other operation that visually "removes" commits, you can use <code>reflog</code> to see where you were before and <code>git reset --hard</code> back to that ref to restore your previous state. Remember, refs imply not just the commit but the entire history behind it. (<a href="https://stackoverflow.com/a/17860179/9109880">source</a>)</p>
</blockquote>
<p>Show only custom commits:</p>
<pre><code>git log --author="Sven"
git log --grep="Message"
git log --until=2013-01-01
git log --since=2013-01-01
</code></pre>
<p>Show stats and summary of commits: <code>git log --stat --summary</code></p>
<p>Show history of commits as graph-summary: <code>git log --oneline --graph --all --decorate</code></p>
<p>A nice <a href="https://stackoverflow.com/a/9074343/9109880">trick</a> is to add some aliases in your <code>~/.gitconfig</code> for using <code>git log</code> with a good combination of options, like:</p>
<pre><code>[alias]
lg1 = log --graph --abbrev-commit --decorate --format=format:'%C(bold blue)%h%C(reset) - %C(bold green)(%ar)%C(reset) %C(white)%s%C(reset) %C(dim white)- %an%C(reset)%C(bold yellow)%d%C(reset)' --all
lg2 = log --graph --abbrev-commit --decorate --format=format:'%C(bold blue)%h%C(reset) - %C(bold cyan)%aD%C(reset) %C(bold green)(%ar)%C(reset)%C(bold yellow)%d%C(reset)%n''          %C(white)%s%C(reset) %C(dim white)- %an%C(reset)' --all
lg = !"git lg1"
</code></pre>
<p>Followh the commit history of a single file: <code>git log --oneline -M --stat --follow -- src/somefile.ts</code></p>
<h2 id="compare"><a class="header" href="#compare">Compare</a></h2>
<p>See lastest changes in a file: <code>git diff [filename]</code></p>
<p>Compare modified files and highlight changes only: <code>git diff --color-words [filename]</code></p>
<p>Compare modified files within the staging area: <code>git diff --staged [filename]</code></p>
<p>Compare branches showing differences line by line: <code>git diff [branch1]..[branch2]</code></p>
<blockquote>
<p>Note: This command combined with the two-dot operator will show you all the commits that “branch2” has that are not in “branch1”. While if used with three dots it will compare the top of the right branch with the common ancestor of the two branches (see <a href="https://devconnected.com/how-to-compare-two-git-branches/">here</a>).</p>
</blockquote>
<p>Compare lines in a file bewtween two branches:
<code>git diff [mybranch]..[master] -- [myfile.cs]</code></p>
<p>Get only the name of the files which are different in the two branches:
<code>git diff –-name-only [mybranch]..[master]</code></p>
<p>To see the commit differences between two branches, use <code>git log</code> and specify the branches that you want to compare.
<code>git log [branch1]..[branch2]</code></p>
<blockquote>
<p>Note: This won't show you the actual file differences between the two branches but only the commits.</p>
</blockquote>
<p>Compare commits:</p>
<pre><code>git diff 6eb715d
git diff 6eb715d..HEAD
git diff 6eb715d..537a09f
</code></pre>
<p>Compare commits of file:</p>
<pre><code>git diff 6eb715d [filename]
git diff 6eb715d..537a09f [filename]
</code></pre>
<p>Compare without caring about whitespaces:</p>
<pre><code>git diff -b 6eb715d..HEAD
git diff --ignore-space-change 6eb715d..HEAD
</code></pre>
<p>This ignores differences even if one line has whitespace where the other line has none:</p>
<pre><code>git diff -w 6eb715d..HEAD
git diff --ignore-all-space 6eb715d..HEAD
</code></pre>
<p>Show what revision and author last modified each line of a file: <code>git blame -L10,+1 [filename]</code></p>
<h2 id="collaborate"><a class="header" href="#collaborate">Collaborate</a></h2>
<p>Clone: <code>git clone https://github.com/user/project.git</code></p>
<p>Clone to local folder: <code>git clone https://github.com/user/project.git ~/dir/folder</code></p>
<p>Get everything ready to commit: <code>git add .</code></p>
<p>Get custom file ready to commit: <code>git add index.html</code></p>
<p>Commit changes: <code>git commit -m "Message"</code></p>
<p>Commit changes with title and description: <code>git commit -m "Title" -m "Description..."</code></p>
<p>Add and commit in one step: <code>git commit -a -m "Message"</code></p>
<p>Rewrite the most recent <strong>not-pushed</strong> commit message: <code>git commit --amend -m "New Message"</code></p>
<p>If the commit was pushed, it will take more steps to rewrite it:</p>
<ul>
<li>use <code>git rebase -i HEAD~n</code> to display a list of the last nn commits in your default text editor</li>
<li>replace <code>pick</code> with <code>reword</code> before each commit message that needs to be changed</li>
<li>save and close the commit list file</li>
<li>in each resulting commit file, type the new commit message, save the file, and close it</li>
<li>force push the amended commits using <code>git push --force</code>.</li>
</ul>
<p>Fetch all changes from the remote and remove deleted branches: <code>git fetch -a -p</code></p>
<p>Push to a branch and set it as the default upstream: <code>git push -u origin [master]</code></p>
<p>Pull a specific branch: <code>git pull origin [branchname]</code></p>
<p>Resolve conflicts after attempted merge by means of a mergetool (see the config file above in the 'General' section): <code>git mergetool</code></p>
<p>Sync a fork with original repository:</p>
<pre><code class="language-bash"># Add a new remote repository with 'upstream' alias
git remote add upstream https://github.com/ORIGINAL_OWNER/ORIGINAL_REPOSITORY.git
# Sync your fork
git fetch upstream
git checkout master
git merge upstream/master
</code></pre>
<h2 id="ignore"><a class="header" href="#ignore">Ignore</a></h2>
<p>Add a <code>.gitignore</code> file at the root of the repository to instruct git to not track specific file types or filepaths: <code>vi .gitignore</code></p>
<p>You can create your own file from an online template generator: https://www.toptal.com/developers/gitignore</p>
<p>To check what gitignore rule is causing a particular path to be ignored, run git check-ignore:
<code>git check-ignore -v [path/to/check]</code></p>
<h2 id="signing-commits"><a class="header" href="#signing-commits">Signing commits</a></h2>
<p>Sign individual commits with:</p>
<ul>
<li><code>git commit -s [..]</code>, to add a <code>Signed-off-by</code> trailer by the committer at the end of the commit log message,</li>
<li><code>git commit -S [&lt;keyid&gt;] [..]</code>, to sign the commit with a GPG key.</li>
</ul>
<p>For the second option you will need to upload the public key to your git hosting service (e.g. GitHub) and configure git locally to use a default key:</p>
<pre><code>git config [--global] user.signingkey &lt;keyid&gt;
git config [--global] commit.gpgsign true
</code></pre>
<p>To retrieve the id of an existing GPG key, run: <code>gpg --list-secret-keys --keyid-format LONG</code>. The key id is the alphanumeric string after the string <code>sec rsaXXXX/</code> in the command output. Then you can use hte id to print out the public key: <code>gpg --armor --export &lt;keyid&gt;</code>.</p>
<h2 id="archive"><a class="header" href="#archive">Archive</a></h2>
<p>Create a zip-archive: <code>git archive --format zip --output filename.zip master</code></p>
<h2 id="security"><a class="header" href="#security">Security</a></h2>
<p>To encrypt your private data inside a git repo: https://git-secret.io/</p>
<h2 id="large-file-storage"><a class="header" href="#large-file-storage">Large File Storage</a></h2>
<p>To version large files (.wav, .pdf, etc) in a git repository: https://git-lfs.github.com/ (it's not free)</p>
<h2 id="add-current-branch-name-to-bash-prompt"><a class="header" href="#add-current-branch-name-to-bash-prompt">Add current branch name to bash prompt</a></h2>
<p>Put the following lines in your <code>.bashrc</code>:</p>
<pre><code>parse_git_branch() {
    git branch 2&gt; /dev/null | sed -e '/^[^*]/d' -e 's/* \(.*\)/(\1)/'
}

export PS1='\[\e]0;\u@\h: \w\a\]\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\e[91m\]$(parse_git_branch)\[\033[00m\]\$ '
</code></pre>
<p>This should modify the prompt as follows:</p>
<p><img src="7-bonus-miscellanea/../../assets/img/git-branch-name-bash-prompt.png" alt="git-branch-name-bash-prompt" /></p>
<p><a href="https://wiki.archlinux.org/title/Bash/Prompt_customization">PS1</a> is the primary prompt (in bash) which is displayed before each command, thus it is the one most people customize. In the lines above PS1 is set to a string composed of <a href="https://misc.flogisoft.com/bash/tip_colors_and_formatting">backslash-escaped characters</a> that are expanded dynamically every time the prompt shows up.</p>
<blockquote>
<p>Warning: Using double quotes  (<code>"</code>) instead of single quotes (<code>'</code>) will result in the function <code>parse_git_branch</code> to be evaluated only once (when you first enter the git dir).</p>
</blockquote>
<hr />
<h3 id="resources-to-learn-more"><a class="header" href="#resources-to-learn-more">Resources to learn more:</a></h3>
<ol>
<li><a href="https://learngitbranching.js.org/">Learn Git Branching</a></li>
<li><a href="https://git-scm.com/book/en/v2">Pro Git</a></li>
<li><a href="https://ohshitgit.com/">Oh Shit, Git!?!</a></li>
<li><a href="https://gist.github.com/hofmannsven/6814451">Git Cheatsheet</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h2 id="repair-the-grub-from-live-cd-or-usb-stick"><a class="header" href="#repair-the-grub-from-live-cd-or-usb-stick">Repair the GRUB from live CD or USB stick</a></h2>
<ol>
<li>
<p>Insert the bootable device and boot into <em>Try Ubuntu</em> mode</p>
</li>
<li>
<p>Find out you root partition by typing: <code>sudo fdisk -l</code> or <code>sudo blkid</code></p>
</li>
<li>
<p>Mount you main partition: <code>sudo mount [/dev/sda2] /mnt</code></p>
</li>
</ol>
<blockquote>
<p>Note: If you have separate partitions for /boo, /var and /usr, repeat steps 2 and 3 to mount them to /mnt/boot, /mnt/var and /mnt/usr respectively</p>
</blockquote>
<ol start="4">
<li>Bind-mount pseudo-filesystems: <code>for i in /sys /proc /run /dev; do sudo mount --bind "$i" "/mnt/"$i"; done</code></li>
</ol>
<blockquote>
<p>Note: A <strong>bind mount</strong> is an alternate view of a directory tree. Classically, mounting creates a view of a storage device as a directory tree. A bind mount instead takes an existing directory tree and replicates it under a different point. The directories and files in the bind mount are the same as the original.</p>
</blockquote>
<ol start="5">
<li>
<p>If Ubuntu was installed in EFI mode, use <code>sudo fdisk -l | grep -i efi</code> to find your EFI partition and then mount it: <code>sudo mount [/dev/sda1] /mnt/boot/efi</code></p>
</li>
<li>
<p><code>sudo chroot /mnt</code></p>
</li>
<li>
<p><code>update-grub</code></p>
</li>
</ol>
<p>If this doesnt't fix the GRUB, go on:</p>
<ol start="8">
<li>
<p><code>grub-install /dev/sda; update-grub</code></p>
</li>
<li>
<p>I fthe EFI partition ha changed, you may need to update it in /etc/fstab accordingly</p>
</li>
<li>
<p><code>sudo reboot</code></p>
</li>
<li>
<p>At this point, you should be able to boot normally (remember to unplug the bootable media).</p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h2 id="install-a-ca-certificate"><a class="header" href="#install-a-ca-certificate">Install a CA certificate</a></h2>
<p>The <strong>PEM</strong> (originally, <em>Privacy Enhanced Mail</em>) format is the de facto file format for storing and sending cryptographic keys, certificates and other sensitive data:</p>
<pre><code>-----BEGIN [label]-----
[base64-encoded binary data]
-----END [label]-----
</code></pre>
<p>PEM data is commonly stored in files with a <code>.pem</code> suffix, a <code>.cer</code> or <code>.crt</code> suffix (for certificates), or a <code>.key</code> suffix (for public or private keys). The label inside a PEM file ("CERTIFICATE", "CERTIFICATE REQUEST", "PRIVATE KEY" and "X509 CRL") represents the type of the data more accurately than the file suffix, since many different types of data can be saved in a <code>.pem</code> file:</p>
<p>A PEM file may contain multiple instances. For instance, an operating system might provide a file containing a list of trusted CA certificates, or a web server might be configured with a "chain" file containing an end-entity certificate plus a list of intermediate certificates.</p>
<blockquote>
<p>Note: A certification authority (<strong>CA</strong>) is an entity that issues digital certificates (usually encoded in <strong>X.509</strong> standard). A CA acts as a trusted third party—trusted both by the subject (owner) of the certificate and by the party relying upon the certificate.</p>
</blockquote>
<blockquote>
<p>Note: X.509 is a series of standards, while PEM is just X.509 object representation in a file (encoding). Literally any data can be represented in PEM format. Anything that can be converted to a byte array (and anything can be, because RAM is a very large byte array) can be represented in PEM format.</p>
</blockquote>
<p>To install a new CA certificate in a server:</p>
<ol>
<li>
<p>Get the root certificate in PEM format and name it with a .crt file extension.</p>
</li>
<li>
<p>Add the .crt file to the folder /usr/local/share/ca-certificates/.</p>
</li>
<li>
<p>Run: <code>update-ca-certificates</code></p>
</li>
<li>
<p>Check if the .crt file has been concatenated to /etc/ssl/certs/ca-certificates.crt.</p>
</li>
</ol>
<p>You can import CA certificates in one line by running:</p>
<pre><code>sudo bash -c "echo -n | openssl s_client -showcerts -connect ${hostname}:${port} \
2&gt;/dev/null | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' \
&gt;&gt; `curl-config --ca`"
</code></pre>
<blockquote>
<p>Note: You may need to install the following package: ``sudo apt-get install libcurl4-openssl-dev`</p>
</blockquote>
<p>Chances are that you will face common issues like <code>server certificate verification failed. CAfile: /etc/ssl/certs/ca-certificates.crt CRLfile: none</code> when cloning a repository.</p>
<p>To solve such problems, first make sure first that you have certificates installed in /etc/ssl/certs.</p>
<p>If not, reinstall them: <code>sudo apt-get install --reinstall ca-certificates</code></p>
<p>Since that package does not include root certificates, add them:</p>
<pre><code>sudo mkdir /usr/local/share/ca-certificates/cacert.org
sudo wget -P /usr/local/share/ca-certificates/cacert.org http://www.cacert.org/certs/root.crt http://www.cacert.org/certs/class3.crt
sudo update-ca-certificates
</code></pre>
<p>Make sure your git configuration does reference those CA certs: <code>git config --global http.sslCAinfo /etc/ssl/certs/ca-certificates.crt</code></p>
<p>Alternatively, to temporarily disable SSL: <code>git config --global http.sslverify false</code></p>
<blockquote>
<p>Note: Another cause of this problem might be that your clock might be off. Certificates are time sensitive. You might consider installing NTP to automatically sync the system time with trusted internet timeservers from the global NTP pool (see NTP <a href="7-bonus-miscellanea/../4-networking/f.html">guide</a> in this repo).</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h2 id="create-a-self-signed-ssl-certificate-for-apache-web-server"><a class="header" href="#create-a-self-signed-ssl-certificate-for-apache-web-server">Create a self-signed SSL certificate for Apache web server</a></h2>
<ol>
<li>Prerequisites:</li>
</ol>
<pre><code>sudo apt install apache2
sudo ufw allow "Apache Full"
sudo a2enmod ssl
sudo systemctl restart apache2
</code></pre>
<ol start="2">
<li>Generate the certificate:
<code>sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout [/etc/ssl/private/apache-selfsigned.key] -out [/etc/ssl/certs/apache-selfsigned.crt]</code></li>
</ol>
<blockquote>
<p>Note: <code>-nodes</code> is for skipping passphrase, <code>-keyout</code> is for the private key destination, while <code>-out</code> for the certificate destination.</p>
</blockquote>
<ol start="3">
<li>Configure Apache to use SSL:
<code>vi /etc/apache2/sites-available/[your-domain-or-ip].conf</code></li>
</ol>
<p>Insert into it:</p>
<pre><code>&lt;Virtual Host *:443&gt;
    ServerName [your-domain-or-ip]
    DocumentRoot [/var/www/your-domain-or-ip]

    SSLEngine on
    SSLCertificateFile [/etc/ssl/certs/apache-selfsigned.crt]
    SSLCertificateKeyFIle [/etc/ssl/private/apache-selfsigned.key]
&lt;/Virtual Host&gt;
</code></pre>
<blockquote>
<p>Note: <code>ServerName</code> must match the <strong>Common Name</strong> you choose when creating the certificate.</p>
</blockquote>
<ol start="4">
<li>Add a stub web page:</li>
</ol>
<pre><code>mkdir [/var/www/your-domain-or-ip]
echo "&lt;h1&gt;it worked&lt;/h1&gt;" &gt; /var/www/[your-domain-or-ip]/index.html
</code></pre>
<ol start="5">
<li>Enable the configuration:</li>
</ol>
<pre><code>sudo a2ensite [your-domain-or-ip].conf
sudo apache2ctl configtest
# if it prints out "syntax ok"
sudo systemctl reload apache2
</code></pre>
<ol start="6">
<li>
<p>Try to connect to your site with a browser: you should receive a warning since your certificate is not signed by any of its known certificate authorities.</p>
</li>
<li>
<p>Redirect http to https, adding to <code>[your-domain-or-ip].conf</code>:</p>
</li>
</ol>
<pre><code>&lt;Virtual Host *:80&gt;
    ServerName [your-domain-or-ip]
    Redirect / https://[your-domain-or-ip]/
&lt;/Virtual Host&gt;
</code></pre>
<ol start="8">
<li>Re-test your configuration an restart apache daemon:</li>
</ol>
<pre><code>sudo apache2ctl configtest
sudo systemctl reload apache2
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="debugging-tls-handshake-issues"><a class="header" href="#debugging-tls-handshake-issues">Debugging TLS handshake issues</a></h2>
<p>TLS handshakes are a mechanism by which a client and server establish the trust and logistics required to secure their connection over the network.</p>
<blockquote>
<p>Note: <strong>SSL</strong> is now-deprecated predecessor of <strong>TLS</strong>, but some people still tend to refer to the current implementation of the protocol with <em>SSL</em> for historical reasons.</p>
</blockquote>
<p>This is a very orchestrated procedure and understanding the details of this can help understand why it often fails, which we intend to cover in the next section.</p>
<p>Typical steps in an TLS handshake are:</p>
<ul>
<li>Client provides a list of possible TLS version and cipher suites to use</li>
<li>Server agrees on a particular TLS version and cipher suite, responding back with its certificate</li>
<li>Client extracts the public key from the certificate responds back with an encrypted “pre-master key”</li>
<li>Server decrypts the “pre-master key” using its private key</li>
<li>Client and server compute a “shared secret” using the exchanged “pre-master key”</li>
<li>Client and server exchange messages confirming the successful encryption and decryption using the “shared secret”</li>
</ul>
<p>While most of the steps are the same for any SSL handshake, there is a subtle difference between one-way and two-way TLS: in the latter both the client and server must present and accept each other's public certificates before a successful connection can be established.</p>
<p>If you have issues with TLS handshakes while trying to comunicate with a server from a client app, e.g. a Java application, first find out what the server supports:
<code>nmap --script ssl-enum-ciphers -p 443 my.server.com</code></p>
<p>To see then what your JVM supports, try to run you app with the VM argument <code>-Djavax.net.debug=ssl:handshake:verbose</code></p>
<p>Comparing the outputs, you could see that the server and the JVM share some cipher suites, but they fail to agree on the TLS version. You can then either configure the server to support a cipher suite and the protocol version that the JVM supports too or instruct the JVM to use what the server expects: e.g you can run your Java application with a specific TLS version by means of <code>-Dhttps.protocols=TLSv1.2</code>.</p>
<hr />
<h3 id="tls-handshake-failures-in-java"><a class="header" href="#tls-handshake-failures-in-java">TLS handshake failures in Java</a></h3>
<p>Private and public keys are used in asymmetric encryption. A public key can have an associated certificate. A certificate is a document that verifies the identity of the person, organization or device claiming to own the public key. A certificate is typically digitally signed by the verifying party as proof.</p>
<p>In most cases, we use a keystore and a truststore when our application needs to communicate over SSL/TLS.</p>
<p>In disussions about Java the two terms like <em>keystore</em> and <em>truststore</em> are often used interchangeably since the same file can act as keystore as well as truststore: it's just a matter of pointing <code>javax.net.ssl.keyStore</code> and <code>javax.net.ssl.trustStore</code> properties to that file but there is a difference between keystore and truststore. Generally speaking, keystores hold keys that our application owns that we can use to prove the integrity of a message and the authenticity of the sender, say by signing payloads. A truststore is the opposite – while a keystore typically holds onto certificates that identify us, a truststore holds onto certificates that identify others.</p>
<p>Usually, these are password-protected files that sit on the same file system as our running application. The default format used for these files is <strong>JKS</strong> until Java 8.</p>
<p>Since Java 9, though, the default keystore format is PKCS12. The biggest difference between JKS and <strong>PKCS12</strong> is that JKS is a format specific to Java, while PKCS12 is a standardized and language-neutral way of storing encrypted private keys and certificates.</p>
<p>Not only Java, but also Web browsers and and application servers (e.g. Tomcat) have a truststore which collects CA certificates which is queried each time a SSL/TLS connection is established: if the server doesn't respond with a certificate issued by a recognized authority an exception is thrown (e.g javax.net.ssl.SSLHandshakeException). If you trust its certificate nevertheless, you can import it into the client truststore. For example, Java has bundled a truststore called <strong>cacerts</strong> and it resides in the <strong>$JAVA_HOME/jre/lib/security</strong> directory:</p>
<ol>
<li>
<p>get the root certificate in PEM format</p>
</li>
<li>
<p>convert it to the DER format: <code>openssl x509 -in [ca.pem] -inform pem -out [ca.der] -outform der</code></p>
</li>
<li>
<p>validate the root certificate content: <code>keytool -v -printcert -file [ca.cert]</code></p>
</li>
<li>
<p>import the root certificate into the JVM truststore:
<code>keytool -importcert -alias [startssl] -keystore $JAVA_HOME/jre/lib/security/cacerts -storepass [changeit] -file [ca.der]</code></p>
</li>
</ol>
<blockquote>
<p>Note: <code>changeit</code> is the default password for the JVM truststore, you should use a new one for a application deployed in production.</p>
</blockquote>
<ol start="5">
<li>verify that the root certificate has been imported:
<code>keystore -keystore $JAVA_HOME/jre/lib/security/cacerts -storepass [changeit] -list | grep [startssl]</code></li>
</ol>
<p>You can learn more on the most frequent handshake failure scenarios in Java <a href="https://www.baeldung.com/java-ssl-handshake-failures">here</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="how-dns-works"><a class="header" href="#how-dns-works">How DNS Works</a></h2>
<p>DNS is a global system for translating IP addresses to human-readable domain names. When a user tries to access a web address like "example.com", their web browser or application performs a DNS Query against a DNS server, supplying the hostname. The DNS server takes the hostname and resolves it into a numeric IP address, which the web browser can connect to.</p>
<p>A component called a DNS Resolver is responsible for checking if the hostname is available in local cache, and if not, contacts a series of DNS Name Servers, until eventually it receives the IP of the service the user is trying to reach, and returns it to the browser or application. This usually takes less than a second.</p>
<h2 id="dns-types-3-dns-query-types"><a class="header" href="#dns-types-3-dns-query-types">DNS Types: 3 DNS Query Types</a></h2>
<p>There are three types of queries in the DNS system:</p>
<ul>
<li>Recursive Query</li>
</ul>
<blockquote>
<p>In a recursive query, a DNS client provides a hostname, and the DNS Resolver "must" provide an answer—it responds with either a relevant resource record, or an error message if it can't be found. The resolver starts a recursive query process, starting from the DNS Root Server, until it finds the Authoritative Name Server (for more on Authoritative Name Servers see DNS Server Types below) that holds the IP address and other information for the requested hostname.</p>
</blockquote>
<ul>
<li>Iterative Query</li>
</ul>
<blockquote>
<p>In an iterative query, a DNS client provides a hostname, and the DNS Resolver returns the best answer it can. If the DNS resolver has the relevant DNS records in its cache, it returns them. If not, it refers the DNS client to the Root Server, or another Authoritative Name Server which is nearest to the required DNS zone. The DNS client must then repeat the query directly against the DNS server it was referred to.</p>
</blockquote>
<ul>
<li>Non-Recursive Query</li>
</ul>
<blockquote>
<p>A non-recursive query is a query in which the DNS Resolver already knows the answer. It either immediately returns a DNS record because it already stores it in local cache, or queries a DNS Name Server which is authoritative for the record, meaning it definitely holds the correct IP for that hostname. In both cases, there is no need for additional rounds of queries (like in recursive or iterative queries). Rather, a response is immediately returned to the client.</p>
</blockquote>
<h2 id="dns-types-3-types-of-dns-servers"><a class="header" href="#dns-types-3-types-of-dns-servers">DNS Types: 3 Types of DNS Servers</a></h2>
<p>The following are the most common DNS server types that are used to resolve hostnames into IP addresses:</p>
<ul>
<li>DNS Resolver</li>
</ul>
<blockquote>
<p>A DNS resolver (recursive resolver), is designed to receive DNS queries, which include a human-readable hostname such as "www.example.com", and is responsible for tracking the IP address for that hostname</p>
</blockquote>
<ul>
<li>DNS Root Server</li>
</ul>
<blockquote>
<p>The root server is the first step in the journey from hostname to IP address. The DNS Root Server extracts the Top Level Domain (TLD) from the user's query — for example, www.example.com —... provides details for the .com TLD Name Server. In turn, that server will provide details for domains with the .com DNS zone, including "example.com".</p>
</blockquote>
<blockquote>
<p>There are 13 root servers worldwide, indicated by the letters A through M, operated by organizations like the Internet Systems Consortium, Verisign, ICANN, the University of Maryland, and the U.S. Army Research Lab.</p>
</blockquote>
<ul>
<li>Authoritative DNS Server</li>
</ul>
<blockquote>
<p>Higher level servers in the DNS hierarchy define which DNS server is the "authoritative" name server for a specific hostname, meaning that it holds the up-to-date information for that hostname.</p>
</blockquote>
<blockquote>
<p>The Authoritative Name Server is the last stop in the name server query—it takes the hostname and returns the correct IP address to the DNS Resolver (or if it cannot find the domain, returns the message NXDOMAIN).</p>
</blockquote>
<h2 id="dns-types-10-top-dns-record-types"><a class="header" href="#dns-types-10-top-dns-record-types">DNS Types: 10 Top DNS Record Types</a></h2>
<p>DNS servers create a DNS record to provide important information about a domain or hostname, particularly its current IP address. The most common DNS record types are:</p>
<ul>
<li>Address Mapping record (A Record)—also known as a DNS host record, stores a hostname and its corresponding IPv4 address.</li>
<li>IP Version 6 Address record (AAAA Record)—stores a hostname and its corresponding IPv6 address.</li>
<li>Canonical Name record (CNAME Record)—can be used to alias a hostname to another hostname. When a DNS client requests a record that contains a CNAME, which points- to another hostname, the DNS resolution process is repeated with the new hostname.</li>
<li>Mail exchanger record (MX Record)—specifies an SMTP email server for the domain, used to route outgoing emails to an email server.</li>
<li>Name Server records (NS Record)—specifies that a DNS Zone, such as "example.com" is delegated to a specific Authoritative Name Server, and provides the address- of the name server.</li>
<li>Reverse-lookup Pointer records (PTR Record)—allows a DNS resolver to provide an IP address and receive a hostname (reverse DNS lookup).</li>
<li>Certificate record (CERT Record)—stores encryption certificates—PKIX, SPKI, PGP, and so on.</li>
<li>Service Location (SRV Record)—a service location record, like MX but for other communication protocols.</li>
<li>Text Record (TXT Record)—typically carries machine-readable data such as opportunistic encryption, sender policy framework, DKIM, DMARC, etc.</li>
<li>Start of Authority (SOA Record)—this record appears at the beginning of a DNS zone file, and indicates the Authoritative Name Server for the current DNS zone,- contact details for the domain administrator, domain serial number, and information on how frequently DNS information for this zone should be refreshed.</li>
</ul>
<h2 id="dns-can-do-much-more"><a class="header" href="#dns-can-do-much-more">DNS Can Do Much More</a></h2>
<p>Now that's we've covered the major types of traditional DNS infrastructure, you should know that DNS can be more than just the "plumbing" of the Internet. Advanced DNS solutions can help do some amazing things, including:</p>
<ul>
<li>Global server load balancing (GSLB): fast routing of connections between globally distributed data centers</li>
<li>Multi CDN: routing users to the CDN that will provide the best experience</li>
<li>Geographical routing: identifying the physical location of each user and ensuring they are routed to the nearest possible resource</li>
<li>Data center and cloud migration: moving traffic in a controlled manner from on-premise resources to cloud resources</li>
<li>Internet traffic management: reducing network congestion and ensuring traffic flows to the appropriate resource in an optimal manner</li>
</ul>
<h2 id="dns-search-domains"><a class="header" href="#dns-search-domains">DNS search domains</a></h2>
<p>A search domain is a domain used as part of a domain search list. The domain search list, as well as the local domain name, is used by a resolver to create a fully qualified domain name (FQDN) from a relative name. For this purpose, the local domain name functions as a single-item search list.</p>
<p>DNS search domains are used to go from a machine name to a Fully Qualified Domain Name.</p>
<p>DNS searches can only look at a Fully Qualified Domain Name, such as <em>mymachine.example.com</em>. But, it's a pain to type out <em>mymachine.example.com</em>, you want to be able to just type mymachine.</p>
<p>Using Search Domains is the mechanism to do this. If you type a name that does not end with a period, it knows it needs to add the search domains for the lookup. So, lets say your Search Domains list was: <em>example.org, example.com</em>.</p>
<p>With <em>mymachine</em> it would try first <em>mymachine.example.org</em>, not find it, then try <em>mymachine.example.com</em>, found it, now done.</p>
<p>With <em>mymachine.example.com</em> it would try <em>mymachine.example.com.example.org</em> (remember, it doesn't end with a period, still adds domains), fail, then <em>mymachine.example.com.example.com</em>, not find it, fall back to <em>mymachine.example.com</em>, found it, now done.</p>
<p><em>mymachine.example.com.</em> ends with a period, no searching, just do <em>mymachine.example.com</em>.</p>
<p>So, if you have your own DNS domain such as <em>example.com</em>, put it there. If not, ignore it. It really is more corporate than a home setting.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="network-manager"><a class="header" href="#network-manager">Network-Manager</a></h2>
<p>The point of <strong>NetworkManager</strong> is to make networking configuration and setup as painless and automatic as possible. If using DHCP, NetworkManager is intended to replace default routes, obtain IP addresses from a DHCP server and change nameservers whenever it sees fit. In effect, the goal of NetworkManager is to make networking Just Work.</p>
<p>The computer should use the wired network connection when it's plugged in, but automatically switch to a wireless connection when the user unplugs it and walks away from the desk. Likewise, when the user plugs the computer back in, the computer should switch back to the wired connection. The user should, most times, not even notice that their connection has been managed for them; they should simply see uninterrupted network connectivity.</p>
<p>NetworkManager is composed of two layers:</p>
<ul>
<li>a daemon running as root: <code>network-manager</code>.</li>
<li>a front-end: <code>nmcli</code> and <code>nmtui</code> (enclosed in package network-manager), <code>nm-tray</code>, <code>network-manager-gnome</code> (<code>nm-applet</code>), <code>plasma-nm</code>.</li>
</ul>
<p>Start network manager: <code>sudo systemctl start network-manager</code></p>
<p>Enable starting the network manager when the system boots: <code>sudo systemctl enable network-manager</code></p>
<p>Depending on the Netplan backend in use (desktop or server:
<code>sudo systemctl [start|restart|stop|status] [network-manager|system-networkd]</code></p>
<p>Use <code>nmcli</code> to manage the former, and <code>networkctl</code> for the latter.</p>
<p>Establish a wifi connection:</p>
<pre><code>nmcli d                                           # determine the name of the wifi interface
nmcli r wifi on                                   # make sure wifi radio is on
nmcli d wifi list                                 # list available wifi connections
nmcli d wifi connect &lt;some-wifi&gt; password &lt;pwd&gt;   # connect to an access point
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="ssh-tunneling"><a class="header" href="#ssh-tunneling">SSH-tunneling</a></h2>
<p>SSH-tunneling (or port forwarding, PF) is a method for creating an encrypted SSH connection between a client and a server machine through which services port can be relayed. There are three types of SSH-tunneling:</p>
<ul>
<li>local (<strong>LPF</strong>), allows you to forward a port on the local (ssh client) machine to a port on the remote (ssh server) machine, which is then forwarded to a port on the destination machine, and is mostly used to connect to a service (e.g. a database) available on an internal network</li>
<li>remote (<strong>RPF</strong>), allows you to forward a port on the remote (ssh server) machine to a port on the local (ssh client) machine, which is then forwarded to a port on the destination machine, and is often used to give access to an internal service to someone from the outside (e.g. to show a preview of a webappp hosted on your local machine to your colleague)</li>
<li>dynamic (<strong>DPF</strong>), allows you to create a socket on the local (ssh client) machine, which acts as a SOCKS proxy server.</li>
</ul>
<h3 id="local-port-forwarding-lpf"><a class="header" href="#local-port-forwarding-lpf">Local Port-Forwarding (LPF)</a></h3>
<p>To create a LPF:</p>
<pre><code>ssh -L [local-ip:]local-port:destination-ip:destination-port [user@]ssh-server
# if local-ip is omitted, it defaults to localhost

# e.g
# ssh -L 3336:db-hostname:3336 user@intermediate-host

# but if the destination host is the same as the ssh server used to access it, simply
# ssh -L 3336:localhost:3336 -N -f user@db-hostname
# -L, specifies that connections to the given TCP port or Unix socket on the local (client) host are to be forwarded to the given host and port, or Unix socket, on the remote side
# -N, disallows execution of remote commands, useful for just forwarding ports
# -f, forks the process to background
</code></pre>
<blockquote>
<p>Note: Make sure 'AllowTcpForwarding' is <strong>not</strong> set to 'no' in the remote ssh server configuration.</p>
</blockquote>
<h3 id="remote-port-forwarding-rpf"><a class="header" href="#remote-port-forwarding-rpf">Remote Port-Forwarding (RPF)</a></h3>
<p>To create a RPF:</p>
<pre><code>ssh -R [remote-ip:]remote-port:dest-ip:dest-port [user@]ssh-server
# e.g.
# ssh -R 8080:localhost:3000 -N -f user@ssh-server-ip
# -R, specifies that connections to the given TCP port or Unix socket on the remote (server) host are to be forwarded to the local side
# -N, disallows execution of remote commands, useful for just forwarding ports
# -f, forks the process to background
</code></pre>
<p>The ssh server will listen on 8080, tunneling all traffic from this port to your local port 3000, so that your colleagues can access your webapp at ssh-server-ip:8080.</p>
<blockquote>
<p>Note: Make sure 'GatewayPorts' is set to 'yes' in the remote ssh server configuration.</p>
</blockquote>
<h3 id="dynamic-port-forwarding-dpf"><a class="header" href="#dynamic-port-forwarding-dpf">Dynamic Port-Forwarding (DPF)</a></h3>
<p>In this configuration, the SSH server acts as a SOCKS proxy, relaying all relevant traffic (including DNS name resolution) through the SSH connection. This is particularly useful when the client is on a network with limited access to the internet, for example, due to a VPN filtering your traffic (e.g. music streaming services suc as YouTube).</p>
<p>For this to happen, the client (e.g. a browser) needs to be SOCKS-aware.</p>
<p>To create a DPF:</p>
<pre><code>ssh -D local-port -q -C -N -f [user@]ssh-server

# e.g.
# ssh -D 1080 -q -C -N -f user@ssh-server-ip
# -D 1080, opens a SOCKS proxy on local port 1080
# -C, compresses data in the tunnel, saves bandwidth
# -q, quiet mode, don’t output anything locally
# -N, disallows execution of remote commands, useful for just forwarding ports
# -f, forks the process to background
</code></pre>
<p>Then you can configure your client to use the SOCKS proxy. For example, you can configure proxy access to the internet in Firefox from the Setting menu as follows:</p>
<p><img src="https://www.redhat.com/sysadmin/sites/default/files/styles/embed_medium/public/2021-01/firefox-socks-proxy-configuration_0.png?itok=PPO8MGG4"
     alt="Markdown Monster icon"
     style=" display: block; margin-left: auto; margin-right: auto;" 
     width="800" height="900" /></p>
<p>If you need to use this configuration often, you'd better off creating a specific browser profile in the Firefox Settings so that it's not necessary to constantly switch between proxy configurations. A new profile can be created by passing the <code>-P</code> flag to the <code>firefox</code> command, launching the Profile Manager:</p>
<pre><code>$ firefox -P $PROXY_PROFILE_NAME
</code></pre>
<!--
 TODO add a paragraph for X forwarding: e.g., https://www.baeldung.com/linux/forward-x-over-ssh
-->
<hr />
<p>References:</p>
<ul>
<li><a href="https://ma.ttias.be/socks-proxy-linux-ssh-bypass-content-filters/">Create a SOCKS proxy on a Linux server with SSH to bypass content filters</a></li>
<li><a href="https://www.redhat.com/sysadmin/ssh-dynamic-port-forwarding">How to set up SSH dynamic port forwarding on Linux</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h2 id="debugging-corrupted-character-encoding-issues"><a class="header" href="#debugging-corrupted-character-encoding-issues">Debugging corrupted character encoding issues</a></h2>
<p>It may happen that you see corrupted text: scrambled, garbled, or displayed as "garbage" characters. Let's say, your application (server) receives a JSON request with some corrupted chars. For example, it could use a different character encoding (UTF-8 vs. ISO-8859-1) than the client it is communicating with.</p>
<p>It can be useful to generate a <a href="https://www.thethingsnetwork.org/docs/devices/bytes/#what-the-hex">hexadecimal</a> view of such request, usually referred to as <a href="https://en.wikipedia.org/wiki/Hex_dump">hex dump</a>, (using commands like <a href="https://www.suse.com/c/making-sense-hexdump/">hexdump</a>, <code>od</code> or <code>xxd</code>) in order to debug such issues looking at the lower-level representation of a text:</p>
<pre><code>:~$ xxd -p &lt;&lt;&lt;{"badv":[],"bcat":[],"device":{"dnt":0,"geo":{"city":"WICHITA","country":"USA","lat":37.68978,"lon":-97.34148,"metro":"678","region":"KS","type":2,"zip":"67212"},"ip":"68.107.183.251","language":"es","os":"WINDOWS","osv":"WINDOWS7","ua":"Mozilla/5.0 (Windows NT 6.1; WOW64; rv:39.0) Gecko/20100101 Firefox/39.0"},"id":"WpkAxTdf5ThP","imp":[{"banner":{"battr":[],"btype":[],"ext":{},"h":250,"pos":3,"topframe":0,"w":300},"bidfloorcur":"USD","id":"WpkAxTdf5ThP","instl":0,"secure":0,"tagid":"302868"}],"site":{"cat":[],"domain":"diario.mx","id":"100017","keywords":"diari,hrs,york,local,tim,new,nacional,chihuahu,paso,vide,the,reform,duart,ciudad,servic,puent,news,mexican,medi,espectacul,york_tim,new_york,the_new,tim_news,servic_21,news_servic,septiembr_2015,ju�_rez,diari_18,associated_press,victor_orozc","page":"http://diario.mx/Nvo_Casas_Grandes/2015-10-01_f2c710fc/realizan-el-segundo-computo-de-las-candidatas/","pagecat":["IAB20"],"publisher":{"domain":"diario.mx","id":"558393"},"ref":"http://diario.mx/Nvo_Casas_Grandes/"},"tmax":125,"user":{"ext":{},"id":"xutRfr-GoxxU-RAOQ_ehzA"}}| tr -d '\n'
7b626164763a5b5d2c626361743a5b5d2c6465766963653a7b646e743a302c67656f3a7b636974793a574943484954412c636f756e7472793a5553412c6c61743a33372e36383937382c6c6f6e3a2d39372e33343134382c6d6574726f3a3637382c726567696f6e3a4b532c747970653a322c7a69703a36373231327d2c69703a36382e3130372e3138332e3235312c6c616e67756167653a65732c6f733a57494e444f57532c6f73763a57494e444f5753372c75613a4d6f7a696c6c612f352e30202857696e646f7773204e5420362e313b20574f5736343b2072763a33392e3029204765636b6f2f32303130303130312046697265666f782f33392e307d2c69643a57706b4178546466355468502c696d703a5b7b62616e6e65723a7b62617474723a5b5d2c62747970653a5b5d2c6578743a7b7d2c683a3235302c706f733a332c746f706672616d653a302c773a3330307d2c626964666c6f6f726375723a5553442c69643a57706b4178546466355468502c696e73746c3a302c7365637572653a302c74616769643a3330323836387d5d2c736974653a7b6361743a5b5d2c646f6d61696e3a64696172696f2e6d782c69643a3130303031372c6b6579776f7264733a64696172692c6872732c796f726b2c6c6f63616c2c74696d2c6e65772c6e6163696f6e616c2c63686968756168752c7061736f2c766964652c7468652c7265666f726d2c64756172742c6369756461642c7365727669632c7075656e742c6e6577732c6d65786963616e2c6d6564692c6573706563746163756c2c796f726b5f74696d2c6e65775f796f726b2c7468655f6e65772c74696d5f6e6577732c7365727669635f32312c6e6577735f7365727669632c7365707469656d62725f323031352c6a75efbfbd5f72657a2c64696172695f31382c6173736f6369617465645f70726573732c766963746f725f6f726f7a632c706167653a687474703a2f2f64696172696f2e6d782f4e766f5f43617361735f4772616e6465732f323031352d31302d30315f66326337313066632f7265616c697a616e2d656c2d736567756e646f2d636f6d7075746f2d64652d6c61732d63616e646964617461732f2c706167656361743a5b49414232305d2c7075626c69736865723a7b646f6d61696e3a64696172696f2e6d782c69643a3535383339337d2c7265663a687474703a2f2f64696172696f2e6d782f4e766f5f43617361735f4772616e6465732f7d2c746d61783a3132352c757365723a7b6578743a7b7d2c69643a7875745266722d476f7878552d52414f515f65687a417d7d0a
</code></pre>
<p>In this way it's also easier to share or manipulate a piece of text without any additional loss of information.</p>
<p>You can read it back to plain text by using the <code>-r</code> flag:</p>
<pre><code>:~$ xxd -p -r &lt;&lt;&lt; 7b2262616476223a5b5d2c2262636174223a5b5d2c22646576696365223a7b22646e74223a302c2267656f223a7b2263697479223a2257494348495441222c22636f756e747279223a22555341222c226c6174223a33372e36383937382c226c6f6e223a2d39372e33343134382c226d6574726f223a22363738222c22726567696f6e223a224b53222c2274797065223a322c227a6970223a223637323132227d2c226970223a2236382e3130372e3138332e323531222c226c616e6775616765223a226573222c226f73223a2257494e444f5753222c226f7376223a2257494e444f575337222c227561223a224d6f7a696c6c612f352e30202857696e646f7773204e5420362e313b20574f5736343b2072763a33392e3029204765636b6f2f32303130303130312046697265666f782f33392e30227d2c226964223a2257706b417854646635546850222c22696d70223a5b7b2262616e6e6572223a7b226261747472223a5b5d2c226274797065223a5b5d2c22657874223a7b7d2c2268223a3235302c22706f73223a332c22746f706672616d65223a302c2277223a3330307d2c22626964666c6f6f72637572223a22555344222c226964223a2257706b417854646635546850222c22696e73746c223a302c22736563757265223a302c227461676964223a22333032383638227d5d2c2273697465223a7b22636174223a5b5d2c22646f6d61696e223a2264696172696f2e6d78222c226964223a22313030303137222c226b6579776f726473223a2264696172692c6872732c796f726b2c6c6f63616c2c74696d2c6e65772c6e6163696f6e616c2c63686968756168752c7061736f2c766964652c7468652c7265666f726d2c64756172742c6369756461642c7365727669632c7075656e742c6e6577732c6d65786963616e2c6d6564692c6573706563746163756c2c796f726b5f74696d2c6e65775f796f726b2c7468655f6e65772c74696d5f6e6577732c7365727669635f32312c6e6577735f7365727669632c7365707469656d62725f323031352c6a75e35f72657a2c64696172695f31382c6173736f6369617465645f70726573732c766963746f725f6f726f7a63222c2270616765223a22687474703a2f2f64696172696f2e6d782f4e766f5f43617361735f4772616e6465732f323031352d31302d30315f66326337313066632f7265616c697a616e2d656c2d736567756e646f2d636f6d7075746f2d64652d6c61732d63616e646964617461732f222c2270616765636174223a5b224941423230225d2c227075626c6973686572223a7b22646f6d61696e223a2264696172696f2e6d78222c226964223a22353538333933227d2c22726566223a22687474703a2f2f64696172696f2e6d782f4e766f5f43617361735f4772616e6465732f227d2c22746d6178223a3132352c2275736572223a7b22657874223a7b7d2c226964223a227875745266722d476f7878552d52414f515f65687a41227d7d
{"badv":[],"bcat":[],"device":{"dnt":0,"geo":{"city":"WICHITA","country":"USA","lat":37.68978,"lon":-97.34148,"metro":"678","region":"KS","type":2,"zip":"67212"},"ip":"68.107.183.251","language":"es","os":"WINDOWS","osv":"WINDOWS7","ua":"Mozilla/5.0 (Windows NT 6.1; WOW64; rv:39.0) Gecko/20100101 Firefox/39.0"},"id":"WpkAxTdf5ThP","imp":[{"banner":{"battr":[],"btype":[],"ext":{},"h":250,"pos":3,"topframe":0,"w":300},"bidfloorcur":"USD","id":"WpkAxTdf5ThP","instl":0,"secure":0,"tagid":"302868"}],"site":{"cat":[],"domain":"diario.mx","id":"100017","keywords":"diari,hrs,york,local,tim,new,nacional,chihuahu,paso,vide,the,reform,duart,ciudad,servic,puent,news,mexican,medi,espectacul,york_tim,new_york,the_new,tim_news,servic_21,news_servic,septiembr_2015,ju�_rez,diari_18,associated_press,victor_orozc","page":"http://diario.mx/Nvo_Casas_Grandes/2015-10-01_f2c710fc/realizan-el-segundo-computo-de-las-candidatas/","pagecat":["IAB20"],"publisher":{"domain":"diario.mx","id":"558393"},"ref":"http://diario.mx/Nvo_Casas_Grandes/"},"tmax":125,"user":{"ext":{},"id":"xutRfr-GoxxU-RAOQ_ehzA"}}
</code></pre>
<p>Please, note the corrupted char in <code>ju�_rez</code>.</p>
<p>You can test that this JSON is encoded in ISO-8859-1 by using <code>file</code>:</p>
<pre><code>:~$ xxd -p -r &lt;&lt;&lt; 7b2262616476223a5b5d2c2262636174223a5b5d2c22646576696365223a7b22646e74223a302c2267656f223a7b2263697479223a2257494348495441222c22636f756e747279223a22555341222c226c6174223a33372e36383937382c226c6f6e223a2d39372e33343134382c226d6574726f223a22363738222c22726567696f6e223a224b53222c2274797065223a322c227a6970223a223637323132227d2c226970223a2236382e3130372e3138332e323531222c226c616e6775616765223a226573222c226f73223a2257494e444f5753222c226f7376223a2257494e444f575337222c227561223a224d6f7a696c6c612f352e30202857696e646f7773204e5420362e313b20574f5736343b2072763a33392e3029204765636b6f2f32303130303130312046697265666f782f33392e30227d2c226964223a2257706b417854646635546850222c22696d70223a5b7b2262616e6e6572223a7b226261747472223a5b5d2c226274797065223a5b5d2c22657874223a7b7d2c2268223a3235302c22706f73223a332c22746f706672616d65223a302c2277223a3330307d2c22626964666c6f6f72637572223a22555344222c226964223a2257706b417854646635546850222c22696e73746c223a302c22736563757265223a302c227461676964223a22333032383638227d5d2c2273697465223a7b22636174223a5b5d2c22646f6d61696e223a2264696172696f2e6d78222c226964223a22313030303137222c226b6579776f726473223a2264696172692c6872732c796f726b2c6c6f63616c2c74696d2c6e65772c6e6163696f6e616c2c63686968756168752c7061736f2c766964652c7468652c7265666f726d2c64756172742c6369756461642c7365727669632c7075656e742c6e6577732c6d65786963616e2c6d6564692c6573706563746163756c2c796f726b5f74696d2c6e65775f796f726b2c7468655f6e65772c74696d5f6e6577732c7365727669635f32312c6e6577735f7365727669632c7365707469656d62725f323031352c6a75e35f72657a2c64696172695f31382c6173736f6369617465645f70726573732c766963746f725f6f726f7a63222c2270616765223a22687474703a2f2f64696172696f2e6d782f4e766f5f43617361735f4772616e6465732f323031352d31302d30315f66326337313066632f7265616c697a616e2d656c2d736567756e646f2d636f6d7075746f2d64652d6c61732d63616e646964617461732f222c2270616765636174223a5b224941423230225d2c227075626c6973686572223a7b22646f6d61696e223a2264696172696f2e6d78222c226964223a22353538333933227d2c22726566223a22687474703a2f2f64696172696f2e6d782f4e766f5f43617361735f4772616e6465732f227d2c22746d6178223a3132352c2275736572223a7b22657874223a7b7d2c226964223a227875745266722d476f7878552d52414f515f65687a41227d7d | file -i -
/dev/stdin: text/plain; charset=iso-8859-1
</code></pre>
<p>You can read correctly the corrupted char by executing:</p>
<pre><code>:~$ xxd -p -r &lt;&lt;&lt; 7b2262616476223a5b5d2c2262636174223a5b5d2c22646576696365223a7b22646e74223a302c2267656f223a7b2263697479223a2257494348495441222c22636f756e747279223a22555341222c226c6174223a33372e36383937382c226c6f6e223a2d39372e33343134382c226d6574726f223a22363738222c22726567696f6e223a224b53222c2274797065223a322c227a6970223a223637323132227d2c226970223a2236382e3130372e3138332e323531222c226c616e6775616765223a226573222c226f73223a2257494e444f5753222c226f7376223a2257494e444f575337222c227561223a224d6f7a696c6c612f352e30202857696e646f7773204e5420362e313b20574f5736343b2072763a33392e3029204765636b6f2f32303130303130312046697265666f782f33392e30227d2c226964223a2257706b417854646635546850222c22696d70223a5b7b2262616e6e6572223a7b226261747472223a5b5d2c226274797065223a5b5d2c22657874223a7b7d2c2268223a3235302c22706f73223a332c22746f706672616d65223a302c2277223a3330307d2c22626964666c6f6f72637572223a22555344222c226964223a2257706b417854646635546850222c22696e73746c223a302c22736563757265223a302c227461676964223a22333032383638227d5d2c2273697465223a7b22636174223a5b5d2c22646f6d61696e223a2264696172696f2e6d78222c226964223a22313030303137222c226b6579776f726473223a2264696172692c6872732c796f726b2c6c6f63616c2c74696d2c6e65772c6e6163696f6e616c2c63686968756168752c7061736f2c766964652c7468652c7265666f726d2c64756172742c6369756461642c7365727669632c7075656e742c6e6577732c6d65786963616e2c6d6564692c6573706563746163756c2c796f726b5f74696d2c6e65775f796f726b2c7468655f6e65772c74696d5f6e6577732c7365727669635f32312c6e6577735f7365727669632c7365707469656d62725f323031352c6a75e35f72657a2c64696172695f31382c6173736f6369617465645f70726573732c766963746f725f6f726f7a63222c2270616765223a22687474703a2f2f64696172696f2e6d782f4e766f5f43617361735f4772616e6465732f323031352d31302d30315f66326337313066632f7265616c697a616e2d656c2d736567756e646f2d636f6d7075746f2d64652d6c61732d63616e646964617461732f222c2270616765636174223a5b224941423230225d2c227075626c6973686572223a7b22646f6d61696e223a2264696172696f2e6d78222c226964223a22353538333933227d2c22726566223a22687474703a2f2f64696172696f2e6d782f4e766f5f43617361735f4772616e6465732f227d2c22746d6178223a3132352c2275736572223a7b22657874223a7b7d2c226964223a227875745266722d476f7878552d52414f515f65687a41227d7d | iconv -f iso-8859-1 -t utf-8 -
{"badv":[],"bcat":[],"device":{"dnt":0,"geo":{"city":"WICHITA","country":"USA","lat":37.68978,"lon":-97.34148,"metro":"678","region":"KS","type":2,"zip":"67212"},"ip":"68.107.183.251","language":"es","os":"WINDOWS","osv":"WINDOWS7","ua":"Mozilla/5.0 (Windows NT 6.1; WOW64; rv:39.0) Gecko/20100101 Firefox/39.0"},"id":"WpkAxTdf5ThP","imp":[{"banner":{"battr":[],"btype":[],"ext":{},"h":250,"pos":3,"topframe":0,"w":300},"bidfloorcur":"USD","id":"WpkAxTdf5ThP","instl":0,"secure":0,"tagid":"302868"}],"site":{"cat":[],"domain":"diario.mx","id":"100017","keywords":"diari,hrs,york,local,tim,new,nacional,chihuahu,paso,vide,the,reform,duart,ciudad,servic,puent,news,mexican,medi,espectacul,york_tim,new_york,the_new,tim_news,servic_21,news_servic,septiembr_2015,juã_rez,diari_18,associated_press,victor_orozc","page":"http://diario.mx/Nvo_Casas_Grandes/2015-10-01_f2c710fc/realizan-el-segundo-computo-de-las-candidatas/","pagecat":["IAB20"],"publisher":{"domain":"diario.mx","id":"558393"},"ref":"http://diario.mx/Nvo_Casas_Grandes/"},"tmax":125,"user":{"ext":{},"id":"xutRfr-GoxxU-RAOQ_ehzA"}}
</code></pre>
<p>Please, note now the a with tilde in <code>juã_rez</code> correctly encoded.</p>
<p>This conversion is possible because UTF-8 (which is multi-byte) is capable of encoding any Unicode code points, while ISO-8859-1 (which is single-byte) can handle only a subset of them. So, transcoding from ISO-8859-1 to UTF-8 is not a problem. Instead, going backwards from UTF-8 to ISO-8859-1 will cause replacement characters (e.g. �) to appear in the text when unsupported characters are found.</p>
<p>Debugging this kind of issues can be tricky: make sure you know at least the absolute minimum about <a href="https://www.joelonsoftware.com/2003/10/08/the-absolute-minimum-every-software-developer-absolutely-positively-must-know-about-unicode-and-character-sets-no-excuses/">character encoding</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="how-to-test-the-microphone"><a class="header" href="#how-to-test-the-microphone">How to test the microphone</a></h2>
<p>List the available microphone devices on your system:</p>
<pre><code>:~# arecord -l
**** List of CAPTURE Hardware Devices ****
card 0: PCH [HDA Intel PCH], device 0: ALC255 Analog [ALC255 Analog]
  Subdevices: 1/1
  Subdevice #0: subdevice #0
</code></pre>
<p>Select one of the audio-input devices from the list and use it to record a 10-second audio clip to see if it's working:</p>
<pre><code>:~# arecord -f cd -d 10 --device="hw:0,0" /tmp/test-mic.wav
</code></pre>
<p><code>hw:0,0</code> is used to specify which microphone device to use: the first digit specifies the <strong>card</strong>, while the second digit specifies the <strong>device</strong>.</p>
<p>Play what you have just recorded:</p>
<pre><code>:~# aplay /tmp/test-mic.wav
Playing WAVE '/tmp/test-mic.wav' : Signed 16 bit Little Endian, Rate 44100 Hz, Stereo
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="automate-login-via-ssh"><a class="header" href="#automate-login-via-ssh">Automate Login via SSH</a></h2>
<p>You can use <a href="https://linux.die.net/man/1/expect">expect</a> for automating the interaction with CLI prompts. It uses expectations captured in the form of regular expressions, which it can respond to by sending out responses without any user intervention.</p>
<p>Let's say you want to automate the login into a home server for which you have to provide the passphrase of your public key (<code>id_rsa</code>). If so, you just need a simple script like the following:</p>
<pre><code>#!/usr/bin/expect
set timeout 60
spawn ssh YOUR_USERNAME_HERE@[lindex $argv 0]
expect "Are you sure you" {
        send "yes\r"
}
expect "*?assphrase" {
        send "YOUR_PASSWORD_HERE\r"
        }
interact
</code></pre>
<p>In the above script:</p>
<ul>
<li><code>lindex</code> gets the individual elements from a positional argument list
<ul>
<li><code>$argv 0</code> should be the IP address of your server</li>
</ul>
</li>
<li><code>spawn</code> invokes a new process or session</li>
<li><code>expect</code> waits for the spawned process output in the expected pattern</li>
<li><code>send</code> writes to the spawned process' stdin</li>
<li><code>interact</code> gives the control back to the current process so that stdin is sent to the current process, and subsequently, stdout and stderr are returned.</li>
</ul>
<p>If your home server doesn't have a static IP address, you could automate the IP discovery by scanning your own home network with an alias in your <code>.bash_aliases</code>:</p>
<pre><code>alias sshlogin='for ip in $(nmap -sn 192.168.1.1/24 | grep -Po "(?&lt;=Nmap scan report for )\d+\.\d+\.\d+\.\d+"); do ./ABOVE_SCRIPT_NAME.sh $ip; done'
</code></pre>
<blockquote>
<p>Note: Also the generation of such script can be automated with <a href="https://www.baeldung.com/linux/logging-into-ssh-server#3-using-autoexpect">autoexpect</a>.</p>
<p>Note: The script above contains the password in plain text. This can be safe only at home, provided that you really configured your home network and home devices in a secured way that protexts you from any security threats. Using an <a href="https://www.baeldung.com/linux/logging-into-ssh-server#2-using-file-in-encrypted-form">encrypted file</a> to store you password should be much safer.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h2 id="how-to-fix-low-screen-resolution"><a class="header" href="#how-to-fix-low-screen-resolution">How to fix low screen resolution</a></h2>
<p>Sometimes when you connect a device to a monitor (external or integrated), you may experience an unexpected low resolution that you cannot change via system setting GUI of your desktop environment: only lower resolutions could be available.</p>
<p>This can happen especially if you are using a VGA-to-HDMI converter to connect an old pc to a newer monitor. If the comunication is unidirectional, from input (e.g., a mini pc supporting only VGA) to output (e.g. an external monitor supporting only HDMI), the monitor won't be able to send <a href="https://en.wikipedia.org/wiki/Extended_Display_Identification_Data">EDID</a> data packets which containts info regarding its capabilities.</p>
<p>In such cases, you can have to grab the EDID data from another pc connected to this monitor or online, if you are lucky enough to find it.</p>
<p>Firstly, you should verify that the graphic card(s) of your pc can match the recommended resolution of your monitor: typically, 1920x1080 at 60 refresh rate (a standard also know as 1080p, Full HD or FHD,). For Intel cards, see <a href="https://www.intel.com/content/www/us/en/support/articles/000023781/graphics.html">here</a>.</p>
<p>Once this is verified, you may try to just add the the intended resolution (let's tick to the default scenario, i.e. 1920x1080) with <a href="https://www.x.org/releases/X11R7.5/doc/man/man1/xrandr.1.html">xrandr</a>:</p>
<pre><code class="language-bash"># show available resolutions for common display types (VGA, HDMI, etc.)
xrandr
# generate correct params for the target resolution
cvt 1920 1080 60
# pass the above params to the next command
xrandr --newmode "1920x1080_60.00"  173.00  1920 2048 2248 2576  1080 1083 1088 1120 -hsync +vsync
# make available the new resolution for the intended display type
xrandr --addmode VGA-1 "1920x1080_60.00"
xrandr --output VGA-1 --mode "1920x1080_60.00"
# go to the system settings GUI and select the resolution you have just configured if it's not still active after last command is executed
</code></pre>
<p>If this solved your problem, you have just to put these commands in an executable file sourced when the X session starts. Put this file in one of the following directories:</p>
<ul>
<li><code>~/.profile</code></li>
<li><code>/etc/profile.d</code></li>
</ul>
<p>If this did not solve the problem for you, some extra work is needed: you will have to manually retrieve the EDID file and set it in a Xorg config file or append it to the kernel parameters in the boot loader's boot selection menu.</p>
<p>To parse EDID info, install the <a href="https://manpages.ubuntu.com/manpages/jammy/man1/get-edid.1.html">read-edid</a> package: <code>apt install read-edid</code></p>
<p>To retrieve the EDID file, you have two options:</p>
<ul>
<li>find it in the <a href="https://github.com/linuxhw/EDID">EDID repository</a> of the The Linux Hardware Project by searching for the model name of your monitor</li>
<li>grab it from another pc connected to the monitor by running the following command (substitute <code>card1-HDMI-A-1</code> with the <a href="https://en.wikipedia.org/wiki/Direct_Rendering_Manager">DRM</a> device found on this second pc):
<pre><code>:~$ edid-decode &lt;/sys/class/drm/card1-HDMI-A-1/edid
edid-decode (hex):

00 ff ff ff ff ff ff 00 09 d1 51 79 45 54 00 00
1f 1d 01 03 80 35 1e 78 2a 05 61 a7 56 52 9c 27
0f 50 54 a5 6b 80 d1 c0 81 c0 81 00 81 80 a9 c0
b3 00 d1 cf 01 01 02 3a 80 18 71 38 2d 40 58 2c
45 00 0f 28 21 00 00 1e 00 00 00 ff 00 31 38 4b
30 30 30 33 33 30 31 51 0a 20 00 00 00 fd 00 30
4b 1e 53 15 00 0a 20 20 20 20 20 20 00 00 00 fc
00 42 65 6e 51 20 45 57 32 34 38 30 0a 20 01 ba

02 03 44 f1 4f 90 1f 05 14 04 13 03 12 07 16 15
01 06 11 02 23 09 07 07 83 01 00 00 e2 00 d5 68
03 0c 00 30 00 38 44 00 67 d8 5d c4 01 78 80 00
68 1a 00 00 01 01 30 4b e6 e3 05 c3 01 e6 06 05
01 61 5a 26 02 3a 80 18 71 38 2d 40 58 2c 45 00
0f 28 21 00 00 1e 01 1d 00 72 51 d0 1e 20 6e 28
55 00 0f 28 21 00 00 1e 8c 0a d0 8a 20 e0 2d 10
10 3e 96 00 0f 28 21 00 00 18 00 00 00 00 00 e8

----------------

Block 0, Base EDID:
EDID Structure Version &amp; Revision: 1.3
Vendor &amp; Product Identification:
    Manufacturer: BNQ
    Model: 31057
    Serial Number: 21573
    Made in: week 31 of 2019
[...]
</code></pre>
</li>
</ul>
<p>Once you have it, use the first hexadecimal block at the beginning of the output of the command to generate the binary file:</p>
<pre><code class="language-bash">$ HEXSTR="\
00 ff ff ff ff ff ff 00 09 d1 51 79 45 54 00 00\
1f 1d 01 03 80 35 1e 78 2a 05 61 a7 56 52 9c 27\
0f 50 54 a5 6b 80 d1 c0 81 c0 81 00 81 80 a9 c0\
b3 00 d1 cf 01 01 02 3a 80 18 71 38 2d 40 58 2c\
45 00 0f 28 21 00 00 1e 00 00 00 ff 00 31 38 4b\
30 30 30 33 33 30 31 51 0a 20 00 00 00 fd 00 30\
4b 1e 53 15 00 0a 20 20 20 20 20 20 00 00 00 fc\
00 42 65 6e 51 20 45 57 32 34 38 30 0a 20 01 ba";

$ echo -en $(echo "$HEXSTR" | sed -E 's/([0-9abcdef][0-9abcdef])[[:space:]]?/\\x\1/g') &gt; edid.bin
# check that the file is readable
$ edid-decode edid.bin
</code></pre>
<p>In order to apply it only to a specific connector with a specific resolution, <a href="https://wiki.archlinux.org/title/kernel_mode_setting#Forcing_modes_and_EDID">force</a> this kernel mode setting (KMS) by copying the file (<code>edid.bin</code> in the example) into <code>/usr/lib/firmware</code> (create it if it does not exists) with a proper name and parent folder according to the following pattern: <code>CONNECTOR:edid/RESOLUTION.bin</code> (e.g. <code>/usr/lib/firmware/VGA-1:edid/1920x1080.bin</code>).</p>
<p>You now have two options to make this file available to the display manager (e.g. <a href="https://en.wikipedia.org/wiki/Simple_Desktop_Display_Manager">SDDM</a>):</p>
<ul>
<li>adding a config file to the <code>xorg.conf.d</code> directory with the relevant info, as described <a href="https://gist.github.com/hinell/0ebaad01b771a70844204f295aaf03b7#via-xorgconf">here</a></li>
<li>modifying the Linux Kernel parameters to include a directive for reading the EDID file at boot time.</li>
</ul>
<p>The first option is lengthy and requires you to understand how to properly configure <a href="https://wiki.archlinux.org/title/xorg#Configuration">Xorg</a>.</p>
<p>The second is quicker but error-prone, so be extra-careful if going through the following steps:</p>
<ul>
<li>reboot the system, wait for the system to restart and then press and hold the <code>Esc</code> key until the GRUB menu appears</li>
<li>if it doesn't appear at all after multiple retries, chanches are that you must set a longer <a href="https://linuxhint.com/change-grub-timeout-linux/">timeout</a> for the GRUB</li>
<li>press <code>e</code> when the menu appears and add the <code>drm.edid_firmware</code> argument to the end of the line starting with <code>linux</code>:</li>
</ul>
<pre><code class="language-bash">linux /boot/vmlinuz-linux root=UUID=0a3407de-014b-458b-b5c1-848e92a327a3 rw [...] drm.edid_firmware=VGA-1:edid/1920x1080.bin
</code></pre>
<p>Boot the system to verify if the change had the desired effect.</p>
<p>If so, make the change permanent by editing the <code>/etc/default/grub</code> to set <code>GRUB_CMDLINE_LINUX_DEFAULT</code> option to the new parameter (e.g. <code>GRUB_CMDLINE_LINUX_DEFAULT="drm.edid_firmware=VGA-1:edid/your_edid.bin"</code>) and then regenerating the GRUB config with: <code>grub-mkconfig -o /boot/grub/grub.cfg</code>.</p>
<p>Reboot to verify that the change works across system restarts.</p>
<hr />
<p>References:</p>
<ul>
<li><a href="https://askubuntu.com/questions/1075157/unable-to-set-my-screen-resolution-higher">Unable to set my screen resolution higher</a></li>
<li><a href="https://gist.github.com/hinell/0ebaad01b771a70844204f295aaf03b7#via-xorgconf">Fix Broken EDID Guide</a></li>
<li><a href="https://wiki.debian.org/RepairEDID">RepairEDID</a></li>
<li><a href="https://wiki.archlinux.org/title/Kernel_parameters">Kernel parameters</a></li>
<li><a href="https://wiki.archlinux.org/title/kernel_mode_setting#Forcing_modes_and_EDID">Kernel mode setting</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h2 id="non-free-firmware-for-debian"><a class="header" href="#non-free-firmware-for-debian">Non-Free Firmware for Debian</a></h2>
<p>After installing, you may need to install non-free firmware to get the drivers required by your hardware: e.g. to enable wireless connection.</p>
<p>First, allow apt to download packages from contrib and non-free sources:</p>
<pre><code class="language-bash">apt-add-repository contrib
apt-add-repository non-free
</code></pre>
<p>Add some common firmware:</p>
<pre><code>apt install firmware-linux-nonfree
apt install firmware-misc-nonfree
# if you have Realtek hardware in your machine
apt install firmware-realtek
</code></pre>
<p>For the specific wifi drivers you need, read the Debian docs online. For example, for Intel cards you will need <a href="https://wiki.debian.org/iwlwifi">iwlwifi</a>:</p>
<pre><code>apt update &amp;&amp; apt install firmware-iwlwifi
# reload kernel module
modprobe -r iwlwifi ; modprobe iwlwifi
</code></pre>
<p>For nvidia GPUs, use <code>nvidia-detect</code> to find out the appropriate drivers, e.g.:</p>
<pre><code>apt install nvidia-driver
</code></pre>
<p>Check if the nvidia modules are loaded with <code>lsmod | grep nvidia</code>. If not, verify that you had already disabled Secure/Fast Boot in the BIOS/UEFI settings.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="how-to-fix-nvidia-graphics-card-problems"><a class="header" href="#how-to-fix-nvidia-graphics-card-problems">How to fix Nvidia graphics card problems</a></h2>
<p>Unfortunately the FOSS project <a href="https://wiki.archlinux.org/title/nouveau">nouveau</a> is long from being able to replace the infamous proprietary nvidia drivers. Chances are you are going to install them to have basic stuff working, such as simply connecting an external monitor to your laptop.</p>
<p>See the article on <a href="7-bonus-miscellanea/./debian.html">non-free firmware</a> to understand how to install them.</p>
<p>The drivers aren't going to completely save your time, tough.</p>
<p>In fact, even if they blacklist nouveau, to configure a dual-monitor setup with your desktop environment you may need anyway to:</p>
<ol>
<li>force the appropriate kernel modules to be loaded at boot-time in the kernel boot parameters</li>
</ol>
<pre><code class="language-bash">nvidia-drm.modeset=1
</code></pre>
<ol start="2">
<li>and, after rebooting, do some magic trick with xrandr:</li>
</ol>
<pre><code class="language-bash">xrandr --setprovideroutputsource NVIDIA-G0 modesetting &amp;&amp; xrandr --auto
</code></pre>
<p>as explained in the nvidia <a href="http://download.nvidia.com/XFree86/Linux-x86_64/450.80.02/README/randr14.html">documentation</a>.</p>
<p>If in trouble, consult or ask for help in their online <a href="https://forums.developer.nvidia.com/c/gpu-graphics/linux/148">forum</a> and study <a href="https://wiki.archlinux.org/title/xorg">Xorg</a> and the related tooling.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="recover-from-a-failed-installation"><a class="header" href="#recover-from-a-failed-installation">Recover from a failed installation</a></h2>
<p>For some reasons the installation process may fail unexpectedly leaving the system in an inconsistent state.</p>
<p>At reboot you will be presented with the <a href="https://wiki.archlinux.org/title/GRUB#Using_the_command_shell">GRUB shell</a>.</p>
<p>To rebooting from the USB stick and retry the installation you will have to manually locate the GRUB EFI binary (grubx64.efi) and boot from this file.</p>
<p>In order to do so, type <code>ls</code> to list all the devices in the system:</p>
<pre><code>grub&gt; ls
(hd0) (hd0,msdos1) (hd1) (hd1,gpt2) (hd1,gpt1) (cd0,msdos1)
</code></pre>
<blockquote>
<p>Note: The keyboard layout may be different from the usual one (default is US English). You will need to guess where is the character you need.</p>
</blockquote>
<p>Inspect every device to find the EFI path (i.e. /efi/boot/grubx64.efi):</p>
<pre><code>grub&gt; ls (cd0,msdos1)/
efi
grub&gt; ls (cd0,msdos1)/EFI
boot
grub&gt; ls (cd0,msdos1)/EFI/boot
grubx64.efi
</code></pre>
<p>Once done, <a href="https://www.gnu.org/software/grub/manual/grub/html_node/Chain_002dloading.html">chain-load</a> the bootloader at this path:</p>
<pre><code>grub&gt; chainloader /efi/boot/grubx64.efi
</code></pre>
<p>Then, simply boot into it:</p>
<pre><code>grub&gt; boot
</code></pre>
<p>The installer will opens up once again and you will be able to restart the installation from scratch.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="mapping-hosts-and-ports-locally"><a class="header" href="#mapping-hosts-and-ports-locally">Mapping Hosts and Ports Locally</a></h2>
<p>Add an entry to <a href="https://linux.die.net/man/5/hosts"><code>/etc/hosts</code></a> mapping a given domain name to <code>127.0.0.1</code>:</p>
<pre><code class="language-bash">$ head -n3 /etc/hosts
127.0.0.1	localhost
127.0.1.1	yourmachinehostname.homenet.isp.com
127.0.0.1	registry.io
</code></pre>
<p>Usually this is the first source (it depends on your Name Service Switch (<a href="https://linux.die.net/man/5/nsswitch.conf">NSS</a>) configuration file, <code>/etc/nsswitch.conf</code>) checked by an application that needs to perform name resolution via C library routines such as <a href="https://linux.die.net/man/3/getaddrinfo">getaddrinfo</a>. The next step should be sending DNS queries to the servers listed in the <a href="https://linux.die.net/man/5/resolv.conf">/etc/resolv.conf</a> file.</p>
<blockquote>
<p>Note: some programming languages as <a href="https://pkg.go.dev/net#hdr-Name_Resolution">Go</a> can use a custom resolver with their own logic as well.</p>
</blockquote>
<p>This works fine but if you want to redirect the traffic to a specific port, you will also need to setup a reverse proxy: you can configure the Apache HTTP Server (with the <a href="https://httpd.apache.org/docs/2.4/mod/mod_rewrite.html">mod_rewrite</a> module) or <code>nginx</code> (with the <a href="https://docs.nginx.com/nginx/admin-guide/web-server/reverse-proxy/">proxy_pass</a> directive) to proxy the incoming requests to the right destination port.</p>
<p>To configure nginx, you could put the snippet below in <code>/etc/nginx/conf.d/registry.conf</code>:</p>
<pre><code class="language-nginx">server {
    listen 80;

    server_name registry.io;

    location / {
        proxy_pass http://127.0.0.1:5000/;
    }
}
</code></pre>
<p>And you would be able to redirect <code>registry.io</code> to <code>127.0.0.1:5000</code>:</p>
<pre><code class="language-bash">$ curl http://registry.io/v2/_catalog
{"repositories":["debian","alpine"]}
</code></pre>
<hr />
<p>If all you need is just to make a simple HTTP call for a one-shot test, you can instruct <a href="https://everything.curl.dev/usingcurl/connections/name">curl</a> to resolve a hostname to specific IP address:</p>
<pre><code class="language-bash">$ curl --resolve registry.io:5000:127.0.0.1 http://registry.io:5000/v2/_catalog
{"repositories":["debian","alpine"]}
</code></pre>
<p>In fact, the documentation for the flag says:</p>
<pre><code>--resolve &lt;[+]host:port:addr[,addr]...&gt;
    Provide  a  custom  address  for a specific host and port pair. Using this, you can make the curl requests(s) use a specified address and prevent the otherwise normally resolved address to be used. Consider it a sort of /etc/hosts alternative provided on the command line. The port number should be the number used for the specific protocol the host will be used for. It means you need several entries if you want to provide address for the same host but different ports.
</code></pre>
<p>It even allows you to specify both a replacement name and a port number when a specific name and port number is used to connect:</p>
<pre><code class="language-bash">curl --connect-to registry.io:80:127.0.0.1:5000 http://registry.io/v2/_catalog
{"repositories":["debian","alpine"]}
</code></pre>
<hr />
<p>Otherwise if you don't want to clutter your hosts file, you can install on your Linux distribution the <a href="https://man7.org/linux/man-pages/man8/nss-myhostname.8.html">nss-myhostname</a> package: it automatically resolves any subdomains of localhost to the <code>127.0.0.1</code>, so that you can simply refer to a server running locally by adding <code>.localhost</code> as a suffix along with its port, e.g.:</p>
<pre><code class="language-bash">$ curl http://registry.localhost:5000/v2/_catalog
{"repositories":["debian","alpine"]}
</code></pre>
<p>In this way (almost) everything works with zero configuration on your local environment, and so it's even better than using <a href="https://www.stevenrombauts.be/2018/01/use-dnsmasq-instead-of-etc-hosts/">dnsmasq</a> which requires a bit of configuration to get the same result.</p>
<p>That said, your are still in need of specifying the target port. You will probably need <code>iptables</code> (or <code>ssh</code>) to setup a port forwarding if that is crucial for you.</p>
<hr />
<p>References:</p>
<ul>
<li><a href="https://httpd.apache.org/docs/2.4/mod/mod_rewrite.html">Apache Module mod_rewrite</a></li>
<li><a href="https://docs.nginx.com/nginx/admin-guide/web-server/reverse-proxy/">NGINX Reverse Proxy</a></li>
<li><a href="https://www.frozentux.net/iptables-tutorial/iptables-tutorial.html">Iptables Tutorial</a></li>
<li><a href="https://everything.curl.dev/usingcurl/connections/name">Name resolve tricks (curl)</a></li>
<li><a href="https://man7.org/linux/man-pages/man8/nss-myhostname.8.html">nss-myhostname(8)</a></li>
<li><a href="https://www.stevenrombauts.be/2018/01/use-dnsmasq-instead-of-etc-hosts/">Use dnsmasq instead of /etc/hosts</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h2 id="tips--tricks"><a class="header" href="#tips--tricks">Tips &amp; tricks</a></h2>
<ol>
<li>
<p>When entering a password in a terminal, if you realize there's a typo, type <code>ctrl + u</code> to undo the password just entered and enter it again.</p>
</li>
<li>
<p>Escaping strings in bash using <code>!:q</code> (TODO)</p>
</li>
<li>
<p>reverse search (TODO)</p>
</li>
<li>
<p>Hiding passwords in scripts (TODO)</p>
</li>
<li>
<p>Create a simple chat with <code>netcat</code> (TODO)</p>
</li>
<li>
<p>Bash allows you to ignore history entries that begin with a space if you set the <code>HISTCONTROL</code> variable to <code>ignorespace</code>. Type a space before a command before running it in the bash shell and the command will run normally, but won't appear in your history if you have this variable enabled. This allows you to keep your history a bit cleaner, choosing to run commands without them appearing in your history. Bash also allows you to ignore duplicate commands that can clutter your history. To do so, set <code>HISTCONTROL</code> to <code>ignoredups</code>. To use both the ignorespace and ignoredups feature, set the <code>HISTCONTROL</code> variable to <code>ignoreboth</code>.</p>
</li>
<li>
<p>Always check if a piece of hardware is compatible with Linux, before buying it. For printers, have a look at this <a href="https://haydenjames.io/finding-linux-compatible-printers/">list</a> or check the <a href="https://www.openprinting.org/printers/">OpenPrinting</a> database. A recent project which aims  help people to collaboratively debug hardware related issues, check for Linux-compatibility and find drivers is <a href="https://linux-hardware.org/">Hardware for Linux</a>. If you are currently not able to write your own printer driver but you have some interest in it, consider starting from <a href="https://openprinting.github.io/documentation/02-designing-printer-drivers">here</a>.</p>
</li>
<li>
<p><a href="https://www.linuxjournal.com/content/more-using-bashs-built-devtcp-file-tcpip">More on Using Bash's Built-in /dev/tcp File (TCP/IP)</a>.</p>
</li>
<li>
<p>Find out neighbours in your local network: <code>sudo nmap -sn 192.168.1.0/24</code></p>
</li>
<li>
<p><a href="https://www.redhat.com/sysadmin/sysadmin-essentials-networking-basics">Learn the networking basics every sysadmin needs to know</a></p>
</li>
<li>
<p>Use floating-point arithmetich in bash: <code>bc &lt;&lt;&lt; 'scale=2; 61/14'</code></p>
</li>
<li>
<p>Encrypt your emails with <a href="https://emailselfdefense.fsf.org/en/">GnuPG</a> to protect yourself from mass surveillance.</p>
</li>
<li>
<p><a href="https://www.cyberciti.biz/faq/linux-check-the-physical-health-of-a-usb-stick-flash-drive/">Check the physical health of a USB stick</a></p>
</li>
<li>
<p><a href="https://labs.ripe.net/author/lorenzo_cogotti/micro-bgp-suite-the-swiss-army-knife-of-routing-analysis/">Micro BGP Suite: The Swiss Army Knife of Routing Analysis</a></p>
</li>
<li>
<p>Capture (unencrypted) HTTP traffic on localhost with nc, e.g.:</p>
</li>
</ol>
<pre><code># listen fon incoming communication on a specific port in a shell
:~$ nc -l 8080
# send a request to this port from another shell in your machine
:~$ curl -X POST -H "Content-Type: application/json" -d '{"hello": "world"}' http://localhost:8080
# return to the main shell to see the received request
:~$ nc -l 8080
POST / HTTP/1.1
Host: localhost:8080
User-Agent: curl/7.68.0
Accept: */*
Content-Type: application/json
Content-Length: 18

{"hello": "world"}
</code></pre>
<ol start="16">
<li>Beware of commands with the same name, especially command shell built-in vs external command as <code>time</code>:</li>
</ol>
<pre><code class="language-bash">:~$ type -a time
time is a shell keyword
time is /usr/bin/time
time is /bin/time
</code></pre>
<p>Use the full path to execute to not execute the built-in command:</p>
<pre><code class="language-bash">/usr/bin/time [OPTIONS] COMMAND [ARG]...
#or
/bin/time [OPTIONS] COMMAND [ARG]...
</code></pre>
<ol start="17">
<li>
<p>Take a screenshot from the command line on a X Window System (with <code>imagemagick</code>): <code>sleep 5; xwd -root | convert xwd:- test.png</code></p>
</li>
<li>
<p>Cat without cat: <code>echo "$(&lt;file.txt)"</code> (credits <a href="https://jarv.org/posts/cat-without-cat/">@jarv</a>)</p>
</li>
<li>
<p>On bash, you can relaunch a command along with its args and flags by using the esclamation mark, e.g.: <code>!gcc</code> will re-execute the last occurence of <code>gcc</code> in the shell history.</p>
</li>
</ol>
<p>20 Again, on bash, <code>!!</code> will re-execute the very last command in shell history. That's very handy, especially when you just forget to prefix a command with <code>sudo</code>: in this case you can simply run <code>sudo !!</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="references"><a class="header" href="#references">References</a></h2>
<ul>
<li><a href="https://training.linuxfoundation.org/training/essentials-of-linux-system-administration/">LFS201 course material</a></li>
<li><a href="https://www.admin.com/">UNIX &amp; LINUX Sysadmin Handbook</a></li>
<li><a href="https://ubuntu.com/server/docs">Ubuntu Server guide</a></li>
<li><a href="https://help.ubuntu.com/community/CommunityHelpWiki">CommunityHelpWiki</a><sup class="footnote-reference" id="fr-1-1"><a href="#footnote-1">1</a></sup></li>
<li><a href="https://www.tecmint.com/category/lfcs/">Tecmint</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials?q=ubuntu">DigitalOcean</a></li>
<li><a href="https://unix.stackexchange.com/">Unix&amp;Linux</a></li>
<li><a href="https://askubuntu.com/">AskUbuntu</a></li>
<li><a href="https://serverfault.com/">ServerFault</a></li>
<li><a href="https://linuxize.com/tags/ubuntu/">Linuxize</a></li>
<li><a href="https://linuxconfig.org/">LinuxConfig</a></li>
<li><a href="https://www.linuxbabe.com/ubuntu">LinuxBabe</a></li>
<li><a href="https://linoxide.com/tag/ubuntu/">LinOxide</a></li>
<li><a href="https://www.howtogeek.com/howto/linux/">HowToGeek</a></li>
<li><a href="https://www.thegeekdiary.com/category/linux/">TheGeekDiary</a></li>
<li><a href="http://cb.vu/unixtoolbox.xhtml">UNIX toolbox</a></li>
<li><a href="archlinux.org">Arch wiki</a></li>
<li><a href="https://www.opsschool.org/unix_101.html">OpsSchool</a></li>
<li><a href="https://debian-handbook.info/browse/stable/">Debian Handbook</a></li>
<li><a href="https://www.skillsoft.com/channel/comptia-linux-44324b71-2c1d-11e7-83d1-dba0327abefc?certificationexam=44424">CompTIA Linux+ (XK0-004) course</a></li>
<li><a href="redhat.com/sysadmin">EnableSysadmin</a></li>
<li><a href="opensource.com">OpenSource</a></li>
</ul>
<hr>
<ol class="footnote-definition"><li id="footnote-1">
<p>beware, not always up to date <a href="#fr-1-1">↩</a></p>
</li>
</ol>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
